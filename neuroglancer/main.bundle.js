/*

 Copyright 2016 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.

 Copyright 2017 Google Inc.
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(m,f,c){m!=Array.prototype&&m!=Object.prototype&&(m[f]=c.value)};$jscomp.getGlobal=function(m){return"undefined"!=typeof window&&window===m?m:"undefined"!=typeof global&&null!=global?global:m};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX="jscomp_symbol_";
$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.symbolCounter_=0;$jscomp.Symbol=function(m){return $jscomp.SYMBOL_PREFIX+(m||"")+$jscomp.symbolCounter_++};
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var m=$jscomp.global.Symbol.iterator;m||(m=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol("iterator"));"function"!=typeof Array.prototype[m]&&$jscomp.defineProperty(Array.prototype,m,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};$jscomp.arrayIterator=function(m){var f=0;return $jscomp.iteratorPrototype(function(){return f<m.length?{done:!1,value:m[f++]}:{done:!0}})};
$jscomp.iteratorPrototype=function(m){$jscomp.initSymbolIterator();m={next:m};m[$jscomp.global.Symbol.iterator]=function(){return this};return m};$jscomp.makeIterator=function(m){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var f=m[Symbol.iterator];return f?f.call(m):$jscomp.arrayIterator(m)};$jscomp.arrayFromIterator=function(m){for(var f,c=[];!(f=m.next()).done;)c.push(f.value);return c};$jscomp.arrayFromIterable=function(m){return m instanceof Array?m:$jscomp.arrayFromIterator($jscomp.makeIterator(m))};
$jscomp.polyfill=function(m,f,c,q){if(f){c=$jscomp.global;m=m.split(".");for(q=0;q<m.length-1;q++){var n=m[q];n in c||(c[n]={});c=c[n]}m=m[m.length-1];q=c[m];f=f(q);f!=q&&null!=f&&$jscomp.defineProperty(c,m,{configurable:!0,writable:!0,value:f})}};$jscomp.polyfill("Number.isNaN",function(m){return m?m:function(f){return"number"===typeof f&&isNaN(f)}},"es6","es3");
$jscomp.polyfill("Number.isFinite",function(m){return m?m:function(f){return"number"!==typeof f?!1:!isNaN(f)&&Infinity!==f&&-Infinity!==f}},"es6","es3");$jscomp.iteratorFromArray=function(m,f){$jscomp.initSymbolIterator();m instanceof String&&(m+="");var c=0,q={next:function(){if(c<m.length){var n=c++;return{value:f(n,m[n]),done:!1}}q.next=function(){return{done:!0,value:void 0}};return q.next()}};q[Symbol.iterator]=function(){return q};return q};
$jscomp.polyfill("Array.prototype.keys",function(m){return m?m:function(){return $jscomp.iteratorFromArray(this,function(f){return f})}},"es6","es3");$jscomp.polyfill("Number.isInteger",function(m){return m?m:function(f){return Number.isFinite(f)?f===Math.floor(f):!1}},"es6","es3");
$jscomp.polyfill("Array.from",function(m){return m?m:function(f,c,q){$jscomp.initSymbolIterator();c=null!=c?c:function(a){return a};var n=[],t=f[Symbol.iterator];if("function"==typeof t)for(f=t.call(f);!(t=f.next()).done;)n.push(c.call(q,t.value));else{t=f.length;for(var a=0;a<t;a++)n.push(c.call(q,f[a]))}return n}},"es6","es3");$jscomp.owns=function(m,f){return Object.prototype.hasOwnProperty.call(m,f)};
$jscomp.polyfill("WeakMap",function(m){function f(a){$jscomp.owns(a,q)||$jscomp.defineProperty(a,q,{value:{}})}function c(a){var b=Object[a];b&&(Object[a]=function(a){f(a);return b(a)})}if(function(){if(!m||!Object.seal)return!1;try{var a=Object.seal({}),b=Object.seal({}),c=new m([[a,2],[b,3]]);if(2!=c.get(a)||3!=c.get(b))return!1;c.delete(a);c.set(b,4);return!c.has(a)&&4==c.get(b)}catch(r){return!1}}())return m;var q="$jscomp_hidden_"+Math.random().toString().substring(2);c("freeze");c("preventExtensions");
c("seal");var n=0,t=function(a){this.id_=(n+=Math.random()+1).toString();if(a){$jscomp.initSymbol();$jscomp.initSymbolIterator();a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};t.prototype.set=function(a,b){f(a);if(!$jscomp.owns(a,q))throw Error("WeakMap key fail: "+a);a[q][this.id_]=b;return this};t.prototype.get=function(a){return $jscomp.owns(a,q)?a[q][this.id_]:void 0};t.prototype.has=function(a){return $jscomp.owns(a,q)&&$jscomp.owns(a[q],this.id_)};t.prototype.delete=
function(a){return $jscomp.owns(a,q)&&$jscomp.owns(a[q],this.id_)?delete a[q][this.id_]:!1};return t},"es6","es3");$jscomp.MapEntry=function(){};
$jscomp.polyfill("Map",function(m){if(!$jscomp.ASSUME_NO_NATIVE_MAP&&function(){if(!m||!m.prototype.entries||"function"!=typeof Object.seal)return!1;try{var a=Object.seal({x:4}),c=new m($jscomp.makeIterator([[a,"s"]]));if("s"!=c.get(a)||1!=c.size||c.get({x:4})||c.set({x:4},"t")!=c||2!=c.size)return!1;var r=c.entries(),v=r.next();if(v.done||v.value[0]!=a||"s"!=v.value[1])return!1;v=r.next();return v.done||4!=v.value[0].x||"t"!=v.value[1]||!r.next().done?!1:!0}catch(p){return!1}}())return m;$jscomp.initSymbol();
$jscomp.initSymbolIterator();var f=new WeakMap,c=function(a){this.data_={};this.head_=t();this.size=0;if(a){a=$jscomp.makeIterator(a);for(var b;!(b=a.next()).done;)b=b.value,this.set(b[0],b[1])}};c.prototype.set=function(a,c){var b=q(this,a);b.list||(b.list=this.data_[b.id]=[]);b.entry?b.entry.value=c:(b.entry={next:this.head_,previous:this.head_.previous,head:this.head_,key:a,value:c},b.list.push(b.entry),this.head_.previous.next=b.entry,this.head_.previous=b.entry,this.size++);return this};c.prototype.delete=
function(a){a=q(this,a);return a.entry&&a.list?(a.list.splice(a.index,1),a.list.length||delete this.data_[a.id],a.entry.previous.next=a.entry.next,a.entry.next.previous=a.entry.previous,a.entry.head=null,this.size--,!0):!1};c.prototype.clear=function(){this.data_={};this.head_=this.head_.previous=t();this.size=0};c.prototype.has=function(a){return!!q(this,a).entry};c.prototype.get=function(a){return(a=q(this,a).entry)&&a.value};c.prototype.entries=function(){return n(this,function(a){return[a.key,
a.value]})};c.prototype.keys=function(){return n(this,function(a){return a.key})};c.prototype.values=function(){return n(this,function(a){return a.value})};c.prototype.forEach=function(a,c){for(var b=this.entries(),l;!(l=b.next()).done;)l=l.value,a.call(c,l[1],l[0],this)};c.prototype[Symbol.iterator]=c.prototype.entries;var q=function(b,c){var l=c&&typeof c;"object"==l||"function"==l?f.has(c)?l=f.get(c):(l=""+ ++a,f.set(c,l)):l="p_"+c;var v=b.data_[l];if(v&&$jscomp.owns(b.data_,l))for(b=0;b<v.length;b++){var p=
v[b];if(c!==c&&p.key!==p.key||c===p.key)return{id:l,list:v,index:b,entry:p}}return{id:l,list:v,index:-1,entry:void 0}},n=function(a,c){var b=a.head_;return $jscomp.iteratorPrototype(function(){if(b){for(;b.head!=a.head_;)b=b.previous;for(;b.next!=b.head;)return b=b.next,{done:!1,value:c(b)};b=null}return{done:!0,value:void 0}})},t=function(){var a={};return a.previous=a.next=a.head=a},a=0;return c},"es6","es3");
$jscomp.checkStringArgs=function(m,f,c){if(null==m)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(f instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return m+""};
$jscomp.polyfill("String.prototype.startsWith",function(m){return m?m:function(f,c){var q=$jscomp.checkStringArgs(this,f,"startsWith");f+="";var n=q.length,t=f.length;c=Math.max(0,Math.min(c|0,q.length));for(var a=0;a<t&&c<n;)if(q[c++]!=f[a++])return!1;return a>=t}},"es6","es3");
$jscomp.polyfill("Set",function(m){if(!$jscomp.ASSUME_NO_NATIVE_SET&&function(){if(!m||!m.prototype.entries||"function"!=typeof Object.seal)return!1;try{var c=Object.seal({x:4}),f=new m($jscomp.makeIterator([c]));if(!f.has(c)||1!=f.size||f.add(c)!=f||1!=f.size||f.add({x:4})!=f||2!=f.size)return!1;var n=f.entries(),t=n.next();if(t.done||t.value[0]!=c||t.value[1]!=c)return!1;t=n.next();return t.done||t.value[0]==c||4!=t.value[0].x||t.value[1]!=t.value[0]?!1:n.next().done}catch(a){return!1}}())return m;
$jscomp.initSymbol();$jscomp.initSymbolIterator();var f=function(c){this.map_=new Map;if(c){c=$jscomp.makeIterator(c);for(var f;!(f=c.next()).done;)this.add(f.value)}this.size=this.map_.size};f.prototype.add=function(c){this.map_.set(c,c);this.size=this.map_.size;return this};f.prototype.delete=function(c){c=this.map_.delete(c);this.size=this.map_.size;return c};f.prototype.clear=function(){this.map_.clear();this.size=0};f.prototype.has=function(c){return this.map_.has(c)};f.prototype.entries=function(){return this.map_.entries()};
f.prototype.values=function(){return this.map_.values()};f.prototype.keys=f.prototype.values;f.prototype[Symbol.iterator]=f.prototype.values;f.prototype.forEach=function(c,f){var n=this;this.map_.forEach(function(t){return c.call(f,t,t,n)})};return f},"es6","es3");$jscomp.polyfill("Object.assign",function(m){return m?m:function(f,c){for(var q=1;q<arguments.length;q++){var n=arguments[q];if(n)for(var t in n)$jscomp.owns(n,t)&&(f[t]=n[t])}return f}},"es6","es3");$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill("Promise",function(m){function f(){this.batch_=null}function c(a){return a instanceof n?a:new n(function(b,c){b(a)})}if(m&&!$jscomp.FORCE_POLYFILL_PROMISE)return m;f.prototype.asyncExecute=function(a){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(a);return this};f.prototype.asyncExecuteBatch_=function(){var a=this;this.asyncExecuteFunction(function(){a.executeBatch_()})};var q=$jscomp.global.setTimeout;f.prototype.asyncExecuteFunction=function(a){q(a,
0)};f.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var a=this.batch_;this.batch_=[];for(var b=0;b<a.length;++b){var c=a[b];delete a[b];try{c()}catch(r){this.asyncThrow_(r)}}}this.batch_=null};f.prototype.asyncThrow_=function(a){this.asyncExecuteFunction(function(){throw a;})};var n=function(a){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var b=this.createResolveAndReject_();try{a(b.resolve,b.reject)}catch(l){b.reject(l)}};n.prototype.createResolveAndReject_=
function(){function a(a){return function(l){c||(c=!0,a.call(b,l))}}var b=this,c=!1;return{resolve:a(this.resolveTo_),reject:a(this.reject_)}};n.prototype.resolveTo_=function(a){if(a===this)this.reject_(new TypeError("A Promise cannot resolve to itself"));else if(a instanceof n)this.settleSameAsPromise_(a);else{a:switch(typeof a){case "object":var b=null!=a;break a;case "function":b=!0;break a;default:b=!1}b?this.resolveToNonPromiseObj_(a):this.fulfill_(a)}};n.prototype.resolveToNonPromiseObj_=function(a){var b=
void 0;try{b=a.then}catch(l){this.reject_(l);return}"function"==typeof b?this.settleSameAsThenable_(b,a):this.fulfill_(a)};n.prototype.reject_=function(a){this.settle_(2,a)};n.prototype.fulfill_=function(a){this.settle_(1,a)};n.prototype.settle_=function(a,b){if(0!=this.state_)throw Error("Cannot settle("+a+", "+b|"): Promise already settled in state"+this.state_);this.state_=a;this.result_=b;this.executeOnSettledCallbacks_()};n.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var a=
this.onSettledCallbacks_,b=0;b<a.length;++b)a[b].call(),a[b]=null;this.onSettledCallbacks_=null}};var t=new f;n.prototype.settleSameAsPromise_=function(a){var b=this.createResolveAndReject_();a.callWhenSettled_(b.resolve,b.reject)};n.prototype.settleSameAsThenable_=function(a,b){var c=this.createResolveAndReject_();try{a.call(b,c.resolve,c.reject)}catch(r){c.reject(r)}};n.prototype.then=function(a,b){function c(a,b){return"function"==typeof a?function(g){try{r(a(g))}catch(d){v(d)}}:b}var r,v,p=new n(function(a,
b){r=a;v=b});this.callWhenSettled_(c(a,r),c(b,v));return p};n.prototype.catch=function(a){return this.then(void 0,a)};n.prototype.callWhenSettled_=function(a,b){function c(){switch(r.state_){case 1:a(r.result_);break;case 2:b(r.result_);break;default:throw Error("Unexpected state: "+r.state_);}}var r=this;null==this.onSettledCallbacks_?t.asyncExecute(c):this.onSettledCallbacks_.push(function(){t.asyncExecute(c)})};n.resolve=c;n.reject=function(a){return new n(function(b,c){c(a)})};n.race=function(a){return new n(function(b,
l){for(var r=$jscomp.makeIterator(a),v=r.next();!v.done;v=r.next())c(v.value).callWhenSettled_(b,l)})};n.all=function(a){var b=$jscomp.makeIterator(a),l=b.next();return l.done?c([]):new n(function(a,v){function p(g){return function(d){k[g]=d;h--;0==h&&a(k)}}var k=[],h=0;do k.push(void 0),h++,c(l.value).callWhenSettled_(p(k.length-1),v),l=b.next();while(!l.done)})};return n},"es6","es3");$jscomp.polyfill("Math.log2",function(m){return m?m:function(f){return Math.log(f)/Math.LN2}},"es6","es3");
$jscomp.polyfill("String.prototype.repeat",function(m){return m?m:function(f){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>f||1342177279<f)throw new RangeError("Invalid count value");f|=0;for(var q="";f;)if(f&1&&(q+=c),f>>>=1)c+=c;return q}},"es6","es3");
$jscomp.polyfill("WeakSet",function(m){if(function(){if(!m||!Object.seal)return!1;try{var c=Object.seal({}),f=Object.seal({}),n=new m([c]);if(!n.has(c)||n.has(f))return!1;n.delete(c);n.add(f);return!n.has(c)&&n.has(f)}catch(t){return!1}}())return m;var f=function(c){this.map_=new WeakMap;if(c){$jscomp.initSymbol();$jscomp.initSymbolIterator();c=$jscomp.makeIterator(c);for(var f;!(f=c.next()).done;)this.add(f.value)}};f.prototype.add=function(c){this.map_.set(c,!0);return this};f.prototype.has=function(c){return this.map_.has(c)};
f.prototype.delete=function(c){return this.map_.delete(c)};return f},"es6","es3");$jscomp.findInternal=function(m,f,c){m instanceof String&&(m=String(m));for(var q=m.length,n=0;n<q;n++){var t=m[n];if(f.call(c,t,n,m))return{i:n,v:t}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.find",function(m){return m?m:function(f,c){return $jscomp.findInternal(this,f,c).v}},"es6","es3");
$jscomp.polyfill("Array.prototype.values",function(m){return m?m:function(){return $jscomp.iteratorFromArray(this,function(f,c){return c})}},"es6","es3");$jscomp.polyfill("Math.sign",function(m){return m?m:function(f){f=Number(f);return 0===f||isNaN(f)?f:0<f?1:-1}},"es6","es3");$jscomp.polyfill("Array.prototype.entries",function(m){return m?m:function(){return $jscomp.iteratorFromArray(this,function(f,c){return[f,c]})}},"es6","es3");
$jscomp.polyfill("Array.prototype.fill",function(m){return m?m:function(f,c,q){var n=this.length||0;0>c&&(c=Math.max(0,n+c));if(null==q||q>n)q=n;q=Number(q);0>q&&(q=Math.max(0,n+q));for(c=Number(c||0);c<q;c++)this[c]=f;return this}},"es6","es3");
$jscomp.polyfill("Array.prototype.copyWithin",function(m){return m?m:function(f,c,q){var n=this.length;f=Number(f);c=Number(c);q=Number(null!=q?q:n);if(f<c)for(q=Math.min(q,n);c<q;)c in this?this[f++]=this[c++]:(delete this[f++],c++);else for(q=Math.min(q,n+c-f),f+=q-c;q>c;)--q in this?this[--f]=this[q]:delete this[f];return this}},"es6","es3");
(function(m){function f(q){if(c[q])return c[q].exports;var n=c[q]={i:q,l:!1,exports:{}};m[q].call(n.exports,n,n.exports,f);n.l=!0;return n.exports}var c={};f.m=m;f.c=c;f.d=function(c,n,t){f.o(c,n)||Object.defineProperty(c,n,{configurable:!1,enumerable:!0,get:t})};f.n=function(c){var n=c&&c.__esModule?function(){return c["default"]}:function(){return c};f.d(n,"a",n);return n};f.o=function(c,f){return Object.prototype.hasOwnProperty.call(c,f)};f.p="";return f(f.s=111)})([function(m,f,c){function q(a,
b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function n(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function t(a,b,c,k){a.addEventListener(b,c,k);return function(){return a.removeEventListener(b,c,k)}}c.d(f,
"c",function(){return t});c.d(f,"a",function(){return b});c.d(f,"b",function(){return l});var a=function(){function a(a,b){for(var k=0;k<b.length;k++){var h=b[k];h.enumerable=h.enumerable||!1;h.configurable=!0;"value"in h&&(h.writable=!0);Object.defineProperty(a,h.key,h)}}return function(b,c,k){c&&a(b.prototype,c);k&&a(b,k);return b}}(),b=function(){function b(){n(this,b);this.refCount=1}a(b,[{key:"addRef",value:function(){++this.refCount;return this}},{key:"dispose",value:function(){0===--this.refCount&&
this.refCountReachedZero()}},{key:"refCountReachedZero",value:function(){this.disposed();var a=this.disposers;if(null!=a){for(var b=a.length;0<b;--b){var k=a[b-1];"object"===typeof k?k.dispose():k.call(this)}this.disposers=void 0}this.wasDisposed=!0}},{key:"disposed",value:function(){}},{key:"registerDisposer",value:function(a){var b=this.disposers;null==b?this.disposers=[a]:b.push(a);return a}},{key:"unregisterDisposer",value:function(a){var b=this.disposers;if(null!=b){var k=b.indexOf(a);-1!==k&&
b.splice(k,1)}return a}},{key:"registerEventListener",value:function(a,b,k,h){this.registerDisposer(t(a,b,k,h))}},{key:"registerCancellable",value:function(a){this.registerDisposer(function(){a.cancel()});return a}}]);return b}(),l=function(a){function b(a){n(this,b);var k=(b.__proto__||Object.getPrototypeOf(b)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");k=!k||"object"!==typeof k&&"function"!==typeof k?this:k;k.value=a;return k}q(b,a);
return b}(b)},function(m,f,c){function q(a,b){var c=Math.abs(a[b]),f=Math.abs(a[b+1]),v=Math.abs(a[b+2]),p=Math.max(c,f,v);1E-4>c/p&&(a[b]=0);1E-4>f/p&&(a[b+1]=0);1E-4>v/p&&(a[b+2]=0)}c.d(f,"b",function(){return t});f.k=function(a){return a[0]*a[1]*a[2]};f.q=function(a){return a[0]+","+a[1]+","+a[2]};f.m=function(a){q(a,0);q(a,4);q(a,8)};f.n=function(a,b,c){var l=b[0],f=b[1];b=b[2];a[0]=c[0]*l+c[4]*f+c[8]*b;a[1]=c[1]*l+c[5]*f+c[9]*b;a[2]=c[2]*l+c[6]*f+c[10]*b;return a};f.c=function(a,b){var c=b[0],
f=b[1],v=b[2],p=b[4],k=b[5],h=b[6],g=b[8],d=b[9];b=b[10];a[0]=Math.sqrt(c*c+f*f+v*v);a[1]=Math.sqrt(p*p+k*k+h*h);a[2]=Math.sqrt(g*g+d*d+b*b);return a};f.o=function(a,b,c,f,v){a[0]=f[0];a[1]=f[1];a[2]=f[2]*v;return n.b.fromRotationTranslationScale(a,c,b,a)};var n=c(69);m=c(11);c.d(f,"i",function(){return n.a});c.d(f,"j",function(){return n.b});c.d(f,"l",function(){return n.c});c.d(f,"p",function(){return n.d});c.d(f,"r",function(){return n.e});c=n.b.create();f.d=c;f.a=["x","y","z"];var t=function b(c,
f){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.lower=c;this.upper=f};c=[n.d.fromValues(1,0,0),n.d.fromValues(0,1,0),n.d.fromValues(0,0,1)];f.e=c;c=n.d.fromValues(0,0,0);f.h=c;c=n.d.fromValues(1,1,1);f.g=c;c=n.d.fromValues(Infinity,Infinity,Infinity);f.f=c;n.c.create();new m.a(1227133513,306783378);new m.a(3272356035,818089008);new m.a(251719695,4027515120);new m.a(4278190335,16711680);new m.a(65535,16711680);new m.a(2097151,0)},function(m,f,c){function q(a){var d=
typeof a;if("number"===d||"string"===d)if(d=parseFloat(""+a),!Number.isNaN(d))return d;throw Error("Expected floating-point number, but received: "+JSON.stringify(a)+".");}function n(a){a=q(a);if(Number.isFinite(a))return a;throw Error("Expected finite floating-point number, but received: "+a+".");}function t(a){a=n(a);if(0<a)return a;throw Error("Expected positive finite floating-point number, but received: "+a+".");}function a(d){if("object"===typeof d){if(null===d)return"null";if(Array.isArray(d)){var e=
"[",b=d.length,g=0;if(g<b)for(e+=a(d[g]);++g<b;)e+=",",e+=a(d[g]);return e+"]"}e="{";b=Object.keys(d).sort();g=0;var h=b.length;if(g<h){var k=b[g];e+=JSON.stringify(k);for(e=e+":"+a(d[k]);++g<h;)e+=",",k=b[g],e+=JSON.stringify(k),e+=":",e+=a(d[k])}return e+"}"}return JSON.stringify(d)}function b(a){return a.replace(/['"]/g,function(a){return'"'===a?"'":'"'})}function l(a){if("object"===typeof a){if(null===a)return"null";var d=a.toJSON;if("function"===typeof d)return l(d.call(a));if(Array.isArray(a)){d=
"[";var e=a.length,g=0;if(g<e)for(d+=l(a[g]);++g<e;)d+="_",d+=l(a[g]);return d+"]"}d="{";g=Object.keys(a);e=!0;g=$jscomp.makeIterator(g);for(var h=g.next();!h.done;h=g.next()){h=h.value;var k=a[h];void 0!==k&&(k=l(k))&&(e?e=!1:d+="_",d+=b(JSON.stringify(b(h))),d+=":",d+=k)}return d+"}"}return"string"===typeof a?b(JSON.stringify(b(a))):JSON.stringify(a)}function r(a,d,e){var b=/[&_,]/g;if('"'===e){var g="'";var h=F;var k=w}else g='"',h=G,k=B;for(var c="";0<a.length;){var p=a.match(k);if(null===p){var l=
a;p=a=""}else{l=a.substr(0,p.index);a=a.substr(p.index+p[0].length);var x=p[1];if(void 0!==x){var D=x,f=g;p=e;x=h;if(2<=D.length&&D.charAt(0)===f&&D.charAt(D.length-1)===f){D=D.substr(1,D.length-2);for(f=p;0<D.length;){var v=D.match(x);if(null===v){f+=D;break}f+=v[1];f+="\\";f+=p;D=D.substr(v.index+v[0].length)}p=f+p}else p=D}else p=p[2]}c+=l.replace(b,d);c+=p}return c}function v(a){return JSON.parse(r(a,",",'"'))}function p(a,d,e){var b=a.length;if(!Array.isArray(d)||d.length!==b)throw Error("Expected length "+
b+" array, but received: "+JSON.stringify(d)+".");for(var g=0;g<b;++g)a[g]=e(d[g],g);return a}function k(a){if("object"!==typeof a||null==a||Array.isArray(a))throw Error("Expected JSON object, but received: "+JSON.stringify(a)+".");return a}function h(a){var d=parseInt(a,10);if(!Number.isInteger(d))throw Error("Expected integer, but received: "+JSON.stringify(a)+".");return d}function g(a){a=h(a);if(0>=a)throw Error("Expected positive integer, but received: "+a+".");return a}function d(a){if("string"!==
typeof a)throw Error("Expected string, but received: "+JSON.stringify(a)+".");return a}f.q=q;f.o=n;f.p=t;f.f=function(a,d,e){e=void 0===e?q:e;k(d);var b=Object.keys(d);b.sort();if(3!==b.length||"x"!==b[0]||"y"!==b[1]||"z"!==b[2])throw Error("Expected object to have keys ['x', 'y', 'z'], but received: "+JSON.stringify(d)+".");a[0]=e(d.x);a[1]=e(d.y);a[2]=e(d.z);return a};f.b=function(a,d){var e=a.length;if(!Array.isArray(d)||d.length!==e)throw Error("Incompatible sizes");for(var b=0;b<e;++b)if(!Number.isFinite(parseFloat(d[b])))throw Error("Non-finite value.");
for(b=0;b<e;++b)a[b]=parseFloat(d[b]);return a};f.d=function(a,d){var e=a.length;if(!Array.isArray(d)||d.length!==e)throw Error("Incompatible sizes.");for(var b=0;b<e;++b){var g=parseInt(d[b],void 0);if(!Number.isInteger(g))throw Error("Non-integer value.");}for(b=0;b<e;++b)a[b]=parseInt(d[b],void 0);return a};f.g=a;f.i=l;f.h=v;f.a=function(a,d){if(!Array.isArray(a))throw Error("Expected array, but received: "+JSON.stringify(a)+".");return a.map(d)};f.c=p;f.u=k;f.s=h;f.A=g;f.t=function(a,d){var e=
d.get(a);if(void 0===e)throw Error("Expected one of "+JSON.stringify(Array.from(d.keys()))+", "+("but received: "+JSON.stringify(a)+"."));return e};f.B=d;f.z=function(a){if(void 0!==a)return d(a)};f.y=function(a){if(void 0!==a)return h(a)};f.x=function(a){if(void 0!==a){if("boolean"===typeof a)return a;if("true"===a)return!0;if("false"===a)return!1;throw Error("Expected string or boolean but received: "+JSON.stringify(a));}};f.w=function(a,d,e){a=a.hasOwnProperty(d)?a[d]:void 0;try{return e(a)}catch(z){throw Error("Error parsing "+
JSON.stringify(d)+" property: "+z.message);}};f.v=function(a,d){k(a);for(var e=new Map,b=$jscomp.makeIterator(Object.keys(a)),g=b.next();!g.done;g=b.next()){g=g.value;try{e.set(g,d(a[g]))}catch(H){throw Error("Error parsing value associated with key "+JSON.stringify(g)+": "+H.message);}}return e};f.r=function(a){if("number"!==typeof a||!Number.isFinite(a)||0>a||1<a)throw Error("Expected floating point number in [0,1], but received: "+JSON.stringify(a)+".");return a};f.e=function(a){if(""===a)return{};
if(a.startsWith("{"))return v(a);var d={};a=a.split(/[&;]/);a=$jscomp.makeIterator(a);for(var e=a.next();!e.done;e=a.next()){e=e.value;var b=e.match(/^([^=&;]+)=([^&;]*)$/);if(null===b)throw Error("Invalid query string part: "+JSON.stringify(e)+".");d[b[1]]=decodeURIComponent(b[2])}return d};f.n=function(a,d){if("string"===typeof a&&null!==a.match(/^[a-zA-Z]/)&&(a=a.toUpperCase(),d.hasOwnProperty(a)))return d[a];throw Error("Invalid enum value: "+JSON.stringify(a)+".");};f.l=function(a){return p(e.p.create(),
a,n)};f.k=function(a){return p(e.p.create(),a,t)};f.j=function(a){return p(e.p.create(),a,g)};f.m=function(a){if("boolean"!==typeof a)throw Error("Expected boolean, received: "+JSON.stringify(a));return a};var e=c(1);m=/('(?:[^'\\]|(?:\\.))*')/;f=/("(?:[^'\\]|(?:\\.))*")/;var w=new RegExp(m.source+"|"+f.source),B=new RegExp(f.source+"|"+m.source),F=/^((?:[^"'\\]|(?:\\.))*)"/,G=/^((?:[^"'\\]|(?:\\.))*)'/},function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function n(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(f,"b",function(){return a});c.d(f,"a",function(){return b});var t=function(){function a(a,b){for(var c=0;c<b.length;c++){var k=b[c];k.enumerable=k.enumerable||!1;k.configurable=!0;"value"in k&&(k.writable=!0);Object.defineProperty(a,
k.key,k)}}return function(b,c,p){c&&a(b.prototype,c);p&&a(b,p);return b}}(),a=function(){function a(){n(this,a);this.handlers=new Set;this.count=0;var b=this;this.dispatch=function(){var a=this,c=arguments;++b.count;b.handlers.forEach(function(b){b.apply(a,c)})}}t(a,[{key:"add",value:function(a){var b=this;this.handlers.add(a);return function(){return b.remove(a)}}},{key:"remove",value:function(a){return this.handlers.delete(a)}},{key:"dispose",value:function(){this.handlers=void 0}}]);return a}(),
b=function(a){function b(){n(this,b);var a=(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==typeof a&&"function"!==typeof a?this:a}q(b,a);return b}(a)},function(m,f,c){f.a=function(c){for(;;){var f=c.firstElementChild;if(!f)break;c.removeChild(f)}};f.b=function(c){var f=c.parentElement;return f?(f.removeChild(c),!0):!1}},function(m,f,c){function q(a,b){if("function"!==typeof b&&
null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function n(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(f,"b",function(){return b});c.d(f,"a",function(){return l});var t=c(3),a=function(){function a(a,b){for(var k=0;k<b.length;k++){var h=
b[k];h.enumerable=h.enumerable||!1;h.configurable=!0;"value"in h&&(h.writable=!0);Object.defineProperty(a,h.key,h)}}return function(b,c,k){c&&a(b.prototype,c);k&&a(b,k);return b}}(),b=function(){function b(a){n(this,b);this.value_=a;this.changed=new t.a}a(b,[{key:"value",get:function(){return this.value_},set:function(a){a!==this.value_&&(this.value_=a,this.changed.dispatch())}}]);return b}(),l=function(b){function c(a,b,h){h=void 0===h?a:h;n(this,c);a=(c.__proto__||Object.getPrototypeOf(c)).call(this,
a);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");a=!a||"object"!==typeof a&&"function"!==typeof a?this:a;a.validator=b;a.defaultValue=h;return a}q(c,b);a(c,[{key:"toJSON",value:function(){if(this.value_!==this.defaultValue)return this.value_}},{key:"reset",value:function(){this.value=this.defaultValue}},{key:"restoreState",value:function(a){if(void 0!==a){var b=this.validator;try{this.value=b(a);return}catch(h){}}this.value=this.defaultValue}}]);return c}(b)},
function(m,f,c){function q(a,d){if(!(a instanceof d))throw new TypeError("Cannot call a class as a function");}function n(a,d){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!d||"object"!==typeof d&&"function"!==typeof d?a:d}function t(a,d){if("function"!==typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function, not "+typeof d);a.prototype=Object.create(d&&d.prototype,{constructor:{value:a,enumerable:!1,writable:!0,
configurable:!0}});d&&(Object.setPrototypeOf?Object.setPrototypeOf(a,d):a.__proto__=d)}function a(a,d){p.set(a,d)}f.e=a;f.d=function(d,e){a(d,function(a){var d=this,g=a.id,h=new b.b;a=e.call(this,a,h);this.set(g,{promise:a,cancellationToken:h});a.then(function(a){var b=a.value;a=a.transfers;d.delete(g);d.invoke("rpc.promise.response",{id:g,value:b},a)},function(a){d.delete(g);d.invoke("rpc.promise.response",{id:g,error:a.message,errorName:a.name})})})};c.d(f,"a",function(){return g});c.d(f,"b",function(){return d});
c.d(f,"c",function(){return e});f.g=function(a){return function(d){d.prototype.RPC_TYPE_ID=a}};f.f=function(a){return function(d){if(void 0!==a)d.prototype.RPC_TYPE_ID=a;else if(a=d.prototype.RPC_TYPE_ID,void 0===a)throw Error("RPC_TYPE_ID should have already been defined");w.set(a,d)}};var b=c(14);m=c(0);var l=function F(a,d,b){null===a&&(a=Function.prototype);var e=Object.getOwnPropertyDescriptor(a,d);if(void 0===e){if(a=Object.getPrototypeOf(a),null!==a)return F(a,d,b)}else{if("value"in e)return e.value;
d=e.get;return void 0===d?void 0:d.call(b)}},r=function(){function a(a,d){for(var b=0;b<d.length;b++){var e=d[b];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(d,b,e){b&&a(d.prototype,b);e&&a(d,e);return d}}(),v=!("undefined"!==typeof Window&&self instanceof Window),p=new Map,k=function(a){function d(a,b){q(this,d);var e=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b));e.name=a;e.message=b;return e}t(d,a);
return d}(Error);a("rpc.promise.cancel",function(a){this.get(a.id).cancellationToken.cancel()});a("rpc.promise.response",function(a){var d=a.id,e=this.get(d),g=e.resolve;e=e.reject;this.delete(d);a.hasOwnProperty("value")?g(a.value):a.errorName===b.a.name?e(b.a):e(new k(a.errorName,a.error))});var h=v?-1:0,g=function(){function a(d){var b=this;q(this,a);this.target=d;this.objects=new Map;this.nextId=h;d.onmessage=function(a){a=a.data;p.get(a.functionName).call(b,a)}}r(a,[{key:"set",value:function(a,
d){this.objects.set(a,d)}},{key:"delete",value:function(a){this.objects.delete(a)}},{key:"get",value:function(a){return this.objects.get(a)}},{key:"getRef",value:function(a){var d=this.get(a.id);d.referencedGeneration=a.gen;d.addRef();return d}},{key:"invoke",value:function(a,d,b){d.functionName=a;this.target.postMessage(d,b)}},{key:"promiseInvoke",value:function(a,d,e,g){var h=this;e=void 0===e?b.e:e;return Object(b.d)(e,function(b,e,k){var w=d.id=h.newId();h.set(w,{resolve:b,reject:e});h.invoke(a,
d,g);k.add(function(){h.invoke("rpc.promise.cancel",{id:w})})})}},{key:"newId",value:function(){return v?this.nextId--:this.nextId++}},{key:"numObjects",get:function(){return this.objects.size}}]);return a}(),d=function(a){function d(){q(this,d);var a=n(this,(d.__proto__||Object.getPrototypeOf(d)).apply(this,arguments));a.rpc=null;a.rpcId=null;return a}t(d,a);r(d,[{key:"initializeSharedObject",value:function(a,d){d=void 0===d?a.newId():d;this.rpc=a;this.rpcId=d;this.isOwner=!1;a.set(d,this)}},{key:"initializeCounterpart",
value:function(a,d){d=void 0===d?{}:d;this.initializeSharedObject(a);this.referencedGeneration=this.unreferencedGeneration=0;this.isOwner=!0;d.id=this.rpcId;d.type=this.RPC_TYPE_ID;a.invoke("SharedObject.new",d)}},{key:"dispose",value:function(){l(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"dispose",this).call(this)}},{key:"addCounterpartRef",value:function(){return{id:this.rpcId,gen:++this.referencedGeneration}}},{key:"refCountReachedZero",value:function(){!0===this.isOwner?this.referencedGeneration===
this.unreferencedGeneration&&this.ownerDispose():!1===this.isOwner?this.rpc.invoke("SharedObject.refCountReachedZero",{id:this.rpcId,gen:this.referencedGeneration}):l(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"refCountReachedZero",this).call(this)}},{key:"ownerDispose",value:function(){var a=this.rpc,b=this.rpcId;l(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"refCountReachedZero",this).call(this);a.delete(b);a.invoke("SharedObject.dispose",{id:b})}},{key:"counterpartRefCountReachedZero",
value:function(a){this.unreferencedGeneration=a;0===this.refCount&&a===this.referencedGeneration&&this.ownerDispose()}}]);return d}(m.a),e=function(a){function d(a,b){b=void 0===b?{}:b;q(this,d);var e=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));b=void 0===b?{}:b;null!=a&&e.initializeSharedObject(a,b.id);return e}t(d,a);return d}(d);a("SharedObject.dispose",function(a){a=this.get(a.id);if(0!==a.refCount)throw Error("Attempted to dispose object with non-zero reference count.");a.disposed();
this.delete(a.rpcId);a.rpcId=null;a.rpc=null});a("SharedObject.refCountReachedZero",function(a){this.get(a.id).counterpartRefCountReachedZero(a.gen)});var w=new Map;a("SharedObject.new",function(a){--(new (w.get(a.type))(this,a)).refCount})},function(m,f,c){c.d(f,"i",function(){return t});f.q=function(a){return(a[3]+1/256*a[2]+1/65536*a[1]+1/16777216*a[0])/256};c.d(f,"g",function(){return a});c.d(f,"f",function(){return r});c.d(f,"h",function(){return v});c.d(f,"d",function(){return p});f.p=function(a,
b){for(var g=0;4>g;++g)a[g]=(b>>8*g&255)/255;return a};f.a=function(a,b){b=void 0===b?1:b;switch(a){case q.b.FLOAT32:if(1===b)return"float";if(1<b&&4>b)return"vec"+b;break;case q.b.UINT8:if(1===b)return"uint8_t";if(1<b&&4>b)return"uint8x"+b+"_t";break;case q.b.UINT16:if(1===b)return"uint16_t";if(2===b)return"uint16x2_t";break;case q.b.UINT32:if(1===b)return"uint32_t";break;case q.b.UINT64:if(1===b)return"uint64_t"}throw Error("No shader type for "+q.b[a]+"["+b+"].");};var q=c(27),n=c(135),t="\nvec4 packFloat01ToFixedPoint(const float value) {\n  const vec4 shift = vec4(256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0);\n  const vec4 mask = vec4(0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0);\n  vec4 result = fract(value * shift);\n  result -= result.xxyz * mask;\n  return result * 256.0 / 255.0;\n}\n",
a="\nvec3 hueToRgb(float hue) {\n  float hue6 = hue * 6.0;\n  float r = abs(hue6 - 3.0) - 1.0;\n  float g = 2.0 - abs(hue6 - 2.0);\n  float b = 2.0 - abs(hue6 - 4.0);\n  return clamp(vec3(r, g, b), 0.0, 1.0);\n}\nvec3 hsvToRgb(vec3 c) {\n  vec3 hueRgb = hueToRgb(c.x);\n  return c.z * ((hueRgb - 1.0) * c.y + 1.0);\n}\n";m=["float","vec2","vec3","vec4"].map(function(a){return"\n"+a+" unnormalizeUint8("+a+" value) {\n  return floor(value * 255.0 + 0.5);\n}\n"}).join("");f.o=m;var b=[m,"\nfloat uintleToFloat(float v) {\n  return unnormalizeUint8(v);\n}\nfloat uintleToFloat(vec2 v) {\n  v = unnormalizeUint8(v);\n  return v.x + v.y * 256.0;\n}\nfloat uintleToFloat(vec3 v) {\n  v = unnormalizeUint8(v);\n  return v.x + v.y * 256.0 + v.z * 256.0 * 256.0;\n}\n"];
f.n=b;var l=[m,"\nfloat uintbeToFloat(float v) {\n  return unnormalizeUint8(v);\n}\nfloat uintbeToFloat(vec2 v) {\n  v = unnormalizeUint8(v);\n  return v.y + v.x * 256.0;\n}\nfloat uintbeToFloat(vec3 v) {\n  v = unnormalizeUint8(v);\n  return v.z + v.y * 256.0 + v.x * 256.0 * 256.0;\n}\n"];(function(){var a=n.a===n.b.BIG?"be":"le";return[n.a===n.b.BIG?l:b,"\nfloat uintToFloat(float v) {\n  return uint"+a+"ToFloat(v);\n}\nfloat uintToFloat(vec2 v) {\n  return uint"+a+"ToFloat(v);\n}\nfloat uintToFloat(vec3 v) {\n  return uint"+
a+"ToFloat(v);\n}\n"]})();f.l="\nstruct uint64_t {\n  vec4 low, high;\n};\nuint64_t toUint64(uint64_t x) { return x; }\n";f.m=[m,"\nstruct uint64_t {\n  vec4 low, high;\n};\nuint64_t toUint64(uint64_t x) { return x; }\n","\nstruct uint8_t {\n  float value;\n};\nstruct uint8x2_t {\n  vec2 value;\n};\nstruct uint8x3_t {\n  vec3 value;\n};\nstruct uint8x4_t {\n  vec4 value;\n};\nfloat toRaw(uint8_t x) { return unnormalizeUint8(x.value); }\nfloat toNormalized(uint8_t x) { return x.value; }\nvec2 toRaw(uint8x2_t x) { return unnormalizeUint8(x.value); }\nvec2 toNormalized(uint8x2_t x) { return x.value; }\nvec3 toRaw(uint8x3_t x) { return unnormalizeUint8(x.value); }\nvec3 toNormalized(uint8x3_t x) { return x.value; }\nvec4 toRaw(uint8x4_t x) { return unnormalizeUint8(x.value); }\nvec4 toNormalized(uint8x4_t x) { return x.value; }\nuint64_t toUint64(uint8_t x) {\n  uint64_t result;\n  result.low = vec4(x.value, 0.0, 0.0, 0.0);\n  result.high = vec4(0.0, 0.0, 0.0, 0.0);\n  return result;\n}\n"];
f.e="\nfloat toRaw(float x) { return x; }\nfloat toNormalized(float x) { return x; }\nvec2 toRaw(vec2 x) { return x; }\nvec2 toNormalized(vec2 x) { return x; }\nvec3 toRaw(vec3 x) { return x; }\nvec3 toNormalized(vec3 x) { return x; }\nvec4 toRaw(vec4 x) { return x; }\nvec4 toNormalized(vec4 x) { return x; }\n";f.j=["\nstruct uint64_t {\n  vec4 low, high;\n};\nuint64_t toUint64(uint64_t x) { return x; }\n",b,"\nstruct uint16_t {\n  vec2 value;\n};\nstruct uint16x2_t {\n  vec4 value;\n};\nfloat toRaw(uint16_t x) { return uintleToFloat(x.value); }\nfloat toNormalized(uint16_t x) { return toRaw(x) / 65535.0; }\nvec2 toRaw(uint16x2_t x) { return vec2(uintleToFloat(x.value.xy), uintleToFloat(x.value.zw)); }\nvec2 toNormalized(uint16x2_t x) { return toRaw(x) / 65535.0; }\nuint64_t toUint64(uint16_t x) {\n  uint64_t result;\n  result.low = vec4(x.value, 0.0, 0.0);\n  result.high = vec4(0.0, 0.0, 0.0, 0.0);\n  return result;\n}\n"];
m=["\nstruct uint64_t {\n  vec4 low, high;\n};\nuint64_t toUint64(uint64_t x) { return x; }\n","\nstruct uint32_t {\n  vec4 value;\n};\nuint64_t toUint64(uint32_t x) {\n  uint64_t result;\n  result.low = x.value;\n  result.high = vec4(0.0, 0.0, 0.0, 0.0);\n  return result;\n}\n"];f.k=m;var r=["\nvec3 getSubscriptsFromNormalized(vec3 normalizedPosition, vec3 size) {\n  return floor(min(normalizedPosition * size, size - 1.0));\n}\n","\nfloat getFortranOrderIndex(vec3 subscripts, vec3 size) {\n  return subscripts.x + size.x * (subscripts.y + size.y * subscripts.z);\n}\n",
"\nfloat getFortranOrderIndexFromNormalized(vec3 normalizedPosition, vec3 size) {\n  return getFortranOrderIndex(getSubscriptsFromNormalized(normalizedPosition, size), size);\n}\n"],v="\nfloat imod(float x, float y) {\n  return x - y * floor(x / y);\n}\n",p="\nfloat exactDot(vec4 a, vec4 b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2] + a[3] * b[3];\n}\nfloat exactDot(vec3 a, vec3 b) {\n  return a[0] * b[0] + a[1] * b[1] + a[2] * b[2];\n}\n";f.b=[m,"\nuint32_t add(uint32_t a, uint32_t b) {\n  uint32_t result;\n  float partial = 0.0;\n\n  partial += a.value.x * 255.0 + b.value.x * 255.0;\n  {\n    float byte0 = mod(partial, 256.0);\n    result.value.x = byte0 / 255.0;\n    partial = (partial - byte0) / 256.0;\n  }\n\n  partial += a.value.y * 255.0 + b.value.y * 255.0;\n  {\n    float byte1 = mod(partial, 256.0);\n    result.value.y = byte1 / 255.0;\n    partial = (partial - byte1) / 256.0;\n  }\n\n  partial += a.value.z * 255.0 + b.value.z * 255.0;\n  {\n    float byte2 = mod(partial, 256.0);\n    result.value.z = byte2 / 255.0;\n    partial = (partial - byte2) / 256.0;\n  }\n\n  partial += a.value.w * 255.0 + b.value.w * 255.0;\n  {\n    float byte3 = mod(partial, 256.0);\n    result.value.w = byte3 / 255.0;\n    partial = (partial - byte3) / 256.0;\n  }\n  return result;\n}\n"];
f.c=[m,"\nfloat divmod(uint32_t dividend, float divisor, out uint32_t quotient) {\n\n  float partial = dividend.value.w * 255.0;\n  float remainder;\n\n  remainder = mod(partial, divisor);\n  quotient.value.w = (partial - remainder) / divisor / 255.0;\n  partial = remainder * 256.0 + dividend.value.z * 255.0;\n\n  remainder = mod(partial, divisor);\n  quotient.value.z = (partial - remainder) / divisor / 255.0;\n  partial = remainder * 256.0 + dividend.value.y * 255.0;\n\n  remainder = mod(partial, divisor);\n  quotient.value.y = (partial - remainder) / divisor / 255.0;\n  partial = remainder * 256.0 + dividend.value.x * 255.0;\n\n  remainder = mod(partial, divisor);\n  quotient.value.x = (partial - remainder) / divisor / 255.0;\n\n  return remainder;\n}\n"]},
function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"d",function(){return l});c.d(f,"c",function(){return r});var n=c(39),t=c(27),a=c(1);c.d(f,"a",function(){return t.b});var b=function(){function a(a,b){for(var h=0;h<
b.length;h++){var g=b[h];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,k,h){k&&a(b.prototype,k);h&&a(b,h);return b}}(),l;(function(a){a[a.UNKNOWN=0]="UNKNOWN";a[a.IMAGE=1]="IMAGE";a[a.SEGMENTATION=2]="SEGMENTATION"})(l||(l={}));var r=function(c){function p(b){if(!(this instanceof p))throw new TypeError("Cannot call a class as a function");var h=(p.__proto__||Object.getPrototypeOf(p)).call(this,b);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
h=!h||"object"!==typeof h&&"function"!==typeof h?this:h;var g=h.dataType=b.dataType,d=h.numChannels=b.numChannels;h.chunkBytes=Object(a.k)(b.chunkDataSize)*t.a[g]*d;h.compressedSegmentationBlockSize=b.compressedSegmentationBlockSize;return h}q(p,c);b(p,[{key:"toObject",value:function(){return{transform:this.chunkLayout.transform,numChannels:this.numChannels,chunkDataSize:this.chunkDataSize,voxelSize:this.voxelSize,dataType:this.dataType,lowerVoxelBound:this.lowerVoxelBound,upperVoxelBound:this.upperVoxelBound,
lowerClipBound:this.lowerClipBound,upperClipBound:this.upperClipBound,baseVoxelOffset:this.baseVoxelOffset,compressedSegmentationBlockSize:this.compressedSegmentationBlockSize}}}],[{key:"make",value:function(a){return new p(Object.assign({},a,{transform:Object(n.e)(a.transform,a.volumeSourceOptions)}))}},{key:"fromObject",value:function(a){return new p(a)}},{key:"withDefaultCompression",value:function(a){var b=a.compressedSegmentationBlockSize,g=a.dataType,d=a.voxelSize,e=a.transform,k=a.lowerVoxelBound,
c=a.upperVoxelBound;e=Object(n.e)(e,a.volumeSourceOptions);void 0!==b||a.volumeType!==l.SEGMENTATION||g!==t.b.UINT32&&g!==t.b.UINT64||(b=Object(n.f)({voxelSize:d,transform:e,lowerVoxelBound:k,upperVoxelBound:c,maxVoxelsPerChunkLog2:9}));return new p(Object.assign({},a,{compressedSegmentationBlockSize:b,transform:e}))}},{key:"getDefaults",value:function(a){var b=Object.assign({},a,{transform:Object(n.e)(a.transform,a.volumeSourceOptions)});return(void 0===a.chunkDataSizes?Object(n.d)(b):a.chunkDataSizes).map(function(b){return p.withDefaultCompression(Object.assign({},
a,{chunkDataSize:b}))})}}]);return p}(n.c);f.b="volume/RenderLayer"},function(m,f,c){function q(a,d){if(!(a instanceof d))throw new TypeError("Cannot call a class as a function");}function n(a,d){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!d||"object"!==typeof d&&"function"!==typeof d?a:d}function t(a,d){if("function"!==typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function, not "+typeof d);a.prototype=Object.create(d&&
d.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});d&&(Object.setPrototypeOf?Object.setPrototypeOf(a,d):a.__proto__=d)}function a(a,d,b,e){e=void 0===e?{}:e;return r.a.forPromise(new Promise(function(g){g(a.getVolume(d,b,e))}),{initialMessage:"Retrieving metadata for volume "+b+".",delay:!0,errorPrefix:"Error retrieving metadata for volume "+b+": "})}f.d=a;c.d(f,"b",function(){return h});c.d(f,"c",function(){return g});c.d(f,"a",function(){return d});f.e=function(a,d){e.set(a,
d)};f.f=function(a,d){w.set(a,d)};var b=c(12),l=c(8),r=c(26);m=c(0);var v=c(2),p=c(3),k=function(){function a(a,d){for(var b=0;b<d.length;b++){var e=d[b];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(d,b,e){b&&a(d.prototype,b);e&&a(d,e);return d}}(),h=function(a){function d(a,b,e){q(this,d);a=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,a));a.initialSpecification=b;a.manager=e;return a}t(d,a);k(d,[{key:"toJSON",
value:function(){var a=this.layer;if(!a)return this.initialSpecification;a=a.toJSON();this.visible||(a.visible=!1);return a}}]);return d}(b.c),g=function(d){function b(a,d,e,g,h){q(this,b);var k=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));k.dataSourceProvider=a;k.layerManager=d;k.chunkManager=e;k.layerSelectedValues=g;k.voxelSize=h;k.changed=new p.a;k.voxelCoordinatesSet=new p.b;k.registerDisposer(d.layersChanged.add(k.changed.dispatch));k.registerDisposer(d.specificationChanged.add(k.changed.dispatch));
return k}t(b,d);k(b,[{key:"reset",value:function(){this.layerManager.clear()}},{key:"restoreState",value:function(a){Object(v.u)(a);this.layerManager.clear();for(var d=$jscomp.makeIterator(Object.keys(a)),b=d.next();!b.done;b=d.next())b=b.value,this.layerManager.addManagedLayer(this.getLayer(b,a[b]))}},{key:"initializeLayerFromSpec",value:function(d,b){var g=this;d.initialSpecification=b;"string"===typeof b&&(b={source:b});Object(v.u)(b);var h=Object(v.w)(b,"type",v.z);d.visible=Object(v.w)(b,"visible",
function(a){if(void 0===a||!0===a)return!0;if(!1===a)return!1;throw Error("Expected boolean, but received: "+JSON.stringify(a)+".");});var k=d.sourceUrl=Object(v.w)(b,"source",v.z);if(void 0===h){if(void 0===k)throw Error("Either layer 'type' or 'source' URL must be specified.");a(this.dataSourceProvider,this.chunkManager,k).then(function(a){if(-1!==g.layerManager.managedLayers.indexOf(d)){var e=w.get(a.volumeType);if(void 0!==e)d.layer=new e(g,b);else throw Error("Unsupported volume type: "+l.d[a.volumeType]+
".");}})}else if(k=e.get(h),void 0!==k)d.layer=new k(this,b);else throw Error("Unsupported layer type: "+JSON.stringify(h)+".");}},{key:"getLayer",value:function(a,d){a=new h(a,d,this);this.initializeLayerFromSpec(a,d);return a}},{key:"add",value:function(a,d){this.layerManager.addManagedLayer(a,d)}},{key:"toJSON",value:function(){for(var a={},d=0,b=$jscomp.makeIterator(this.layerManager.managedLayers),e=b.next();!e.done;e=b.next()){e=e.value;var g=e.toJSON();null!=g&&(a[e.name]=g,++d)}if(0!==d)return a}},
{key:"setVoxelCoordinates",value:function(a){this.voxelCoordinatesSet.dispatch(a)}},{key:"worker",get:function(){return this.chunkManager.rpc}},{key:"rpc",get:function(){return this.chunkManager.rpc}},{key:"rootLayers",get:function(){return this.layerManager}}]);return b}(m.a),d=function(a){function d(a){q(this,d);var e=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));e.master=a;e.changed=new p.a;e.layerManager=new b.a;e.registerDisposer(a);a=e.layerManager;e.registerDisposer(a.layersChanged.add(e.changed.dispatch));
e.registerDisposer(a.specificationChanged.add(e.changed.dispatch));return e}t(d,a);k(d,[{key:"reset",value:function(){this.layerManager.clear()}},{key:"restoreState",value:function(a){var d=this.master.layerManager,b=[];a=$jscomp.makeIterator(new Set(Object(v.a)(a,v.B)));for(var e=a.next();!e.done;e=a.next()){e=e.value;var g=d.getLayerByName(e);if(void 0===g)throw Error("Undefined layer referenced in subset specification: "+JSON.stringify(e));b.push(g)}this.layerManager.clear();d=$jscomp.makeIterator(b);
for(b=d.next();!b.done;b=d.next())this.layerManager.addManagedLayer(b.value.addRef())}},{key:"toJSON",value:function(){return this.layerManager.managedLayers.map(function(a){return a.name})}},{key:"initializeLayerFromSpec",value:function(a,d){this.master.initializeLayerFromSpec(a,d)}},{key:"getLayer",value:function(a,d){return this.master.getLayer(a,d)}},{key:"add",value:function(a,d){-1===this.master.layerManager.managedLayers.indexOf(a)&&(a.name=this.master.layerManager.getUniqueLayerName(a.name),
this.master.layerManager.addManagedLayer(a.addRef()));this.layerManager.addManagedLayer(a,d)}},{key:"setVoxelCoordinates",value:function(a){this.master.setVoxelCoordinates(a)}},{key:"voxelCoordinatesSet",get:function(){return this.master.voxelCoordinatesSet}},{key:"worker",get:function(){return this.master.rpc}},{key:"rpc",get:function(){return this.master.rpc}},{key:"dataSourceProvider",get:function(){return this.master.dataSourceProvider}},{key:"chunkManager",get:function(){return this.master.chunkManager}},
{key:"voxelSize",get:function(){return this.master.voxelSize}},{key:"layerSelectedValues",get:function(){return this.master.layerSelectedValues}},{key:"rootLayers",get:function(){return this.master.rootLayers}}]);return d}(m.a),e=new Map,w=new Map},function(m,f,c){function q(a,d){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!d||"object"!==typeof d&&"function"!==typeof d?a:d}function n(a,d){if("function"!==typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function, not "+
typeof d);a.prototype=Object.create(d&&d.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});d&&(Object.setPrototypeOf?Object.setPrototypeOf(a,d):a.__proto__=d)}function t(a,d){if(!(a instanceof d))throw new TypeError("Cannot call a class as a function");}function a(a){if("number"!==typeof a||0>a)throw Error("Expected non-negative number as limit, but received: "+JSON.stringify(a));return a}c.d(f,"b",function(){return B});c.d(f,"a",function(){return F});c.d(f,"d",function(){return G});
c.d(f,"c",function(){return A});c.d(f,"e",function(){return x});f.f=function(a,b){a=function(a){function b(a){for(var d=[],e=0;e<arguments.length;++e)d[e-0]=arguments[e];t(this,b);var g;e=q(this,(g=b.__proto__||Object.getPrototypeOf(b)).call.apply(g,[].concat([this],$jscomp.arrayFromIterable(d))));e.parameters=d[1].parameters;return e}n(b,a);e(b,[{key:"initializeCounterpart",value:function(a,e){e.parameters=this.parameters;d(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"initializeCounterpart",
this).call(this,a,e)}}],[{key:"encodeOptions",value:function(a){var e=d(b.__proto__||Object.getPrototypeOf(b),"encodeOptions",this).call(this,a);e.parameters=a.parameters;return e}}]);return b}(a);return a=w([Object(g.g)(b.RPC_ID)],a)};var b=c(23),l=c(45),r=c(5),v=c(2),p=c(46),k=c(19),h=c(3),g=c(6),d=function z(a,d,b){null===a&&(a=Function.prototype);var e=Object.getOwnPropertyDescriptor(a,d);if(void 0===e){if(a=Object.getPrototypeOf(a),null!==a)return z(a,d,b)}else{if("value"in e)return e.value;
d=e.get;return void 0===d?void 0:d.call(b)}},e=function(){function a(a,d){for(var b=0;b<d.length;b++){var e=d[b];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(d,b,e){b&&a(d.prototype,b);e&&a(d,e);return d}}(),w=this&&this.__decorate||function(a,d,b,e){var g=arguments.length,h=3>g?d:null===e?e=Object.getOwnPropertyDescriptor(d,b):e,k;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)h=Reflect.decorate(a,
d,b,e);else for(var c=a.length-1;0<=c;c--)if(k=a[c])h=(3>g?k(h):3<g?k(d,b,h):k(d,b))||h;return 3<g&&h&&Object.defineProperty(d,b,h),h},B=function(){function a(d){t(this,a);this.source=d;this.state=b.d.SYSTEM_MEMORY}e(a,[{key:"copyToGPU",value:function(a){this.state=b.d.GPU_MEMORY}},{key:"freeGPUMemory",value:function(a){this.state=b.d.SYSTEM_MEMORY}},{key:"gl",get:function(){return this.source.gl}}]);return a}(),F=function C(d){var b=void 0===d?{}:d;d=void 0===b.defaultItemLimit?Number.POSITIVE_INFINITY:
b.defaultItemLimit;b=void 0===b.defaultSizeLimit?Number.POSITIVE_INFINITY:b.defaultSizeLimit;t(this,C);this.sizeLimit=new r.a(b,a);this.itemLimit=new r.a(d,a)},G=function(a){function d(a,b,e){t(this,d);var g=q(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));g.gl=b;g.capacities=e;g.visibleChunksChanged=new h.a;g.pendingChunkUpdates=null;g.pendingChunkUpdatesTail=null;g.chunkUpdateDeadline=null;g.chunkUpdateDelay=30;b=function(d){return{itemLimit:g.registerDisposer(l.a.makeFromExisting(a,d.itemLimit)).rpcId,
sizeLimit:g.registerDisposer(l.a.makeFromExisting(a,d.sizeLimit)).rpcId}};g.initializeCounterpart(a,{gpuMemoryCapacity:b(e.gpuMemory),systemMemoryCapacity:b(e.systemMemory),downloadCapacity:b(e.download)});return g}n(d,a);e(d,[{key:"scheduleChunkUpdate",value:function(){var a=this.chunkUpdateDeadline;a=null===a||Date.now()<a?0:this.chunkUpdateDelay;setTimeout(this.processPendingChunkUpdates.bind(this),a)}},{key:"processPendingChunkUpdates",value:function(){var a=this.chunkUpdateDeadline;null===a&&
(a=Date.now()+30);for(var d=!1;;){if(Date.now()>a){setTimeout(this.processPendingChunkUpdates.bind(this),this.chunkUpdateDelay);break}var e=this.pendingChunkUpdates,g=this.rpc.get(e.source);if(void 0===e.id){d=$jscomp.makeIterator(g.chunks.keys());for(var h=d.next();!h.done;h=d.next())g.deleteChunk(h.value);d=!0}else if(h=e.state,h===b.d.EXPIRED)g.deleteChunk(e.id);else{var k=e.id;if(e["new"]){var c=g.getChunk(e);g.addChunk(k,c)}else c=g.chunks.get(k);if(h!==c.state)switch(h){case b.d.GPU_MEMORY:c.copyToGPU(this.gl);
d=!0;break;case b.d.SYSTEM_MEMORY:c.freeGPUMemory(this.gl);break;default:throw Error("INTERNAL ERROR: Invalid chunk state: "+b.d[h]);}}e=this.pendingChunkUpdates=e.nextUpdate;--window.numPendingChunkUpdates;if(null==e){this.pendingChunkUpdatesTail=null;break}}d&&this.visibleChunksChanged.dispatch()}}]);return d}(g.b);G=w([Object(g.g)(b.b)],G);window.numPendingChunkUpdates=0;Object(g.e)("Chunk.update",function(a){var d=this.get(a.source).chunkManager.chunkQueueManager,b=d.pendingChunkUpdatesTail;++window.numPendingChunkUpdates;
null==b?(d.pendingChunkUpdates=a,d.pendingChunkUpdatesTail=a,d.scheduleChunkUpdate()):(b.nextUpdate=a,d.pendingChunkUpdatesTail=a)});var A=function(a){function d(a){t(this,d);var b=q(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));b.chunkQueueManager=a;b.memoize=new p.b;b.registerDisposer(a.addRef());b.initializeCounterpart(a.rpc,{chunkQueueManager:a.rpcId});return b}n(d,a);e(d,[{key:"getChunkSource",value:function(a,d){var b=this,e=a.encodeOptions(d);e.constructorId=Object(k.a)(a);e=Object(v.g)(e);
return this.memoize.get(e,function(){var e=new a(b,d);e.initializeCounterpart(b.rpc,{});return e})}},{key:"gl",get:function(){return this.chunkQueueManager.gl}}]);return d}(g.b);A=w([Object(g.g)(b.a)],A);var x=function(a){function g(a,d){t(this,g);d=q(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));d.chunkManager=a;d.chunks=new Map;return d}n(g,a);e(g,[{key:"initializeCounterpart",value:function(a,b){b.chunkManager=this.chunkManager.rpcId;d(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),
"initializeCounterpart",this).call(this,a,b)}},{key:"deleteChunk",value:function(a){var d=this.chunks.get(a);d.state===b.d.GPU_MEMORY&&d.freeGPUMemory(this.gl);this.chunks.delete(a)}},{key:"addChunk",value:function(a,d){this.chunks.set(a,d)}},{key:"getChunk",value:function(a){throw Error("Not implemented.");}},{key:"invalidateCache",value:function(){this.rpc.invoke(b.c,{id:this.rpcId})}},{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}}],[{key:"encodeOptions",value:function(a){return{}}}]);
return g}(g.b)},function(m,f,c){c.d(f,"a",function(){return r});var q=function(){function a(a,b){for(var h=0;h<b.length;h++){var g=b[h];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,k,h){k&&a(b.prototype,k);h&&a(b,h);return b}}(),n=new Uint32Array(2),t=[];for(m=2;36>=m;++m){f=Math.floor(32/Math.log2(m));c=Math.pow(m,f);var a=Math.floor(f/2),b=Math.pow(m,a);a=Math.pow(m,f-a);var l="^[0-"+String.fromCharCode(48+Math.min(9,
m-1));10<m&&(l+="a-"+String.fromCharCode(97+m-11),l+="A-"+String.fromCharCode(65+m-11));l+="]{1,"+Math.ceil(64/Math.log2(m))+"}$";t[m]={lowDigits:f,lowBase:c,lowBase1:b,lowBase2:a,pattern:new RegExp(l)}}var r=function(){function a(b,k){b=void 0===b?0:b;k=void 0===k?0:k;if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.low=b;this.high=k}q(a,[{key:"clone",value:function(){return new a(this.low,this.high)}},{key:"assign",value:function(a){this.low=a.low;this.high=
a.high}},{key:"toString",value:function(a){a=void 0===a?10:a;var b=this.low,h=this.high;if(0===h)return b.toString(a);h*=4294967296;var g=t[a],d=g.lowBase;g=g.lowDigits;var e=h%d;h=Math.floor(h/d);b+=e;h+=Math.floor(b/d);b=(b%d).toString(a);return h.toString(a)+"0".repeat(g-b.length)+b}},{key:"tryParseString",value:function(a,b){b=void 0===b?10:b;var h=t[b],g=h.lowDigits,d=h.lowBase,e=h.lowBase1,k=h.lowBase2;if(!h.pattern.test(a))return!1;if(a.length<=g)return this.low=parseInt(a,b),this.high=0,!0;
g=a.length-g;h=parseInt(a.substr(g),b);a=parseInt(a.substr(0,g),b);d=Math.floor(a*d/4294967296);e=h+a%4294967296*e%4294967296*k%4294967296;4294967296<e&&(++d,e-=4294967296);if(e>>>0!==e||d>>>0!==d)return!1;this.low=e;this.high=d;return!0}},{key:"parseString",value:function(a,b){if(!this.tryParseString(a,void 0===b?10:b))throw Error("Failed to parse string as uint64 value: "+JSON.stringify(a)+".");return this}},{key:"valid",value:function(){var a=this.low,b=this.high;return a>>>0===a&&b>>>0===b}},
{key:"toJSON",value:function(){return this.toString()}},{key:"lshift",value:function(b){b&=63;if(0==b)return this.clone();var c=this.low,h=this.high;return 32>b?new a(c<<b,h<<b|c>>>32-b):new a(0,c<<b-32)}},{key:"rshift",value:function(b){b&=63;if(0==b)return this.clone();var c=this.low,h=this.high;return 32>b?new a(c>>>b|h<<32-b,h>>b):new a(h>>b-32,0<=h?0:-1)}},{key:"or",value:function(b){return new a(this.low|b.low,this.high|b.high)}},{key:"xor",value:function(b){return new a(this.low^b.low,this.high^
b.high)}},{key:"and",value:function(b){return new a(this.low&b.low,this.high&b.high)}}],[{key:"less",value:function(a,b){return a.high<b.high||a.high===b.high&&a.low<b.low}},{key:"compare",value:function(a,b){return a.high-b.high||a.low-b.low}},{key:"equal",value:function(a,b){return a.low===b.low&&a.high===b.high}},{key:"min",value:function(b,c){return a.less(b,c)?b:c}},{key:"random",value:function(){crypto.getRandomValues(n);return new a(n[0],n[1])}},{key:"parseString",value:function(b,c){c=void 0===
c?10:c;return(new a).parseString(b,c)}}]);return a}();r.ZERO=new r(0,0)},function(m,f,c){function q(a,d){if(!(a instanceof d))throw new TypeError("Cannot call a class as a function");}function n(a,d){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!d||"object"!==typeof d&&"function"!==typeof d?a:d}function t(a,d){if("function"!==typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function, not "+typeof d);a.prototype=
Object.create(d&&d.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});d&&(Object.setPrototypeOf?Object.setPrototypeOf(a,d):a.__proto__=d)}c.d(f,"e",function(){return d});c.d(f,"h",function(){return e});c.d(f,"g",function(){return w});c.d(f,"f",function(){return B});c.d(f,"c",function(){return F});c.d(f,"a",function(){return G});c.d(f,"d",function(){return A});c.d(f,"b",function(){return x});f.i=function(a,d,b){return b.registerDisposer(new D(a,d,function(a){var d=a.redrawNeeded.add(function(){return b.scheduleRedraw()});
b.scheduleRedraw();return function(){d();b.scheduleRedraw()}},b.visibility))};m=c(13);var a=c.n(m);m=c(132);var b=c.n(m);m=c(0);var l=c(1),r=c(3),v=c(133),p=c(11),k=c(33),h=function C(a,d,b){null===a&&(a=Function.prototype);var e=Object.getOwnPropertyDescriptor(a,d);if(void 0===e){if(a=Object.getPrototypeOf(a),null!==a)return C(a,d,b)}else{if("value"in e)return e.value;d=e.get;return void 0===d?void 0:d.call(b)}},g=function(){function a(a,d){for(var b=0;b<d.length;b++){var e=d[b];e.enumerable=e.enumerable||
!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(d,b,e){b&&a(d.prototype,b);e&&a(d,e);return d}}(),d=function(a){function d(){q(this,d);var a=n(this,(d.__proto__||Object.getPrototypeOf(d)).apply(this,arguments));a.ready=!1;a.layerChanged=new r.a;a.redrawNeeded=new r.a;a.readyStateChanged=new r.a;a.voxelSize=null;a.boundingBox=null;return a}t(d,a);g(d,[{key:"setReady",value:function(a){this.ready=a;this.readyStateChanged.dispatch();this.layerChanged.dispatch()}},
{key:"handleAction",value:function(a){}},{key:"getValueAt",value:function(a){}},{key:"transformPickedValue",value:function(a,d){return a}},{key:"updateMouseState",value:function(a,d,b){}}]);return d}(m.a),e=function(a){function d(){q(this,d);var a=n(this,(d.__proto__||Object.getPrototypeOf(d)).apply(this,arguments));a.visibility=new k.a;return a}t(d,a);return d}(d),w=function(a){function d(){q(this,d);return n(this,(d.__proto__||Object.getPrototypeOf(d)).apply(this,arguments))}t(d,a);g(d,[{key:"onShow",
value:function(){}},{key:"onHide",value:function(){}}]);return d}(m.a),B=function(a){function d(a){a=void 0===a?[]:a;q(this,d);var b=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));b.layersChanged=new r.a;b.readyStateChanged=new r.a;b.specificationChanged=new r.a;b.renderLayers=[];a.forEach(b.addRenderLayer.bind(b));return b}t(d,a);g(d,[{key:"addRenderLayer",value:function(a){this.renderLayers.push(a);var d=this.layersChanged,b=this.readyStateChanged;this.registerDisposer(a);this.registerDisposer(a.layerChanged.add(d.dispatch));
this.registerDisposer(a.readyStateChanged.add(b.dispatch));b.dispatch();d.dispatch()}},{key:"getValueAt",value:function(a,d){var b=this.renderLayers,e=d.pickedRenderLayer;if(null!==e&&-1!==b.indexOf(e)){var g=e.transformPickedValue(d.pickedValue,d.pickedOffset);return this.transformPickedValue(g)}d=$jscomp.makeIterator(b);for(b=d.next();!b.done&&(b=b.value,!b.ready||(g=b.getValueAt(a),void 0===g));b=d.next());return this.transformPickedValue(g)}},{key:"transformPickedValue",value:function(a){return a}},
{key:"toJSON",value:function(){return null}},{key:"makeDropdown",value:function(a){}},{key:"handleAction",value:function(a){}}]);return d}(m.a),F=function(a){function d(a,b,e){b=void 0===b?null:b;e=void 0===e?!0:e;q(this,d);var g=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));g.name=a;g.visible=e;g.readyStateChanged=new r.a;g.layerChanged=new r.a;g.specificationChanged=new r.a;g.wasDisposed=!1;g.layer_=null;g.layer=b;return g}t(d,a);g(d,[{key:"handleLayerChanged",value:function(){this.visible&&
this.layerChanged.dispatch()}},{key:"setVisible",value:function(a){a!==this.visible&&(this.visible=a,this.layerChanged.dispatch())}},{key:"disposed",value:function(){this.wasDisposed=!0;this.layer=null;h(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"disposed",this).call(this)}},{key:"layer",get:function(){return this.layer_},set:function(a){var d=this,b=this.layer_;null!=b&&(this.unregisterUserLayer(),b.dispose());this.layer_=a;if(null!=a){var e=[a.layersChanged.add(function(){return d.handleLayerChanged()}),
a.readyStateChanged.add(this.readyStateChanged.dispatch),a.specificationChanged.add(this.specificationChanged.dispatch)];this.unregisterUserLayer=function(){e.forEach(function(a){return a()})};this.readyStateChanged.dispatch();this.handleLayerChanged()}}}]);return d}(m.a),G=function(d){function b(){q(this,b);var d=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));d.managedLayers=[];d.layersChanged=new r.a;d.readyStateChanged=new r.a;d.specificationChanged=new r.a;d.boundPositions=new WeakSet;
d.numDirectUsers=0;d.scheduleRemoveLayersWithSingleRef=d.registerCancellable(a()(function(){return d.removeLayersWithSingleRef()},0));d.layersChanged.add(d.scheduleRemoveLayersWithSingleRef);return d}t(b,d);g(b,[{key:"filter",value:function(a){var d=this,b=!1;this.managedLayers=this.managedLayers.filter(function(e){return a(e)?!0:(d.unbindManagedLayer(e),b=!0,!1)});b&&this.layersChanged.dispatch()}},{key:"removeLayersWithSingleRef",value:function(){0<this.numDirectUsers||this.filter(function(a){return 1!==
a.refCount})}},{key:"updateSignalBindings",value:function(a,d){d(a.layerChanged,this.layersChanged.dispatch);d(a.readyStateChanged,this.readyStateChanged.dispatch);d(a.specificationChanged,this.specificationChanged.dispatch)}},{key:"useDirectly",value:function(){var a=this;1===++this.numDirectUsers&&this.layersChanged.remove(this.scheduleRemoveLayersWithSingleRef);return function(){0===--a.numDirectUsers&&(a.layersChanged.add(a.scheduleRemoveLayersWithSingleRef),a.scheduleRemoveLayersWithSingleRef())}}},
{key:"addManagedLayer",value:function(a,d){this.updateSignalBindings(a,v.a);void 0===d&&(d=this.managedLayers.length);this.managedLayers.splice(d,0,a);this.layersChanged.dispatch();this.readyStateChanged.dispatch();return a}},{key:"addUserLayer",value:function(a,d,b){a=new F(a,d,b);return this.addManagedLayer(a)}},{key:"readyRenderLayers",value:function(){function a(a,C){for(;;)switch(d){case 0:w=$jscomp.makeIterator(k.managedLayers),c=w.next();case 1:if(c.done){d=3;break}h=c.value;if(h.visible&&
h.layer){d=4;break}d=2;break;case 4:g=$jscomp.makeIterator(h.layer.renderLayers),e=g.next();case 5:if(e.done){d=7;break}b=e.value;if(b.ready){d=8;break}d=6;break;case 8:return d=9,{value:b,done:!1};case 9:if(void 0===C){d=10;break}d=-1;throw C;case 10:case 6:e=g.next();d=5;break;case 7:case 2:c=w.next();d=1;break;case 3:d=-1;default:return{value:void 0,done:!0}}}var d=0,b,e,g,h,c,w,k=this,C={next:function(d){return a(d,void 0)},throw:function(d){return a(void 0,d)},return:function(a){throw Error("Not yet implemented");
}};$jscomp.initSymbolIterator();C[Symbol.iterator]=function(){return this};return C}},{key:"unbindManagedLayer",value:function(a){this.updateSignalBindings(a,v.b);a.dispose()}},{key:"clear",value:function(){for(var a=$jscomp.makeIterator(this.managedLayers),d=a.next();!d.done;d=a.next())this.unbindManagedLayer(d.value);this.managedLayers.length=0;this.layersChanged.dispatch()}},{key:"remove",value:function(a){this.unbindManagedLayer(this.managedLayers[a]);this.managedLayers.splice(a,1);this.layersChanged.dispatch()}},
{key:"removeManagedLayer",value:function(a){a=this.managedLayers.indexOf(a);if(-1===a)throw Error("Internal error: invalid managed layer.");this.remove(a)}},{key:"reorderManagedLayer",value:function(a,d){var b=this.managedLayers.length;a===d||0>a||a>=b||0>d||d>=b||(a=$jscomp.makeIterator(this.managedLayers.splice(a,1)).next().value,this.managedLayers.splice(d,0,a),this.layersChanged.dispatch())}},{key:"disposed",value:function(){this.clear();h(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),
"disposed",this).call(this)}},{key:"getLayerByName",value:function(a){return this.managedLayers.find(function(d){return d.name===a})}},{key:"getUniqueLayerName",value:function(a){for(var d=a,b=0;void 0!==this.getLayerByName(d);)d=a+ ++b;return d}},{key:"has",value:function(a){return-1!==this.managedLayers.indexOf(a)}},{key:"initializePosition",value:function(d){var b=this,e=this.boundPositions;e.has(d)||(e.add(d),e=a()(function(){b.updatePositionFromLayers(d)}),this.readyStateChanged.add(e),d.changed.add(e),
this.updatePositionFromLayers(d))}},{key:"updatePositionFromLayers",value:function(a){if(!a.valid)for(var d=$jscomp.makeIterator(this.managedLayers),b=d.next();!b.done;b=d.next())if(b=b.value.layer,null!=b){b=$jscomp.makeIterator(b.renderLayers);for(var e=b.next();!e.done;e=b.next())if(e=e.value,e.ready&&(a.voxelSize.valid||null==e.voxelSize||(l.p.copy(a.voxelSize.size,e.voxelSize),a.voxelSize.setValid()),!a.spatialCoordinatesValid&&!a.voxelCoordinatesValid&&null!=e.boundingBox)){e=e.boundingBox;
var g=a.spatialCoordinates;l.p.add(g,e.lower,e.upper);l.p.scale(g,g,.5);a.spatialCoordinatesValid=!0;a.changed.dispatch()}}}},{key:"invokeAction",value:function(a){for(var d=$jscomp.makeIterator(this.managedLayers),b=d.next();!b.done;b=d.next())if(b=b.value,null!==b.layer&&b.visible){b=b.layer;b.handleAction(a);b=$jscomp.makeIterator(b.renderLayers);for(var e=b.next();!e.done;e=b.next())e=e.value,e.ready&&e.handleAction(a)}}},{key:"renderLayers",get:function(){var a=this;$jscomp.initSymbol();$jscomp.initSymbolIterator();
var d={};return d[Symbol.iterator]=function(){function d(d,C){for(;;)switch(b){case 0:k=$jscomp.makeIterator(a.managedLayers),w=k.next();case 1:if(w.done){b=3;break}c=w.value;if(null!==c.layer){b=4;break}b=2;break;case 4:h=$jscomp.makeIterator(c.layer.renderLayers),g=h.next();case 5:if(g.done){b=7;break}e=g.value;b=8;return{value:e,done:!1};case 8:if(void 0===C){b=9;break}b=-1;throw C;case 9:case 6:g=h.next();b=5;break;case 7:case 2:w=k.next();b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}
var b=0,e,g,h,c,w,k,C={next:function(a){return d(a,void 0)},throw:function(a){return d(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();C[Symbol.iterator]=function(){return this};return C},d}},{key:"visibleRenderLayers",get:function(){var a=this;$jscomp.initSymbol();$jscomp.initSymbolIterator();var d={};return d[Symbol.iterator]=function(){function d(d,C){for(;;)switch(b){case 0:k=$jscomp.makeIterator(a.managedLayers),w=k.next();case 1:if(w.done){b=
3;break}c=w.value;if(null!==c.layer&&c.visible){b=4;break}b=2;break;case 4:h=$jscomp.makeIterator(c.layer.renderLayers),g=h.next();case 5:if(g.done){b=7;break}e=g.value;b=8;return{value:e,done:!1};case 8:if(void 0===C){b=9;break}b=-1;throw C;case 9:case 6:g=h.next();b=5;break;case 7:case 2:w=k.next();b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,e,g,h,c,w,k,C={next:function(a){return d(a,void 0)},throw:function(a){return d(void 0,a)},return:function(a){throw Error("Not yet implemented");
}};$jscomp.initSymbolIterator();C[Symbol.iterator]=function(){return this};return C},d}}]);return b}(m.a),A=function(){function a(){var d=this;q(this,a);this.changed=new r.a;this.position=l.p.create();this.active=!1;this.pickedRenderLayer=null;this.pickedValue=new p.a(0,0);this.pickedOffset=0;this.updater=void 0;this.stale=!1;this.triggerUpdate=b()(function(){d.update()},50,{leading:!0,trailing:!0})}g(a,[{key:"updateUnconditionally",value:function(){this.triggerUpdate.cancel();this.update();return this.active}},
{key:"updateIfStale",value:function(){this.stale&&this.update()}},{key:"update",value:function(){var a=this.updater;this.stale=!1;a?this.setActive(a(this)):this.setActive(!1)}},{key:"setActive",value:function(a){this.stale=!1;if(this.active!==a||!0===a)this.active=a,this.changed.dispatch()}}]);return a}(),x=function(a){function d(a,b){q(this,d);var e=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));e.layerManager=a;e.mouseState=b;e.values=new Map;e.changed=new r.a;e.needsUpdate=!0;e.registerDisposer(b.changed.add(function(){e.handleChange()}));
e.registerDisposer(a.layersChanged.add(function(){e.handleLayerChange()}));return e}t(d,a);g(d,[{key:"handleLayerChange",value:function(){this.mouseState.active&&this.handleChange()}},{key:"handleChange",value:function(){this.needsUpdate=!0;this.changed.dispatch()}},{key:"update",value:function(){if(this.needsUpdate){this.needsUpdate=!1;var a=this.values,d=this.mouseState;a.clear();if(d.active)for(var b=d.position,e=$jscomp.makeIterator(this.layerManager.managedLayers),g=e.next();!g.done;g=e.next()){g=
g.value;var h=g.layer;g.visible&&h&&a.set(h,h.getValueAt(b,d))}}}},{key:"get",value:function(a){this.update();return this.values.get(a)}},{key:"toJSON",value:function(){this.update();for(var a={},d=this.values,b=$jscomp.makeIterator(this.layerManager.managedLayers),e=b.next();!e.done;e=b.next()){e=e.value;var g=e.layer;g&&(g=d.get(g),void 0!==g&&(g instanceof p.a&&(g={t:"u64",v:g}),a[e.name]=g))}return a}}]);return d}(m.a),D=function(a){function d(a,e,g,h){q(this,d);var c=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));
c.layerManager=a;c.renderLayerType=e;c.layerAdded=g;c.visibility=h;c.visibleLayers=new Map;c.newVisibleLayers=new Set;c.throttledUpdateVisibleLayers=b()(function(){c.updateVisibleLayers()},0);c.registerDisposer(a.layersChanged.add(function(){c.handleLayersChanged()}));c.updateVisibleLayers();return c}t(d,a);g(d,[{key:"handleLayersChanged",value:function(){this.throttledUpdateVisibleLayers()}},{key:"disposed",value:function(){this.throttledUpdateVisibleLayers.cancel();this.visibleLayers.forEach(function(a){return a()});
this.visibleLayers.clear();h(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"disposed",this).call(this)}},{key:"updateVisibleLayers",value:function(){for(var a=this.visibleLayers,d=this.newVisibleLayers,b=this.renderLayerType,e=this.layerAdded,g={},h=$jscomp.makeIterator(this.layerManager.readyRenderLayers()),c=h.next();!c.done;g={disposer:g.disposer,visibilityDisposer:g.visibilityDisposer,typedLayer:g.typedLayer},c=h.next())c=c.value,c instanceof b&&(g.typedLayer=c,d.add(g.typedLayer),
a.has(g.typedLayer)||(g.visibilityDisposer=g.typedLayer.visibility.add(this.visibility),g.disposer=e(g.typedLayer),a.set(g.typedLayer.addRef(),function(a){return function(){a.disposer();a.visibilityDisposer();a.typedLayer.dispose()}}(g))));b=$jscomp.makeIterator(a);for(e=b.next();!e.done;e=b.next())g=$jscomp.makeIterator(e.value),e=g.next().value,g=g.next().value,d.has(e)||(a.delete(e),g());d.clear()}},{key:"getVisibleLayers",value:function(){this.throttledUpdateVisibleLayers.flush();return[].concat($jscomp.arrayFromIterable(this.visibleLayers.keys()))}}]);
return d}(m.a)},function(m,f,c){var q=c(49),n=c(123),t=c(126),a=Math.max,b=Math.min;m.exports=function(c,f,v){function l(a){var d=e,b=w;e=w=void 0;A=a;return B=c.apply(b,d)}function k(a){var d=a-G;a-=A;return void 0===G||d>=f||0>d||D&&a>=C}function h(){var a=n();if(k(a))return g(a);var d=setTimeout;var e=a-A;a=f-(a-G);e=D?b(a,C-e):a;r=d(h,e)}function g(a){r=void 0;if(z&&e)return l(a);e=w=void 0;return B}function d(){var a=n(),d=k(a);e=arguments;w=this;G=a;if(d){if(void 0===r)return A=a=G,r=setTimeout(h,
f),x?l(a):B;if(D)return r=setTimeout(h,f),l(G)}void 0===r&&(r=setTimeout(h,f));return B}var e,w,B,r,G,A=0,x=!1,D=!1,z=!0;if("function"!=typeof c)throw new TypeError("Expected a function");f=t(f)||0;if(q(v)){x=!!v.leading;var C=(D="maxWait"in v)?a(t(v.maxWait)||0,f):C;z="trailing"in v?!!v.trailing:z}d.cancel=function(){void 0!==r&&clearTimeout(r);A=0;e=G=w=r=void 0};d.flush=function(){return void 0===r?B:g(n())};return d}},function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function n(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(f,"b",function(){return l});c.d(f,"c",function(){return r});f.d=function(a,c){return new Promise(function(k,h){if(a===b)c(k,h,b);else{var g=new l,d=a.add(function(){g.cancel()});c(function(a){d();k(a)},function(a){d();
h(a)},g)}})};var t=function(){function a(a,b){for(var h=0;h<b.length;h++){var g=b[h];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,c,h){c&&a(b.prototype,c);h&&a(b,h);return b}}();m=new (function(){function a(){n(this,a);this.name="CancellationError";this.message="CANCELED"}t(a,[{key:"toString",value:function(){return"CANCELED"}}]);return a}());f.a=m;var a=function(){},b={isCanceled:!1,add:function(){return a},remove:a};
f.e=b;var l=function(){function b(){n(this,b)}t(b,[{key:"cancel",value:function(){var a=this.handlers;if(null!==a&&(this.handlers=null,void 0!==a)){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())b=b.value,b()}}},{key:"add",value:function(b){var c=this,h=this.handlers;if(null===h)return b(),a;void 0===h&&(h=this.handlers=new Set);h.add(b);return function(){c.remove(b)}}},{key:"remove",value:function(a){var b=this.handlers;null!=b&&b.delete(a)}},{key:"isCanceled",get:function(){return null===
this.handlers}}]);return b}(),r=function(a){function c(){n(this,c);var a=(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");a=!a||"object"!==typeof a&&"function"!==typeof a?this:a;a.consumers=new Set;return a}q(c,a);t(c,[{key:"addConsumer",value:function(a){var h=this;a=void 0===a?b:a;var g=this.consumers;g.has(a)||a.isCanceled||(g.add(a),a.add(function(){g.delete(a);0===g.size&&h.cancel()}))}}]);
return c}(l)},function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function n(a,b){var d="";b&1&&(d+="control+");b&2&&(d+="alt+");b&4&&(d+="meta+");b&8&&(d+="shift+");return d+a}function t(a){return"string"===typeof a?{action:a}:
a}function a(a){function b(b,g){for(;;)switch(d){case 0:c=a.indexOf(":");a:{b=void 0;var w=a.substring(c+1).split("+"),k=0;w=$jscomp.makeIterator(w);for(var z=w.next();!z.done;z=w.next())switch(z=z.value,z){case "control":k|=1;break;case "alt":k|=2;break;case "meta":k|=4;break;case "shift":k|=8;break;default:if(void 0===b)b=z;else{h=void 0;break a}}h=void 0===b?void 0:n(b,k)}if(void 0!==h){d=1;break}d=-1;throw Error("Invalid event identifier: "+JSON.stringify(a));case 1:if(-1===c){d=2;break}e=a.substring(0,
c);if("at"===e||"bubble"===e){d=4;break}d=-1;throw Error("Invalid event phase: "+JSON.stringify(e));case 4:return d=5,{value:e+":"+h,done:!1};case 5:if(void 0===g){d=6;break}d=-1;throw g;case 6:d=3;break;case 2:return d=7,{value:"at:"+h,done:!1};case 7:if(void 0===g){d=8;break}d=-1;throw g;case 8:return d=9,{value:"bubble:"+h,done:!1};case 9:if(void 0===g){d=10;break}d=-1;throw g;case 10:case 3:d=-1;default:return{value:void 0,done:!0}}}var d=0,e,h,c,k={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,
a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();k[Symbol.iterator]=function(){return this};return k}c.d(f,"a",function(){return p});f.b=function(a,b,d){a=k[b.eventPhase]+":"+n(a,(b.ctrlKey?1:0)|(b.altKey?2:0)|(b.metaKey?4:0)|(b.shiftKey?8:0));d=d.get(a);void 0!==d&&(!1!==d.stopPropagation&&b.stopPropagation(),a=new CustomEvent("action:"+d.action,{bubbles:!0,detail:b,cancelable:!0}),a=!b.target.dispatchEvent(a),(!1!==d.preventDefault||a)&&b.preventDefault())};
f.c=function(a,g,d,e){return Object(b.c)(a,"action:"+g,d,e)};var b=c(0);m=c(139);var l=function(){function a(a,d){for(var b=0;b<d.length;b++){var g=d[b];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}(),r=function g(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return g(a,b,c)}else{if("value"in
d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},v;(function(a){a[a.CONTROL=1]="CONTROL";a[a.ALT=2]="ALT";a[a.META=4]="META";a[a.SHIFT=8]="SHIFT"})(v||(v={}));var p=function(b){function d(){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");var a=(d.__proto__||Object.getPrototypeOf(d)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==typeof a&&"function"!==typeof a?this:
a}q(d,b);l(d,[{key:"setFromObject",value:function(a){for(var d=$jscomp.makeIterator(Object.keys(a)),b=d.next();!b.done;b=d.next())b=b.value,this.set(b,t(a[b]))}},{key:"set",value:function(b,g){g=t(g);b=$jscomp.makeIterator(a(b));for(var e=b.next();!e.done;e=b.next())e=e.value,r(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"set",this).call(this,e,g)}},{key:"delete",value:function(b){b=$jscomp.makeIterator(a(b));for(var e=b.next();!e.done;e=b.next())e=e.value,r(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),
"delete",this).call(this,e)}}],[{key:"fromObject",value:function(a,b){b=void 0===b?{}:b;var e=new d;e.label=b.label;if(void 0!==b.parents){b=$jscomp.makeIterator(b.parents);for(var g=b.next();!g.done;g=b.next()){var c=$jscomp.makeIterator(g.value);g=c.next().value;c=c.next().value;e.addParent(g,c)}}b=$jscomp.makeIterator(Object.keys(a));for(g=b.next();!g.done;g=b.next())g=g.value,e.set(g,t(a[g]));return e}}]);return d}(m.a),k=[];k[Event.AT_TARGET]="at";k[Event.CAPTURING_PHASE]="capture";k[Event.BUBBLING_PHASE]=
"bubble"},function(m,f,c){c.d(f,"a",function(){return q});f.b=1E-6;var q="undefined"!==typeof Float32Array?Float32Array:Array;f.c=Math.random},function(m,f,c){c.d(f,"a",function(){return t});var q=c(20),n=function(){function a(a,c){for(var b=0;b<c.length;b++){var l=c[b];l.enumerable=l.enumerable||!1;l.configurable=!0;"value"in l&&(l.writable=!0);Object.defineProperty(a,l.key,l)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),t=function(){function a(b,c){c=void 0===c?q.a:c;if(!(this instanceof
a))throw new TypeError("Cannot call a class as a function");this.gl=b;this.bufferType=c;this.gl=b;this.buffer=b.createBuffer()}n(a,[{key:"bind",value:function(){this.gl.bindBuffer(this.bufferType,this.buffer)}},{key:"bindToVertexAttrib",value:function(a,c,f,v,p,k){f=void 0===f?q.c:f;v=void 0===v?!1:v;p=void 0===p?0:p;k=void 0===k?0:k;this.bind();this.gl.enableVertexAttribArray(a);this.gl.vertexAttribPointer(a,c,f,v,p,k)}},{key:"setData",value:function(a,c){c=void 0===c?q.k:c;var b=this.gl;this.bind();
b.bufferData(this.bufferType,a,c)}},{key:"dispose",value:function(){this.gl.deleteBuffer(this.buffer);this.gl=this.buffer=void 0}}],[{key:"fromData",value:function(b,c,f,v){b=new a(b,f);b.setData(c,v);return b}}]);return a}()},function(m,f,c){function q(a,d){if(!(a instanceof d))throw new TypeError("Cannot call a class as a function");}function n(a,d){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!d||"object"!==typeof d&&"function"!==typeof d?a:
d}function t(a,d){if("function"!==typeof d&&null!==d)throw new TypeError("Super expression must either be null or a function, not "+typeof d);a.prototype=Object.create(d&&d.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});d&&(Object.setPrototypeOf?Object.setPrototypeOf(a,d):a.__proto__=d)}function a(a,d){for(var b=$jscomp.makeIterator(p),g=b.next();!g.done;g=b.next())if(g=g.value,g=g(a,d),null!=g)return g;throw Error("No chunk format handler found.");}f.c=function(a){p.push(a)};
c.d(f,"b",function(){return k});c.d(f,"a",function(){return h});m=c(35);var b=c(1),l=function(){function a(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(d,b,g){b&&a(d.prototype,b);g&&a(d,g);return d}}(),r=b.p.create(),v=b.p.create(),p=[],k=function(g){function d(b,g){q(this,d);g=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,b,g));g.chunkFormatHandler=g.registerDisposer(a(b.chunkQueueManager.gl,
g.spec));return g}t(d,g);l(d,[{key:"getValueAt",value:function(a){var d=this.spec,e=d.chunkLayout,g=e.size;e.globalToLocalSpatial(v,a);for(a=0;3>a;++a)r[a]=Math.floor(v[a]/g[a]);a=Object(b.q)(r);a=this.chunks.get(a);if(!a)return null;e=d.voxelSize;for(var c=0;3>c;++c)r[c]=Math.floor((v[c]-r[c]*g[c])/e[c]);g=a.chunkDataSize;for(e=0;3>e;++e)if(r[e]>=g[e])return;d=d.numChannels;if(1===d)return a.getChannelValueAt(r,0);g=Array(d);for(e=0;e<d;++e)g[e]=a.getChannelValueAt(r,e);return g}},{key:"getChunk",
value:function(a){return this.chunkFormatHandler.getChunk(this,a)}},{key:"chunkFormat",get:function(){return this.chunkFormatHandler.chunkFormat}}]);return d}(m.c),h=function(a){function d(a,b){q(this,d);return n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,a,b))}t(d,a);l(d,[{key:"chunkFormat",get:function(){return this.source.chunkFormat}}]);return d}(m.b)},function(m,f,c){f.a=function(c){if(c instanceof Object){var a=c[q];void 0===a&&(a=c[q]=n++);return"o"+a}return""+JSON.stringify(c)};
$jscomp.initSymbol();var q=Symbol("objectId"),n=0},function(m,f,c){f.a=34962;f.k=35044;f.r=3317;f.t=5121;f.c=5126;f.i=6407;f.j=6408;f.f=6409;f.g=6410;f.d=35632;f.u=35633;f.h=9728;f.e=9729;f.n=10240;f.o=10241;f.p=10242;f.q=10243;f.m=3553;f.l=33984;f.b=33071;f.s=37440},function(m,f){},function(m,f,c){f.b=function(c,a){n.set(c,a)};f.a=function(c){for(var a=new q.b,b=$jscomp.makeIterator(n),f=b.next();!f.done;f=b.next()){var r=$jscomp.makeIterator(f.value);f=r.next().value;r=r.next().value;a.register(f,
r(c))}return a};var q=c(24),n=new Map},function(m,f,c){c.d(f,"d",function(){return q});var q;(function(c){c[c.GPU_MEMORY=0]="GPU_MEMORY";c[c.SYSTEM_MEMORY=1]="SYSTEM_MEMORY";c[c.SYSTEM_MEMORY_WORKER=2]="SYSTEM_MEMORY_WORKER";c[c.DOWNLOADING=3]="DOWNLOADING";c[c.QUEUED=4]="QUEUED";c[c.NEW=5]="NEW";c[c.FAILED=6]="FAILED";c[c.EXPIRED=7]="EXPIRED"})(q||(q={}));var n;(function(c){c[c.FIRST_TIER=0]="FIRST_TIER";c[c.FIRST_ORDERED_TIER=0]="FIRST_ORDERED_TIER";c[c.VISIBLE=0]="VISIBLE";c[c.PREFETCH=1]="PREFETCH";
c[c.LAST_ORDERED_TIER=1]="LAST_ORDERED_TIER";c[c.RECENT=2]="RECENT";c[c.LAST_TIER=2]="LAST_TIER"})(n||(n={}));f.b="ChunkQueueManager";f.a="ChunkManager";f.c="ChunkSource.invalidate"},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&
null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){void 0===b&&(b=-1===a.indexOf("/")?":":"/");a=a.lastIndexOf(b);return-1===a?0:a+1}c.d(f,"a",function(){return v});c.d(f,"b",function(){return k});var b=c(14),l=c(30);m=c(0);var r=function(){function a(a,d){for(var b=
0;b<d.length;b++){var g=d[b];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}(),v=function(a){function b(){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}t(b,a);return b}(m.a),p=/^(?:([a-zA-Z-+_]+):\/\/)?(.*)$/,k=function(c){function g(){q(this,g);var a=n(this,(g.__proto__||Object.getPrototypeOf(g)).apply(this,arguments));a.dataSources=
new Map;return a}t(g,c);r(g,[{key:"register",value:function(a,b){this.dataSources.set(a,this.registerDisposer(b))}},{key:"getDataSource",value:function(a){a=a.match(p);if(null===a||void 0===a[1])throw Error('Data source URL must have the form "<protocol>://<path>".');var d=a[1],b=this.dataSources.get(d);if(void 0===b)throw Error("Unsupported data source: "+JSON.stringify(d)+".");return[b,a[2],d]}},{key:"getVolume",value:function(a,e,g,c){g=void 0===g?{}:g;c=void 0===c?b.e:c;e=$jscomp.makeIterator(this.getDataSource(e));
var d=e.next().value,h=e.next().value;return new Promise(function(b){b(d.getVolume(a,h,g,c))})}},{key:"getVectorGraphicsSource",value:function(a,e,g,c){g=void 0===g?{}:g;c=void 0===c?b.e:c;e=$jscomp.makeIterator(this.getDataSource(e));var d=e.next().value,h=e.next().value;return new Promise(function(b){b(d.getVectorGraphicsSource(a,h,g,c))})}},{key:"getMeshSource",value:function(a,e,g){g=void 0===g?b.e:g;e=$jscomp.makeIterator(this.getDataSource(e));var d=e.next().value,c=e.next().value;return new Promise(function(b){b(d.getMeshSource(a,
c,g))})}},{key:"getSkeletonSource",value:function(a,e,g){g=void 0===g?b.e:g;e=$jscomp.makeIterator(this.getDataSource(e));var d=e.next().value,c=e.next().value;return new Promise(function(b){b(d.getSkeletonSource(a,c,g))})}},{key:"volumeCompleter",value:function(a,e,g){g=void 0===g?b.e:g;var d=a.match(p),c=d[1];if(void 0===c){e=[];g=$jscomp.makeIterator(this.dataSources);for(d=g.next();!d.done;d=g.next()){var h=$jscomp.makeIterator(d.value);d=h.next().value;h=h.next().value;d+="://";d.startsWith(a)&&
e.push({value:d,description:h.description})}return Promise.resolve({offset:0,completions:e})}a=this.dataSources.get(c);return void 0!==a&&void 0!==a.volumeCompleter?a.volumeCompleter(d[2],e,g).then(function(a){return Object(l.a)(c.length+3,a)}):Promise.reject(null)}},{key:"suggestLayerName",value:function(d){d=$jscomp.makeIterator(this.getDataSource(d));var b=d.next().value;d=d.next().value;b=b.suggestLayerName;if(void 0!==b)return b(d);b=a(d,void 0);return d.substring(b)}},{key:"findSourceGroup",
value:function(d){var b=$jscomp.makeIterator(this.getDataSource(d));d=b.next().value;var g=b.next().value;b=b.next().value;return(d.findSourceGroup||a)(g)+b.length+3}}]);return g}(m.a)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&
null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b,g){var d=a.createShader(g);a.shaderSource(d,b);a.compileShader(d);if(!a.getShaderParameter(d,a.COMPILE_STATUS)){a=a.getShaderInfoLog(d)||"";var e=a.replace("\x00","");d=[];e=$jscomp.makeIterator(e.split("\n"));for(var c=
e.next();!c.done;c=e.next()){c=c.value;var h=c.match(/^ERROR:\s*(\d+):(\d+)\s*(.+)$/);null!==h?d.push({message:h[3].trim(),file:parseInt(h[1],10),line:parseInt(h[2],10)}):(h=c.match(/^ERROR:\s*(.+)$/),null!==h?d.push({message:h[1]}):(c=c.trim())&&d.push({message:c}))}throw new v(g,b,a,d);}return d}c.d(f,"a",function(){return g});m=c(0);var b=c(20),l=function(){function a(a,d){for(var b=0;b<d.length;b++){var e=d[b];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,
e.key,e)}}return function(d,b,g){b&&a(d.prototype,b);g&&a(d,g);return d}}(),r;(function(a){a[a.VERTEX=b.u]="VERTEX";a[a.FRAGMENT=b.d]="FRAGMENT"})(r||(r={}));var v=function(a){function d(a,b,e,g){q(this,d);var c="Error compiling "+r[a].toLowerCase()+" shader: "+e,h=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,c));h.name="ShaderCompilationError";h.log=e;h.message=c;h.shaderType=a;h.source=b;h.errorMessages=g;return h}t(d,a);return d}(Error),p=function(a){function d(a,b,e){q(this,d);var g=
"Error linking shader: "+e,c=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,g));c.name="ShaderLinkError";c.log=e;c.message=g;c.vertexSource=a;c.fragmentSource=b;return c}t(d,a);return d}(Error),k=function(d){function b(d,e,g,c,h){q(this,b);var k=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));k.gl=d;k.vertexSource=e;k.fragmentSource=g;k.attributes=new Map;k.uniforms=new Map;var w=k.vertexShader=a(d,e,d.VERTEX_SHADER),z=k.fragmentShader=a(d,g,d.FRAGMENT_SHADER),C=d.createProgram();
d.attachShader(C,w);d.attachShader(C,z);d.linkProgram(C);if(!d.getProgramParameter(C,d.LINK_STATUS))throw d=d.getProgramInfoLog(C)||"",new p(e,g,d);k.program=C;g=k.uniforms;e=k.attributes;if(c)for(c=$jscomp.makeIterator(c),w=c.next();!w.done;w=c.next())w=w.value,g.set(w,d.getUniformLocation(C,w));if(h)for(h=$jscomp.makeIterator(h),w=h.next();!w.done;w=h.next())c=w.value,e.set(c,d.getAttribLocation(C,c));return k}t(b,d);l(b,[{key:"uniform",value:function(a){return this.uniforms.get(a)}},{key:"attribute",
value:function(a){return this.attributes.get(a)}},{key:"textureUnit",value:function(a){return this.textureUnits.get(a)}},{key:"bind",value:function(){this.gl.useProgram(this.program)}},{key:"disposed",value:function(){var a=this.gl;a.deleteShader(this.vertexShader);this.vertexShader=void 0;a.deleteShader(this.fragmentShader);this.fragmentShader=void 0;a.deleteProgram(this.program);this.uniforms=this.attributes=this.gl=this.program=void 0}}]);return b}(m.a),h=function(){function a(){q(this,a);this.code=
"";this.parts=new Set}l(a,[{key:"add",value:function(a){if(!this.parts.has(a))switch(this.parts.add(a),typeof a){case "string":this.code+=a;break;case "function":this.add(a());break;default:if(Array.isArray(a)){a=$jscomp.makeIterator(a);for(var d=a.next();!d.done;d=a.next())this.add(d.value)}else throw Error("Invalid code type");}}},{key:"toString",value:function(){return this.code}}]);return a}(),g=function(){function a(d){q(this,a);this.gl=d;this.nextTextureUnit=this.nextSymbolID=0;this.varyingsCode=
this.attributesCode=this.uniformsCode="";this.fragmentExtensionsSet=new Set;this.fragmentExtensions="";this.vertexCode=new h;this.vertexMain="";this.fragmentCode=new h;this.fragmentMain="";this.required=new Set;this.uniforms=[];this.attributes=[];this.initializers=[];this.textureUnits=new Map}l(a,[{key:"allocateTextureUnit",value:function(a,d){d=void 0===d?1:d;if(this.textureUnits.has(a))throw Error("Duplicate texture unit symbol: "+a);var b=this.nextTextureUnit;this.nextTextureUnit+=d;this.textureUnits.set(a,
b);return b}},{key:"addTextureSampler2D",value:function(a,d,b){var e=this.allocateTextureUnit(d,b);this.addUniform("highp sampler2D",a,b);this.addInitializer(function(d){if(b){for(var g=new Int32Array(b),c=0;c<b;++c)g[c]=c+e;d.gl.uniform1iv(d.uniform(a),g)}else d.gl.uniform1i(d.uniform(a),e)});return e}},{key:"symbol",value:function(a){return a+this.nextSymbolID++}},{key:"addAttribute",value:function(a,d){this.attributes.push(d);this.attributesCode+="attribute "+a+" "+d+";\n";return d}},{key:"addVarying",
value:function(a,d){this.varyingsCode+="varying "+a+" "+d+";\n"}},{key:"addUniform",value:function(a,d,b){this.uniforms.push(d);this.uniformsCode=null!=b?this.uniformsCode+("uniform "+a+" "+d+"["+b+"];\n"):this.uniformsCode+("uniform "+a+" "+d+";\n");return d}},{key:"addFragmentExtension",value:function(a){this.fragmentExtensionsSet.has(a)||(this.fragmentExtensionsSet.add(a),this.fragmentExtensions+="#extension "+a+" : require\n")}},{key:"addVertexCode",value:function(a){this.vertexCode.add(a)}},
{key:"addFragmentCode",value:function(a){this.fragmentCode.add(a)}},{key:"setVertexMain",value:function(a){this.vertexMain=a}},{key:"addVertexMain",value:function(a){this.vertexMain=(this.vertexMain||"")+a}},{key:"setFragmentMain",value:function(a){this.fragmentMain="void main() {\n"+a+"\n}\n"}},{key:"setFragmentMainFunction",value:function(a){this.fragmentMain=a}},{key:"addInitializer",value:function(a){this.initializers.push(a)}},{key:"require",value:function(a){this.required.has(a)||(this.required.add(a),
a(this))}},{key:"build",value:function(){var a=new k(this.gl,"\nprecision highp float;\n"+this.uniformsCode+"\n"+this.attributesCode+"\n"+this.varyingsCode+"\n"+this.vertexCode+"\nvoid main() {\n"+this.vertexMain+"\n}\n","\n"+this.fragmentExtensions+"\nprecision highp float;\n"+this.uniformsCode+"\n"+this.varyingsCode+"\n"+this.fragmentCode+"\n"+this.fragmentMain+"\n",this.uniforms,this.attributes);a.textureUnits=this.textureUnits;var d=this.initializers;if(0<d.length){a.bind();d=$jscomp.makeIterator(d);
for(var b=d.next();!b.done;b=d.next())b=b.value,b(a)}return a}}]);return a}()},function(m,f,c){c.d(f,"a",function(){return t});var q=function(){function a(a,c){for(var b=0;b<c.length;b++){var f=c[b];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}();c(144);var n=null,t=function(){function a(b){b=void 0===b?!1:b;if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");
null===n&&(n=document.createElement("ul"),n.id="statusContainer",document.body.appendChild(n));var c=document.createElement("li");this.element=c;!0===b&&(b=200);!1!==b?(this.setVisible(!1),this.timer=setTimeout(this.setVisible.bind(this,!0),b)):this.timer=null;n.appendChild(c)}q(a,[{key:"dispose",value:function(){n.removeChild(this.element);this.element=void 0;null!==this.timer&&clearTimeout(this.timer)}},{key:"setText",value:function(a,c){this.element.textContent=a;c&&this.setVisible(!0)}},{key:"setHTML",
value:function(a,c){this.element.innerHTML=a;c&&this.setVisible(!0)}},{key:"setVisible",value:function(a){null!==this.timer&&(clearTimeout(this.timer),this.timer=null);this.element.style.display=a?"block":"none"}}],[{key:"forPromise",value:function(b,c){var f=new a(c.delay);f.setText(c.initialMessage);var l=f.dispose.bind(f);b.then(l,function(a){f.element.textContent=(void 0===c.errorPrefix?"":c.errorPrefix)+(a instanceof Error?a.message:""+a)+"  ";a=document.createElement("button");a.textContent=
"Dismiss";a.addEventListener("click",function(){f.dispose()});f.element.appendChild(a);f.setVisible(!0)});return b}},{key:"showMessage",value:function(b){var c=new a;c.element.textContent=b;c.setVisible(!0);return c}},{key:"showTemporaryMessage",value:function(a,c){c=void 0===c?2E3:c;var b=this.showMessage(a);setTimeout(function(){return b.dispose()},c);return b}}]);return a}()},function(m,f,c){c.d(f,"b",function(){return q});var q;(function(c){c[c.UINT8=0]="UINT8";c[c.UINT16=1]="UINT16";c[c.UINT32=
2]="UINT32";c[c.UINT64=3]="UINT64";c[c.FLOAT32=4]="FLOAT32"})(q||(q={}));m=[];f.a=m;m[q.UINT8]=1;m[q.UINT16]=2;m[q.UINT32]=4;m[q.UINT64]=8;m[q.FLOAT32]=4},function(m,f,c){f.b=function(){return new q.b(void 0)};f.a=function(c){return new q.a(c,n.B)};var q=c(5),n=c(2)},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"b",function(){return r});c.d(f,"a",function(){return p});var t=c(38);m=c(0);var a=c(34),b=function(){function a(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,g,d){g&&a(b.prototype,g);
d&&a(b,d);return b}}(),l=function h(a,d,b){null===a&&(a=Function.prototype);var e=Object.getOwnPropertyDescriptor(a,d);if(void 0===e){if(a=Object.getPrototypeOf(a),null!==a)return h(a,d,b)}else{if("value"in e)return e.value;d=e.get;return void 0===d?void 0:d.call(b)}};c(163);var r=0,v=a.a.fromObject({escape:{action:"close"}}),p=function(c){function g(){if(!(this instanceof g))throw new TypeError("Cannot call a class as a function");var d=q(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));
d.keyMap=new a.a;d.keyMap.addParent(v,Number.NEGATIVE_INFINITY);++r;var b=d.container=document.createElement("div");b.className="overlay";var c=d.content=document.createElement("div");d.registerDisposer(new t.a(c));c.className="overlay-content";b.appendChild(c);document.body.appendChild(b);d.registerDisposer(new a.b(d.container,d.keyMap));d.registerEventListener(b,"action:close",function(){d.dispose()});c.focus();return d}n(g,c);b(g,[{key:"disposed",value:function(){--r;document.body.removeChild(this.container);
l(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"disposed",this).call(this)}}]);return g}(m.a)},function(m,f,c){f.a=function(c,f){f.offset+=c;return f};f.b=function(c,f){var t=[];f=$jscomp.makeIterator(f);for(var a=f.next();!a.done;a=f.next())a=a.value,a.startsWith(c)&&t.push({value:a});return t};f.c=function(c,f,t,a){var b=[];f=$jscomp.makeIterator(f);for(var l=f.next();!l.done;l=f.next()){l=l.value;var r=t(l);r.startsWith(c)&&b.push({value:r,description:a(l)})}return b}},function(m,
f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return r});f.b=function(a,c,k){k=void 0===k?"GET":k;var h=new XMLHttpRequest;if(Array.isArray(a)){var g=a.length;g=1===g?0:Math.abs(Object(t.a)(c))%g;a=a[g]+c}else a+=
c;h[l]=k;h[b]=a;h.open(k,a);return h};f.d=function(a,b,c){c=void 0===c?n.e:c;a.responseType=b;return new Promise(function(b,g){var d=function(){a.abort()};c.add(d);a.onloadend=function(){var e=this.status;c.remove(d);200<=e&&300>e?b(this.response):g(r.fromXhr(a))};a.send()})};f.c=function(a){var b=a.match(/^([^:\/]+):\/\/([^\/]+)(\/.*)?$/);if(null===b)throw Error("Invalid URL: "+JSON.stringify(a));return"gs"===b[1]?[["https://storage.googleapis.com/"+b[2]],b[3]]:[[a],""]};var n=c(14),t=c(120),a=function(){function a(a,
b){for(var c=0;c<b.length;c++){var g=b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,c,h){c&&a(b.prototype,c);h&&a(b,h);return b}}();$jscomp.initSymbol();var b=Symbol("url");$jscomp.initSymbol();var l=Symbol("method"),r=function(c){function f(a,b,g,d){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");var e=a+" "+JSON.stringify(b)+" resulted in HTTP error "+g;d&&(e+=": "+d);e+=".";var c=
(f.__proto__||Object.getPrototypeOf(f)).call(this,e);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");c=!c||"object"!==typeof c&&"function"!==typeof c?this:c;c.name="HttpError";c.message=e;c.method=a;c.url=b;c.code=g;c.statusMessage=d;return c}q(f,c);a(f,null,[{key:"fromXhr",value:function(a){return new f(a[l],a[b],a.status,a.statusText)}}]);return f}(Error)},function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return t});m=c(12);var n=function(){function a(a,c){for(var b=0;b<c.length;b++){var f=c[b];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),t=function(a){function b(){if(!(this instanceof
b))throw new TypeError("Cannot call a class as a function");var a=(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==typeof a&&"function"!==typeof a?this:a}q(b,a);n(b,[{key:"draw",value:function(a){}},{key:"isTransparent",get:function(){return!1}}]);return b}(m.h)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"b",function(){return r});
c.d(f,"a",function(){return v});f.c=function(c){return function(c){function h(){q(this,h);var a=n(this,(h.__proto__||Object.getPrototypeOf(h)).apply(this,arguments));a.visibility=new v;return a}t(h,c);l(h,[{key:"initializeCounterpart",value:function(g,d){d=void 0===d?{}:d;d.visibility=this.registerDisposer(a.a.makeFromExisting(g,this.visibility)).rpcId;b(h.prototype.__proto__||Object.getPrototypeOf(h.prototype),"initializeCounterpart",this).call(this,g,d)}}]);return h}(c)};var a=c(45);m=c(5);var b=
function k(a,b,d){null===a&&(a=Function.prototype);var e=Object.getOwnPropertyDescriptor(a,b);if(void 0===e){if(a=Object.getPrototypeOf(a),null!==a)return k(a,b,d)}else{if("value"in e)return e.value;b=e.get;return void 0===b?void 0:b.call(d)}},l=function(){function a(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,g,d){g&&a(b.prototype,g);d&&a(b,d);return b}}(),r=function(a){function b(a){a=
void 0===a?Number.NEGATIVE_INFINITY:a;q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a))}t(b,a);l(b,[{key:"visible",get:function(){return this.value===Number.POSITIVE_INFINITY}},{key:"ignored",get:function(){return this.value===Number.NEGATIVE_INFINITY}}]);return b}(m.b);r.VISIBLE=Number.POSITIVE_INFINITY;r.IGNORED=Number.NEGATIVE_INFINITY;var v=function(a){function b(){q(this,b);var a=n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments));a.contributors=
new Map;return a}t(b,a);l(b,[{key:"add",value:function(a){var d=this,b=this.contributors,g=a.changed.add(function(){d.update()}),c=function(){b.delete(c);g();d.update()};b.set(c,a);this.update();return c}},{key:"update",value:function(){for(var a=Number.NEGATIVE_INFINITY,d=$jscomp.makeIterator(this.contributors.values()),b=d.next();!b.done;b=d.next())a=Math.max(a,b.value.value);this.value=a}}]);return b}(r)},function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"b",function(){return l});m=c(0);var n=c(15);c.d(f,"a",function(){return n.a});c.d(f,"c",function(){return n.c});var t=function(){function a(a,b){for(var c=0;c<b.length;c++){var h=b[c];h.enumerable=h.enumerable||!1;h.configurable=!0;"value"in h&&(h.writable=!0);Object.defineProperty(a,h.key,h)}}return function(b,
c,k){c&&a(b.prototype,c);k&&a(b,k);return b}}(),a=new Set("f1 f2 f3 f4 f5 f6 f7 f8 f9 f10 f11 f12 escape pause".split(" ")),b=new Set("color date datetime datetime-local email month number password search tel text time url week".split(" ")),l=function(c){function f(a,b){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");var c=(f.__proto__||Object.getPrototypeOf(f)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
c=!c||"object"!==typeof c&&"function"!==typeof c?this:c;c.target=a;c.eventMap=b;c.modifierShortcutsAreGlobal=!0;c.allShortcutsAreGlobal=!1;c.allowSpaceKeyOnButtons=!1;c.registerEventListener(a,"keydown",c.handleKeyDown.bind(c),!1);return c}q(f,c);t(f,[{key:"shouldIgnoreEvent",value:function(c,k){var h=k.target,g=h.tagName;if(h===this.target)return!1;var d="TEXTAREA"===g||"INPUT"===g||"BUTTON"===g||"SELECT"===g,e=!d&&(h.isContentEditable||h.ownerDocument&&"on"===h.ownerDocument.designMode);return!d&&
!e||this.allShortcutsAreGlobal||a.has(c)?!1:e||this.modifierShortcutsAreGlobal&&(k.altKey||k.ctrlKey||k.metaKey)?!0:"INPUT"===g&&b.has(h.type)?"enter"!==c:"INPUT"===g||"BUTTON"===g?this.allowSpaceKeyOnButtons?!1:"space"===c:!0}},{key:"handleKeyDown",value:function(a){var b=a.code.toLowerCase();this.shouldIgnoreEvent(b,a)||Object(n.b)(b,a,this.eventMap)}}]);return f}(m.a)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return A});c.d(f,"c",function(){return x});c.d(f,"b",function(){return D});c.d(f,"d",function(){return z});
m=c(13);var a=c.n(m),b=c(23);m=c(10);f=c(39);var l=c(51),r=c(0),v=c(1),p=c(19),k=c(3),h=c(33),g=c(52),d=c(25),e=c(53);c=c(6);var w=function(){function a(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}(),B=function H(a,b,d){null===a&&(a=Function.prototype);var e=Object.getOwnPropertyDescriptor(a,b);if(void 0===e){if(a=Object.getPrototypeOf(a),
null!==a)return H(a,b,d)}else{if("value"in e)return e.value;b=e.get;return void 0===b?void 0:b.call(d)}},F=this&&this.__decorate||function(a,b,d,e){var g=arguments.length,c=3>g?b:null===e?e=Object.getOwnPropertyDescriptor(b,d):e,h;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)c=Reflect.decorate(a,b,d,e);else for(var k=a.length-1;0<=k;k--)if(h=a[k])c=(3>g?h(c):3<g?h(b,d,c):h(b,d))||c;return 3<g&&c&&Object.defineProperty(b,d,c),c},G=v.j.create(),A=function(b){function d(b,e,c){q(this,
d);var h=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));h.chunkManager=b;h.layerManager=e;h.navigationState=c;h.gl=h.chunkManager.gl;h.dataToViewport=v.j.create();h.viewportToDevice=v.j.create();h.dataToDevice=v.j.create();h.visibleChunks=new Map;h.viewChanged=new k.a;h.renderingStale=!0;h.visibleChunksStale=!0;h.visibleLayerList=[];h.newVisibleLayers=new Set;h.offscreenFramebuffer=h.registerDisposer(new g.b(h.gl,{colorBuffers:Object(g.e)(h.gl,1),depthBuffer:new g.d(h.gl)}));h.updateVisibleLayers=
h.registerCancellable(a()(function(){h.updateVisibleLayersNow()},0));v.j.identity(h.dataToViewport);h.initializeCounterpart(h.chunkManager.rpc,{chunkManager:b.rpcId});h.registerDisposer(c.changed.add(function(){h.updateViewportFromNavigationState()}));h.updateViewportFromNavigationState();h.registerDisposer(e.layersChanged.add(function(){h.hasValidViewport&&h.updateVisibleLayers()}));h.viewChanged.add(function(){h.renderingStale=!0});h.registerDisposer(b.chunkQueueManager.visibleChunksChanged.add(h.viewChanged.dispatch));
h.updateViewportFromNavigationState();h.updateVisibleLayers();return h}t(d,b);w(d,[{key:"updateViewportFromNavigationState",value:function(){var a=this.navigationState;a.valid&&(a.toMat4(G),this.setViewportToDataMatrix(G))}},{key:"updateVisibleLayersNow",value:function(){if(this.wasDisposed||!this.hasValidViewport)return!1;var a=this.visibleLayers,b=this.rpc,d={id:this.rpcId},e=this.newVisibleLayers,g=!1,c=this.visibleLayerList;c.length=0;for(var h=$jscomp.makeIterator(this.layerManager.readyRenderLayers()),
k=h.next();!k.done;k=h.next())k=k.value,k instanceof l.a&&(e.add(k),c.push(k),a.has(k)||(a.set(k.addRef(),[]),k.redrawNeeded.add(this.viewChanged.dispatch),d.layerId=k.rpcId,b.invoke("SliceView.addVisibleLayer",d),g=!0));c=$jscomp.makeIterator(a.keys());for(k=c.next();!k.done;k=c.next())h=k.value,e.has(h)||(a.delete(h),h.redrawNeeded.remove(this.viewChanged.dispatch),d.layerId=h.rpcId,b.invoke("SliceView.removeVisibleLayer",d),h.dispose(),g=!0);e.clear();g&&(this.visibleSourcesStale=!0);this.viewChanged.dispatch();
return g}},{key:"onViewportChanged",value:function(){var a=this.width,b=this.height,d=this.viewportToDevice,e=this.dataToViewport,g=this.dataToDevice;v.j.ortho(d,-a/2,a/2,b/2,-b/2,-10,10);v.j.multiply(g,d,e);this.visibleChunksStale=!0;this.viewChanged.dispatch()}},{key:"setViewportSize",value:function(a,b){return B(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"setViewportSize",this).call(this,a,b)?(this.rpc.invoke("SliceView.updateView",{id:this.rpcId,width:a,height:b}),!0):!1}},{key:"onViewportToDataMatrixChanged",
value:function(){var a=this.viewportToData,b=this.dataToViewport;v.j.invert(b,a);Object(v.m)(b);this.rpc.invoke("SliceView.updateView",{id:this.rpcId,viewportToData:a})}},{key:"onHasValidViewport",value:function(){this.updateVisibleLayers()}},{key:"updateRendering",value:function(){if(this.renderingStale&&this.hasValidViewport&&0!==this.width&&0!==this.height){this.renderingStale=!1;this.maybeUpdateVisibleChunks();var a=this.gl,b=this.offscreenFramebuffer;b.bind(this.width,this.height);a.disable(a.SCISSOR_TEST);
a.clearStencil(0);a.clearColor(0,0,0,0);a.colorMask(!0,!0,!0,!0);a.clear(a.COLOR_BUFFER_BIT);a.enable(a.STENCIL_TEST);a.disable(a.DEPTH_TEST);a.stencilOpSeparate(a.FRONT_AND_BACK,a.KEEP,a.KEEP,a.REPLACE);for(var d=0,e=$jscomp.makeIterator(this.visibleLayerList),g=e.next();!g.done;g=e.next())g=g.value,a.clear(a.STENCIL_BUFFER_BIT),a.stencilFuncSeparate(a.FRONT_AND_BACK,a.GREATER,1,1),1===d&&(a.enable(a.BLEND),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA)),g.draw(this),++d;a.disable(a.BLEND);a.disable(a.STENCIL_TEST);
b.unbind()}}},{key:"maybeUpdateVisibleChunks",value:function(){this.updateVisibleLayers.flush();if(!this.visibleChunksStale&&!this.visibleSourcesStale)return!1;this.visibleChunksStale=!1;this.updateVisibleChunks();return!0}},{key:"updateVisibleChunks",value:function(){var a=this.visibleChunks;this.computeVisibleChunks(function(b){var d=a.get(b);void 0===d?(d=[],a.set(b,d)):d.length=0;return d},function(a,b,d){a=Object(v.q)(d);b[b.length]=a})}},{key:"disposed",value:function(){for(var a=$jscomp.makeIterator(this.visibleLayers.keys()),
b=a.next();!b.done;b=a.next())b.value.dispose();this.visibleLayers.clear();this.visibleLayerList.length=0}}]);return d}(Object(h.c)(f.b));A=F([Object(c.g)(f.a)],A);var x=function(a){function b(a,d){q(this,b);a=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,d));a.spec=d.spec;return a}t(b,a);w(b,[{key:"initializeCounterpart",value:function(a,d){d.spec=this.spec.toObject();B(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"initializeCounterpart",this).call(this,a,d)}}],[{key:"encodeOptions",
value:function(a){var d=B(b.__proto__||Object.getPrototypeOf(b),"encodeOptions",this).call(this,a);d.spec=a.spec.toObject();return d}}]);return b}(m.e),D=function(a){function d(a,e){q(this,d);var g=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,a));g.chunkGridPosition=e.chunkGridPosition;g.chunkDataSize=e.chunkDataSize||a.spec.chunkDataSize;g.state=b.d.SYSTEM_MEMORY;return g}t(d,a);return d}(m.b),z=function(a){function b(a,g){q(this,b);var c=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));
c.gl=a;c.copyVertexPositionsBuffer=Object(e.a)(c.gl);c.textureCoordinateAdjustment=new Float32Array(4);var h=new d.a(a);h.addVarying("vec2","vTexCoord");h.addUniform("sampler2D","uSampler");h.addInitializer(function(b){a.uniform1i(b.uniform("uSampler"),0)});h.addUniform("vec4","uColorFactor");h.addUniform("vec4","uBackgroundColor");h.addUniform("mat4","uProjectionMatrix");h.addUniform("vec4","uTextureCoordinateAdjustment");h.require(g);h.setFragmentMain("\nvec4 sampledColor = texture2D(uSampler, vTexCoord);\nif (sampledColor.a == 0.0) {\n  sampledColor = uBackgroundColor;\n}\nemit(sampledColor * uColorFactor, vec4(0,0,0,0));\n");
h.addAttribute("vec4","aVertexPosition");h.setVertexMain("\nvTexCoord = uTextureCoordinateAdjustment.xy + 0.5 * (aVertexPosition.xy + 1.0) * uTextureCoordinateAdjustment.zw;\ngl_Position = uProjectionMatrix * aVertexPosition;\n");c.shader=c.registerDisposer(h.build());return c}t(b,a);w(b,[{key:"draw",value:function(a,b,d,e,g,c,h,k){var w=this.gl,f=this.shader,z=this.textureCoordinateAdjustment;z[0]=g;z[1]=c;z[2]=h-g;z[3]=k-c;f.bind();w.activeTexture(w.TEXTURE0);w.bindTexture(w.TEXTURE_2D,a);w.uniformMatrix4fv(f.uniform("uProjectionMatrix"),
!1,b);w.uniform4fv(f.uniform("uColorFactor"),d);w.uniform4fv(f.uniform("uBackgroundColor"),e);w.uniform4fv(f.uniform("uTextureCoordinateAdjustment"),z);a=f.attribute("aVertexPosition");this.copyVertexPositionsBuffer.bindToVertexAttrib(a,2);w.drawArrays(w.TRIANGLE_FAN,0,4);w.disableVertexAttribArray(a);w.bindTexture(w.TEXTURE_2D,null)}}],[{key:"get",value:function(a,d){return a.memoize.get("sliceview/SliceViewRenderHelper:"+Object(p.a)(d),function(){return new b(a,d)})}}]);return b}(r.a)},function(m,
f,c){f.a=function(c){return new q.a(void 0===c?.5:c,n.r)};var q=c(5),n=c(2)},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});
b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function t(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function a(a,b){var d=b.redrawNeeded.dispatch;b.registerDisposer(a.segmentColorHash.changed.add(d));b.registerDisposer(a.visibleSegments.changed.add(d));b.registerDisposer(a.segmentEquivalences.changed.add(d));b.registerDisposer(a.segmentSelectionState.changed.add(d))}c.d(f,"c",function(){return h});c.d(f,"a",function(){return g});f.g=a;
f.f=function(b,d){a(b,d);d.registerDisposer(b.objectAlpha.changed.add(d.redrawNeeded.dispatch));d.registerDisposer(b.objectToDataTransform.changed.add(d.redrawNeeded.dispatch))};f.e=function(a,b,e){e=void 0===e?1:e;var g=d;g[3]=e;a.segmentColorHash.compute(g,b);if(a.segmentSelectionState.isSelected(b))for(a=0;3>a;++a)g[a]=.5*g[a]+.5;g[0]*=e;g[1]*=e;g[2]*=e;return g};f.d=function(a,d,e){Object(b.a)(a,function(g,c){var h=Object(b.b)(g,a.clipBounds.value);h=d.get(h);void 0!==h&&e(c,g,h)})};c.d(f,"b",
function(){return e});var b=c(134);m=c(0);f=c(1);var l=c(3),r=c(11),v=c(33);c=c(6);var p=function B(a,b,d){null===a&&(a=Function.prototype);var e=Object.getOwnPropertyDescriptor(a,b);if(void 0===e){if(a=Object.getPrototypeOf(a),null!==a)return B(a,b,d)}else{if("value"in e)return e.value;b=e.get;return void 0===b?void 0:b.call(d)}},k=function(){function a(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,
e.key,e)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}(),h=function(){function a(b,d){t(this,a);this.key=b;this.value=d}k(a,[{key:"toString",value:function(){return this.key+"\u2192"+this.value}}]);return a}(),g=function(a){function b(){t(this,b);var a=q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments));a.selectedSegment=new r.a;a.hasSelectedSegment=!1;a.changed=new l.a;return a}n(b,a);k(b,[{key:"set",value:function(a){if(null==a)this.hasSelectedSegment&&(this.hasSelectedSegment=
!1,this.changed.dispatch());else{var b=this.selectedSegment;this.hasSelectedSegment&&a.low===b.low&&a.high===b.high||(b.low=a.low,b.high=a.high,this.hasSelectedSegment=!0,this.changed.dispatch())}}},{key:"isSelected",value:function(a){return this.hasSelectedSegment&&r.a.equal(a,this.selectedSegment)}},{key:"bindTo",value:function(a,b){var d=this,e=new r.a;this.registerDisposer(a.changed.add(function(){var g=a.get(b);"number"===typeof g?(e.low=g,e.high=0,g=e):g instanceof h&&(g=g.value);d.set(g)}))}}]);
return b}(m.a),d=f.r.create(),e=function(a){function b(a,d){t(this,b);var e=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));e.chunkManager=a;e.displayState=d;e.registerDisposer(d.clipBounds.changed.add(function(){return a.chunkQueueManager.scheduleChunkUpdate()}));return e}n(b,a);k(b,[{key:"initializeCounterpartWithChunkManager",value:function(a){var d=this.displayState;a.chunkManager=this.chunkManager.rpcId;a.visibleSegments=d.visibleSegments.rpcId;a.segmentEquivalences=d.segmentEquivalences.rpcId;
a.clipBounds=d.clipBounds.rpcId;p(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"initializeCounterpart",this).call(this,this.chunkManager.rpc,a)}}]);return b}(Object(v.c)(c.b))},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function t(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(f,"a",function(){return k});m=c(13);var a=c.n(m);m=c(0);var b=c(138),l=function(){function a(a,b){for(var d=0;d<b.length;d++){var g=b[d];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,
g.key,g)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}(),r=function g(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return g(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},v=new function d(){t(this,d);b.a.initializeHead(this)},p=a()(function(){var a=document.activeElement;if(null===a||a===document.body)a=b.a.front(v),null!==a&&a.element.focus()});window.addEventListener("focus",
function(){p()},!0);window.addEventListener("blur",function(){p()},!0);var k=function(d){function e(d){t(this,e);var c=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));c.element=d;c.prev0=null;c.next0=null;c.lastFocusedElement=null;c.scheduleUpdateFocus=c.registerCancellable(a()(function(){var a=document.activeElement,b=c.element;b.contains(a)||((a===c.lastFocusedElement||a.contains(b))&&c.element.focus(),c.lastFocusedElement=null)},0));d.tabIndex=-1;c.registerEventListener(d,"mouseenter",
function(){c.lastFocusedElement=document.activeElement;c.scheduleUpdateFocus()});c.registerEventListener(d,"mouseleave",function(){c.scheduleUpdateFocus.cancel()});b.a.insertBefore(v,c);c.registerEventListener(d,"focus",function(){b.a.pop(c);b.a.insertAfter(v,c)});p();return c}n(e,d);l(e,[{key:"disposed",value:function(){b.a.pop(this);r(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}}]);return e}(m.a)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function t(a,b,d){for(var e=0;3>e;++e)a[e]=Number.POSITIVE_INFINITY,b[e]=Number.NEGATIVE_INFINITY;d=$jscomp.makeIterator(d);for(e=d.next();!e.done;e=d.next()){var g=e.value.spec;e=g.lowerChunkBound;
g=g.upperChunkBound;for(var c=0;3>c;++c)a[c]=Math.min(a[c],e[c]),b[c]=Math.max(b[c],g[c])}}function a(a,b,e,g){for(var c=d.FULLY_INSIDE,h=0;3>h;++h){var k=a[h];var f=b[h],w=e[h],l=g[h];k=k>=l||f<=w?d.FULLY_OUTSIDE:k>=w&&f<=l?d.FULLY_INSIDE:d.PARTIALLY_INSIDE;switch(k){case d.FULLY_OUTSIDE:return k;case d.PARTIALLY_INSIDE:c=k}}return c}function b(a,b){var d=b.length,e=0;if(1<d)for(var c=0,h=0;h<d;++h){var k=b[h].spec.chunkLayout;var f=k.size;k=k.globalToLocalSpatialVector(g,a);for(var w=0,l=0,p=1,
r=0;3>r;++r){var v=f[r];p*=v;v*=k[r];w=Math.min(w,v);l=Math.max(l,v)}f=p/(l-w);f>c&&(c=f,e=h)}return b[e]}function l(a){var b=a.voxelSize,d=void 0===a.lowerVoxelBound?k.h:a.lowerVoxelBound,e=a.upperVoxelBound,g=void 0===a.maxVoxelsPerChunkLog2?18:a.maxVoxelsPerChunkLog2;a=void 0===a.transform?k.d:a.transform;a=Object(k.c)(k.p.create(),a);b=k.p.multiply(a,a,b);a=k.p.fromValues(1,1,1);if(void 0===e)var c=k.f;else{c=k.p.create();for(var h=0;3>h;++h)c[h]=Math.pow(2,Math.floor(Math.log2(e[h]-d[h])))}for(d=
0;d<g;++d){e=Infinity;h=-1;for(var f=0;3>f;++f)if(!(a[f]>=c[f])){var w=a[f]*b[f];w<e&&(e=w,h=f)}e=h;if(-1===e)break;a[e]*=2}return a}c.d(f,"b",function(){return w});f.f=l;f.e=function(a,b){b=b.transform;return void 0===b?void 0===a?k.d:a:void 0===a?b:k.j.multiply(k.j.create(),b,a)};f.d=function(a){if(void 0!==a.chunkDataSizes)return a.chunkDataSizes;var b=void 0===a.chunkLayoutPreference?B.ISOTROPIC:a.chunkLayoutPreference;switch(b){case B.ISOTROPIC:return[l(a)];case B.FLAT:b=[];for(var d=0;3>d;++d){var e=
d;var c=a.lowerVoxelBound;var h=a.upperVoxelBound,f=d,w=a.voxelSize,r=a.maxVoxelsPerChunkLog2,p=a.transform;k.p.subtract(g,void 0===h?k.f:h,void 0===c?k.h:c);g[f]=1;c=l({voxelSize:w,upperVoxelBound:g,maxVoxelsPerChunkLog2:r,transform:p});b[e]=c}b.push(l(a));return b}throw Error("Invalid chunk layout preference: "+b+".");};c.d(f,"c",function(){return F});var r=c(142),v=c(82),p=c(143);c(27);var k=c(1);m=c(6);var h=function(){function a(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||
!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}(),g=k.p.create(),d;(function(a){a[a.FULLY_OUTSIDE=0]="FULLY_OUTSIDE";a[a.FULLY_INSIDE=1]="FULLY_INSIDE";a[a.PARTIALLY_INSIDE=2]="PARTIALLY_INSIDE"})(d||(d={}));var e=[k.p.create(),k.p.create(),k.p.create(),k.p.create()],w=function(c){function f(){q(this,f);var a=(f.__proto__||Object.getPrototypeOf(f)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
a=!a||"object"!==typeof a&&"function"!==typeof a?this:a;a.width=-1;a.height=-1;a.hasViewportToData=!1;a.hasValidViewport=!1;a.viewportToData=k.j.create();a.viewportAxes=[k.p.create(),k.p.create(),k.p.create()];a.previousViewportAxes=[k.p.create(),k.p.create()];a.centerDataPosition=k.p.create();a.viewportPlaneDistanceToOrigin=0;a.visibleChunkLayouts=new Map;a.visibleLayers=new Map;a.visibleSourcesStale=!0;a.pixelSize=0;k.j.identity(a.viewportToData);return a}n(f,c);h(f,[{key:"onViewportChanged",value:function(){}},
{key:"maybeSetHasValidViewport",value:function(){!this.hasValidViewport&&-1!==this.width&&-1!==this.height&&this.hasViewportToData&&(this.hasValidViewport=!0,this.onHasValidViewport());if(this.hasValidViewport)this.onViewportChanged()}},{key:"onHasValidViewport",value:function(){}},{key:"setViewportSize",value:function(a,b){return a!==this.width||b!==this.height?(this.width=a,this.height=b,this.maybeSetHasValidViewport(),!0):!1}},{key:"setViewportToDataMatrix",value:function(a){if(this.hasViewportToData&&
k.j.equals(this.viewportToData,a))return!1;this.hasViewportToData=!0;var b=this.viewportToData;k.j.copy(b,a);Object(k.m)(b);k.p.transformMat4(this.centerDataPosition,k.h,a);a=0;for(var d=this.viewportAxes,e=this.previousViewportAxes,g=0;3>g;++g){var c=d[g];Object(k.n)(c,k.e[g],b);0===g&&(a=k.p.length(c));k.p.normalize(c,c)}this.viewportAxes=d;this.previousViewportAxes=e;if(!Object(p.a)(a,this.pixelSize)||.95>k.p.dot(d[0],e[0])||.95>k.p.dot(d[1],e[1]))k.p.copy(e[0],d[0]),k.p.copy(e[1],d[1]),this.visibleSourcesStale=
!0,this.pixelSize=a;this.viewportPlaneDistanceToOrigin=k.p.dot(this.centerDataPosition,this.viewportAxes[2]);this.onViewportToDataMatrixChanged();this.maybeSetHasValidViewport();return!0}},{key:"onViewportToDataMatrixChanged",value:function(){}},{key:"updateVisibleSources",value:function(){if(this.visibleSourcesStale){this.visibleSourcesStale=!1;var a=1.1*this.pixelSize,d=this.visibleChunkLayouts,e=this.viewportAxes[2],g=this.visibleLayers;d.clear();var c={};g=$jscomp.makeIterator(g);for(var h=g.next();!h.done;c=
{smallestVoxelSize:c.smallestVoxelSize,visibleSources:c.visibleSources},h=g.next()){h=$jscomp.makeIterator(h.value);var k=h.next().value;c.visibleSources=h.next().value;c.visibleSources.length=0;h=k.sources;var f=h.length;k=void 0;c.smallestVoxelSize=h[0][0].spec.voxelSize;var w=function(b){return function(d){for(var e=0;3>e;++e){var g=d[e];if(g>a&&g>b.smallestVoxelSize[e])return!0}return!1}}(c),l=function(a){return function(b,e){a.visibleSources[a.visibleSources.length++]=b;var g=b.spec.chunkLayout,
c=d.get(g);void 0===c&&(c=new Map,d.set(g,c));c.set(b,e)}}(c);for(k=f-1;;){f=b(e,h[k]);l(f,k);if(0===k||!w(f.spec.voxelSize))break;--k}c.visibleSources.reverse()}}}},{key:"computeVisibleChunks",value:function(b,c){var h=this;this.updateVisibleSources();for(var f=this.width,w=this.height,l=this.viewportToData,r=0;3>r;++r)e[0][r]=-k.e[0][r]*f/2-k.e[1][r]*w/2,e[1][r]=-k.e[0][r]*f/2+k.e[1][r]*w/2,e[2][r]=k.e[0][r]*f/2-k.e[1][r]*w/2,e[3][r]=k.e[0][r]*f/2+k.e[1][r]*w/2;for(f=0;4>f;++f)k.p.transformMat4(e[f],
e[f],l);var p=k.p.create(),D=k.p.create(),x=k.p.create(),B=k.p.create(),A=k.p.create(),F=k.p.create(),n=[],q=[];this.visibleChunkLayouts.forEach(function(f,w){function z(){for(var a=0,b=0,d=0;3>d;++d){var e=F[d],g=p[d],c=D[d]-g,h=A[d]*c;a+=e*(g+h);b+=e*(g+c-h)}return a<H?!1:b<=H}function C(b){function e(){G=Object(v.b)(n,0,H,function(b){var e=b.spec;switch(a(p,D,e.lowerChunkBound,e.upperChunkBound)){case d.PARTIALLY_INSIDE:return!0;case d.FULLY_INSIDE:q.push(b);default:return!1}})}if(0!==q.length||
0!==G){for(var g=1,h=0;3>h;++h)g*=Math.max(0,D[h]-p[h]);if(0!==g&&z())if(1===g)c(w,l,p,q);else{for(var k;;)if(g=p[b],h=D[b],k=h-g,1===k)b=(b+1)%3;else break;k=g+Math.floor(.5*k);var f=(b+1)%3,r=q.length;D[b]=k;var H=G;e();C(f);q.length=r;G=H;D[b]=h;p[b]=k;e();C(f);p[b]=g;q.length=r;G=H}}}var l=b(w);t(x,B,f.keys());k.p.set(p,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);k.p.set(D,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);w.globalToLocalSpatialVector(F,
h.viewportAxes[2]);for(var r=0;3>r;++r)A[r]=0<F[r]?1:0;var H=k.p.dot(w.globalToLocalGrid(g,h.centerDataPosition),F);for(r=0;4>r;++r)for(var J=w.globalToLocalGrid(g,e[r]),E=0;3>E;++E)p[E]=Math.min(p[E],Math.floor(J[E])),D[E]=Math.max(D[E],Math.floor(J[E])+1);k.p.max(p,p,x);k.p.min(D,D,B);q.length=0;n.length=0;f=$jscomp.makeIterator(f.keys());for(r=f.next();!r.done;r=f.next())switch(r=r.value,J=r.spec,a(p,D,J.lowerChunkBound,J.upperChunkBound)){case d.FULLY_INSIDE:q.push(r);break;case d.PARTIALLY_INSIDE:n.push(r)}var G=
n.length;C(0)})}}]);return f}(m.b),B;(function(a){a[a.ISOTROPIC=0]="ISOTROPIC";a[a.FLAT=1]="FLAT"})(B||(B={}));var F=function A(a){q(this,A);var b=void 0===a.lowerVoxelBound?k.h:a.lowerVoxelBound,d=a.upperVoxelBound,e=a.chunkDataSize,g=a.voxelSize,c=a.transform,h=void 0===a.baseVoxelOffset?k.h:a.baseVoxelOffset,f=void 0===a.lowerClipBound?k.p.multiply(k.p.create(),g,b):a.lowerClipBound,w=void 0===a.upperClipBound?k.p.multiply(k.p.create(),g,d):a.upperClipBound;this.voxelSize=g;this.chunkDataSize=
e;this.chunkLayout=r.a.get(k.p.multiply(k.p.create(),a.chunkDataSize,g),c);this.lowerClipBound=f;this.upperClipBound=w;this.lowerVoxelBound=b;this.upperVoxelBound=d;this.baseVoxelOffset=h;a=this.lowerChunkBound=k.p.create();g=this.upperChunkBound=k.p.create();for(c=0;3>c;++c)a[c]=Math.floor(b[c]/e[c]),g[c]=Math.floor((d[c]-1)/e[c]+1)};f.a="SliceView"},function(m,f,c){function q(c){c.texParameteri(n.m,n.o,n.h);c.texParameteri(n.m,n.n,n.h);c.texParameteri(n.m,n.p,n.b);c.texParameteri(n.m,n.q,n.b)}f.b=
q;f.a=function(c,a,b,f,r,v){r=void 0===r?n.j:r;v=void 0===v?n.t:v;c.activeTexture(n.l+c.tempTextureUnit);c.bindTexture(n.m,a);q(c);c.texImage2D(n.m,0,r,b,f,0,r,v,null);c.bindTexture(n.m,null)};f.c=function(c,a,b){c.activeTexture(n.l+c.tempTextureUnit);c.bindTexture(n.m,a);c.texParameteri(n.m,n.o,n.e);c.texParameteri(n.m,n.n,n.e);c.texParameteri(n.m,n.p,n.b);c.texParameteri(n.m,n.q,n.b);c.pixelStorei(n.s,!0);c.pixelStorei(n.r,4);c.texImage2D(n.m,0,n.j,n.j,n.t,b);c.pixelStorei(n.s,!1);c.bindTexture(n.m,
null)};var n=c(20)},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):
a.__proto__=b)}function t(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(f,"a",function(){return r});c.d(f,"b",function(){return v});m=c(0);var a=c(3),b=function k(a,b,d){null===a&&(a=Function.prototype);var e=Object.getOwnPropertyDescriptor(a,b);if(void 0===e){if(a=Object.getPrototypeOf(a),null!==a)return k(a,b,d)}else{if("value"in e)return e.value;b=e.get;return void 0===b?void 0:b.call(d)}},l=function(){function a(a,b){for(var d=0;d<b.length;d++){var e=
b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,g,d){g&&a(b.prototype,g);d&&a(b,d);return b}}(),r=function(){function b(c,g){t(this,b);this.value_=c;this.defaultValue=g;this.changed=new a.a}l(b,[{key:"toggle",value:function(){this.value=!this.value}},{key:"toJSON",value:function(){if(this.value_!==this.defaultValue)return this.value_}},{key:"restoreState",value:function(a){this.value=!0===a||!1===a?a:this.defaultValue}},
{key:"reset",value:function(){this.value=this.defaultValue}},{key:"value",get:function(){return this.value_},set:function(a){a!==this.value_&&(this.value_=a,this.changed.dispatch())}}]);return b}(),v=function(a){function c(a){t(this,c);var b=q(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));b.model=a;b.element=document.createElement("input");var e=b.element;e.type="checkbox";b.registerDisposer(a.changed.add(function(){b.updateCheckbox()}));b.updateCheckbox();b.registerEventListener(e,"change",
function(b){a.value=this.checked});e.addEventListener("mousedown",function(a){a.preventDefault()});return b}n(c,a);l(c,[{key:"updateCheckbox",value:function(){this.element.checked=this.model.value}},{key:"disposed",value:function(){var a=this.element,d=a.parentElement;d&&d.removeChild(a);b(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"disposed",this).call(this)}}]);return c}(m.a);(function(a){function b(a,d){t(this,b);var e=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));e.model=
a;e.element=d;e.updateVisibility();e.registerDisposer(a.changed.add(function(){e.updateVisibility()}));return e}n(b,a);l(b,[{key:"updateVisibility",value:function(){this.element.style.display=this.model.value?"":"none"}}]);return b})(m.a)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==
typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b,d,e){var g=!1,c;a.registerDisposer(b);var h=p.UNLINKED,k=function(){var g=d.value;if(g!==h)switch(g){case p.UNLINKED:c=void 0;break;case p.LINKED:c=void 0;e.assign(a,
b);break;case p.RELATIVE:c=e.difference(a,b)}h=g;a.changed.dispatch()};a.registerDisposer(a.changed.add(function(){if(!g)switch(d.value){case p.LINKED:e.assign(b,a);break;case p.RELATIVE:e.subtract(b,a,c)}}));a.registerDisposer(b.changed.add(function(){g=!0;switch(d.value){case p.UNLINKED:if(e.isValid(a))break;case p.LINKED:e.assign(a,b);break;case p.RELATIVE:e.add(a,b,c)}g=!1}));a.registerDisposer(d.changed.add(k));k();return a}c.d(f,"d",function(){return p});c.d(f,"b",function(){return w});c.d(f,
"f",function(){return B});c.d(f,"a",function(){return F});c.d(f,"g",function(){return G});c.d(f,"c",function(){return x});c.d(f,"e",function(){return D});m=c(0);var b=c(1),l=c(2),r=c(3);c=c(208);var v=function(){function a(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}(),p;(function(a){a[a.LINKED=0]="LINKED";a[a.RELATIVE=1]="RELATIVE";
a[a.UNLINKED=2]="UNLINKED"})(p||(p={}));var k=function(a){function b(a){a=void 0===a?p.LINKED:a;q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,p,a))}t(b,a);return b}(c.a),h=function(a){function d(a){q(this,d);var e=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));e.changed=new r.a;var g=!0;null==a&&(a=b.p.create(),g=!1);e.size=a;e.valid=g;return e}t(d,a);v(d,[{key:"reset",value:function(){this.valid=!1;this.changed.dispatch()}},{key:"setValid",value:function(){this.valid||
(this.valid=!0,this.changed.dispatch())}},{key:"toJSON",value:function(){if(this.valid)return Array.prototype.slice.call(this.size)}},{key:"restoreState",value:function(a){try{Object(l.b)(this.size,a),this.valid=!0,this.changed.dispatch()}catch(J){this.valid=!1,this.changed.dispatch()}}},{key:"toString",value:function(){return this.valid?this.size.toString():null}},{key:"voxelFromSpatial",value:function(a,d){return b.p.divide(a,d,this.size)}},{key:"spatialFromVoxel",value:function(a,d){return b.p.multiply(a,
d,this.size)}}]);return d}(m.a),g=b.p.create(),d=b.l.create(),e=function(a){function d(a,e){q(this,d);var g=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));g.voxelCoordinates=null;g.changed=new r.a;null==a&&(a=new h);g.voxelSize=a;var c=!0;null==e&&(e=b.p.create(),c=!1);g.spatialCoordinates=e;g.spatialCoordinatesValid=c;g.registerDisposer(a);g.registerDisposer(a.changed.add(function(){g.handleVoxelSizeChanged()}));return g}t(d,a);v(d,[{key:"reset",value:function(){this.spatialCoordinatesValid=
!1;this.voxelCoordinates=null;this.voxelSize.reset();this.changed.dispatch()}},{key:"getVoxelCoordinates",value:function(a){var d=this.voxelCoordinates;if(d)b.p.copy(a,d);else if(this.valid)this.voxelSize.voxelFromSpatial(a,this.spatialCoordinates);else return!1;return!0}},{key:"setVoxelCoordinates",value:function(a){var d=this.voxelSize;d.valid?(d.spatialFromVoxel(this.spatialCoordinates,a),this.markSpatialCoordinatesChanged()):(d=this.voxelCoordinates)?b.p.copy(d,a):this.voxelCoordinates=b.p.clone(a);
this.changed.dispatch()}},{key:"markSpatialCoordinatesChanged",value:function(){this.spatialCoordinatesValid=!0;this.voxelCoordinates=null;this.changed.dispatch()}},{key:"handleVoxelSizeChanged",value:function(){null==this.voxelCoordinates||this.spatialCoordinatesValid||(this.voxelSize.spatialFromVoxel(this.spatialCoordinates,this.voxelCoordinates),this.spatialCoordinatesValid=!0);this.voxelCoordinates=null;this.changed.dispatch()}},{key:"toJSON",value:function(){var a=!0,b=this.voxelSize.toJSON(),
d={};void 0!==b&&(a=!1,d.voxelSize=b);this.voxelCoordinatesValid?(this.getVoxelCoordinates(g),d.voxelCoordinates=Array.prototype.slice.call(g),a=!1):this.spatialCoordinatesValid&&(d.spatialCoordinates=Array.prototype.slice.call(this.spatialCoordinates),a=!1);if(!a)return d}},{key:"restoreState",value:function(a){var d=this;Object(l.u)(a);Object(l.w)(a,"voxelSize",function(a){void 0!==a&&d.voxelSize.restoreState(a)});this.spatialCoordinatesValid=!1;Object(l.w)(a,"voxelCoordinates",function(a){void 0!==
a&&d.setVoxelCoordinates(Object(l.b)(b.p.create(),a))});Object(l.w)(a,"spatialCoordinates",function(a){void 0!==a&&(Object(l.b)(d.spatialCoordinates,a),d.markSpatialCoordinatesChanged())})}},{key:"snapToVoxel",value:function(){if(this.valid){for(var a=this.spatialCoordinates,b=this.voxelSize.size,d=0;3>d;++d){var e=b[d];a[d]=Math.round(a[d]/e)*e}this.changed.dispatch()}else if(a=this.voxelCoordinates,null!=a){for(b=0;3>b;++b)a[b]=Math.round(a[b]);this.changed.dispatch()}}},{key:"assign",value:function(a){this.spatialCoordinatesValid=
a.spatialCoordinatesValid;b.p.copy(this.spatialCoordinates,a.spatialCoordinates);this.voxelCoordinates=(a=a.voxelCoordinates)&&b.p.clone(a);this.changed.dispatch()}},{key:"valid",get:function(){return this.spatialCoordinatesValid&&this.voxelSize.valid}},{key:"voxelCoordinatesValid",get:function(){return this.valid||null!=this.voxelCoordinates}}],[{key:"getOffset",value:function(a,d){if(a.spatialCoordinatesValid&&d.spatialCoordinatesValid)return{spatialOffset:b.p.subtract(b.p.create(),a.spatialCoordinates,
d.spatialCoordinates)};if(a.voxelCoordinates&&d.voxelCoordinates){if(a.voxelSize!==d.voxelSize)throw Error("Voxel offsets are only meaningful with identical voxelSize.");return{voxelOffset:b.p.subtract(b.p.create(),a.voxelCoordinates,d.voxelCoordinates)}}return{}}},{key:"addOffset",value:function(a,d,e,c){c=void 0===c?1:c;var h=e.spatialOffset;e=e.voxelOffset;void 0!==h&&d.spatialCoordinatesValid?(b.p.scaleAndAdd(a.spatialCoordinates,d.spatialCoordinates,h,c),a.markSpatialCoordinatesChanged()):void 0!==
e&&d.getVoxelCoordinates(g)&&a.setVoxelCoordinates(b.p.scaleAndAdd(g,g,e,c))}}]);return d}(m.a);c=function(){function a(b,d){d=void 0===d?new k:d;q(this,a);this.peer=b;this.link=d}v(a,[{key:"toJSON",value:function(){var a=this.link;if(a.value!==p.LINKED)return{link:a.toJSON(),value:this.getValueJson()}}},{key:"getValueJson",value:function(){return this.value.toJSON()}},{key:"reset",value:function(){this.link.value=p.LINKED}},{key:"restoreState",value:function(a){var b=this;void 0===a?this.link.value=
p.LINKED:(Object(l.u)(a),this.link.value=p.UNLINKED,Object(l.w)(a,"value",function(a){void 0!==a&&b.value.restoreState(a)}),Object(l.w)(a,"link",function(a){return b.link.restoreState(a)}))}},{key:"copyToPeer",value:function(){this.link.value!==p.LINKED&&(this.link.value=p.UNLINKED,this.peer.assign(this.value),this.link.value=p.LINKED)}},{key:"changed",get:function(){return this.value.changed}}]);return a}();var w=function(b){function d(){q(this,d);var b=n(this,(d.__proto__||Object.getPrototypeOf(d)).apply(this,
arguments));b.value=a(new e(b.peer.voxelSize.addRef()),b.peer,b.link,{assign:function(a,b){return a.assign(b)},isValid:function(a){return a.spatialCoordinatesValid||a.voxelCoordinatesValid},difference:e.getOffset,add:e.addOffset,subtract:function(a,b,d){e.addOffset(a,b,d,-1)}});return b}t(d,b);v(d,[{key:"getValueJson",value:function(){var a=this.value.toJSON()||{};delete a.voxelSize;return a}}]);return d}(c),B=function(a){function d(a){q(this,d);var e=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));
e.changed=new r.a;null==a&&(a=b.l.create());e.orientation=a;return e}t(d,a);v(d,[{key:"toJSON",value:function(){var a=this.orientation;if(0!==a[0]||0!==a[1]||0!==a[2]||1!==a[3])return Array.prototype.slice.call(this.orientation)}},{key:"restoreState",value:function(a){try{Object(l.b)(this.orientation,a),b.l.normalize(this.orientation,this.orientation)}catch(J){b.l.identity(this.orientation)}this.changed.dispatch()}},{key:"reset",value:function(){b.l.identity(this.orientation);this.changed.dispatch()}},
{key:"snap",value:function(){var a=b.i.create();b.i.fromQuat(a,this.orientation);for(var d=[!1,!1,!1],e=0;3>e;++e){for(var g=0,c=0,h=0;3>h;++h){var k=a[3*e+h];a[3*e+h]=0;!d[h]&&Math.abs(k)>Math.abs(g)&&(g=k,c=h)}a[3*e+c]=Math.sign(g);d[c]=!0}b.l.fromMat3(this.orientation,a);this.changed.dispatch()}},{key:"assign",value:function(a){b.l.copy(this.orientation,a.orientation);this.changed.dispatch()}}],[{key:"makeRelative",value:function(a,e){var g=new d(b.l.multiply(b.l.create(),a.orientation,e)),c=!1;
g.registerDisposer(a.changed.add(function(){c||(h=!0,b.l.multiply(g.orientation,a.orientation,e),g.changed.dispatch(),h=!1)}));var h=!1,k=b.l.invert(b.l.create(),e);g.registerDisposer(g.changed.add(function(){h||(c=!0,b.l.multiply(a.orientation,g.orientation,k),a.changed.dispatch(),c=!1)}));return g}}]);return d}(m.a),F=function(e){function g(){q(this,g);var e=n(this,(g.__proto__||Object.getPrototypeOf(g)).apply(this,arguments));e.value=a(new B,e.peer,e.link,{assign:function(a,b){return a.assign(b)},
isValid:function(){return!0},difference:function(a,d){var e=b.l.create();return b.l.multiply(e,b.l.invert(e,d.orientation),a.orientation)},add:function(a,d,e){b.l.multiply(a.orientation,d.orientation,e);a.changed.dispatch()},subtract:function(a,e,g){b.l.multiply(a.orientation,e.orientation,b.l.invert(d,g));a.changed.dispatch()}});return e}t(g,e);return g}(c),G=function(a){function c(a,b){q(this,c);var d=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));d.changed=new r.a;null==a&&(a=new e);
d.position=a;null==b&&(b=new B);d.orientation=b;d.registerDisposer(d.position);d.registerDisposer(d.orientation);d.registerDisposer(d.position.changed.add(d.changed.dispatch));d.registerDisposer(d.orientation.changed.add(d.changed.dispatch));return d}t(c,a);v(c,[{key:"reset",value:function(){this.position.reset();this.orientation.reset()}},{key:"toMat4",value:function(a){b.j.fromRotationTranslation(a,this.orientation.orientation,this.position.spatialCoordinates)}},{key:"toJSON",value:function(){var a=
this.position.toJSON(),b=this.orientation.toJSON();if(void 0!==a||void 0!==b)return{position:a,orientation:b}}},{key:"restoreState",value:function(a){var b=this;Object(l.u)(a);Object(l.w)(a,"position",function(a){void 0!==a&&b.position.restoreState(a)});Object(l.w)(a,"orientation",function(a){void 0!==a&&b.orientation.restoreState(a)})}},{key:"snap",value:function(){this.orientation.snap();this.position.snapToVoxel();this.changed.dispatch()}},{key:"translateAbsolute",value:function(a){b.p.add(this.position.spatialCoordinates,
this.position.spatialCoordinates,a);this.position.changed.dispatch()}},{key:"translateRelative",value:function(a){this.valid&&(b.p.transformQuat(g,a,this.orientation.orientation),b.p.add(this.position.spatialCoordinates,this.position.spatialCoordinates,g),this.position.changed.dispatch())}},{key:"translateVoxelsRelative",value:function(a){if(this.valid){var d=b.p.create();b.p.transformQuat(d,a,this.orientation.orientation);b.p.multiply(d,d,this.position.voxelSize.size);b.p.add(this.position.spatialCoordinates,
this.position.spatialCoordinates,d);this.position.changed.dispatch()}}},{key:"rotateRelative",value:function(a,d){var e=b.l.create();b.l.setAxisAngle(e,a,d);a=this.orientation.orientation;b.l.multiply(a,a,e);this.orientation.changed.dispatch()}},{key:"rotateAbsolute",value:function(a,e,c){var h=b.l.create();b.l.setAxisAngle(h,a,e);a=this.orientation.orientation;if(void 0!==c){e=this.position.spatialCoordinates;var k=b.p.subtract(g,c,e),f=b.l.invert(d,a);b.p.transformQuat(k,k,f);b.l.multiply(a,h,a);
b.p.transformQuat(e,k,a);b.p.subtract(e,c,e);this.position.changed.dispatch()}else b.l.multiply(a,h,a);this.orientation.changed.dispatch()}},{key:"valid",get:function(){return this.position.valid}}]);return c}(m.a),A=function(a){function b(a,d){a=void 0===a?Number.NaN:a;d=void 0===d?a:d;q(this,b);var e=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));e.value_=a;e.defaultValue=d;e.changed=new r.a;return e}t(b,a);v(b,[{key:"toJSON",value:function(){var a=this.value_,b=this.defaultValue;if(!(Number.isNaN(a)&&
Number.isNaN(b)||a===b))return a}},{key:"restoreState",value:function(a){"number"===typeof a&&Number.isFinite(a)&&0<a?this.value=a:this.value=this.defaultValue}},{key:"reset",value:function(){this.value=this.defaultValue}},{key:"zoomBy",value:function(a){var b=this.value_;Number.isNaN(b)||(this.value=b*a)}},{key:"assign",value:function(a){this.value=a.value}},{key:"value",get:function(){return this.value_},set:function(a){a!==this.value_&&(this.value_=a,this.changed.dispatch())}},{key:"valid",get:function(){return!Number.isNaN(this.value)}}]);
return b}(m.a),x=function(b){function d(){q(this,d);var b=n(this,(d.__proto__||Object.getPrototypeOf(d)).apply(this,arguments));b.value=function(){var d=new A;return a(d,b.peer,b.link,{assign:function(a,b){return a.assign(b)},isValid:function(a){return a.valid},difference:function(a,b){return a.value/b.value},add:function(a,b,d){a.value=b.value*d},subtract:function(a,b,d){a.value=b.value/d}})}();return b}t(d,b);return d}(c),D=function(a){function d(a,b){a=void 0===a?new G:a;b=void 0===b?Number.NaN:
b;q(this,d);var e=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));e.pose=a;e.changed=new r.a;e.zoomFactor="number"===typeof b?new A(b):b;e.registerDisposer(e.zoomFactor);e.registerDisposer(a);e.registerDisposer(e.pose.changed.add(function(){e.changed.dispatch()}));e.registerDisposer(e.zoomFactor.changed.add(function(){e.changed.dispatch()}));e.registerDisposer(e.voxelSize.changed.add(function(){e.handleVoxelSizeChanged()}));e.handleVoxelSizeChanged();return e}t(d,a);v(d,[{key:"reset",value:function(){this.pose.reset();
this.zoomFactor.reset()}},{key:"setZoomFactorFromVoxelSize",value:function(){this.voxelSize.valid&&(this.zoomFactor.value=Math.min.apply(null,this.voxelSize.size))}},{key:"handleVoxelSizeChanged",value:function(){this.zoomFactor.valid||this.setZoomFactorFromVoxelSize()}},{key:"toMat4",value:function(a){this.pose.toMat4(a);var d=this.zoomFactor.value;b.j.scale(a,a,b.p.fromValues(d,d,d))}},{key:"toJSON",value:function(){var a=this.pose.toJSON(),b=this.zoomFactor.toJSON();if(void 0!==a||void 0!==b)return{pose:a,
zoomFactor:b}}},{key:"restoreState",value:function(a){var b=this;try{Object(l.u)(a),Object(l.w)(a,"pose",function(a){void 0!==a&&b.pose.restoreState(a)}),Object(l.w)(a,"zoomFactor",function(a){void 0!==a&&b.zoomFactor.restoreState(a)}),this.handleVoxelSizeChanged(),this.changed.dispatch()}catch(E){this.reset()}}},{key:"zoomBy",value:function(a){this.zoomFactor.zoomBy(a)}},{key:"voxelSize",get:function(){return this.pose.position.voxelSize}},{key:"position",get:function(){return this.pose.position}},
{key:"valid",get:function(){return this.pose.valid}}]);return d}(m.a)},function(m,f){},function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function n(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
}function t(a){var b=p.get(a),g=a.changed.count;if(void 0!==b&&b.generation===g)return b;if(a instanceof v){var d=a.baseJSON();for(var e=$jscomp.makeIterator(a.children),c=e.next();!c.done;c=e.next()){var k=$jscomp.makeIterator(c.value);c=k.next().value;k=k.next().value;d[c]=t(k).value}}else d=a.toJSON();void 0===b?(b={generation:g,value:d},p.set(a,b)):(b.generation=g,b.value=d);return b}c.d(f,"a",function(){return v});f.b=t;var a=c(2),b=c(3),l=function h(a,b,e){null===a&&(a=Function.prototype);var d=
Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return h(a,b,e)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(e)}},r=function(){function a(a,b){for(var d=0;d<b.length;d++){var g=b[d];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}(),v=function(){function c(){n(this,c);this.children=new Map;this.changed=
new b.a}r(c,[{key:"add",value:function(a,b){var d=this;if(this.children.has(a))throw Error("Key "+JSON.stringify(a)+" already registered.");this.children.set(a,b);b.changed.add(this.changed.dispatch);this.changed.dispatch();return function(){d.remove(a)}}},{key:"remove",value:function(a){var b=this.children;if(b.has(a))throw Error("Key "+JSON.stringify(a)+" not registered.");b=b.get(a);this.children.delete(a);b.changed.remove(this.changed.dispatch);this.changed.dispatch()}},{key:"dispose",value:function(){for(var a=
this.changed,b=$jscomp.makeIterator(this.children.values()),e=b.next();!e.done;e=b.next())e.value.changed.remove(a.dispatch);this.children=void 0}},{key:"toJSON",value:function(){for(var a=this.baseJSON(),b=$jscomp.makeIterator(this.children),e=b.next();!e.done;e=b.next()){var c=$jscomp.makeIterator(e.value);e=c.next().value;c=c.next().value;a[e]=c.toJSON()}return a}},{key:"baseJSON",value:function(){return{}}},{key:"reset",value:function(){for(var a=$jscomp.makeIterator(this.children.values()),b=
a.next();!b.done;b=a.next())b.value.reset()}},{key:"restoreState",value:function(b){Object(a.u)(b);for(var d=$jscomp.makeIterator(this.children),e=d.next();!e.done;e=d.next()){var c=$jscomp.makeIterator(e.value);e=c.next().value;c=c.next().value;try{b.hasOwnProperty(e)&&c.restoreState(b[e])}catch(B){throw Error("Error restoring property "+JSON.stringify(e)+": "+B.message);}}}}]);return c}();(function(b){function c(){n(this,c);var a=(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
a=!a||"object"!==typeof a&&"function"!==typeof a?this:a;a.lastState={};return a}q(c,b);r(c,[{key:"restoreState",value:function(b){Object(a.u)(b);this.lastState=b;l(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"restoreState",this).call(this,b)}},{key:"reset",value:function(){this.lastState={};l(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"reset",this).call(this)}},{key:"baseJSON",value:function(){for(var a=Object.assign(l(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),
"baseJSON",this).call(this),this.lastState),b=$jscomp.makeIterator(this.children.keys()),g=b.next();!g.done;g=b.next())delete a[g.value];return a}},{key:"toJSON",value:function(){var a=l(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"toJSON",this).call(this);return this.lastState=a}},{key:"add",value:function(a,b){var d=l(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"add",this).call(this,a,b);a=this.lastState[a];void 0!==a&&(b.reset(),b.restoreState(a));return d}}]);return c})(v);
var p=new WeakMap},function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return b});var n=c(5);m=c(6);var t=function(){function a(a,b){for(var c=0;c<b.length;c++){var h=b[c];h.enumerable=h.enumerable||!1;
h.configurable=!0;"value"in h&&(h.writable=!0);Object.defineProperty(a,h.key,h)}}return function(b,c,k){c&&a(b.prototype,c);k&&a(b,k);return b}}(),a=function v(a,b,c){null===a&&(a=Function.prototype);var g=Object.getOwnPropertyDescriptor(a,b);if(void 0===g){if(a=Object.getPrototypeOf(a),null!==a)return v(a,b,c)}else{if("value"in g)return g.value;b=g.get;return void 0===b?void 0:b.call(c)}};f=this&&this.__decorate||function(a,b,c,h){var g=arguments.length,d=3>g?b:null===h?h=Object.getOwnPropertyDescriptor(b,
c):h,e;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)d=Reflect.decorate(a,b,c,h);else for(var k=a.length-1;0<=k;k--)if(e=a[k])d=(3>g?e(d):3<g?e(b,c,d):e(b,c))||d;return 3<g&&d&&Object.defineProperty(b,c,d),d};var b=l=function(b){function c(a,b){b=void 0===b?{}:b;if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");var g=(c.__proto__||Object.getPrototypeOf(c)).call(this,a,b);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
g=!g||"object"!==typeof g&&"function"!==typeof g?this:g;g.updatingValue_=!1;void 0!==a&&(g.base=new n.b(b.value),g.setupChangedHandler());return g}q(c,b);t(c,[{key:"initializeCounterpart",value:function(b,h){h=void 0===h?{}:h;h.value=this.value;a(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"initializeCounterpart",this).call(this,b,h)}},{key:"setupChangedHandler",value:function(){var a=this;this.registerDisposer(this.base.changed.add(function(){if(a.updatingValue_)a.updatingValue_=!1;
else{var b=a.rpc;null!==b&&b.invoke("SharedWatchableValue.changed",{id:a.rpcId,value:a.value})}}))}},{key:"value",get:function(){return this.base.value},set:function(a){this.base.value=a}},{key:"changed",get:function(){return this.base.changed}}],[{key:"makeFromExisting",value:function(a,b){var c=new l;c.base=b;c.setupChangedHandler();c.initializeCounterpart(a);return c}},{key:"make",value:function(a,b){return l.makeFromExisting(a,new n.b(b))}}]);return c}(m.c);b=l=f([Object(m.f)("SharedWatchableValue")],
b);Object(m.e)("SharedWatchableValue.changed",function(a){var b=this.get(a.id);b.updatingValue_=!0;b.base.value=a.value;b.updatingValue_=!1});var l},function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function n(a,b){if(!(a instanceof
b))throw new TypeError("Cannot call a class as a function");}c.d(f,"a",function(){return r});c.d(f,"b",function(){return v});var t=c(0),a=c(2),b=function k(a,b,d){null===a&&(a=Function.prototype);var e=Object.getOwnPropertyDescriptor(a,b);if(void 0===e){if(a=Object.getPrototypeOf(a),null!==a)return k(a,b,d)}else{if("value"in e)return e.value;b=e.get;return void 0===b?void 0:b.call(d)}},l=function(){function a(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=
!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),r=function(){function a(){n(this,a);this.map=new Map}l(a,[{key:"get",value:function(a,b){var d=this.map,e=d.get(a);void 0===e?(e=b(),e.registerDisposer(function(){d.delete(a)}),d.set(a,e)):e.addRef();return e}}]);return a}(),v=function(c){function h(){n(this,h);var a=(h.__proto__||Object.getPrototypeOf(h)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!a||"object"!==typeof a&&"function"!==typeof a?this:a}q(h,c);l(h,[{key:"get",value:function(c,d){"string"!==typeof c&&(c=Object(a.g)(c));return b(h.prototype.__proto__||Object.getPrototypeOf(h.prototype),"get",this).call(this,c,d)}},{key:"getUncounted",value:function(a,b){return this.get(a,function(){return new t.b(b())}).value}}]);return h}(r)},function(m,f,c){f.b=function(c,a,b,f){f=void 0===f?q.e:f;var l=void 0;return new Promise(function(r,p){function k(g){null!==l&&(l=Object(n.b)(c.serverUrls,
b.path,b.method),l.responseType=b.responseType,l.setRequestHeader("Authorization",g.credentials.tokenType+" "+g.credentials.accessToken),l.onloadend=function(){if(null!==l){var b=this.status;200<=b&&300>b?(f.remove(h),r(this.response)):401===b?a.get(g,f).then(k):504===b||503===b?a.get(void 0,f).then(k):(f.remove(h),p(n.a.fromXhr(this)))}},l.send(b.payload))}var h=function(){var a=l;l=null;null!=a&&a.abort();p(q.a)};f.add(h);a.get(void 0,f).then(k)})};var q=c(14),n=c(31);f.a="google-brainmaps"},function(m,
f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function t(a,b){if(!(a instanceof
b))throw new TypeError("Cannot call a class as a function");}c.d(f,"a",function(){return B});c.d(f,"b",function(){return G});var a=c(23);m=c(10);var b=c(122);f=c(32);var l=c(37),r=c(1),v=c(19),p=c(17),k=c(25),h=c(7);c=c(6);var g=function D(a,b,d){null===a&&(a=Function.prototype);var e=Object.getOwnPropertyDescriptor(a,b);if(void 0===e){if(a=Object.getPrototypeOf(a),null!==a)return D(a,b,d)}else{if("value"in e)return e.value;b=e.get;return void 0===b?void 0:b.call(d)}},d=function(){function a(a,b){for(var d=
0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}(),e=this&&this.__decorate||function(a,b,d,e){var c=arguments.length,g=3>c?b:null===e?e=Object.getOwnPropertyDescriptor(b,d):e,h;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)g=Reflect.decorate(a,b,d,e);else for(var k=a.length-1;0<=k;k--)if(h=a[k])g=(3>c?h(g):3<c?h(b,d,g):h(b,
d))||g;return 3<c&&g&&Object.defineProperty(b,d,g),g},w=function(){function a(){t(this,a);this.tempLightVec=new Float32Array(4);this.tempPickID=new Float32Array(4)}d(a,[{key:"defineShader",value:function(a){a.addAttribute("highp vec3","aVertexPosition");a.addAttribute("highp vec3","aVertexNormal");a.addVarying("highp vec4","vColor");a.addUniform("highp vec4","uLightDirection");a.addUniform("highp vec4","uColor");a.addUniform("highp mat4","uModelMatrix");a.addUniform("highp mat4","uProjection");a.addUniform("highp vec4",
"uPickID");a.setVertexMain("\ngl_Position = uProjection * (uModelMatrix * vec4(aVertexPosition, 1.0));\nvec3 normal = (uModelMatrix * vec4(aVertexNormal, 0.0)).xyz;\nfloat lightingFactor = abs(dot(normal, uLightDirection.xyz)) + uLightDirection.w;\nvColor = vec4(lightingFactor * uColor.rgb, uColor.a);\n");a.setFragmentMain("emit(vColor, uPickID);")}},{key:"beginLayer",value:function(a,b,d){var e=d.dataToDevice,c=d.lightDirection,g=d.ambientLighting;d=d.directionalLighting;a.uniformMatrix4fv(b.uniform("uProjection"),
!1,e);e=this.tempLightVec;r.p.scale(e,c,d);e[3]=g;a.uniform4fv(b.uniform("uLightDirection"),e)}},{key:"setColor",value:function(a,b,d){a.uniform4fv(b.uniform("uColor"),d)}},{key:"setPickID",value:function(a,b,d){a.uniform4fv(b.uniform("uPickID"),Object(h.p)(this.tempPickID,d))}},{key:"beginObject",value:function(a,b,d){a.uniformMatrix4fv(b.uniform("uModelMatrix"),!1,d)}},{key:"getShader",value:function(a,b){var d=this;return a.memoize.get("mesh/MeshShaderManager:"+Object(v.a)(b),function(){var e=
new k.a(a);e.require(b);d.defineShader(e);return e.build()})}},{key:"drawFragment",value:function(a,b,d){d.vertexBuffer.bindToVertexAttrib(b.attribute("aVertexPosition"),3);d.normalBuffer.bindToVertexAttrib(b.attribute("aVertexNormal"),3);d.indexBuffer.bind();a.drawElements(a.TRIANGLES,d.numIndices,a.UNSIGNED_INT,0)}},{key:"endLayer",value:function(a,b){a.disableVertexAttribArray(b.attribute("aVertexPosition"));a.disableVertexAttribArray(b.attribute("aVertexNormal"))}}]);return a}(),B=function(e){function c(a,
d,e){t(this,c);var g=q(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));g.chunkManager=a;g.source=d;g.displayState=e;g.meshShaderManager=new w;g.shaders=new Map;Object(l.f)(e,g);a=g.sharedObject=g.registerDisposer(new l.b(a,e));a.RPC_TYPE_ID=b.b;a.initializeCounterpartWithChunkManager({source:d.addCounterpartRef()});g.setReady(!0);a.visibility.add(g.visibility);return g}n(c,e);d(c,[{key:"getShader",value:function(a){var b=this.shaders,d=b.get(a);void 0===d&&(d=this.registerDisposer(this.meshShaderManager.getShader(this.gl,
a)),b.set(a,d));return d}},{key:"draw",value:function(b){var d=this;if(b.emitColor||!b.alreadyEmittedPickID){var e=this.gl,c=this.displayState,g=this.meshShaderManager,h=Math.min(1,c.objectAlpha.value);if(!(0>=h)){var k=this.getShader(b.emitter);k.bind();g.beginLayer(e,k,b);var f=b.pickIDs,w=this.displayState.objectToDataTransform.transform;Object(l.d)(c,this.source.fragmentSource.objectChunks,function(z,r,C){b.emitColor&&g.setColor(e,k,Object(l.e)(c,z,h));b.emitPickID&&g.setPickID(e,k,f.registerUint64(d,
r));g.beginObject(e,k,w);z=$jscomp.makeIterator(C);for(r=z.next();!r.done;r=z.next())r=r.value,r.state===a.d.GPU_MEMORY&&g.drawFragment(e,k,r)});g.endLayer(e,k)}}}},{key:"isTransparent",get:function(){return 1>this.displayState.objectAlpha.value}},{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}}]);return c}(f.a),F=function(a){function b(a,d){t(this,b);a=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));a.objectKey=d.objectKey;a.vertexPositions=d.vertexPositions;
var e=a.indices=d.indices;a.numIndices=e.length;a.vertexNormals=d.vertexNormals;return a}n(b,a);d(b,[{key:"copyToGPU",value:function(a){g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"copyToGPU",this).call(this,a);this.vertexBuffer=p.a.fromData(a,this.vertexPositions,a.ARRAY_BUFFER,a.STATIC_DRAW);this.indexBuffer=p.a.fromData(a,this.indices,a.ELEMENT_ARRAY_BUFFER,a.STATIC_DRAW);this.normalBuffer=p.a.fromData(a,this.vertexNormals,a.ARRAY_BUFFER,a.STATIC_DRAW)}},{key:"freeGPUMemory",value:function(a){g(b.prototype.__proto__||
Object.getPrototypeOf(b.prototype),"freeGPUMemory",this).call(this,a);this.vertexBuffer.dispose();this.indexBuffer.dispose();this.normalBuffer.dispose()}}]);return b}(m.b),G=function(a){function b(){t(this,b);var a=q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments));a.fragmentSource=a.registerDisposer(new A(a.chunkManager,a));return a}n(b,a);d(b,[{key:"initializeCounterpart",value:function(a,d){this.fragmentSource.initializeCounterpart(this.chunkManager.rpc,{});d.fragmentSource=
this.fragmentSource.addCounterpartRef();g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"initializeCounterpart",this).call(this,a,d)}}]);return b}(m.e),A=function(a){function b(a,d){t(this,b);a=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));a.meshSource=d;a.objectChunks=new Map;return a}n(b,a);d(b,[{key:"addChunk",value:function(a,d){g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"addChunk",this).call(this,a,d);a=this.objectChunks;var e=d.objectKey,c=a.get(e);
void 0===c&&(c=new Set,a.set(e,c));c.add(d)}},{key:"deleteChunk",value:function(a){var d=this.chunks.get(a);g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"deleteChunk",this).call(this,a);a=this.objectChunks;var e=d.objectKey,c=a.get(e);c.delete(d);0===c.size&&a.delete(e)}},{key:"getChunk",value:function(a){return new F(this,a)}}]);return b}(m.e);A=e([Object(c.g)(b.a)],A)},function(m,f){m.exports=function(c){var f=typeof c;return null!=c&&("object"==f||"function"==f)}},function(m,f,c){function q(a,
b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?
Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){a.addFragmentCode("\nvoid emit(vec4 color, vec4 pickId) {\n  gl_FragColor = color;\n}\n")}function b(a){a.addFragmentCode("\nvoid emit(vec4 color, vec4 pickId) {\n  gl_FragColor = pickId;\n}\n")}c.d(f,"b",function(){return F});c.d(f,"a",function(){return G});var l=c(76),r=c(12),v=c(78);m=c(79);var p=c(35),k=c(15),h=c(1),g=c(83),d=c(52),e=c(84),w=function(){function a(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=
!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}(),B;(function(a){a[a.COLOR=0]="COLOR";a[a.PICK=1]="PICK";a[a.NUM_TEXTURES=2]="NUM_TEXTURES"})(B||(B={}));var F=function(a){function b(){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}t(b,a);w(b,[{key:"draw",value:function(a){}}]);return b}(r.h),G=function(c){function f(b,c,w,x){q(this,f);var z=n(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,
b,c,x));z.sliceView=w;z.axesLineHelper=z.registerDisposer(l.a.get(z.gl));z.sliceViewRenderHelper=z.registerDisposer(p.d.get(z.gl,a));z.colorFactor=h.r.fromValues(1,1,1,1);z.backgroundColor=h.r.fromValues(1,1,1,1);z.pickIDs=new v.a;z.visibleLayerTracker=Object(r.i)(z.viewer.layerManager,F,z);z.offscreenFramebuffer=z.registerDisposer(new d.b(z.gl,{colorBuffers:Object(d.e)(z.gl,B.NUM_TEXTURES)}));z.offscreenCopyHelper=z.registerDisposer(d.c.get(z.gl));z.scaleBarCopyHelper=z.registerDisposer(d.c.get(z.gl));
z.scaleBarTexture=z.registerDisposer(new e.a(z.gl));Object(k.c)(c,"translate-via-mouse-drag",function(a){z.viewer.mouseState.updateUnconditionally()&&Object(g.a)(a.detail,function(a,b,d){a=z.viewer.navigationState.position;var e=a.spatialCoordinates;h.p.set(e,b,d,0);h.p.transformMat4(e,e,z.sliceView.viewportToData);a.changed.dispatch()})});Object(k.c)(c,"rotate-via-mouse-drag",function(a){var b=z.viewer.mouseState;if(b.updateUnconditionally()){var d=h.p.clone(b.position);Object(g.a)(a.detail,function(a,
b,e){a=z.sliceView.viewportAxes;z.viewer.navigationState.pose.rotateAbsolute(a[1],b/4*Math.PI/180,d);z.viewer.navigationState.pose.rotateAbsolute(a[0],e/4*Math.PI/180,d)})}});z.registerDisposer(w);z.registerDisposer(w.visibility.add(z.visibility));z.registerDisposer(w.viewChanged.add(function(){z.visible&&b.scheduleRedraw()}));z.registerDisposer(x.showAxisLines.changed.add(function(){z.visible&&z.scheduleRedraw()}));z.registerDisposer(x.showScaleBar.changed.add(function(){z.visible&&z.context.scheduleRedraw()}));
return z}t(f,c);w(f,[{key:"draw",value:function(){var d=this.sliceView;if(d.hasValidViewport){this.onResize();d.updateRendering();var e=this.gl,c=d.width,g=d.height,k=d.dataToDevice;this.offscreenFramebuffer.bind(c,g);e.disable(e.SCISSOR_TEST);this.gl.clearColor(0,0,0,0);e.clear(e.COLOR_BUFFER_BIT);var f=h.j.create();this.sliceViewRenderHelper.draw(d.offscreenFramebuffer.colorBuffers[0].texture,h.d,this.colorFactor,this.backgroundColor,0,0,1,1);var w=this.visibleLayerTracker.getVisibleLayers(),l=
this.pickIDs;l.clear();this.offscreenFramebuffer.bindSingle(B.COLOR);l={dataToDevice:d.dataToDevice,pickIDs:l,emitter:a,emitColor:!0,emitPickID:!1,viewportWidth:c,viewportHeight:g};e.enable(e.BLEND);e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA);for(var r=$jscomp.makeIterator(w),p=r.next();!p.done;p=r.next())p.value.draw(l);e.disable(e.BLEND);this.offscreenFramebuffer.bindSingle(B.PICK);l.emitColor=!1;l.emitPickID=!0;l.emitter=b;w=$jscomp.makeIterator(w);for(p=w.next();!p.done;p=w.next())p.value.draw(l);
if(this.viewer.showAxisLines.value||this.viewer.showScaleBar.value){if(this.viewer.showAxisLines.value){h.j.copy(f,k);for(k=0;3>k;++k)f[12+k]=0;for(k=0;4>k;++k)f[2+4*k]=0;g=Math.min(c,g)/4*1.5;k=d.pixelSize;for(w=0;12>w;++w)f[w]=f[w]*g*k}this.offscreenFramebuffer.bindSingle(B.COLOR);this.viewer.showAxisLines.value&&this.axesLineHelper.draw(f);this.viewer.showScaleBar.value&&(e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),f=this.scaleBarTexture,g=f.dimensions,g.targetLengthInPixels=
Math.min(c/4,100),g.nanometersPerPixel=d.pixelSize,f.update(),e.viewport(10,10,f.width,f.height),this.scaleBarCopyHelper.draw(f.texture),e.disable(e.BLEND))}this.offscreenFramebuffer.unbind();this.setGLViewport();this.offscreenCopyHelper.draw(this.offscreenFramebuffer.colorBuffers[B.COLOR].texture)}}},{key:"onResize",value:function(){this.sliceView.setViewportSize(this.element.clientWidth,this.element.clientHeight)}},{key:"updateMouseState",value:function(a){a.pickedRenderLayer=null;var b=this.sliceView;
if(!b.hasValidViewport)return!1;var d=b.width,e=b.height,c=this.offscreenFramebuffer;if(!c.hasSize(d,e))return!1;var g=a.position,k=this.mouseX,f=this.mouseY;h.p.set(g,k-d/2,f-e/2,0);h.p.transformMat4(g,g,b.viewportToData);this.pickIDs.setMouseState(a,c.readPixelAsUint32(B.PICK,k,e-f));return!0}},{key:"zoomByMouse",value:function(a){var b=this.navigationState;if(b.valid){var d=this.sliceView,e=d.height,c=this.mouseX,g=this.mouseY;c-=d.width/2;g-=e/2;e=this.navigationState.zoomFactor.value;b.zoomBy(a);
a=b.zoomFactor.value;var k=b.position.spatialCoordinates;h.p.scaleAndAdd(k,k,d.viewportAxes[0],c*(e-a));h.p.scaleAndAdd(k,k,d.viewportAxes[1],g*(e-a));b.position.changed.dispatch()}}},{key:"navigationState",get:function(){return this.sliceView.navigationState}}]);return f}(m.a)},function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,
writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return v});m=c(12);var n=c(1),t=c(28),a=c(25),b=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,g){c&&a(b.prototype,c);g&&a(b,g);return b}}(),l=function k(a,b,d){null===a&&(a=Function.prototype);var e=Object.getOwnPropertyDescriptor(a,
b);if(void 0===e){if(a=Object.getPrototypeOf(a),null!==a)return k(a,b,d)}else{if("value"in e)return e.value;b=e.get;return void 0===b?void 0:b.call(d)}},r=n.p.create(),v=function(c){function h(a,b,e){e=void 0===e?{}:e;var d=void 0===e.shaderError?Object(t.b)():e.shaderError;if(!(this instanceof h))throw new TypeError("Cannot call a class as a function");e=(h.__proto__||Object.getPrototypeOf(h)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
e=!e||"object"!==typeof e&&"function"!==typeof e?this:e;e.sources=null;e.sourceIds=[];e.shader=void 0;e.shaderUpdated=!0;e.rpcId=null;e.shaderError=d;d.value=void 0;e.chunkManager=a;e.sources=b;a=$jscomp.makeIterator(b);for(b=a.next();!b.done;b=a.next()){d=b.value;b=[];e.sourceIds.push(b);d=$jscomp.makeIterator(d);for(var c=d.next();!c.done;c=d.next())b.push(c.value.rpcId)}a=e.sources[0][0].spec;b=a.chunkLayout;d=e.voxelSize=b.localSpatialVectorToGlobal(n.p.create(),a.voxelSize);for(c=0;3>c;++c)d[c]=
Math.abs(d[c]);d=e.boundingBox=new n.b(n.p.fromValues(Infinity,Infinity,Infinity),n.p.fromValues(-Infinity,-Infinity,-Infinity));c=n.p.create();for(var g=0;8>g;++g){for(var f=0;3>f;++f)r[f]=g&1<<f?a.upperClipBound[f]:a.lowerClipBound[f];b.localSpatialToGlobal(c,r);n.p.min(d.lower,d.lower,c);n.p.max(d.upper,d.upper,c)}e.setReady(!0);return e}q(h,c);b(h,[{key:"initializeShader",value:function(){if(this.shaderUpdated){this.shaderUpdated=!1;try{var a=this.getShader();this.disposeShader();this.shader=
a;this.shaderError.value=null}catch(d){this.shaderError.value=d}}}},{key:"disposeShader",value:function(){this.shader&&(this.shader.dispose(),this.shader=void 0)}},{key:"disposed",value:function(){l(h.prototype.__proto__||Object.getPrototypeOf(h.prototype),"disposed",this).call(this);this.disposeShader()}},{key:"getShaderKey",value:function(){return""}},{key:"getShader",value:function(){var a=this,b=this.getShaderKey();return this.gl.memoize.get(b,function(){return a.buildShader()})}},{key:"buildShader",
value:function(){var b=new a.a(this.gl);this.defineShader(b);return b.build()}},{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}}]);return h}(m.e)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return h});f.e=function(a,b,d,c){d=void 0===d?a.RGBA:d;c=void 0===c?a.UNSIGNED_BYTE:c;for(var g=[],h=0;h<b;++h)g[h]=new e(a,d,c);return g};c.d(f,"b",function(){return B});c.d(f,"c",function(){return F});m=c(0);var a=c(1),b=c(19),l=c(53),r=c(40),v=c(77),p=function A(a,b,d){null===a&&(a=Function.prototype);
var e=Object.getOwnPropertyDescriptor(a,b);if(void 0===e){if(a=Object.getPrototypeOf(a),null!==a)return A(a,b,d)}else{if("value"in e)return e.value;b=e.get;return void 0===b?void 0:b.call(d)}},k=function(){function a(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}();c=function(a){function b(){q(this,b);var a=n(this,(b.__proto__||
Object.getPrototypeOf(b)).apply(this,arguments));a.width=Number.NaN;a.height=Number.NaN;return a}t(b,a);k(b,[{key:"hasSize",value:function(a,b){return this.width===a&&this.height===b}},{key:"resize",value:function(a,b){this.hasSize(a,b)||(this.width=a,this.height=b,this.performResize())}}]);return b}(m.a);var h=function(a){function b(a,d){d=void 0===d?!1:d;q(this,b);var e=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,d?a.DEPTH_STENCIL:a.DEPTH_COMPONENT16));e.gl=a;e.includeStencilBuffer=
d;return e}t(b,a);k(b,[{key:"attachToFramebuffer",value:function(){var a=this.gl;p(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"attachToFramebuffer",this).call(this,this.includeStencilBuffer?a.DEPTH_STENCIL_ATTACHMENT:a.DEPTH_ATTACHMENT)}}]);return b}(function(a){function b(a,d){q(this,b);var e=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));e.gl=a;e.internalformat=d;e.renderbuffer=null;e.renderbuffer=a.createRenderbuffer();return e}t(b,a);k(b,[{key:"performResize",value:function(){var a=
this.gl;a.bindRenderbuffer(a.RENDERBUFFER,this.renderbuffer);a.renderbufferStorage(a.RENDERBUFFER,this.internalformat,this.width,this.height);a.bindRenderbuffer(a.RENDERBUFFER,null)}},{key:"disposed",value:function(){this.gl.deleteRenderbuffer(this.renderbuffer)}},{key:"attachToFramebuffer",value:function(a){var b=this.gl;b.framebufferRenderbuffer(b.FRAMEBUFFER,a,b.RENDERBUFFER,this.renderbuffer)}}]);return b}(c)),g=function(a){function b(a){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,
a,!0))}t(b,a);return b}(h);f.d=g;var d=function(a){function b(a){q(this,b);var d=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));d.gl=a;d.framebuffer=d.gl.createFramebuffer();return d}t(b,a);k(b,[{key:"disposed",value:function(){this.gl.deleteFramebuffer(this.framebuffer)}},{key:"bind",value:function(){var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,this.framebuffer)}},{key:"unbind",value:function(){var a=this.gl;a.bindFramebuffer(a.FRAMEBUFFER,null)}}]);return b}(m.a),e=function(a){function b(a,
d,e){q(this,b);var c=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.gl=a;c.format=d;c.dataType=e;c.texture=a.createTexture();return c}t(b,a);k(b,[{key:"performResize",value:function(){Object(r.a)(this.gl,this.texture,this.width,this.height,this.format,this.dataType)}},{key:"disposed",value:function(){this.gl.deleteTexture(this.texture)}},{key:"attachToFramebuffer",value:function(a){var b=this.gl;b.framebufferTexture2D(b.FRAMEBUFFER,a,b.TEXTURE_2D,this.texture,0)}}]);return b}(c),w=new Uint8Array(4),
B=function(a){function b(a,e){q(this,b);var c=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.gl=a;c.width=Number.NaN;c.height=Number.NaN;c.fullAttachmentList=[];c.attachmentVerified=!1;c.singleAttachmentList=[c.gl.COLOR_ATTACHMENT0];var g=void 0===e.framebuffer?new d(a):e.framebuffer,h=e.colorBuffers;e=e.depthBuffer;c.framebuffer=c.registerDisposer(g);c.colorBuffers=h;c.depthBuffer=e;void 0!==e&&c.registerDisposer(e);var f=c.fullAttachmentList;h.forEach(function(b,d){c.registerDisposer(b);
f[d]=a.COLOR_ATTACHMENT0+d});return c}t(b,a);k(b,[{key:"hasSize",value:function(a,b){return this.width===a&&this.height===b}},{key:"bind",value:function(a,b){this.width=a;this.height=b;this.framebuffer.bind();var d=this.gl,e=this.depthBuffer;void 0!==e&&(e.resize(a,b),e.attachToFramebuffer());this.colorBuffers.forEach(function(e,c){e.resize(a,b);e.attachToFramebuffer(d.COLOR_ATTACHMENT0+c)});d.WEBGL_draw_buffers.drawBuffersWEBGL(this.fullAttachmentList);this.verifyAttachment();d.viewport(0,0,a,b)}},
{key:"bindSingle",value:function(a){var b=this.gl;this.framebuffer.bind();0!==a&&b.framebufferTexture2D(b.FRAMEBUFFER,b.COLOR_ATTACHMENT0+a,b.TEXTURE_2D,null,0);b.bindTexture(b.TEXTURE_2D,null);this.colorBuffers[a].attachToFramebuffer(b.COLOR_ATTACHMENT0);b.WEBGL_draw_buffers.drawBuffersWEBGL(this.singleAttachmentList)}},{key:"unbind",value:function(){this.framebuffer.unbind()}},{key:"readPixel",value:function(a,b,d){var e=this.gl;try{this.bindSingle(a),e.readPixels(b,d,1,1,e.RGBA,e.UNSIGNED_BYTE,
w)}finally{this.framebuffer.unbind()}return w}},{key:"readPixelAsUint32",value:function(a,b,d){a=this.readPixel(a,b,d);return a[0]+(a[1]<<8)+(a[2]<<16)+(a[3]<<24)}},{key:"verifyAttachment",value:function(){if(!this.attachmentVerified){var a=this.gl;if(a.checkFramebufferStatus(a.FRAMEBUFFER)!==a.FRAMEBUFFER_COMPLETE)throw Error("Framebuffer configuration not supported");this.attachmentVerified=!0}}}]);return b}(m.a),F=function(d){function e(a,b){q(this,e);var d=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));
d.gl=a;d.shader=b;d.copyVertexPositionsBuffer=Object(l.a)(d.gl);d.copyTexCoordsBuffer=Object(l.a)(d.gl,0,0,1,1);d.registerDisposer(b);return d}t(e,d);k(e,[{key:"draw",value:function(b){for(var d=[],e=0;e<arguments.length;++e)d[e-0]=arguments[e];e=this.gl;var c=this.shader;c.bind();for(var g=d.length,h=0;h<g;++h)e.activeTexture(e.TEXTURE0+h),e.bindTexture(e.TEXTURE_2D,d[h]);e.uniformMatrix4fv(c.uniform("uProjectionMatrix"),!1,a.d);d=c.attribute("aVertexPosition");this.copyVertexPositionsBuffer.bindToVertexAttrib(d,
2);c=c.attribute("aTexCoord");this.copyTexCoordsBuffer.bindToVertexAttrib(c,2);e.drawArrays(e.TRIANGLE_FAN,0,4);e.disableVertexAttribArray(d);e.disableVertexAttribArray(c);for(d=0;d<g;++d)e.activeTexture(e.TEXTURE0+d),e.bindTexture(e.TEXTURE_2D,null)}}],[{key:"get",value:function(a,d,c){d=void 0===d?v.a:d;c=void 0===c?1:c;return a.memoize.get("OffscreenCopyHelper:"+c+":"+Object(b.a)(d),function(){return new e(a,Object(v.b)(a,d,c))})}}]);return e}(m.a)},function(m,f,c){f.a=function(a,b,c,f,v){b=void 0===
b?-1:b;c=void 0===c?-1:c;f=void 0===f?1:f;v=void 0===v?1:v;return a.memoize.get("SquareCornersBuffer:"+b+","+c+","+f+","+v,function(){return new q.b(n.a.fromData(a,new Float32Array([b,c,b,v,f,v,f,c]),t.a,t.k))}).value};var q=c(0),n=c(17),t=c(20)},function(m,f){m.exports="\n\nvec3 colormapJet(float x) {\n  vec3 result;\n  result.r = x < 0.89 ? ((x - 0.35) / 0.31) : (1.0 - (x - 0.89) / 0.11 * 0.5);\n  result.g = x < 0.64 ? ((x - 0.125) * 4.0) : (1.0 - (x - 0.64) / 0.27);\n  result.b = x < 0.34 ? (0.5 + x * 0.5 / 0.11) : (1.0 - (x - 0.34) / 0.31);\n  return clamp(result, 0.0, 1.0);\n}\n"},
function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,
configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){Object(x.u)(a);var b=Object(x.w)(a,"neariso_voxelres",function(a){return Object(x.v)(a,x.k)}),d=Object(x.w)(a,"neariso_imagesize",function(a){return Object(x.v)(a,x.j)}),e=Object(x.w)(a,"neariso_offset",function(a){return Object(x.v)(a,x.l)});return Object(x.w)(a,"resolutions",function(a){return Object(x.a)(a,x.s)}).map(function(a){var c=""+a,g=b.get(c),h=d.get(c),f=e.get(c);if(void 0===g||void 0===
h||void 0===f)throw Error("Missing neariso_voxelres/neariso_imagesize/neariso_offset for resolution "+(a+"."));return{key:c,voxelSize:g,imageSize:h,voxelOffset:f}})}function b(a){a=z.get(a);void 0===a&&(a=w.d.UNKNOWN);return a}function l(a){Object(x.u)(a);var d=Object(x.w)(a,"channel_type",x.B);return{channelType:d,description:Object(x.w)(a,"description",x.B),volumeType:b(d),dataType:Object(x.w)(a,"datatype",function(a){return Object(x.n)(a,w.a)})}}function r(b){Object(x.u)(b);return{channels:Object(x.w)(b,
"channels",function(a){return Object(x.v)(a,l)}),scales:Object(x.w)(b,"dataset",a)}}function v(a,b,d,e){return a.memoize.getUncounted({type:"ndstore:getTokenInfo",hostnames:b,token:d},function(){return Object(A.d)(Object(A.b)(b,e+"/"+d+"/info/"),"json").then(r)})}function p(a,b,d,e){var c=d.match(E);if(null===c)throw Error("Invalid volume path "+JSON.stringify(d));var g=c[1],h=c[2],f=Object(x.e)(c[3]||"");return a.memoize.getUncounted({type:"ndstore:MultiscaleVolumeChunkSource",hostnames:b,path:d},
function(){return v(a,b,g,e).then(function(d){return new J(a,b,g,d,h,e,f)})})}function k(a,b){var d=b.match(S);if(null===d)throw Error("Invalid ndstore volume path: "+JSON.stringify(b));return p(a,[d[1]],d[2],e.b)}function h(a,b,d){return a.memoize.getUncounted({type:"dvid:getPublicTokens",hostnames:b},function(){return Object(A.d)(Object(A.b)(b,d+"/public_tokens/"),"json").then(function(a){return Object(x.a)(a,x.B)})})}function g(a,b,d,e){var c=d.match(/^(?:([^\/]+)(?:\/([^\/]*))?)?$/);if(null===
c)return Promise.reject(null);if(void 0===c[2]){var g=c[1]||"";return h(a,b,e).then(function(a){return{offset:0,completions:Object(F.c)(g,a,function(a){return a+"/"},function(){})}})}return v(a,b,c[1],e).then(function(a){a=Object(F.c)(c[2],a.channels,function(a){return a[0]},function(a){return a[1].channelType+" ("+w.a[a[1].dataType]+")"});return{offset:c[1].length+1,completions:a}})}function d(a,b){var d=a.match(S);return null===d?Promise.reject(null):g(b,[d[1]],d[2],e.b).then(function(a){return Object(F.a)(d[1].length+
1,a)})}Object.defineProperty(f,"__esModule",{value:!0});c.d(f,"getVolume",function(){return k});c.d(f,"volumeCompleter",function(){return d});c.d(f,"MultiscaleVolumeChunkSource",function(){return J});f.getTokenInfo=v;f.getShardedVolume=p;f.getPublicTokens=h;f.tokenAndChannelCompleter=g;c.d(f,"NDStoreDataSource",function(){return K});c.d(f,"SingleServerDataSource",function(){return U});m=c(10);f=c(24);var e=c(87),w=c(8),B=c(18),F=c(30),G=c(1),A=c(31),x=c(2),D=function(){function a(a,b){for(var d=0;d<
b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}(),z=new Map;z.set("image",w.d.IMAGE);z.set("annotation",w.d.SEGMENTATION);var C=new Set(["npz","raw","jpeg"]),H=function(a){function b(){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}t(b,a);return b}(Object(m.f)(B.b,e.c)),J=function(){function a(b,d,c,g,h,f,k){q(this,
a);this.chunkManager=b;this.baseUrls=d;this.key=c;this.tokenInfo=g;this.parameters=k;this.urlPrefix=e.b;this.neariso=!0;if(void 0===h){h=Array.from(g.channels.keys());if(1!==h.length)throw Error("Dataset contains multiple channels: "+JSON.stringify(h));h=h[0]}b=g.channels.get(h);if(void 0===b)throw Error("Specified channel "+JSON.stringify(h)+" is not one of the supported "+("channels "+JSON.stringify(Array.from(g.channels.keys()))));this.channel=h;this.channelInfo=b;this.scales=g.scales;void 0!==
f&&(this.urlPrefix=f);"false"===Object(x.z)(k.neariso)&&(this.neariso=!1);g=Object(x.z)(k.encoding);if(void 0===g)g=this.volumeType===w.d.IMAGE?"jpeg":"npz";else if(!C.has(g))throw Error("Invalid encoding: "+JSON.stringify(g)+".");this.encoding=g}D(a,[{key:"getSources",value:function(a){var b=this;return this.scales.map(function(d){for(var e=d.voxelOffset,c=d.voxelSize,g=G.p.create(),h=0;3>h;++h)g[h]=Math.ceil(e[h]);return w.c.getDefaults({numChannels:b.numChannels,volumeType:b.volumeType,dataType:b.dataType,
voxelSize:c,transform:G.j.fromTranslation(G.j.create(),G.p.multiply(G.p.create(),e,c)),baseVoxelOffset:g,upperVoxelBound:d.imageSize,volumeSourceOptions:a}).map(function(a){return b.chunkManager.getChunkSource(H,{spec:a,parameters:{baseUrls:b.baseUrls,urlPrefix:b.urlPrefix,key:b.key,channel:b.channel,resolution:d.key,encoding:b.encoding,neariso:b.neariso}})})})}},{key:"getMeshSource",value:function(){return null}},{key:"dataType",get:function(){return this.channelInfo.dataType}},{key:"numChannels",
get:function(){return 1}},{key:"volumeType",get:function(){return this.channelInfo.volumeType}}]);return a}(),E=/^([^\/?]+)(?:\/([^\/?]+))?(?:\?(.*))?$/,S=/^((?:http|https):\/\/[^\/?]+)\/(.*)$/,K=function(a){function b(){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}t(b,a);D(b,[{key:"volumeCompleter",value:function(a,b){return d(a,b)}},{key:"getVolume",value:function(a,b){return k(a,b)}},{key:"description",get:function(){return"NDstore"}}]);return b}(f.a),
U=function(a){function b(a,d,c){c=void 0===c?e.b:c;q(this,b);var g=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));g.description=a;g.hostnames=d;g.urlprefix=c;return g}t(b,a);D(b,[{key:"getVolume",value:function(a,b){return p(a,this.hostnames,b,this.urlprefix)}},{key:"volumeCompleter",value:function(a,b){return g(b,this.hostnames,a,this.urlprefix)}}]);return b}(f.a)},function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"c",function(){return b});c.d(f,"b",function(){return l});var n=c(39),t=c(1),a=function(){function a(a,b){for(var c=0;c<b.length;c++){var h=b[c];h.enumerable=h.enumerable||!1;h.configurable=!0;"value"in h&&(h.writable=!0);Object.defineProperty(a,h.key,h)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);
return b}}(),b;(function(a){a[a.LINE=0]="LINE";a[a.POINT=1]="POINT"})(b||(b={}));var l=function(b){function c(a){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");a=(c.__proto__||Object.getPrototypeOf(c)).call(this,a);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==typeof a&&"function"!==typeof a?this:a}q(c,b);a(c,[{key:"toObject",value:function(){return{transform:this.chunkLayout.transform,chunkDataSize:this.chunkDataSize,
voxelSize:this.voxelSize,lowerVoxelBound:this.lowerVoxelBound,upperVoxelBound:this.upperVoxelBound,lowerClipBound:this.lowerClipBound,upperClipBound:this.upperClipBound,baseVoxelOffset:this.baseVoxelOffset}}}],[{key:"make",value:function(a){return new c(Object.assign({},a,{transform:Object(n.e)(a.transform,a.vectorGraphicsSourceOptions)}))}},{key:"fromObject",value:function(a){return new c(a)}},{key:"withDefaults",value:function(a){var b=a.transform,h=a.lowerVoxelBound,g=a.upperVoxelBound,d=a.chunkDataSize;
b=Object(n.e)(b,a.vectorGraphicsSourceOptions);if(void 0===d&&(d=t.p.clone(g),void 0!==h))for(g=0;3>g;g++)d[g]+=Math.abs(h[g]);console.log(d);console.log(a);return new c(Object.assign({},a,{transform:b,chunkDataSize:d}))}}]);return c}(n.c);f.a="vectorgraphics/RenderLayer"},function(m,f,c){c.d(f,"a",function(){return b});var q=c(1),n=c(2),t=c(3),a=function(){function a(a,b){for(var c=0;c<b.length;c++){var f=b[c];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,
f.key,f)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),b=function(){function b(a){a=void 0===a?q.j.create():a;if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.transform=a;this.changed=new t.a}a(b,[{key:"reset",value:function(){q.j.copy(this.transform,q.d);this.changed.dispatch()}},{key:"toJSON",value:function(){if(!q.j.equals(q.d,this.transform)){var a=this.transform;return[[a[0],a[4],a[8],a[12]],[a[1],a[5],a[9],a[13]],[a[2],a[6],a[10],a[14]],
[a[3],a[7],a[11],a[15]]]}}},{key:"restoreState",value:function(a){if(null==a)this.reset();else if(Array.isArray(a))if(4===a.length)try{for(var b=0;4>b;++b)Object(n.b)(this.transform.subarray(4*b,4*(b+1)),a[b]);q.j.transpose(this.transform,this.transform)}catch(h){this.reset()}else if(16===a.length)try{Object(n.b)(this.transform,a),q.j.transpose(this.transform,this.transform)}catch(h){this.reset()}else this.reset();else if("object"===typeof a){b=q.l.create();var c=q.p.create(),f=q.p.fromValues(1,1,
1);try{Object(n.b)(b,a.rotation),q.l.normalize(b,b)}catch(h){q.l.identity(b)}try{Object(n.b)(c,a.translation)}catch(h){q.p.copy(c,q.h)}try{Object(n.b)(f,a.scale)}catch(h){q.p.copy(f,q.g)}q.j.fromRotationTranslationScale(this.transform,b,c,f);this.changed.dispatch()}else this.reset()}},{key:"clone",value:function(){return new b(q.j.clone(this.transform))}}]);return b}()},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||
"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return l});m=c(0);var t=c(4),a=function(){function a(a,b){for(var c=0;c<b.length;c++){var h=b[c];h.enumerable=h.enumerable||
!1;h.configurable=!0;"value"in h&&(h.writable=!0);Object.defineProperty(a,h.key,h)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),b=function v(a,b,c){null===a&&(a=Function.prototype);var g=Object.getOwnPropertyDescriptor(a,b);if(void 0===g){if(a=Object.getPrototypeOf(a),null!==a)return v(a,b,c)}else{if("value"in g)return g.value;b=g.get;return void 0===b?void 0:b.call(c)}};c(165);var l=function(c){function f(a,b){var c=void 0===b?{}:b;b=void 0===c.min?0:c.min;var d=void 0===c.max?
1:c.max;c=void 0===c.step?.01:c.step;if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");var e=q(this,(f.__proto__||Object.getPrototypeOf(f)).call(this));e.value=a;e.element=document.createElement("label");e.promptElement=document.createElement("span");e.inputElement=document.createElement("input");var h=e.element,k=e.promptElement,l=e.inputElement;h.className="range-slider";k.className="range-prompt";l.type="range";l.min=""+b;l.max=""+d;l.step=""+c;l.valueAsNumber=e.value.value;
h.appendChild(k);h.appendChild(l);var p=function(){e.value.value=e.inputElement.valueAsNumber};e.registerEventListener(l,"change",p);e.registerEventListener(l,"input",p);e.registerEventListener(l,"wheel",function(a){a=a.deltaY;0<a?(e.inputElement.stepUp(),p()):0>a&&(e.inputElement.stepDown(),p())});a.changed.add(function(){e.inputElement.valueAsNumber=e.value.value});return e}n(f,c);a(f,[{key:"disposed",value:function(){Object(t.b)(this.element);b(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),
"disposed",this).call(this)}}]);return f}(m.a)},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?
Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return v});m=c(166);c.n(m);m=c(95);var t=c.n(m);m=c(13);var a=c.n(m);m=c(0);var b=c(4),l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,g){c&&a(b.prototype,c);g&&a(b,g);return b}}(),r=function k(a,b,d){null===a&&(a=Function.prototype);var e=Object.getOwnPropertyDescriptor(a,b);if(void 0===
e){if(a=Object.getPrototypeOf(a),null!==a)return k(a,b,d)}else{if("value"in e)return e.value;b=e.get;return void 0===b?void 0:b.call(d)}};c(167);c(168);c(169);c(170)(t.a);var v=function(c){function h(b){if(!(this instanceof h))throw new TypeError("Cannot call a class as a function");var d=q(this,(h.__proto__||Object.getPrototypeOf(h)).call(this));d.state=b;d.changingValue=!1;d.debouncedValueUpdater=a()(function(){d.changingValue=!0;try{d.state.fragmentMain.value=d.textEditor.getValue()}finally{d.changingValue=
!1}},500);d.textEditor=t()(function(a){},{value:d.state.fragmentMain.value,mode:"glsl",gutters:["CodeMirror-lint-markers"]});d.textEditor.on("change",function(){d.setValidState(void 0);d.debouncedValueUpdater()});d.registerDisposer(d.state.fragmentMain.changed.add(function(){d.changingValue||d.textEditor.setValue(d.state.fragmentMain.value)}));d.element.classList.add("neuroglancer-shader-code-widget");d.registerDisposer(d.state.shaderError.changed.add(function(){d.updateErrorState()}));d.updateErrorState();
return d}n(h,c);l(h,[{key:"updateErrorState",value:function(){var a=this,b=this.state.shaderError.value;void 0===b?this.setValidState(void 0):null!==b?(this.textEditor.setOption("lint",{getAnnotations:function(){if("ShaderCompilationError"===b.name){var d=b.source.split("\n").indexOf(a.state.fragmentMainStartLine)+2;return b.errorMessages.map(function(a){return{message:a.message,severity:"error",from:t.a.Pos(void 0===a.line?0:a.line-d)}})}return"ShaderLinkError"===b.name?[{message:b.log,severity:"error",
from:t.a.Pos(0)}]:[{message:b.message,severity:"error",from:t.a.Pos(0)}]}}),this.setValidState(!1)):(this.textEditor.setOption("lint",void 0),this.setValidState(!0))}},{key:"setValidState",value:function(a){var b=this.element;b.classList.remove("invalid-input");b.classList.remove("valid-input");!0===a?b.classList.add("valid-input"):!1===a&&b.classList.add("invalid-input")}},{key:"disposed",value:function(){this.debouncedValueUpdater.flush();this.debouncedValueUpdater=void 0;Object(b.b)(this.element);
this.textEditor=void 0;r(h.prototype.__proto__||Object.getPrototypeOf(h.prototype),"disposed",this).call(this)}},{key:"element",get:function(){return this.textEditor.getWrapperElement()}}]);return h}(m.a)},function(m,f){},function(m,f,c){c.d(f,"a",function(){return n});var q=function(){function c(a,b){for(var c=0;c<b.length;c++){var f=b[c];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(a,b,f){b&&c(a.prototype,b);f&&c(a,
f);return a}}();f.b=4093;var n=function(){function c(a,b,f,r){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");this.a0=a;this.a1=b;this.b=f;this.c=r}q(c,[{key:"computeDotProduct",value:function(a,b){var c=this.a0,f=this.a1;return c[0]*(a&255)+c[1]*(a>>8&255)+c[2]*(a>>16&255)+c[3]*(a>>24&255)+(f[0]*(b&255)+f[1]*(b>>8&255)+f[2]*(b>>16&255)+f[3]*(b>>24&255))}},{key:"compute",value:function(a,b){var c=this.b,f=this.c;a=this.computeDotProduct(a,b);return(a+a*a%4093*f+c)%
4093}},{key:"toString",value:function(){return"new HashFunction(Float32Array.of("+this.a0+"), "+("Float32Array.of("+this.a1+"), "+this.b+", "+this.c+")")}}],[{key:"generate",value:function(){function a(){return Math.floor(4093*Math.random())}return new c(Float32Array.of(a(),a(),a(),a()),Float32Array.of(a(),a(),a(),a()),a(),a())}}]);return c}()},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&
"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function t(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(f,"b",function(){return g});c.d(f,"a",function(){return F});
var a=c(61),b=c(11),l=function A(a,b,d){null===a&&(a=Function.prototype);var e=Object.getOwnPropertyDescriptor(a,b);if(void 0===e){if(a=Object.getPrototypeOf(a),null!==a)return A(a,b,d)}else{if("value"in e)return e.value;b=e.get;return void 0===b?void 0:b.call(d)}},r=function(){function a(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,d,e){d&&a(b.prototype,d);e&&a(b,e);return b}}();
f.c=3;var v=0,p=0,k=0,h=0;m=function(){function d(a){a=void 0===a?d.generateHashFunctions(3):a;t(this,d);this.loadFactor=.9;this.size=0;this.growFactor=1.2;this.maxHeight=8192;this.emptyHigh=this.emptyLow=4294967295;this.maxAttempts=this.maxRehashAttempts=5;this.maxWidth=4096/this.entryStride;this.generation=0;this.mungedEmptyKey=-1;this.hashFunctions=a;this.allocate(4,1)}r(d,[{key:"updateHashFunctions",value:function(a){this.hashFunctions=d.generateHashFunctions(a);this.mungedEmptyKey=-1}},{key:"tableWithMungedEmptyKey",
value:function(a){for(var b=this.hashFunctions.length,d=Array(b),e=0;e<b;++e)d[e]=this.getHash(e,this.emptyLow,this.emptyHigh);e=this.mungedEmptyKey;if(-1===e)a:for(;;){e=16777216*Math.random()>>>0;for(var c=0;c<b;++c)for(var g=this.getHash(c,e,e),h=0;h<b;++h)if(d[h]===g)continue a;this.mungedEmptyKey=e;break}c=this.table;g=this.emptyLow;h=this.emptyHigh;for(var f=0;f<b;++f){var k=d[f];c[k]===g&&c[k+1]===h&&(c[k]=e,c[k+1]=e)}try{a(c)}finally{for(a=0;a<b;++a)f=d[a],c[f]===e&&c[f+1]===e&&(c[f]=g,c[f+
1]=h)}}},{key:"getHash",value:function(a,b,d){a=this.hashFunctions[a];var e=this.width,c=this.height;e=a[0].compute(b,d)%e;b=a[1].compute(b,d)%c;return this.entryStride*(b*this.width+e)}},{key:"keys",value:function(a){function d(d,z){for(;;)switch(e){case 0:a=void 0===a?new b.a:a,B=v,p=B.emptyLow,r=B.emptyHigh,l=B.entryStride,w=v,k=w.table,f=0,h=k.length;case 1:if(!(f<h)){e=3;break}g=k[f];c=k[f+1];if(g===p&&c===r){e=4;break}a.low=g;a.high=c;e=5;return{value:a,done:!1};case 5:if(void 0===z){e=6;break}e=
-1;throw z;case 6:case 4:case 2:f+=l;e=1;break;case 3:e=-1;default:return{value:void 0,done:!0}}}var e=0,c,g,h,f,k,w,l,r,p,B,v=this,x={next:function(a){return d(a,void 0)},throw:function(a){return d(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();x[Symbol.iterator]=function(){return this};return x}},{key:"indexOfPair",value:function(a,b){var d=this.table,e=this.emptyHigh;if(a===this.emptyLow&&b===e)return-1;e=0;for(var c=this.hashFunctions.length;e<
c;++e){var g=this.getHash(e,a,b);if(d[g]===a&&d[g+1]===b)return g}return-1}},{key:"indexOf",value:function(a){return this.indexOfPair(a.low,a.high)}},{key:"chooseAnotherEmptyKey",value:function(){for(var a=this.emptyLow,b=this.emptyHigh,d=this.table,e=this.entryStride,c,g;c=4294967296*Math.random()>>>0,g=4294967296*Math.random()>>>0,c===a&&g===b||this.hasPair(c,g););this.emptyLow=c;this.emptyHigh=g;for(var h=0,f=d.length;h<f;h+=e)d[h]===a&&d[h+1]===b&&(d[h]=c,d[h+1]=g)}},{key:"has",value:function(a){return-1!==
this.indexOf(a)}},{key:"hasPair",value:function(a,b){return-1!==this.indexOfPair(a,b)}},{key:"delete",value:function(a){a=this.indexOf(a);if(-1!==a){var b=this.table;b[a]=this.emptyLow;b[a+1]=this.emptyHigh;++this.generation;this.size--;return!0}return!1}},{key:"clearTable",value:function(){for(var a=this.table,b=this.entryStride,d=this.emptyLow,e=this.emptyHigh,c=a.length,g=0;g<c;g+=b)a[g]=d,a[g+1]=e}},{key:"clear",value:function(){if(0===this.size)return!1;this.size=0;++this.generation;this.clearTable();
return!0}},{key:"swapPending",value:function(a,b){var d=v,e=p;this.storePending(a,b);a[b]=d;a[b+1]=e}},{key:"storePending",value:function(a,b){v=a[b];p=a[b+1]}},{key:"backupPending",value:function(){k=v;h=p}},{key:"restorePending",value:function(){v=k;p=h}},{key:"tryToInsert",value:function(){for(var a=0,b=this.emptyLow,d=this.emptyHigh,e=this.maxAttempts,c=this.table,g=this.hashFunctions.length,h=Math.floor(Math.random()*g);;){var f=this.getHash(h,v,p);this.swapPending(c,f);if(v===b&&p===d)return!0;
if(++a===e)break;h=(h+Math.floor(Math.random()*(g-1))+1)%g}return!1}},{key:"allocate",value:function(a,b){var d=a*b;this.width=a;this.height=b;this.table=new Uint32Array(d*this.entryStride);this.maxAttempts=d;this.clearTable();this.capacity=d*this.loadFactor;this.mungedEmptyKey=-1}},{key:"rehash",value:function(a,b,d){this.allocate(b,d);this.updateHashFunctions(this.hashFunctions.length);b=this.emptyLow;d=this.emptyHigh;for(var e=this.entryStride,c=0,g=a.length;c<g;c+=e){var h=a[c+1];if(a[c]!==b||
h!==d)if(this.storePending(a,c),!this.tryToInsert())return!1}return!0}},{key:"grow",value:function(a){for(var b=this.table,d=this.width,e=this.height,c=this.maxWidth,g=this.maxHeight;;){var h=d*e;d=Math.min(c,Math.ceil(a/this.height));d*e<a&&(e=Math.min(g,Math.ceil(a/d)));var f=d*e;if(f<a&&f===h)throw Error("Maximum table size exceeded");for(h=0;h<this.maxRehashAttempts;++h)if(this.rehash(b,d,e))return;a=Math.ceil(this.growFactor*a)}}},{key:"insertInternal",value:function(){++this.generation;v===
this.emptyLow&&p===this.emptyHigh&&this.chooseAnotherEmptyKey();++this.size>this.capacity&&(this.backupPending(),this.grow(Math.ceil(this.growFactor*this.width*this.height)),this.restorePending());for(;!this.tryToInsert();)this.backupPending(),this.grow(this.width*this.height),this.restorePending()}}],[{key:"generateHashFunctions",value:function(b){b=void 0===b?3:b;for(var d=[],e=0;e<b;++e){var c=[a.a.generate(),a.a.generate()];d.push(c)}return d}}]);return d}();var g=function(a){function b(){t(this,
b);return q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}n(b,a);$jscomp.initSymbol();$jscomp.initSymbolIterator();r(b,[{key:"add",value:function(a){var b=a.low;a=a.high;if(this.hasPair(b,a))return!1;v=b;p=a;this.insertInternal();return!0}},{key:Symbol.iterator,value:function(){return this.keys()}}]);return b}(m);g.prototype.entryStride=2;var d=0,e=0,w=0,B=0,F=function(a){function c(){t(this,c);return q(this,(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments))}n(c,
a);$jscomp.initSymbol();$jscomp.initSymbolIterator();r(c,[{key:"set",value:function(a,b){var c=a.low;a=a.high;if(this.hasPair(c,a))return!1;v=c;p=a;d=b.low;e=b.high;this.insertInternal();return!0}},{key:"get",value:function(a,b){a=this.indexOf(a);if(-1===a)return!1;var d=this.table;b.low=d[a+2];b.high=d[a+3];return!0}},{key:"swapPending",value:function(a,b){var g=d,h=e;l(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"swapPending",this).call(this,a,b);a[b+2]=g;a[b+3]=h}},{key:"storePending",
value:function(a,b){l(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"storePending",this).call(this,a,b);d=a[b+2];e=a[b+3]}},{key:"backupPending",value:function(){l(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"backupPending",this).call(this);w=d;B=e}},{key:"restorePending",value:function(){l(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"restorePending",this).call(this);d=w;e=B}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(a){function d(d,
z){for(;;)switch(e){case 0:a=void 0===a?[new b.a,new b.a]:a,n=F,D=n.emptyLow,v=n.emptyHigh,B=n.entryStride,p=F,r=p.table,l=$jscomp.makeIterator(a),w=l.next().value,k=l.next().value,f=0,h=r.length;case 1:if(!(f<h)){e=3;break}g=r[f];c=r[f+1];if(g===D&&c===v){e=4;break}w.low=g;w.high=c;k.low=r[f+2];k.high=r[f+3];e=5;return{value:a,done:!1};case 5:if(void 0===z){e=6;break}e=-1;throw z;case 6:case 4:case 2:f+=B;e=1;break;case 3:e=-1;default:return{value:void 0,done:!0}}}var e=0,c,g,h,f,k,w,l,r,p,B,v,D,
n,F=this,q={next:function(a){return d(a,void 0)},throw:function(a){return d(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();q[Symbol.iterator]=function(){return this};return q}}]);return c}(m);F.prototype.entryStride=4},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(f,"b",function(){return v});f.c=function(b,d,e){e=void 0===e?1:e;switch(d){case t.b.UINT8:if(1>e||4<e)break;b.texelsPerElement=
1;b.textureFormat=p[e];b.texelType=a.t;b.arrayElementsPerTexel=e;b.arrayConstructor=Uint8Array;return b;case t.b.UINT16:if(1>e||2<e)break;b.texelsPerElement=1;b.textureFormat=p[2*e];b.texelType=a.t;b.arrayElementsPerTexel=2*e;b.arrayConstructor=Uint8Array;return b;case t.b.UINT64:if(1!==e)break;b.texelsPerElement=2;b.textureFormat=a.j;b.texelType=a.t;b.arrayElementsPerTexel=4;b.arrayConstructor=Uint8Array;return b;case t.b.UINT32:if(1!==e)break;b.texelsPerElement=1;b.textureFormat=a.j;b.texelType=
a.t;b.arrayElementsPerTexel=4;b.arrayConstructor=Uint8Array;return b;case t.b.FLOAT32:if(!(1>e||4<e))return b.texelsPerElement=1,b.textureFormat=p[e],b.texelType=a.c,b.arrayElementsPerTexel=e,b.arrayConstructor=Float32Array,b}throw Error("No supported texture format for "+t.b[d]+"["+e+"].");};f.e=function(a,b,e,c,h,f){b=b.maxTextureSize;var d=c*h*f;if(!(e*c<=b&&h*f<=b))if(e*c*h<=b&&f<=b)c*=h;else if(c=Math.ceil(d/b),c*e>b)throw Error("Chunk data size exceeds maximum texture size: "+e+" * "+d);e=Math.ceil(d/
c);a.dataWidth=c;a.textureHeight=e;a.textureAccessCoefficients=Float32Array.of(1/c,1/(c*e))};f.d=function(a,b,e,c){var d=b.maxTextureSize;b=Math.ceil(c/d);if(b*e>d)throw Error("Number of elements exceeds maximum texture size: "+e+" * "+c);e=Math.ceil(c/b);a.dataWidth=b;a.textureHeight=e;a.textureAccessCoefficients=Float32Array.of(1/b,1/(b*e))};f.f=function(b,d,e,c){var g=e.arrayConstructor,h=e.textureFormat,f=e.texelsPerElement,k=d.dataWidth;d=d.textureHeight;var w=k*d*e.arrayElementsPerTexel*f;c.constructor!==
g&&(c=new g(c.buffer,c.byteOffset,c.byteLength/g.BYTES_PER_ELEMENT));c=Object(n.a)(c,w);b.pixelStorei(a.r,1);Object(l.b)(b);b.texImage2D(b.TEXTURE_2D,0,h,k*f,d,0,h,e.texelType,c)};c.d(f,"a",function(){return h});var n=c(82),t=c(27),a=c(20),b=c(7),l=c(40),r=function(){function a(a,b){for(var d=0;d<b.length;d++){var e=b[d];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,e,c){e&&a(b.prototype,e);c&&a(b,c);return b}}(),v=
function d(){q(this,d)},p=[-1,a.f,a.g,a.i,a.j],k=["","r","ra","rgb","rgba"],h=function(){function a(b){q(this,a);this.key=b;this.uniformName="uTextureAccessCoefficients_"+this.key;this.readTextureValue="readTextureValue_"+this.key}r(a,[{key:"defineShader",value:function(a){a.addUniform("highp vec2",this.uniformName)}},{key:"getReadTextureValueCode",value:function(a){for(var b=this.uniformName,d="\nvoid "+this.readTextureValue+"(highp sampler2D sampler, float index",e=0;e<a;++e)d+=", out vec4 output"+
e;d+=") {\n  index += "+.5/a+";\n  vec2 texCoords = vec2(fract(index * "+b+".x),\n                        index * "+b+".y);\n";for(e=0;e<a;++e)d+="\n  output"+e+" = texture2D(sampler,\n                        vec2(texCoords.x +\n                             "+b+".x * "+(e/a).toFixed(8)+",\n                             texCoords.y));\n";return d+"\n}\n"}},{key:"getAccessor",value:function(a,d,c,h){h=void 0===h?1:h;var e=Object(b.a)(c,h),f=[];f.push(this.getReadTextureValueCode(c===t.b.UINT64?2:1));
a="\n"+e+" "+a+"(float index) {\n";switch(c){case t.b.UINT8:f.push(b.m);a+="\n  "+e+" result;\n  vec4 temp;\n  "+this.readTextureValue+"("+d+", index, temp);\n  result.value = temp."+k[h]+";\n  return result;\n";break;case t.b.UINT16:f.push(b.j);a+="\n  "+e+" result;\n  vec4 temp;\n  "+this.readTextureValue+"("+d+", index, temp);\n  result.value = temp."+k[2*h]+";\n  return result;\n";break;case t.b.UINT32:f.push(b.k);a+="\n  "+e+" result;\n  "+this.readTextureValue+"("+d+", index, result.value);\n  return result;\n";
break;case t.b.UINT64:f.push(b.l);a+="\n  "+e+" result;\n  "+this.readTextureValue+"("+d+", index, result.low, result.high);\n  return result;\n";break;case t.b.FLOAT32:f.push(b.e),a+="\n  vec4 temp;\n  "+this.readTextureValue+"("+d+", index, temp);\n  return temp."+k[h]+";\n"}f.push(a+"\n}\n");return f}},{key:"setupTextureLayout",value:function(a,b,d){a.uniform2fv(b.uniform(this.uniformName),d.textureAccessCoefficients)}}]);return a}()},function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==
b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function n(a,b){var c=document.documentElement.scrollTop+Math.min(document.documentElement.clientHeight-a.offsetHeight,b.clientY);a.style.left=document.documentElement.scrollLeft+Math.min(document.documentElement.clientWidth-a.offsetWidth,
b.clientX)+"px";a.style.top=c+"px";a.style.visibility=null}c.d(f,"a",function(){return r});var t=c(0),a=c(4),b=c(3),l=function(){function a(a,b){for(var c=0;c<b.length;c++){var g=b[c];g.enumerable=g.enumerable||!1;g.configurable=!0;"value"in g&&(g.writable=!0);Object.defineProperty(a,g.key,g)}}return function(b,c,h){c&&a(b.prototype,c);h&&a(b,h);return b}}();c(223);var r=function(c){function f(a){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");var c=(f.__proto__||
Object.getPrototypeOf(f)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");c=!c||"object"!==typeof c&&"function"!==typeof c?this:c;c.element=document.createElement("div");c.parentDisposers=new Map;c.disabledValue=!1;c.opened=new b.a;c.closed=new b.a;var g=c.element;g.className="neuroglancer-context-menu";g.style.visibility="hidden";g.tabIndex=-1;document.body.appendChild(g);void 0!==a&&c.registerParent(a);return c}q(f,c);l(f,[{key:"registerParent",
value:function(a){var b=this,c=this.parentDisposers;c.has(a)||c.set(a,Object(t.c)(a,"contextmenu",function(a){b.show(a);a.stopPropagation();a.preventDefault()}))}},{key:"show",value:function(a){var b=this;if(!this.disabledValue){this.hide();var c=this.element,d=Object(t.c)(document,"mousedown",function(a){a.target instanceof Node&&!c.contains(a.target)&&b.hide()},!0),e=Object(t.c)(document,"keydown",function(a){"Escape"===a.code&&b.hide()},!0);c.style.display=null;c.style.visibility="hidden";this.opened.dispatch();
n(c,a);this.menuDisposer=function(){e();d();c.style.display="none"}}}},{key:"unregisterParent",value:function(a){var b=this.parentDisposers,c=b.get(a);void 0!==c&&(c(),b.delete(a))}},{key:"disposed",value:function(){for(var b=this.parentDisposers,c=$jscomp.makeIterator(b.values()),g=c.next();!g.done;g=c.next())g=g.value,g();b.clear();Object(a.b)(this.element)}},{key:"hide",value:function(){void 0!==this.menuDisposer&&(this.menuDisposer(),this.menuDisposer=void 0,this.closed.dispatch())}},{key:"disabled",
get:function(){return this.disabledValue},set:function(a){this.disabledValue!==a&&(this.disabledValue=a)&&this.hide()}},{key:"open",get:function(){return void 0!==this.menuDisposer}}]);return f}(t.a)},function(m,f,c){function q(a){return Object(b.a)(a.dataTransfer.types,"neuroglancer-layer\x00")}function n(a){if(void 0!==v&&v.manager.rootLayers===a.rootLayers)return v}function t(a,b,c){if(a.shiftKey)return"copy";if(a.ctrlKey)return"move";a=void 0===c?!1:c;a=void 0===a?!1:a;c=n(b);b=void 0===c?"copy":
a||c.manager!==b?"link":"move";return b}f.e=function(a,c){a.dataTransfer.setData(Object(b.b)("neuroglancer-layer\x00",c.layers.map(function(a){return{name:a.name,visible:a.visible}})),JSON.stringify(c.layers.map(function(a){return a.toJSON()})));void 0!==v&&v.disposer();var g,d=function(){c.manager.unregisterDisposer(d);for(var a=$jscomp.makeIterator(c.layers),b=a.next();!b.done;b=a.next())b.value.dispose();c.manager.dispose();v===g&&(v=void 0)};v=g={manager:c.manager.addRef(),layers:c.layers.map(function(a){return a.addRef()}),
disposer:d}};f.a=function(a){if(void 0!==v){if(a&&"move"===a.dataTransfer.dropEffect){var b=new Set(v.layers);v.manager.layerManager.filter(function(a){return!b.has(a)})}v.disposer()}};f.c=q;f.d=t;f.f=function(a,c,g){return Object(b.e)(a,t(a,c,void 0===g?!1:g))};f.b=function(b,c,g,d,e){var h=n(c),f=!e&&void 0!==h&&h.manager===c;if(!g&&void 0!==h){var k=new p;k.manager=c;k.numSourceLayers=h.layers.length;k.sourceManager=h.manager;k.moveSupported=f;k.layers=new Map;if(!e&&h.manager===c)if(d)h.layers.forEach(function(a,
b){k.layers.set(a,b)});else return;h.layers.forEach(function(a,b){!e&&c.layerManager.has(a)||k.layers.set(a.addRef(),b)});return k}b=q(b);if(void 0!==b)try{var r=Object(l.a)(b.parameters,function(b,d){var e=Object(l.w)(b,"name",l.B);b=Object(l.w)(b,"visible",l.m);e=new a.b(e,null,c);e.visible=b;return[e,d]}),v=new p;v.numSourceLayers=r.length;v.moveSupported=f;v.manager=c;v.dragType=b.dragType;v.layers=new Map(r);return v}catch(x){}};var a=c(9),b=c(66),l=c(2),r=function(){function a(a,b){for(var d=
0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),v,p=function(){function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");}r(a,[{key:"finalize",value:function(a){var b=this.dragType;if(void 0!==b)try{var d=JSON.parse(a.dataTransfer.getData(b));if(!Array.isArray(d)||this.numSourceLayers!==d.length)throw Error("Invalid layer drop data");
for(var c=$jscomp.makeIterator(this.layers),h=c.next();!h.done;h=c.next()){var f=$jscomp.makeIterator(h.value),k=f.next().value,l=f.next().value;this.manager.initializeLayerFromSpec(k,d[l])}}catch(A){return!1}return!0}},{key:"compatibleWithMethod",value:function(a){return this.method===a||!this.moveSupported&&"move"===a?!0:!1}},{key:"method",get:function(){return void 0!==this.sourceManager?this.manager===this.sourceManager?"move":"link":"copy"}}]);return a}()},function(m,f,c){f.b=function(a,b){b=
JSON.stringify(b);b=Object(q.b)((new TextEncoder).encode(b));return a+b};f.a=function(a,b){a=$jscomp.makeIterator(a);for(var c=a.next();!c.done;c=a.next()){c=c.value;a:{var f=b;if(c.startsWith(f))try{var v=c.substring(f.length);var p=(new TextDecoder).decode(Object(q.a)(v));var k=JSON.parse(p);break a}catch(h){k=void 0;break a}k=void 0}f=k;if(void 0!==f)return{parameters:f,dragType:c}}};f.e=function(a,b){return t=a.dataTransfer.dropEffect=b};f.c=function(){return t};f.d=function(a){a.draggable=!0;
return Object(n.c)(a,"dragstart",function(a){a.stopPropagation();a.preventDefault()})};var q=c(224),n=c(0),t},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"b",function(){return B});c.d(f,"c",function(){return F});c.d(f,"a",function(){return G});var a=c(26),b=c(108),l=c(109);m=c(0);var r=c(4),v=c(15),p=c(1),k=c(34),h=c(81),g=c(84),d=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=
!0);Object.defineProperty(a,c.key,c)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}(),e=function x(a,b,d){null===a&&(a=Function.prototype);var c=Object.getOwnPropertyDescriptor(a,b);if(void 0===c){if(a=Object.getPrototypeOf(a),null!==a)return x(a,b,d)}else{if("value"in c)return c.value;b=c.get;return void 0===b?void 0:b.call(d)}};c(225);c(43);f.d="neuroglancer-position";var w=v.a.fromObject({tab:{action:"tab-forward",preventDefault:!1},arrowup:{action:"adjust-up"},arrowdown:{action:"adjust-down"},
wheel:{action:"adjust-via-wheel"},"shift+tab":{action:"tab-backward",preventDefault:!1},backspace:{action:"delete-backward",preventDefault:!1},escape:{action:"cancel"},mouseup0:{action:"select-all-if-was-not-focused",preventDefault:!1}}),B=function(c){function g(d,c){c=void 0===c?6:c;q(this,g);var e=n(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));e.position=d;e.maxNumberWidth=c;e.element=document.createElement("div");e.inputContainer=document.createElement("div");e.inputElement=document.createElement("input");
e.hintElement=document.createElement("input");e.tempPosition=p.p.create();e.updateHintScrollPosition=e.registerCancellable(Object(b.a)(function(){e.hintElement.scrollLeft=e.inputElement.scrollLeft}));var f=e.element,r=e.inputElement,z=e.hintElement,B=e.inputContainer;B.className="neuroglancer-position-widget-input-container";r.className="neuroglancer-position-widget-input";z.className="neuroglancer-position-widget-hint";e.inputFieldWidth=3*c+11;c=$jscomp.makeIterator([r,z]);for(var C=c.next();!C.done;C=
c.next())C=C.value,C.spellcheck=!1,C.autocomplete="off",C.type="text",C.style.width=e.inputFieldWidth+"ch";z.disabled=!0;c=document.createElement("div");c.textContent="\u29c9";c.className="neuroglancer-copy-button neuroglancer-button";c.title="Copy position to clipboard";c.addEventListener("click",function(){var b=Object(l.b)(e.getPositionText());a.a.showTemporaryMessage(b?"Position copied to clipboard":"Failed to copy position to clipboard")});c.addEventListener("dragstart",function(a){a.dataTransfer.setData("neuroglancer-position",
JSON.stringify(d.toJSON()));a.dataTransfer.setData("text",e.getPositionText());a.stopPropagation()});c.draggable=!0;f.appendChild(c);f.appendChild(B);B.appendChild(r);B.appendChild(z);f.className="neuroglancer-position-widget";e.registerDisposer(d.changed.add(e.registerCancellable(Object(b.a)(function(){return e.updateView()}))));e.registerDisposer(new k.b(r,w)).allShortcutsAreGlobal=!0;e.registerDisposer(new h.a(r,w));e.registerEventListener(r,"change",function(){return e.updatePosition()});e.registerEventListener(r,
"blur",function(){return e.updatePosition()});e.registerEventListener(r,"input",function(){return e.cleanInput()});e.registerEventListener(r,"keydown",e.updateHintScrollPosition);e.registerEventListener(r,"copy",function(a){var b=r.value.substring(r.selectionStart,r.selectionEnd);b=b.trim().replace(/\s+/g," ");a.clipboardData.setData("text/plain",b);a.stopPropagation();a.preventDefault()});var D=!1;e.registerEventListener(r,"mousedown",function(){D=document.activeElement===r});e.registerDisposer(Object(v.c)(r,
"select-all-if-was-not-focused",function(a){D||(r.selectionStart=0,r.selectionEnd=r.value.length,r.selectionDirection="forward",a.preventDefault())}));e.registerDisposer(Object(v.c)(r,"tab-forward",function(a){var b=Math.min(r.selectionStart,r.selectionEnd),d=r.value.substring(b).match(/^([^,\s]*)((?:\s+)|(?:\s*,\s*))?([^,\s]*)/);null!==d&&void 0!==d[2]&&(r.selectionStart=b+d[1].length+d[2].length,r.selectionEnd=r.selectionStart+d[3].length,r.selectionDirection="forward",a.preventDefault())}));e.registerDisposer(Object(v.c)(r,
"tab-backward",function(a){var b=r.value.substring(0,Math.max(r.selectionStart,r.selectionEnd)).match(/([^,\s]*)((?:\s+)|(?:\s*,\s*))?([^,\s]*)$/);null!==b&&void 0!==b[2]&&(r.selectionStart=b.index,r.selectionEnd=r.selectionStart+b[1].length,r.selectionDirection="forward",a.preventDefault())}));e.registerDisposer(Object(v.c)(r,"delete-backward",function(a){if(r.selectionStart===r.selectionEnd&&r.selectionStart===r.value.length){var b=r.value.match(/^(.*)(?![\s])(?:(?:\s+)|(?:\s*,\s*))$/);null!==b&&
(r.value=b[1],e.cleanInput(),a.preventDefault())}}));e.registerDisposer(Object(v.c)(r,"cancel",function(){e.updateView();e.inputElement.blur()}));e.registerDisposer(Object(v.c)(r,"adjust-via-wheel",function(a){a=a.detail;var b=a.deltaY;0!==b&&e.adjustFromCursor(Math.ceil((r.scrollLeft+a.offsetX-r.clientLeft)/(r.scrollWidth/e.inputFieldWidth)),-Math.sign(b))}));e.registerDisposer(Object(v.c)(r,"adjust-up",function(){e.adjustFromCursor(void 0,1)}));e.registerDisposer(Object(v.c)(r,"adjust-down",function(){e.adjustFromCursor(void 0,
-1)}));e.updateView();return e}t(g,c);d(g,[{key:"adjustFromCursor",value:function(a,b){var d=this.inputElement;void 0===a&&(a="forward"===d.selectionDirection?d.selectionEnd:d.selectionStart);void 0!==this.cleanInput()&&(a=d.value.substring(0,a).split(",").length-1,this.updatePosition(),d=this.tempPosition,this.position.getVoxelCoordinates(d)&&(d[a]+=b,this.position.setVoxelCoordinates(d),this.updateView()))}},{key:"cleanInput",value:function(){var a=this.inputElement.selectionStart,b=/(-?\d+(?:\.(?:\d+)?)?)/.source,
d=/((?:\s+(?![\s,]))|(?:\s*,\s*))/.source,c=/([\[\]{}()\s]*)/.source;b=this.inputElement.value.match(new RegExp("^"+c+"(?![\\s])"+b+"?"+("(?:"+d+b+"?(?:"+d+b+"?)?)?")+(c+"$")));if(null!==b){var e="  ",g="x ",h=2,f=b[1].length;d=function(b,d,c){if(void 0!==b){var k=f+b.length;void 0===d&&(d=b,c=" ".repeat(d.length));a>=f&&(h=a===k?e.length+d.length:e.length+Math.min(d.length,a-f));e+=d;g+=c;f=k}};d(b[2]);d(b[3],",   ","  y ");d(b[4]);d(b[5],",   ","  z ");d(b[6]);this.hintElement.value=g;this.inputElement.value!==
e&&(this.inputElement.value=e,this.inputElement.selectionEnd=h,this.inputElement.selectionStart=h);this.updateHintScrollPosition();return void 0!==b[2]&&void 0!==b[4]&&void 0!==b[6]?{position:p.p.set(this.tempPosition,parseFloat(b[2]),parseFloat(b[4]),parseFloat(b[6]))}:{}}this.hintElement.value=""}},{key:"updatePosition",value:function(){var a=this.cleanInput();void 0!==a&&void 0!==a.position&&this.position.setVoxelCoordinates(a.position)}},{key:"getPositionText",value:function(){var a=this.tempPosition;
return this.position.getVoxelCoordinates(a)?Math.floor(a[0])+", "+Math.floor(a[1])+", "+Math.floor(a[2]):"<unspecified position>"}},{key:"updateView",value:function(){var a=this.tempPosition;if(this.position.getVoxelCoordinates(a)){var b=this.inputElement;a="  "+Math.floor(a[0])+",   "+Math.floor(a[1])+",   "+Math.floor(a[2]);var d=a.indexOf(","),c=a.indexOf(",",d+1)-d-4;d="x "+" ".repeat(d-2)+"  y "+" ".repeat(c)+"  z";c=b.selectionStart;var e=b.selectionEnd,g=b.selectionDirection;b.value=a;b.setSelectionRange(c,
e,g);this.hintElement.value=d+" ".repeat(a.length-d.length);this.updateHintScrollPosition()}else this.inputElement.value="",this.hintElement.value=""}},{key:"disposed",value:function(){Object(r.b)(this.element);e(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"disposed",this).call(this)}}]);return g}(m.a),F=function(a){function c(a,d){q(this,c);var e=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));e.element=a;e.voxelSize=d;e.dimensionsContainer=document.createElement("span");
e.unitsElement=document.createElement("span");var g=e.dimensionsContainer,h=e.unitsElement;a.className="neuroglancer-voxel-size-widget";a.title="Voxel size";g.className="neuroglancer-voxel-size-dimensions-container";a.appendChild(g);a.appendChild(h);h.className="neuroglancer-voxel-size-units";e.registerDisposer(d.changed.add(e.registerCancellable(Object(b.a)(function(){return e.updateView()}))));e.updateView();return e}t(c,a);d(c,[{key:"updateView",value:function(){var a=this.dimensionsContainer,
b=this.unitsElement;Object(r.a)(a);this.element.style.display=this.voxelSize.valid?null:"none";var d=this.voxelSize.size,c=Object(g.b)(Math.min(d[0],d[1],d[2]));b.textContent=c.unit;for(b=0;3>b;++b){for(var e=d[b]/c.lengthInNanometers,h="",f=0;2>=f&&(h=e.toFixed(f),parseFloat(h)!==e);++f);e=document.createElement("span");e.className="neuroglancer-voxel-size-dimension";e.textContent=h;a.appendChild(e)}}},{key:"disposed",value:function(){Object(r.b)(this.element);e(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),
"disposed",this).call(this)}}]);return c}(m.a),G=function(a){function c(a,d,e){q(this,c);var g=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));g.element=a;g.mouseState=d;g.voxelSize=e;g.tempPosition=p.p.create();a.className="neuroglancer-mouse-position-widget";a=g.registerCancellable(Object(b.a)(function(){return g.updateView()}));g.registerDisposer(d.changed.add(a));g.registerDisposer(e.changed.add(a));return g}t(c,a);d(c,[{key:"updateView",value:function(){var a="",b=this.mouseState,
d=this.voxelSize;b.active&&d.valid&&(a=this.tempPosition,d.voxelFromSpatial(a,b.position),a="x "+Math.floor(a[0])+",  y "+Math.floor(a[1])+",  z "+Math.floor(a[2]));this.element.textContent=a}},{key:"disposed",value:function(){Object(r.b)(this.element);e(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"disposed",this).call(this)}}]);return c}(m.a)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){var b=a.match(/^([^:?]+:[^:?]+:[^:?]+)(?::([^:?]+))?(?:\?(.*))?$/);if(null===b)throw Error("Invalid Brain Maps volume key: "+
JSON.stringify(a)+".");var d;void 0!==b[2]&&(d={changeStackId:b[2]});a=Object(A.e)(b[3]||"");return{volumeId:b[1],changeSpec:d,parameters:a}}function b(a){try{return Object(A.u)(a),{id:Object(A.w)(a,"id",A.B),label:Object(A.w)(a,"label",A.B),description:Object(A.w)(a,"description",A.z)}}catch(M){throw Error("Failed to parse project: "+M.message);}}function l(a){try{return Object(A.u)(a),Object(A.w)(a,"project",function(a){return void 0===a?[]:Object(A.a)(a,b)})}catch(M){throw Error("Error parsing project list: "+
M.message);}}function r(a){return Object(A.w)(a,"changeStackId",function(a){return void 0===a?void 0:Object(A.a)(a,A.B)})}Object.defineProperty(f,"__esModule",{value:!0});c.d(f,"BrainmapsSkeletonSource",function(){return C});c.d(f,"VolumeInfo",function(){return J});c.d(f,"MeshInfo",function(){return E});c.d(f,"MultiscaleVolumeChunkSource",function(){return S});f.parseVolumeKey=a;c.d(f,"VolumeList",function(){return U});f.parseChangeStackList=r;c.d(f,"BrainmapsDataSource",function(){return W});m=c(10);
var v=c(117),p=c(24),k=c(47),h=c(121),g=c(48),d=c(75),e=c(8),w=c(18),B=c(26),F=c(30),G=c(1),A=c(2),x=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}(),D=function(a){function b(){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}t(b,a);return b}(Object(m.f)(Object(v.a)()(w.b),
h.d)),z=function(a){function b(){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}t(b,a);return b}(Object(m.f)(Object(v.a)()(g.b),h.a)),C=function(a){function b(){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}t(b,a);x(b,[{key:"skeletonVertexCoordinatesInVoxels",get:function(){return!1}}]);return b}(Object(m.f)(Object(v.a)()(d.d),h.b)),H=new Map;H.set("UINT8",e.a.UINT8);H.set("FLOAT",e.a.FLOAT32);H.set("UINT64",e.a.UINT64);
var J=function M(a){q(this,M);try{Object(A.u)(a),this.numChannels=Object(A.A)(a.channelCount),this.dataType=Object(A.t)(a.channelType,H),this.voxelSize=Object(A.f)(G.p.create(),a.pixelSize,A.p),this.upperVoxelBound=Object(A.f)(G.p.create(),a.volumeSize,A.A)}catch(ba){throw Error("Failed to parse BrainMaps volume geometry: "+ba.message);}},E=function R(a){q(this,R);Object(A.u)(a);this.name=Object(A.w)(a,"name",A.B);this.type=Object(A.w)(a,"type",A.B)},S=function(){function a(b,d,c,g,h,f,k,w){q(this,
a);this.chunkManager=b;this.instance=d;this.credentialsProvider=c;this.volumeId=g;this.changeSpec=h;this.encoding=w.encoding;try{Object(A.u)(f);var l=this.scales=Object(A.w)(f,"geometry",function(a){return Object(A.a)(a,function(a){return new J(a)})});if(0===l.length)throw Error("Expected at least one scale.");var r=l[0],p=this.numChannels=r.numChannels,B=this.dataType=r.dataType;b=1;for(var v=l.length;b<v;++b){var z=l[b];if(z.dataType!==B)throw Error("Scale "+b+" has data type "+e.a[z.dataType]+
" "+("but scale 0 has data type "+e.a[B]+"."));if(z.numChannels!==p)throw Error("Scale "+b+" has "+z.numChannels+" channel(s) "+("but scale 0 has "+p+" channels."));}if(1===p)switch(B){case e.a.UINT64:var n=e.d.SEGMENTATION}void 0===n&&(n=void 0!==w.volumeType?w.volumeType:e.d.IMAGE);this.volumeType=n}catch(mb){throw Error("Failed to parse BrainMaps multiscale volume specification: "+mb.message);}try{Object(A.u)(k),this.meshes=Object(A.w)(k,"meshes",function(a){return void 0===a?[]:Object(A.a)(a,
function(a){return new E(a)})})}catch(mb){throw Error("Failed to parse BrainMaps meshes specification: "+mb.message);}}x(a,[{key:"getSources",value:function(a){var b=this,d=h.c.RAW;this.dataType===e.a.UINT64?d=h.c.COMPRESSED_SEGMENTATION:this.volumeType===e.d.IMAGE&&this.dataType===e.a.UINT8&&1===this.numChannels&&this.encoding!==h.c.RAW&&(d=h.c.JPEG);return this.scales.map(function(c,g){return e.c.getDefaults({voxelSize:c.voxelSize,dataType:c.dataType,numChannels:c.numChannels,upperVoxelBound:c.upperVoxelBound,
volumeType:b.volumeType,volumeSourceOptions:a}).map(function(a){return b.chunkManager.getChunkSource(D,{credentialsProvider:b.credentialsProvider,spec:a,parameters:{instance:b.instance,volumeId:b.volumeId,changeSpec:b.changeSpec,scaleIndex:g,encoding:d}})})})}},{key:"getMeshSource",value:function(){var a=this.meshes.find(function(a){return"TRIANGLES"===a.type});return void 0===a?null:this.chunkManager.getChunkSource(z,{credentialsProvider:this.credentialsProvider,parameters:{instance:this.instance,
volumeId:this.volumeId,meshName:a.name,changeSpec:this.changeSpec}})}}]);return a}(),K=/^([^\/]+)\/(.*)$/,U=function ba(a,b){q(this,ba);this.projects=new Map;this.hierarchicalVolumeIds=new Map;var d=this.projects;a=$jscomp.makeIterator(l(a));for(var c=a.next();!c.done;c=a.next())c=c.value,d.set(c.id,c);try{Object(A.u)(b);var e=this.volumeIds=Object(A.w)(b,"volumeId",function(a){return void 0===a?[]:Object(A.a)(a,A.B)});e.sort();for(var g=new Map,h=$jscomp.makeIterator(e),f=h.next();!f.done;f=h.next()){var k=
f.value;for(b=0;;){var w=k.indexOf(":",b);-1===w?w=void 0:++w;var r=k.substring(0,b),p=g.get(r);void 0===p&&(p=new Set,g.set(r,p));p.add(k.substring(b,w));if(void 0===w)break;b=w}}for(var B=this.hierarchicalVolumeIds,v=$jscomp.makeIterator(g),z=v.next();!z.done;z=v.next()){var n=$jscomp.makeIterator(z.value),t=n.next().value,D=n.next().value;B.set(t,Array.from(D))}}catch(sc){throw Error("Failed to parse Brain Maps volume list reply: "+sc.message);}},W=function(b){function d(a,b){q(this,d);var c=n(this,
(d.__proto__||Object.getPrototypeOf(d)).call(this));c.instance=a;c.credentialsProvider=b;return c}t(d,b);x(d,[{key:"getMeshSource",value:function(a,b){return a.getChunkSource(z,{credentialsProvider:this.credentialsProvider,parameters:this.getMeshSourceParameters(b)})}},{key:"getMeshSourceParameters",value:function(b){var d=b.match(K);if(null===d)throw Error("Invalid Brainmaps mesh URL: "+b);b=a(d[1]);return{instance:this.instance,volumeId:b.volumeId,changeSpec:b.changeSpec,meshName:d[2]}}},{key:"getSkeletonSource",
value:function(a,b){return a.getChunkSource(C,{credentialsProvider:this.credentialsProvider,parameters:this.getMeshSourceParameters(b)})}},{key:"getVolume",value:function(b,d,c){var e=this;d=a(d);var g=d.volumeId,f=d.changeSpec,w=d.parameters;Object(A.u)(w);d=Object(A.w)(w,"encoding",function(a){return void 0===a?void 0:Object(A.n)(w.encoding,h.c)});var l=Object.assign({},c,{encoding:d});return b.memoize.getUncounted({type:"brainmaps:getVolume",instance:this.instance,volumeId:g,changeSpec:f,brainmapsOptions:l},
function(){return Promise.all([Object(k.b)(e.instance,e.credentialsProvider,{method:"GET",path:"/v1beta2/volumes/"+g,responseType:"json"}),Object(k.b)(e.instance,e.credentialsProvider,{method:"GET",path:"/v1beta2/objects/"+g+"/meshes",responseType:"json"})]).then(function(a){var d=$jscomp.makeIterator(a);a=d.next().value;d=d.next().value;return new S(b,e.instance,e.credentialsProvider,g,f,a,d,l)})})}},{key:"getVolumeList",value:function(a){var b=this;return a.memoize.getUncounted({instance:this.instance,
type:"brainmaps:getVolumeList"},function(){var a=Promise.all([Object(k.b)(b.instance,b.credentialsProvider,{method:"GET",path:"/v1beta2/projects",responseType:"json"}),Object(k.b)(b.instance,b.credentialsProvider,{method:"GET",path:"/v1beta2/volumes",responseType:"json"})]).then(function(a){var b=$jscomp.makeIterator(a);a=b.next().value;b=b.next().value;return new U(a,b)}),d=b.instance.description+" volume list";B.a.forPromise(a,{delay:!0,initialMessage:"Retrieving "+d+".",errorPrefix:"Error retrieving "+
d+": "});return a})}},{key:"getChangeStackList",value:function(a,b){var d=this;return a.memoize.getUncounted({instance:this.instance,type:"brainmaps:getChangeStackList",volumeId:b},function(){var a=Object(k.b)(d.instance,d.credentialsProvider,{method:"GET",path:"/v1beta2/changes/"+b+"/change_stacks",responseType:"json"}).then(function(a){return r(a)}),c="change stacks for "+b;B.a.forPromise(a,{delay:!0,initialMessage:"Retrieving "+c+".",errorPrefix:"Error retrieving "+c+": "});return a})}},{key:"volumeCompleter",
value:function(a,b){var d=this;return this.getVolumeList(b).then(function(c){var e=a.match(/^([^:]+:[^:]+:[^:]+):(.*)$/);if(null!==e){var g=e[1],h=e[2];return d.getChangeStackList(b,g).then(function(a){if(void 0===a)throw null;return{offset:g.length+1,completions:Object(F.b)(h,a)}})}var f=a.lastIndexOf(":")+1;e=a.substring(0,f);f=a.substring(f);var k=c.hierarchicalVolumeIds.get(e);if(void 0===k)throw null;return e?{offset:e.length,completions:Object(F.b)(f,k)}:{offset:0,completions:Object(F.c)(f,
k,function(a){return a},function(a){return(a=c.projects.get(a.substring(0,a.length-1)))&&a.label})}})}},{key:"description",get:function(){return this.instance.description}}]);return d}(p.a);f.productionInstance={description:"Google Brain Maps",serverUrls:["https://brainmaps.googleapis.com"]}},function(m,f,c){c(16);c(112);c(113);var q=c(70),n=c(114),t=c(115);c(116);var a=c(71),b=c(72);c.d(f,"a",function(){return q});c.d(f,"b",function(){return n});c.d(f,"c",function(){return t});c.d(f,"d",function(){return a});
c.d(f,"e",function(){return b})},function(m,f,c){function q(a,b,c){var f=b[0],l=b[1],p=b[2],k=b[3],h=b[4],g=b[5],d=b[6],e=b[7];b=b[8];var w=c[0],B=c[1],n=c[2],q=c[3],t=c[4],m=c[5],D=c[6],z=c[7];c=c[8];a[0]=w*f+B*k+n*d;a[1]=w*l+B*h+n*e;a[2]=w*p+B*g+n*b;a[3]=q*f+t*k+m*d;a[4]=q*l+t*h+m*e;a[5]=q*p+t*g+m*b;a[6]=D*f+z*k+c*d;a[7]=D*l+z*h+c*e;a[8]=D*p+z*g+c*b;return a}function n(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];a[4]=b[4]-c[4];a[5]=b[5]-c[5];a[6]=b[6]-c[6];a[7]=b[7]-c[7];
a[8]=b[8]-c[8];return a}Object.defineProperty(f,"__esModule",{value:!0});f.create=function(){var a=new t.a(9);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};f.fromMat4=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[4];a[4]=b[5];a[5]=b[6];a[6]=b[8];a[7]=b[9];a[8]=b[10];return a};f.clone=function(a){var b=new t.a(9);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];return b};f.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=
b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};f.fromValues=function(a,b,c,f,v,p,k,h,g){var d=new t.a(9);d[0]=a;d[1]=b;d[2]=c;d[3]=f;d[4]=v;d[5]=p;d[6]=k;d[7]=h;d[8]=g;return d};f.set=function(a,b,c,f,v,p,k,h,g,d){a[0]=b;a[1]=c;a[2]=f;a[3]=v;a[4]=p;a[5]=k;a[6]=h;a[7]=g;a[8]=d;return a};f.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};f.transpose=function(a,b){if(a===b){var c=b[1],f=b[2],v=b[5];a[1]=b[3];a[2]=b[6];a[3]=c;a[5]=b[7];a[6]=
f;a[7]=v}else a[0]=b[0],a[1]=b[3],a[2]=b[6],a[3]=b[1],a[4]=b[4],a[5]=b[7],a[6]=b[2],a[7]=b[5],a[8]=b[8];return a};f.invert=function(a,b){var c=b[0],f=b[1],v=b[2],p=b[3],k=b[4],h=b[5],g=b[6],d=b[7];b=b[8];var e=b*k-h*d,w=-b*p+h*g,B=d*p-k*g,n=c*e+f*w+v*B;if(!n)return null;n=1/n;a[0]=e*n;a[1]=(-b*f+v*d)*n;a[2]=(h*f-v*k)*n;a[3]=w*n;a[4]=(b*c-v*g)*n;a[5]=(-h*c+v*p)*n;a[6]=B*n;a[7]=(-d*c+f*g)*n;a[8]=(k*c-f*p)*n;return a};f.adjoint=function(a,b){var c=b[0],f=b[1],v=b[2],p=b[3],k=b[4],h=b[5],g=b[6],d=b[7];
b=b[8];a[0]=k*b-h*d;a[1]=v*d-f*b;a[2]=f*h-v*k;a[3]=h*g-p*b;a[4]=c*b-v*g;a[5]=v*p-c*h;a[6]=p*d-k*g;a[7]=f*g-c*d;a[8]=c*k-f*p;return a};f.determinant=function(a){var b=a[3],c=a[4],f=a[5],v=a[6],p=a[7],k=a[8];return a[0]*(k*c-f*p)+a[1]*(-k*b+f*v)+a[2]*(p*b-c*v)};f.multiply=q;f.translate=function(a,b,c){var f=b[0],l=b[1],p=b[2],k=b[3],h=b[4],g=b[5],d=b[6],e=b[7];b=b[8];var w=c[0];c=c[1];a[0]=f;a[1]=l;a[2]=p;a[3]=k;a[4]=h;a[5]=g;a[6]=w*f+c*k+d;a[7]=w*l+c*h+e;a[8]=w*p+c*g+b;return a};f.rotate=function(a,
b,c){var f=b[0],l=b[1],p=b[2],k=b[3],h=b[4],g=b[5],d=b[6],e=b[7];b=b[8];var w=Math.sin(c);c=Math.cos(c);a[0]=c*f+w*k;a[1]=c*l+w*h;a[2]=c*p+w*g;a[3]=c*k-w*f;a[4]=c*h-w*l;a[5]=c*g-w*p;a[6]=d;a[7]=e;a[8]=b;return a};f.scale=function(a,b,c){var f=c[0];c=c[1];a[0]=f*b[0];a[1]=f*b[1];a[2]=f*b[2];a[3]=c*b[3];a[4]=c*b[4];a[5]=c*b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];return a};f.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=1;a[5]=0;a[6]=b[0];a[7]=b[1];a[8]=1;return a};f.fromRotation=function(a,
b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=0;a[3]=-c;a[4]=b;a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};f.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=b[1];a[5]=0;a[6]=0;a[7]=0;a[8]=1;return a};f.fromMat2d=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=0;a[3]=b[2];a[4]=b[3];a[5]=0;a[6]=b[4];a[7]=b[5];a[8]=1;return a};f.fromQuat=function(a,b){var c=b[0],f=b[1],v=b[2];b=b[3];var p=c+c,k=f+f,h=v+v;c*=p;var g=f*p;f*=k;var d=v*p,e=v*k;v*=h;p*=b;k*=b;b*=h;a[0]=1-f-v;a[3]=g-b;a[6]=d+k;a[1]=
g+b;a[4]=1-c-v;a[7]=e-p;a[2]=d-k;a[5]=e+p;a[8]=1-c-f;return a};f.normalFromMat4=function(a,b){var c=b[0],f=b[1],v=b[2],p=b[3],k=b[4],h=b[5],g=b[6],d=b[7],e=b[8],w=b[9],B=b[10],n=b[11],q=b[12],t=b[13],m=b[14];b=b[15];var D=c*h-f*k,z=c*g-v*k,C=c*d-p*k,H=f*g-v*h,J=f*d-p*h,E=v*d-p*g,S=e*t-w*q,K=e*m-B*q;e=e*b-n*q;var U=w*m-B*t;w=w*b-n*t;B=B*b-n*m;n=D*B-z*w+C*U+H*e-J*K+E*S;if(!n)return null;n=1/n;a[0]=(h*B-g*w+d*U)*n;a[1]=(g*e-k*B-d*K)*n;a[2]=(k*w-h*e+d*S)*n;a[3]=(v*w-f*B-p*U)*n;a[4]=(c*B-v*e+p*K)*n;a[5]=
(f*e-c*w-p*S)*n;a[6]=(t*E-m*J+b*H)*n;a[7]=(m*C-q*E-b*z)*n;a[8]=(q*J-t*C+b*D)*n;return a};f.projection=function(a,b,c){a[0]=2/b;a[1]=0;a[2]=0;a[3]=0;a[4]=-2/c;a[5]=0;a[6]=-1;a[7]=1;a[8]=1;return a};f.str=function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};f.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],
2))};f.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];a[8]=b[8]+c[8];return a};f.subtract=n;f.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*c;return a};f.multiplyScalarAndAdd=function(a,b,c,f){a[0]=b[0]+c[0]*f;a[1]=b[1]+c[1]*f;a[2]=b[2]+c[2]*f;a[3]=b[3]+c[3]*f;a[4]=b[4]+c[4]*f;a[5]=b[5]+c[5]*f;a[6]=b[6]+c[6]*f;a[7]=
b[7]+c[7]*f;a[8]=b[8]+c[8]*f;return a};f.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]};f.equals=function(a,b){var c=a[0],f=a[1],v=a[2],p=a[3],k=a[4],h=a[5],g=a[6],d=a[7];a=a[8];var e=b[0],w=b[1],B=b[2],n=b[3],q=b[4],m=b[5],x=b[6],D=b[7];b=b[8];return Math.abs(c-e)<=t.b*Math.max(1,Math.abs(c),Math.abs(e))&&Math.abs(f-w)<=t.b*Math.max(1,Math.abs(f),Math.abs(w))&&Math.abs(v-B)<=t.b*Math.max(1,Math.abs(v),
Math.abs(B))&&Math.abs(p-n)<=t.b*Math.max(1,Math.abs(p),Math.abs(n))&&Math.abs(k-q)<=t.b*Math.max(1,Math.abs(k),Math.abs(q))&&Math.abs(h-m)<=t.b*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(g-x)<=t.b*Math.max(1,Math.abs(g),Math.abs(x))&&Math.abs(d-D)<=t.b*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(a-b)<=t.b*Math.max(1,Math.abs(a),Math.abs(b))};var t=c(16);f.mul=q;f.sub=n},function(m,f,c){function q(){var a=new g.a(3);a[0]=0;a[1]=0;a[2]=0;return a}function n(a){var b=a[0],d=a[1];a=a[2];return Math.sqrt(b*
b+d*d+a*a)}function t(a,b,c){var d=new g.a(3);d[0]=a;d[1]=b;d[2]=c;return d}function a(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];return a}function b(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*c[1];a[2]=b[2]*c[2];return a}function l(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];return a}function r(a,b){var d=b[0]-a[0],c=b[1]-a[1];a=b[2]-a[2];return Math.sqrt(d*d+c*c+a*a)}function v(a,b){var d=b[0]-a[0],c=b[1]-a[1];a=b[2]-a[2];return d*d+c*c+a*a}function p(a){var b=a[0],d=a[1];a=a[2];return b*
b+d*d+a*a}function k(a,b){var d=b[0],c=b[1],e=b[2];d=d*d+c*c+e*e;0<d&&(d=1/Math.sqrt(d),a[0]=b[0]*d,a[1]=b[1]*d,a[2]=b[2]*d);return a}function h(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}Object.defineProperty(f,"__esModule",{value:!0});f.create=q;f.clone=function(a){var b=new g.a(3);b[0]=a[0];b[1]=a[1];b[2]=a[2];return b};f.length=n;f.fromValues=t;f.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];return a};f.set=function(a,b,c,g){a[0]=b;a[1]=c;a[2]=g;return a};f.add=function(a,b,c){a[0]=b[0]+c[0];
a[1]=b[1]+c[1];a[2]=b[2]+c[2];return a};f.subtract=a;f.multiply=b;f.divide=l;f.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);a[2]=Math.ceil(b[2]);return a};f.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);a[2]=Math.floor(b[2]);return a};f.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],c[2]);return a};f.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);return a};f.round=function(a,
b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);a[2]=Math.round(b[2]);return a};f.scale=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;return a};f.scaleAndAdd=function(a,b,c,g){a[0]=b[0]+c[0]*g;a[1]=b[1]+c[1]*g;a[2]=b[2]+c[2]*g;return a};f.distance=r;f.squaredDistance=v;f.squaredLength=p;f.negate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];return a};f.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];a[2]=1/b[2];return a};f.normalize=k;f.dot=h;f.cross=function(a,b,c){var d=b[0],e=b[1];b=b[2];var g=
c[0],f=c[1];c=c[2];a[0]=e*c-b*f;a[1]=b*g-d*c;a[2]=d*f-e*g;return a};f.lerp=function(a,b,c,g){var d=b[0],e=b[1];b=b[2];a[0]=d+g*(c[0]-d);a[1]=e+g*(c[1]-e);a[2]=b+g*(c[2]-b);return a};f.hermite=function(a,b,c,g,f,h){var d=h*h,e=d*(2*h-3)+1,k=d*(h-2)+h,w=d*(h-1);h=d*(3-2*h);a[0]=b[0]*e+c[0]*k+g[0]*w+f[0]*h;a[1]=b[1]*e+c[1]*k+g[1]*w+f[1]*h;a[2]=b[2]*e+c[2]*k+g[2]*w+f[2]*h;return a};f.bezier=function(a,b,c,g,f,h){var d=1-h,e=d*d,k=h*h,w=e*d;e*=3*h;d*=3*k;h*=k;a[0]=b[0]*w+c[0]*e+g[0]*d+f[0]*h;a[1]=b[1]*
w+c[1]*e+g[1]*d+f[1]*h;a[2]=b[2]*w+c[2]*e+g[2]*d+f[2]*h;return a};f.random=function(a,b){b=b||1;var d=2*g.c()*Math.PI,c=2*g.c()-1,e=Math.sqrt(1-c*c)*b;a[0]=Math.cos(d)*e;a[1]=Math.sin(d)*e;a[2]=c*b;return a};f.transformMat4=function(a,b,c){var d=b[0],e=b[1];b=b[2];var g=c[3]*d+c[7]*e+c[11]*b+c[15];g=g||1;a[0]=(c[0]*d+c[4]*e+c[8]*b+c[12])/g;a[1]=(c[1]*d+c[5]*e+c[9]*b+c[13])/g;a[2]=(c[2]*d+c[6]*e+c[10]*b+c[14])/g;return a};f.transformMat3=function(a,b,c){var d=b[0],e=b[1];b=b[2];a[0]=d*c[0]+e*c[3]+
b*c[6];a[1]=d*c[1]+e*c[4]+b*c[7];a[2]=d*c[2]+e*c[5]+b*c[8];return a};f.transformQuat=function(a,b,c){var d=b[0],e=b[1],g=b[2];b=c[0];var f=c[1],h=c[2];c=c[3];var k=c*d+f*g-h*e,w=c*e+h*d-b*g,l=c*g+b*e-f*d;d=-b*d-f*e-h*g;a[0]=k*c+d*-b+w*-h-l*-f;a[1]=w*c+d*-f+l*-b-k*-h;a[2]=l*c+d*-h+k*-f-w*-b;return a};f.rotateX=function(a,b,c,g){var d=[],e=[];d[0]=b[0]-c[0];d[1]=b[1]-c[1];d[2]=b[2]-c[2];e[0]=d[0];e[1]=d[1]*Math.cos(g)-d[2]*Math.sin(g);e[2]=d[1]*Math.sin(g)+d[2]*Math.cos(g);a[0]=e[0]+c[0];a[1]=e[1]+
c[1];a[2]=e[2]+c[2];return a};f.rotateY=function(a,b,c,g){var d=[],e=[];d[0]=b[0]-c[0];d[1]=b[1]-c[1];d[2]=b[2]-c[2];e[0]=d[2]*Math.sin(g)+d[0]*Math.cos(g);e[1]=d[1];e[2]=d[2]*Math.cos(g)-d[0]*Math.sin(g);a[0]=e[0]+c[0];a[1]=e[1]+c[1];a[2]=e[2]+c[2];return a};f.rotateZ=function(a,b,c,g){var d=[],e=[];d[0]=b[0]-c[0];d[1]=b[1]-c[1];d[2]=b[2]-c[2];e[0]=d[0]*Math.cos(g)-d[1]*Math.sin(g);e[1]=d[0]*Math.sin(g)+d[1]*Math.cos(g);e[2]=d[2];a[0]=e[0]+c[0];a[1]=e[1]+c[1];a[2]=e[2]+c[2];return a};f.angle=function(a,
b){a=t(a[0],a[1],a[2]);b=t(b[0],b[1],b[2]);k(a,a);k(b,b);b=h(a,b);return 1<b?0:-1>b?Math.PI:Math.acos(b)};f.str=function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"};f.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]};f.equals=function(a,b){var d=a[0],c=a[1];a=a[2];var e=b[0],f=b[1];b=b[2];return Math.abs(d-e)<=g.b*Math.max(1,Math.abs(d),Math.abs(e))&&Math.abs(c-f)<=g.b*Math.max(1,Math.abs(c),Math.abs(f))&&Math.abs(a-b)<=g.b*Math.max(1,Math.abs(a),Math.abs(b))};var g=c(16);
f.sub=a;f.mul=b;f.div=l;f.dist=r;f.sqrDist=v;f.len=n;f.sqrLen=p;m=function(){var a=q();return function(b,d,c,g,f,h){d||(d=3);c||(c=0);for(g=g?Math.min(g*d+c,b.length):b.length;c<g;c+=d)a[0]=b[c],a[1]=b[c+1],a[2]=b[c+2],f(a,a,h),b[c]=a[0],b[c+1]=a[1],b[c+2]=a[2];return b}}();f.forEach=m},function(m,f,c){function q(){var a=new h.a(4);a[0]=0;a[1]=0;a[2]=0;a[3]=0;return a}function n(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];return a}function t(a,b,c){a[0]=b[0]*c[0];a[1]=b[1]*
c[1];a[2]=b[2]*c[2];a[3]=b[3]*c[3];return a}function a(a,b,c){a[0]=b[0]/c[0];a[1]=b[1]/c[1];a[2]=b[2]/c[2];a[3]=b[3]/c[3];return a}function b(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;return a}function l(a,b){var d=b[0]-a[0],c=b[1]-a[1],g=b[2]-a[2];a=b[3]-a[3];return Math.sqrt(d*d+c*c+g*g+a*a)}function r(a,b){var d=b[0]-a[0],c=b[1]-a[1],g=b[2]-a[2];a=b[3]-a[3];return d*d+c*c+g*g+a*a}function v(a){var b=a[0],c=a[1],g=a[2];a=a[3];return Math.sqrt(b*b+c*c+g*g+a*a)}function p(a){var b=a[0],
c=a[1],g=a[2];a=a[3];return b*b+c*c+g*g+a*a}function k(a,b){var d=b[0],c=b[1],g=b[2];b=b[3];var f=d*d+c*c+g*g+b*b;0<f&&(f=1/Math.sqrt(f),a[0]=d*f,a[1]=c*f,a[2]=g*f,a[3]=b*f);return a}Object.defineProperty(f,"__esModule",{value:!0});f.create=q;f.clone=function(a){var b=new h.a(4);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];return b};f.fromValues=function(a,b,c,f){var d=new h.a(4);d[0]=a;d[1]=b;d[2]=c;d[3]=f;return d};f.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];return a};f.set=function(a,
b,c,f,h){a[0]=b;a[1]=c;a[2]=f;a[3]=h;return a};f.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=b[2]+c[2];a[3]=b[3]+c[3];return a};f.subtract=n;f.multiply=t;f.divide=a;f.ceil=function(a,b){a[0]=Math.ceil(b[0]);a[1]=Math.ceil(b[1]);a[2]=Math.ceil(b[2]);a[3]=Math.ceil(b[3]);return a};f.floor=function(a,b){a[0]=Math.floor(b[0]);a[1]=Math.floor(b[1]);a[2]=Math.floor(b[2]);a[3]=Math.floor(b[3]);return a};f.min=function(a,b,c){a[0]=Math.min(b[0],c[0]);a[1]=Math.min(b[1],c[1]);a[2]=Math.min(b[2],
c[2]);a[3]=Math.min(b[3],c[3]);return a};f.max=function(a,b,c){a[0]=Math.max(b[0],c[0]);a[1]=Math.max(b[1],c[1]);a[2]=Math.max(b[2],c[2]);a[3]=Math.max(b[3],c[3]);return a};f.round=function(a,b){a[0]=Math.round(b[0]);a[1]=Math.round(b[1]);a[2]=Math.round(b[2]);a[3]=Math.round(b[3]);return a};f.scale=b;f.scaleAndAdd=function(a,b,c,f){a[0]=b[0]+c[0]*f;a[1]=b[1]+c[1]*f;a[2]=b[2]+c[2]*f;a[3]=b[3]+c[3]*f;return a};f.distance=l;f.squaredDistance=r;f.length=v;f.squaredLength=p;f.negate=function(a,b){a[0]=
-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=-b[3];return a};f.inverse=function(a,b){a[0]=1/b[0];a[1]=1/b[1];a[2]=1/b[2];a[3]=1/b[3];return a};f.normalize=k;f.dot=function(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]};f.lerp=function(a,b,c,f){var d=b[0],e=b[1],g=b[2];b=b[3];a[0]=d+f*(c[0]-d);a[1]=e+f*(c[1]-e);a[2]=g+f*(c[2]-g);a[3]=b+f*(c[3]-b);return a};f.random=function(a,d){d=d||1;a[0]=h.c();a[1]=h.c();a[2]=h.c();a[3]=h.c();k(a,a);b(a,a,d);return a};f.transformMat4=function(a,b,c){var d=b[0],e=b[1],
g=b[2];b=b[3];a[0]=c[0]*d+c[4]*e+c[8]*g+c[12]*b;a[1]=c[1]*d+c[5]*e+c[9]*g+c[13]*b;a[2]=c[2]*d+c[6]*e+c[10]*g+c[14]*b;a[3]=c[3]*d+c[7]*e+c[11]*g+c[15]*b;return a};f.transformQuat=function(a,b,c){var d=b[0],e=b[1],g=b[2],f=c[0],h=c[1],k=c[2];c=c[3];var l=c*d+h*g-k*e,r=c*e+k*d-f*g,p=c*g+f*e-h*d;d=-f*d-h*e-k*g;a[0]=l*c+d*-f+r*-k-p*-h;a[1]=r*c+d*-h+p*-f-l*-k;a[2]=p*c+d*-k+l*-h-r*-f;a[3]=b[3];return a};f.str=function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};f.exactEquals=function(a,b){return a[0]===
b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]};f.equals=function(a,b){var d=a[0],c=a[1],g=a[2];a=a[3];var f=b[0],k=b[1],l=b[2];b=b[3];return Math.abs(d-f)<=h.b*Math.max(1,Math.abs(d),Math.abs(f))&&Math.abs(c-k)<=h.b*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(g-l)<=h.b*Math.max(1,Math.abs(g),Math.abs(l))&&Math.abs(a-b)<=h.b*Math.max(1,Math.abs(a),Math.abs(b))};var h=c(16);f.sub=n;f.mul=t;f.div=a;f.dist=l;f.sqrDist=r;f.len=v;f.sqrLen=p;m=function(){var a=q();return function(b,c,g,f,h,k){c||(c=4);g||
(g=0);for(f=f?Math.min(f*c+g,b.length):b.length;g<f;g+=c)a[0]=b[g],a[1]=b[g+1],a[2]=b[g+2],a[3]=b[g+3],h(a,a,k),b[g]=a[0],b[g+1]=a[1],b[g+2]=a[2],b[g+3]=a[3];return b}}();f.forEach=m},function(m,f,c){f=c(124);c="object"==typeof self&&self&&self.Object===Object&&self;f=f||c||Function("return this")();m.exports=f},function(m,f,c){f=c(73).Symbol;m.exports=f},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){switch(a){case h.b.FLOAT32:return G.c;default:throw Error("Data type not supported by WebGL: ${DataType[dataType]}");
}}f.f=function(a){return new k.a(void 0===a?"void main() {\n  emitDefault();\n}\n":a,e.B)};c.d(f,"c",function(){return S});c.d(f,"b",function(){return K});c.d(f,"e",function(){return U});c.d(f,"d",function(){return R});var b=c(23);m=c(10);var l=c(32),r=c(37),v=c(136),p=c(50),k=c(5),h=c(27),g=c(0),d=c(1),e=c(2),w=c(19),B=c(3),F=c(17),G=c(20),A=c(25),x=c(7),D=function ha(a,b,d){null===a&&(a=Function.prototype);var c=Object.getOwnPropertyDescriptor(a,b);if(void 0===c){if(a=Object.getPrototypeOf(a),null!==
a)return ha(a,b,d)}else{if("value"in c)return c.value;b=c.get;return void 0===b?void 0:b.call(d)}},z=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}(),C=c(54),H=d.j.create(),J=new Float32Array(4);f.a="//NEUROGLANCER_SKELETON_LAYER_FRAGMENT_MAIN_START";var E=function(a){function b(a){q(this,b);var d=n(this,(b.__proto__||
Object.getPrototypeOf(b)).call(this));d.vertexAttributes=a;d.shaders=new Map;d.shaderGeneration=-1;d.vertexAttributesKey=Object(e.g)(d.vertexAttributes);return d}t(b,a);z(b,[{key:"defineShader",value:function(a,b){a.addUniform("highp vec4","uColor");a.addUniform("highp mat4","uProjection");a.addUniform("highp vec4","uPickID");var d="\ngl_Position = uProjection * vec4(aVertex0, 1.0);\n";a.addFragmentCode("\nvec4 segmentColor() {\n  return uColor;\n}\nvoid emitRGB(vec3 color) {\n  emit(vec4(color * uColor.a, uColor.a), uPickID);\n}\nvoid emitDefault() {\n  emit(uColor, uPickID);\n}\n");
a.addFragmentCode(C);this.vertexAttributes.forEach(function(b,c){a.addAttribute("highp "+b.glslDataType,"aVertex"+c);0!==c&&(a.addVarying("highp "+b.glslDataType,"vVertex"+c),d+="vVertex"+c+" = aVertex"+c+";\n",a.addFragmentCode("#define "+b.name+" vVertex"+c+"\n"))});a.setVertexMain(d);a.setFragmentMainFunction("//NEUROGLANCER_SKELETON_LAYER_FRAGMENT_MAIN_START\n"+b)}},{key:"beginLayer",value:function(a,b,c,e){c=d.j.multiply(H,c.dataToDevice,e);a.uniformMatrix4fv(b.uniform("uProjection"),!1,c)}},
{key:"getShader",value:function(a,b,d){var c=this;return this.registerDisposer(a.memoize.get("skeleton/SkeletonShaderManager:"+Object(w.a)(b)+":"+this.vertexAttributesKey+":"+d,function(){var e=new A.a(a);e.require(b);c.defineShader(e,d);return e.build()}))}},{key:"setColor",value:function(a,b,d){a.uniform4fv(b.uniform("uColor"),d)}},{key:"setPickID",value:function(a,b,d){a.uniform4fv(b.uniform("uPickID"),Object(x.p)(J,d))}},{key:"drawSkeleton",value:function(a,b,d){for(var c=this.vertexAttributes,
e=c.length,g=d.vertexAttributeOffsets,f=0;f<e;++f){var h=c[f];d.vertexBuffer.bindToVertexAttrib(b.attribute("aVertex"+f),h.numComponents,h.webglDataType,!1,0,g[f])}d.indexBuffer.bind();a.drawElements(a.LINES,d.numIndices,a.UNSIGNED_INT,0)}},{key:"endLayer",value:function(a,b){for(var d=this.vertexAttributes.length,c=0;c<d;++c)a.disableVertexAttribArray(b.attribute("aVertex"+c))}}]);return b}(g.a),S=function(c){function e(b,c,g,f){q(this,e);var h=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));
h.chunkManager=b;h.source=c;h.voxelSizeObject=g;h.displayState=f;h.tempMat=d.j.create();h.redrawNeeded=new B.a;h.fallbackFragmentMain="void main() {\n  emitDefault();\n}\n";Object(r.f)(f,h);h.displayState.shaderError.value=void 0;h.registerDisposer(f.fragmentMain.changed.add(function(){h.displayState.shaderError.value=void 0;h.redrawNeeded.dispatch()}));b=h.sharedObject=h.registerDisposer(new r.b(b,f));b.RPC_TYPE_ID=v.a;b.initializeCounterpartWithChunkManager({source:c.addCounterpartRef()});b=h.vertexAttributes=
[W];c=$jscomp.makeIterator(c.vertexAttributes);for(g=c.next();!g.done;g=c.next())f=$jscomp.makeIterator(g.value),g=f.next().value,f=f.next().value,b.push({name:g,dataType:f.dataType,numComponents:f.numComponents,webglDataType:a(f.dataType),glslDataType:1<f.numComponents?"vec"+f.numComponents:"float"});return h}t(e,c);z(e,[{key:"getShader",value:function(a,b,d){var c=this.displayState.fragmentMain,e=c.changed.count,g=b.shaders;b.shaderGeneration!==e&&(g.clear(),b.shaderGeneration=e);e=g.get(d);if(void 0===
e){e=null;try{e=b.getShader(a,d,c.value),this.fallbackFragmentMain=c.value,this.displayState.shaderError.value=null}catch(uc){this.displayState.shaderError.value=uc;try{e=b.getShader(a,d,this.fallbackFragmentMain)}catch(Db){}}g.set(d,e)}return e}},{key:"draw",value:function(a,c,e,g){void 0===g&&(g=a.emitColor?1:5);var f=this.gl,h=this.source,k=this.displayState,l=Math.min(1,k.objectAlpha.value);if(!(0>=l)){var w=this.getShader(f,e,a.emitter);if(null!==w){w.bind();var p=this.tempMat;d.j.identity(p);
h.skeletonVertexCoordinatesInVoxels&&d.j.scale(p,p,this.voxelSizeObject.size);d.j.multiply(p,this.displayState.objectToDataTransform.transform,p);e.beginLayer(f,w,a,p);h=h.chunks;var v=a.pickIDs;f.lineWidth(g);Object(r.d)(k,h,function(d,g,h){h.state===b.d.GPU_MEMORY&&(a.emitColor&&e.setColor(f,w,Object(r.e)(k,d,l)),a.emitPickID&&e.setPickID(f,w,v.registerUint64(c,g)),e.drawSkeleton(f,w,h))});e.endLayer(f,w)}}}},{key:"visibility",get:function(){return this.sharedObject.visibility}},{key:"gl",get:function(){return this.chunkManager.chunkQueueManager.gl}}]);
return e}(g.a),K=function(a){function b(a){q(this,b);var d=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));d.base=a;d.renderHelper=d.registerDisposer(new E(d.base.vertexAttributes));d.registerDisposer(a);d.registerDisposer(a.redrawNeeded.add(function(){d.redrawNeeded.dispatch()}));d.setReady(!0);d.registerDisposer(a.visibility.add(d.visibility));return d}t(b,a);z(b,[{key:"draw",value:function(a){this.base.draw(a,this,this.renderHelper)}},{key:"gl",get:function(){return this.base.gl}},{key:"isTransparent",
get:function(){return 1>this.base.displayState.objectAlpha.value}}]);return b}(l.a),U=function(a){function b(a){q(this,b);var d=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));d.base=a;d.renderHelper=d.registerDisposer(new E(d.base.vertexAttributes));d.registerDisposer(a);d.registerDisposer(a.redrawNeeded.add(function(){d.redrawNeeded.dispatch()}));d.setReady(!0);d.registerDisposer(a.visibility.add(d.visibility));return d}t(b,a);z(b,[{key:"draw",value:function(a){this.base.draw(a,this,
this.renderHelper,10)}},{key:"gl",get:function(){return this.base.gl}}]);return b}(p.b),W={dataType:h.b.FLOAT32,numComponents:3,name:"",webglDataType:G.c,glslDataType:"vec3"},V=function(a){function b(a,d){q(this,b);a=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));a.vertexAttributes=d.vertexAttributes;var c=a.indices=d.indices;a.vertexAttributeOffsets=d.vertexAttributeOffsets;a.numIndices=c.length;return a}t(b,a);z(b,[{key:"copyToGPU",value:function(a){D(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),
"copyToGPU",this).call(this,a);this.vertexBuffer=F.a.fromData(a,this.vertexAttributes,a.ARRAY_BUFFER,a.STATIC_DRAW);this.indexBuffer=F.a.fromData(a,this.indices,a.ELEMENT_ARRAY_BUFFER,a.STATIC_DRAW)}},{key:"freeGPUMemory",value:function(a){D(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"freeGPUMemory",this).call(this,a);this.vertexBuffer.dispose();this.indexBuffer.dispose()}}]);return b}(m.b),M=new Map,R=function(a){function b(){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,
arguments))}t(b,a);z(b,[{key:"getChunk",value:function(a){return new V(this,a)}},{key:"skeletonVertexCoordinatesInVoxels",get:function(){return!0}},{key:"vertexAttributes",get:function(){return M}}]);return b}(m.e)},function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?
Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return b});m=c(0);var n=c(17),t=c(77),a=function(){function a(a,b){for(var c=0;c<b.length;c++){var f=b[c];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),b=function(b){function c(a){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");var b=(c.__proto__||Object.getPrototypeOf(c)).call(this);
if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");b=!b||"object"!==typeof b&&"function"!==typeof b?this:b;b.gl=a;b.vertexBuffer=b.registerDisposer(n.a.fromData(a,new Float32Array([0,0,0,1,1,0,0,1,0,0,0,1,0,1,0,1,0,0,0,1,0,0,1,1]),a.ARRAY_BUFFER,a.STATIC_DRAW));b.colorBuffer=b.registerDisposer(n.a.fromData(a,new Float32Array([1,0,0,.5,1,0,0,.5,0,1,0,.5,0,1,0,.5,0,0,1,.5,0,0,1,.5]),a.ARRAY_BUFFER,a.STATIC_DRAW));b.trivialColorShader=b.registerDisposer(Object(t.c)(a));
return b}q(c,b);a(c,[{key:"draw",value:function(a,b){b=void 0===b?!0:b;var c=this.trivialColorShader,f=this.gl;c.bind();f.uniformMatrix4fv(c.uniform("uProjectionMatrix"),!1,a);a=c.attribute("aVertexPosition");this.vertexBuffer.bindToVertexAttrib(a,4);c=c.attribute("aColor");this.colorBuffer.bindToVertexAttrib(c,4);b&&(f.colorMask(!1,!1,!1,!0),f.clearColor(0,0,0,0),f.clear(f.COLOR_BUFFER_BIT),f.colorMask(!0,!0,!0,!0),f.enable(f.BLEND),f.blendFunc(f.ONE_MINUS_DST_ALPHA,f.DST_ALPHA));f.lineWidth(1);
f.drawArrays(f.LINES,0,6);b&&f.disable(f.BLEND);f.disableVertexAttribArray(a);f.disableVertexAttribArray(c)}}],[{key:"get",value:function(a){return a.memoize.get("SliceViewPanel:AxesLineHelper",function(){return new c(a)})}}]);return c}(m.a)},function(m,f,c){function q(a){a.setFragmentMain("gl_FragColor = getValue0();")}f.a=q;f.b=function(a,b,c){b=void 0===b?q:b;c=void 0===c?1:c;return a.memoize.get("elementWiseTextureShader:"+c+":"+Object(n.a)(b),function(){var f=new t.a(a);f.addVarying("vec2","vTexCoord");
f.addUniform("sampler2D","uSampler",c);f.addInitializer(function(b){for(var f=[],h=0;h<c;++h)f[h]=h;a.uniform1iv(b.uniform("uSampler"),f)});for(var l=0;l<c;++l)f.addFragmentCode("\nvec4 getValue"+l+"() {\n  return texture2D(uSampler["+l+"], vTexCoord);\n}\n");f.addUniform("mat4","uProjectionMatrix");f.require(b);f.addAttribute("vec4","aVertexPosition");f.addAttribute("vec2","aTexCoord");f.setVertexMain("vTexCoord = aTexCoord; gl_Position = uProjectionMatrix * aVertexPosition;");return f.build()})};
f.c=function(a){return a.memoize.get("trivialColorShader",function(){var b=new t.a(a);b.addVarying("vec4","vColor");b.setFragmentMain("gl_FragColor = vColor;");b.addAttribute("vec4","aVertexPosition");b.addAttribute("vec4","aColor");b.addUniform("mat4","uProjectionMatrix");b.setVertexMain("vColor = aColor; gl_Position = uProjectionMatrix * aVertexPosition;");return b.build()})};var n=c(19),t=c(25)},function(m,f,c){c.d(f,"a",function(){return n});var q=function(){function c(a,b){for(var c=0;c<b.length;c++){var f=
b[c];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(a,b,f){b&&c(a.prototype,b);f&&c(a,f);return a}}(),n=function(){function c(){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");this.renderLayers=[null];this.values=[0,0,0];this.nextPickID=1}q(c,[{key:"clear",value:function(){this.renderLayers.length=1;this.values.length=3;this.nextPickID=1}},{key:"registerUint64",value:function(a,b,c){return this.register(a,
void 0===c?1:c,b.low,b.high)}},{key:"register",value:function(a,b,c,f){var l=this.renderLayers,r=this.values,k=this.nextPickID;this.nextPickID+=void 0===b?1:b;b=l.length;l[b]=a;a=3*b;r[a]=k;r[a+1]=void 0===c?0:c;r[a+2]=void 0===f?0:f;return k}},{key:"setMouseState",value:function(a,b){for(var c=this.renderLayers,f=this.values,v=0,p=c.length-1;v<p;){var k=Math.ceil(v+(p-v)/2);f[3*k]>b?p=k-1:v=k}c=a.pickedRenderLayer=c[v];v*=3;b=a.pickedOffset=b-f[v];p=a.pickedValue;p.low=f[v+1];p.high=f[v+2];null!==
c&&c.updateMouseState(a,p,b)}}]);return c}()},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?
Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return g});m=c(80);var t=c(38),a=c(15),b=c(1),l=c(34),r=c(81),v=c(140),p=function(){function a(a,b){for(var d=0;d<b.length;d++){var c=b[d];c.enumerable=c.enumerable||!1;c.configurable=!0;"value"in c&&(c.writable=!0);Object.defineProperty(a,c.key,c)}}return function(b,d,c){d&&a(b.prototype,d);c&&a(b,c);return b}}(),k=function e(a,b,c){null===a&&(a=Function.prototype);var g=Object.getOwnPropertyDescriptor(a,b);if(void 0===g){if(a=Object.getPrototypeOf(a),
null!==a)return e(a,b,c)}else{if("value"in g)return g.value;b=g.get;return void 0===b?void 0:b.call(c)}};c(141);c(21);var h=b.p.create(),g=function(c){function e(c,g,f){if(!(this instanceof e))throw new TypeError("Cannot call a class as a function");var k=q(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,c,g,f.visibility));k.viewer=f;k.mouseX=0;k.mouseY=0;k.mouseStateUpdater=k.updateMouseState.bind(k);k.inputEventMap=f.inputEventMap;g.classList.add("neuroglancer-rendered-data-panel");g.classList.add("neuroglancer-panel");
g.classList.add("neuroglancer-noselect");k.registerDisposer(new t.a(g));k.registerDisposer(new l.b(g,k.inputEventMap));k.registerDisposer(new r.a(g,k.inputEventMap));k.registerEventListener(g,"mousemove",k.onMousemove.bind(k));k.registerEventListener(g,"mouseleave",k.onMouseout.bind(k));Object(a.c)(g,"snap",function(){k.navigationState.pose.snap()});Object(a.c)(g,"zoom-in",function(){k.navigationState.zoomBy(.5)});Object(a.c)(g,"zoom-out",function(){k.navigationState.zoomBy(2)});for(c={axis:0};3>
c.axis;c={axis:c.axis},++c.axis){f=b.a[c.axis];for(var w={},p=$jscomp.makeIterator([-1,1]),z=p.next();!z.done;w={sign:w.sign,tempOffset:w.tempOffset},z=p.next())w.sign=z.value,z=0>w.sign?"-":"+",Object(a.c)(g,"rotate-relative-"+f+z,function(a,c){return function(){k.navigationState.pose.rotateRelative(b.e[a.axis],.1*c.sign)}}(c,w)),w.tempOffset=b.p.create(),Object(a.c)(g,""+f+z,function(a,b){return function(){var c=k.navigationState,e=a.tempOffset;e[0]=0;e[1]=0;e[2]=0;e[b.axis]=a.sign;c.pose.translateVoxelsRelative(e)}}(w,
c))}Object(a.c)(g,"zoom-via-wheel",function(a){a=a.detail;k.onMousemove(a);k.zoomByMouse(Object(v.a)(a))});c={};f=$jscomp.makeIterator([1,10]);for(w=f.next();!w.done;c={amount:c.amount},w=f.next())c.amount=w.value,Object(a.c)(g,"z+"+c.amount+"-via-wheel",function(a){return function(b){var c=b.detail;b=k.navigationState;c=0!==c.deltaY?c.deltaY:c.deltaX;h[0]=0;h[1]=0;h[2]=(0<c?-1:1)*a.amount;b.pose.translateVoxelsRelative(h)}}(c));Object(a.c)(g,"move-to-mouse-position",function(){var a=k.viewer.mouseState;
if(a.updateUnconditionally()){var c=k.navigationState.pose.position;b.p.copy(c.spatialCoordinates,a.position);c.changed.dispatch()}});Object(a.c)(g,"snap",function(){return k.navigationState.pose.snap()});return k}n(e,c);p(e,[{key:"onMouseout",value:function(a){a=this.viewer.mouseState;a.updater=void 0;a.setActive(!1)}},{key:"onMousemove",value:function(a){var b=this.element;a.target===b&&(this.mouseX=a.offsetX-b.clientLeft,this.mouseY=a.offsetY-b.clientTop,a=this.viewer.mouseState,a.updater=this.mouseStateUpdater,
a.triggerUpdate())}},{key:"disposed",value:function(){var a=this.viewer.mouseState;a.updater===this.mouseStateUpdater&&(a.updater=void 0,a.setActive(!1));k(e.prototype.__proto__||Object.getPrototypeOf(e.prototype),"disposed",this).call(this)}}]);return e}(m.b)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==
typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"b",function(){return v});c.d(f,"a",function(){return p});m=c(0);var a=c(3),b=c(137),l=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=
b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),r=function h(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return h(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},v=function(a){function b(a,c,g){q(this,b);var d=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));
d.context=a;d.element=c;d.visibility=g;d.gl=a.gl;a.addPanel(d);return d}t(b,a);l(b,[{key:"scheduleRedraw",value:function(){this.context.scheduleRedraw()}},{key:"setGLViewport",value:function(){var a=this.element,b=a.getBoundingClientRect(),c=this.context.canvasRect,g=a.clientLeft+b.left-c.left,f=a.clientWidth,h=a.clientHeight;b=b.top-c.top+a.clientTop+h;a=this.gl;a.enable(a.SCISSOR_TEST);b=this.context.canvas.height-b;a.viewport(g,b,f,h);a.scissor(g,b,f,h)}},{key:"disposed",value:function(){this.context.removePanel(this);
r(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"disposed",this).call(this)}},{key:"visible",get:function(){return this.visibility.visible}}]);return b}(m.a),p=function(c){function g(c){q(this,g);var d=n(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));d.container=c;d.canvas=document.createElement("canvas");d.updateStarted=new a.a;d.updateFinished=new a.a;d.panels=new Set;d.updatePending=null;d.needsRedraw=!1;var f=d.canvas;c.style.position="relative";f.style.position="absolute";
f.style.top="0px";f.style.left="0px";f.style.width="100%";f.style.height="100%";f.style.zIndex="0";c.appendChild(f);d.gl=Object(b.a)(f);d.registerEventListener(window,"resize",d.onResize.bind(d));return d}t(g,c);l(g,[{key:"makeCanvasOverlayElement",value:function(){var a=document.createElement("div");a.style.position="absolute";a.style.top="0px";a.style.left="0px";a.style.width="100%";a.style.height="100%";a.style.zIndex="2";this.container.appendChild(a);return a}},{key:"disposed",value:function(){null!=
this.updatePending&&(cancelAnimationFrame(this.updatePending),this.updatePending=null)}},{key:"addPanel",value:function(a){this.panels.add(a)}},{key:"removePanel",value:function(a){this.panels.delete(a);a.dispose()}},{key:"onResize",value:function(){this.scheduleRedraw();for(var a=$jscomp.makeIterator(this.panels),b=a.next();!b.done;b=a.next())b.value.onResize()}},{key:"scheduleUpdate",value:function(){null===this.updatePending&&(this.updatePending=requestAnimationFrame(this.update.bind(this)))}},
{key:"scheduleRedraw",value:function(){this.needsRedraw||(this.needsRedraw=!0,this.scheduleUpdate())}},{key:"update",value:function(){this.updatePending=null;this.updateStarted.dispatch();if(this.needsRedraw){this.needsRedraw=!1;var a=this.gl,b=this.canvas;b.width=b.offsetWidth;b.height=b.offsetHeight;this.canvasRect=b.getBoundingClientRect();this.gl.clearColor(0,0,0,0);a.clear(a.COLOR_BUFFER_BIT|a.DEPTH_BUFFER_BIT);b=$jscomp.makeIterator(this.panels);for(var c=b.next();!c.done;c=b.next()){c=c.value;
var g=c.element;c.visible&&0!==g.clientWidth&&0!==g.clientHeight&&0!==g.offsetWidth&&0!==g.offsetHeight&&(c.setGLViewport(),c.draw())}a.disable(a.SCISSOR_TEST);this.gl.clearColor(1,1,1,1);this.gl.colorMask(!1,!1,!1,!0);a.clear(a.COLOR_BUFFER_BIT);this.gl.colorMask(!0,!0,!0,!0)}this.updateFinished.dispatch()}}]);return g}(m.a)},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?
a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return b});m=c(0);var t=c(15),a=function(){function a(a,b){for(var c=0;c<b.length;c++){var f=b[c];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=
!0);Object.defineProperty(a,f.key,f)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),b=function(b){function c(a,b){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");var f=q(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));f.target=a;f.eventMap=b;f.registerEventListener(a,"wheel",function(a){f.dispatch("wheel",a)});f.registerEventListener(a,"click",function(a){f.dispatch("click"+a.button,a)});f.registerEventListener(a,"dblclick",function(a){f.dispatch("dblclick"+
a.button,a)});f.registerEventListener(a,"mousedown",function(a){f.dispatch("mousedown"+a.button,a)});f.registerEventListener(a,"mouseup",function(a){f.dispatch("mouseup"+a.button,a)});return f}n(c,b);a(c,[{key:"dispatch",value:function(a,b){Object(t.b)(a,b,this.eventMap)}}]);return c}(m.a)},function(m,f,c){f.b=function(c,f,t,a){for(;f<t;){var b=c[f];a(b)?++f:(--t,c[f]=c[t],c[t]=b)}return t};f.a=function(c,f){if(c.length===f)return c;f=new c.constructor(f);f.set(c);return f}},function(m,f,c){f.a=function(c,
f){var n=c.view.document,a=c.screenX,b=c.screenY,l=function(c){var k=a-c.screenX,h=b-c.screenY;a=c.screenX;b=c.screenY;f(c,k,h)},r=c.button,v=function(a){a.button===r&&(n.removeEventListener("mousemove",l,!0),n.removeEventListener("mouseup",v,!1))};n.addEventListener("mousemove",l,!0);n.addEventListener("mouseup",v,!1)}},function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&
b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function n(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function t(a){for(var b=v.length,c=v[b-1],e=0;e<b;++e){var f=v[e];if(a>=f.lengthInNanometers){c=f;break}}return c}f.b=t;c.d(f,"a",function(){return k});m=c(0);var a=c(40),b=function g(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,
b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return g(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,g){c&&a(b.prototype,c);g&&a(b,g);return b}}(),r=[1.5,2,3,5,7.5,10],v=[{unit:"km",lengthInNanometers:1E12},{unit:"m",lengthInNanometers:1E9},{unit:"mm",
lengthInNanometers:1E6},{unit:"\u00b5m",lengthInNanometers:1E3},{unit:"nm",lengthInNanometers:1},{unit:"pm",lengthInNanometers:.001}],p=function(){function a(){n(this,a);this.allowedSignificands=r;this.prevTargetLengthInPixels=this.prevNanometersPerPixel=this.nanometersPerPixel=this.targetLengthInPixels=0}l(a,[{key:"update",value:function(){var a=this.nanometersPerPixel,b=this.targetLengthInPixels;if(this.prevNanometersPerPixel===a&&this.prevTargetLengthInPixels===b)return!1;this.prevNanometersPerPixel=
a;this.prevTargetLengthInPixels=b;var c=b*a;b=Math.pow(10,Math.floor(Math.log(c)/Math.LN10));c/=b;for(var g=1,f=$jscomp.makeIterator(this.allowedSignificands),k=f.next();!k.done;k=f.next())if(k=k.value,Math.abs(k-c)<Math.abs(g-c))g=k;else break;b*=g;c=t(b);this.lengthInPixels=Math.round(b/a);this.physicalUnit=c.unit;this.physicalLength=b/c.lengthInNanometers;return!0}}]);return a}(),k=function(c){function d(a,b){b=void 0===b?new p:b;n(this,d);var c=(d.__proto__||Object.getPrototypeOf(d)).call(this);
if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");c=!c||"object"!==typeof c&&"function"!==typeof c?this:c;c.gl=a;c.dimensions=b;c.texture=null;c.width=0;c.height=0;return c}q(d,c);l(d,[{key:"update",value:function(){var b=this.dimensions,c=this.texture;if(b.update()||null===c){null===c&&(c=this.texture=this.gl.createTexture());var d=this.gl,g=document.createElement("canvas"),f=g.getContext("2d");f.font="bold 15px sans-serif";f.fillStyle="white";var k=b.physicalLength+
" "+b.physicalUnit,l=f.measureText(k);l=Math.max(b.lengthInPixels,l.width)+4;g.width=l;g.height=32;f.font="bold 15px sans-serif";f.textAlign="center";f.fillStyle="rgba(0, 0, 0, 0.3)";f.fillRect(0,0,l,32);f.fillStyle="white";f.fillText(k,l/2,17);f.fillRect(2,22,b.lengthInPixels,8);Object(a.c)(d,c,g);this.width=l;this.height=32}}},{key:"disposed",value:function(){this.gl.deleteTexture(this.texture);this.texture=null;b(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"disposed",this).call(this)}}]);
return d}(m.a)},function(m,f,c){m=new (c(86).a);f.a=m},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,
{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){var c,d,e;return function(g,f){if(void 0!==d&&(void 0===c||void 0===g||c.generation!==g.generation))return void 0===c&&e.addConsumer(f),d;c=void 0;e=new b.c;return d=a(g,e).then(function(a){c=a;e=void 0;return a},function(a){e.isCanceled&&(d=e=void 0);throw a;})}}c.d(f,"b",function(){return v});f.c=function(b){var c=0;return a(function(a,e){return b(e).then(function(a){return{generation:++c,
credentials:a}})})};c.d(f,"a",function(){return k});var b=c(14);m=c(0);var l=c(46),r=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),v=function(a){function b(){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}t(b,a);return b}(m.a),p=function(){function a(){q(this,a);this.providers=
new Map}r(a,[{key:"register",value:function(a,b){this.providers.set(a,b)}},{key:"getCredentialsProvider",value:function(a,b){var c=this.providers.get(a);if(void 0===c)throw Error("No registered credentials provider: "+JSON.stringify(a));return c(b)}}]);return a}(),k=function(a){function b(){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,new p))}t(b,a);r(b,[{key:"register",value:function(a,b){this.base.register(a,b)}}]);return b}(function(a){function b(a){q(this,b);var c=
n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.base=a;c.memoize=new l.b;return c}t(b,a);r(b,[{key:"getCredentialsProvider",value:function(a,b){var c=this;return this.memoize.get({key:a,parameters:b},function(){return c.registerDisposer(c.base.getCredentialsProvider(a,b).addRef())})}}]);return b}(m.a))},function(m,f,c){c.d(f,"c",function(){return q});f.a="/ocp/ca";f.b="/nd/sd";var q=function t(){if(!(this instanceof t))throw new TypeError("Cannot call a class as a function");};q.RPC_ID=
"ndstore/VolumeChunkSource"},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,
b):a.__proto__=b)}function t(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function a(a,b,c){Object(x.u)(a);var e=Object(x.w)(a,"Base",function(a){return new C(a)});switch(e.typeName){case "uint8blk":case "grayscale8":return new E(a,b,e,d.c.JPEG,c);case "imagetile":return new W(a,b,e);case "labels64":case "labelblk":return new E(a,b,e,d.c.COMPRESSED_SEGMENTATION,c);default:throw Error("DVID data type "+JSON.stringify(e.typeName)+" is not supported.");}}function b(a){try{for(var b=
Object(x.v)(a,function(a){return new V(a)}),c=new Map,d=$jscomp.makeIterator(b),e=d.next();!e.done;e=d.next()){var g=$jscomp.makeIterator(e.value),f=g.next().value,h=g.next().value;c.set(f,h);for(var k=$jscomp.makeIterator(h.vnodes),l=k.next();!l.done;l=k.next()){var w=l.value;if(w!==f){var r=new V(h);c.set(w,r)}}}for(var p=$jscomp.makeIterator(c),z=p.next();!z.done;z=p.next()){var v=$jscomp.makeIterator(z.value),n=v.next().value;v.next().value.uuid=n}return c}catch(Ka){throw Error("Failed to parse DVID repositories info: "+
Ka.message);}}function l(a,b){return a.memoize.getUncounted({type:"dvid:getServerInfo",baseUrls:b},function(){var a=Object(A.d)(Object(A.b)(b,"/api/repos/info","GET"),"json").then(function(a){return new M(a)}),c="repository info for DVID server "+b[0];B.a.forPromise(a,{initialMessage:"Retrieving "+c+".",delay:!0,errorPrefix:"Error retrieving "+c+": "});return a})}function r(a,b,c,d){return a.memoize.getUncounted({type:"dvid:getInstanceDetails",baseUrls:b,nodeKey:c,name:d.name},function(){var a=Object(A.d)(Object(A.b)(b,
"/api/node/"+c+"/"+d.name+"/info","GET"),"json"),e="datainstance info for node "+c+" and instance "+d.name+" "+("on DVID server "+b[0]);B.a.forPromise(a,{initialMessage:"Retrieving "+e+".",delay:!0,errorPrefix:"Error retrieving "+e+": "});return a.then(function(a){a=Object(x.w)(a,"Extended",x.u);d.lowerVoxelBound=Object(x.w)(a,"MinPoint",function(a){return Object(x.d)(G.p.create(),a)});d.upperVoxelBound=Object(x.w)(a,"MaxPoint",function(a){return Object(x.d)(G.p.create(),a)});return d})})}function v(a,
b,c,d){return l(a,b).then(function(e){e=e.getNode(c);if(void 0===e)throw Error("Invalid node: "+JSON.stringify(c)+".");e=e.dataInstances.get(d);if(!(e instanceof E||e instanceof W))throw Error("Invalid data instance "+d+".");return r(a,b,c,e)}).then(function(e){return a.memoize.getUncounted({type:"dvid:MultiscaleVolumeChunkSource",baseUrls:b,nodeKey:c,dataInstanceKey:d},function(){return new R(a,b,c,d,e)})})}function p(a,b){var c=b.match(ba);if(null===c)throw Error("Invalid DVID URL: "+JSON.stringify(b)+
".");return v(a,[c[1]],c[2],c[3])}function k(a,b){return{offset:0,completions:Object(F.c)(b,a.dataInstances.values(),function(a){return a.name},function(a){return""+a.base.typeName})}}function h(a,b){var c=b.match(/^(?:([^\/]+)(?:\/([^\/]*))?)?$/);if(null===c)throw Error("Invalid DVID URL syntax.");if(void 0===c[2])return{offset:0,completions:Object(F.c)(b,a.repositories.values(),function(a){return a.uuid+"/"},function(a){return a.alias+": "+a.description})};b=c[1];a=a.getNode(b);return Object(F.a)(b.length+
1,k(a,c[2]))}function g(a,b){a=a.match(/^((?:http|https):\/\/[^\/]+)\/(.*)$/);if(null===a)return Promise.reject(null);var c=a[1],d=a[2];return l(b,[c]).then(function(a){return Object(F.a)(c.length+1,h(a,d))})}Object.defineProperty(f,"__esModule",{value:!0});c.d(f,"getVolume",function(){return p});c.d(f,"volumeCompleter",function(){return g});c.d(f,"DataInstanceBaseInfo",function(){return C});c.d(f,"DataInstanceInfo",function(){return H});c.d(f,"VolumeDataInstanceInfo",function(){return E});c.d(f,
"TileLevelInfo",function(){return S});c.d(f,"TileDataInstanceInfo",function(){return W});f.parseDataInstance=a;c.d(f,"RepositoryInfo",function(){return V});f.parseRepositoriesInfo=b;c.d(f,"ServerInfo",function(){return M});f.getServerInfo=l;f.getDataInstanceDetails=r;c.d(f,"MultiscaleVolumeChunkSource",function(){return R});f.getShardedVolume=v;f.completeInstanceName=k;f.completeNodeAndInstance=h;c.d(f,"DVIDDataSource",function(){return ha});m=c(10);f=c(24);var d=c(151),e=c(8),w=c(18),B=c(26),F=c(30),
G=c(1),A=c(31),x=c(2),D=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),z=new Map;z.set("uint8",e.a.UINT8);z.set("uint32",e.a.UINT32);z.set("uint64",e.a.UINT64);var C=function(){function a(b){t(this,a);this.obj=b;Object(x.u)(b);Object(x.w)(b,"TypeName",x.B)}D(a,[{key:"typeName",get:function(){return this.obj.TypeName}}]);
return a}(),H=function P(a,b,c){t(this,P);this.obj=a;this.name=b;this.base=c},J=function(a){function b(){t(this,b);return q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}n(b,a);return b}(Object(m.f)(w.b,d.d)),E=function(a){function b(a,c,d,e,g){t(this,b);d=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c,d));d.encoding=e;a=Object(x.w)(a,"Extended",x.u);e=Object(x.w)(a,"Values",function(a){return Object(x.a)(a,x.u)});if(1>e.length)throw Error("Expected Extended.Values property to have length >= 1, but received: ${JSON.stringify(extendedValues)}.");
d.numLevels=1;for(g=new Set(g);g.has(c+"_"+d.numLevels.toString());)d.numLevels+=1;d.dataType=Object(x.w)(e[0],"DataType",function(a){return Object(x.t)(a,z)});d.voxelSize=Object(x.w)(a,"VoxelSize",function(a){return Object(x.c)(G.p.create(),a,x.p)});d.numChannels=1;return d}n(b,a);D(b,[{key:"getSources",value:function(a,b,c){for(var g=this.encoding,f=[],h={},k=0;k<this.numLevels;h={volParameters:h.volParameters},++k){for(var l=G.p.scale(G.p.create(),this.voxelSize,Math.pow(2,k)),w=G.p.create(),r=
G.p.create(),p=0;3>p;++p)w[p]=Math.floor(this.voxelSize[p]/l[p]*this.lowerVoxelBound[p]),r[p]=Math.ceil(this.voxelSize[p]/l[p]*this.upperVoxelBound[p]);p=b.dataInstanceKey;0<k&&(p+="_"+k.toString());h.volParameters={baseUrls:b.baseUrls,nodeKey:b.nodeKey,dataInstanceKey:p,encoding:g};l=e.c.getDefaults({voxelSize:l,dataType:this.dataType,numChannels:this.numChannels,transform:G.j.fromTranslation(G.j.create(),G.p.multiply(G.p.create(),w,l)),baseVoxelOffset:w,upperVoxelBound:G.p.subtract(G.p.create(),
r,w),volumeType:this.volumeType,volumeSourceOptions:c,compressedSegmentationBlockSize:g===d.c.COMPRESSED_SEGMENTATION?G.p.fromValues(8,8,8):void 0}).map(function(b){return function(c){return a.getChunkSource(J,{spec:c,parameters:b.volParameters})}}(h));f.push(l)}return f}},{key:"volumeType",get:function(){return this.encoding===d.c.COMPRESSED_SEGMENTATION?e.d.SEGMENTATION:e.d.IMAGE}}]);return b}(H),S=function Va(a){t(this,Va);Object(x.u)(a);this.resolution=Object(x.w)(a,"Resolution",function(a){return Object(x.c)(G.p.create(),
a,x.p)});this.tileSize=Object(x.w)(a,"TileSize",function(a){return Object(x.c)(G.p.create(),a,x.A)})},K=[[0,1],[0,2],[1,2]],U=function(a){function b(){t(this,b);return q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}n(b,a);return b}(Object(m.f)(w.b,d.a)),W=function(a){function b(a,c,e){t(this,b);c=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c,e));a=Object(x.w)(a,"Extended",x.u);c.levels=Object(x.w)(a,"Levels",function(a){return Object(x.v)(a,function(a){return new S(a)})});
e=c.levels.get("0");if(void 0===e)throw Error("Level 0 is not defined.");c.voxelSize=e.resolution;var g=Object(x.w)(a,"MinTileCoord",function(a){return Object(x.c)(G.p.create(),a,x.s)}),f=Object(x.w)(a,"MaxTileCoord",function(a){return Object(x.c)(G.p.create(),a,x.s)});c.lowerVoxelBound=G.p.multiply(G.p.create(),e.tileSize,g);c.upperVoxelBound=G.p.multiply(G.p.create(),e.tileSize,f);a=Object(x.w)(a,"Encoding",function(a){return a});switch(a){case 2:c.encoding=d.b.JPEG;break;default:throw Error("Unsupported tile encoding: "+
JSON.stringify(a)+".");}return c}n(b,a);D(b,[{key:"dataType",get:function(){return e.a.UINT8}},{key:"volumeType",get:function(){return e.d.IMAGE}},{key:"numChannels",get:function(){return 1}}]);D(b,[{key:"getSources",value:function(a,b,c){for(var d=this,g=[],f=this.numChannels,h=this.dataType,k=this.encoding,l={},w=$jscomp.makeIterator(this.levels),r=w.next();!r.done;l={levelInfo:l.levelInfo,level:l.level},r=w.next())r=$jscomp.makeIterator(r.value),l.level=r.next().value,l.levelInfo=r.next().value,
r=K.map(function(g){return function(l){for(var w=G.p.clone(d.voxelSize),r=G.p.fromValues(1,1,1),p=0;2>p;++p)w[l[p]]=g.levelInfo.resolution[l[p]],r[l[p]]=g.levelInfo.tileSize[l[p]];p=G.p.create();for(var z=G.p.create(),v=0;3>v;++v)p[v]=Math.floor(d.voxelSize[v]/w[v]*d.lowerVoxelBound[v]),z[v]=Math.ceil(d.voxelSize[v]/w[v]*d.upperVoxelBound[v]);w=e.c.make({voxelSize:w,chunkDataSize:r,numChannels:f,dataType:h,lowerVoxelBound:p,upperVoxelBound:z,volumeSourceOptions:c});return a.getChunkSource(U,{spec:w,
parameters:{baseUrls:b.baseUrls,nodeKey:b.nodeKey,dataInstanceKey:b.dataInstanceKey,encoding:k,level:g.level,dims:l[0]+"_"+l[1]}})}}(l)),g.push(r);return g}}]);return b}(H),V=function Wa(b){t(this,Wa);this.errors=[];this.dataInstances=new Map;this.vnodes=new Set;if(b instanceof Wa)this.alias=b.alias,this.description=b.description,this.errors=b.errors,this.dataInstances=b.dataInstances;else{Object(x.u)(b);this.alias=Object(x.w)(b,"Alias",x.B);this.description=Object(x.w)(b,"Description",x.B);for(var c=
Object(x.w)(b,"DataInstances",x.u),d=Object.keys(c),e=$jscomp.makeIterator(d),g=e.next();!g.done;g=e.next()){g=g.value;try{this.dataInstances.set(g,a(c[g],g,d))}catch(Ja){g="Failed to parse data instance "+JSON.stringify(g)+": "+Ja.message,console.log(g),this.errors.push(g)}}b=Object(x.w)(b,"DAG",x.u);b=Object(x.w)(b,"Nodes",x.u);b=$jscomp.makeIterator(Object.keys(b));for(g=b.next();!g.done;g=b.next())this.vnodes.add(g.value)}},M=function(){function a(c){t(this,a);this.repositories=b(c)}D(a,[{key:"getNode",
value:function(a){for(var b=[],c=$jscomp.makeIterator(this.repositories.keys()),d=c.next();!d.done;d=c.next())d=d.value,d.startsWith(a)&&b.push(d);if(1!==b.length)throw Error("Node key "+JSON.stringify(a)+" matches "+JSON.stringify(b)+" nodes.");return this.repositories.get(b[0])}}]);return a}(),R=function(){function a(b,c,d,e,g){t(this,a);this.chunkManager=b;this.baseUrls=c;this.nodeKey=d;this.dataInstanceKey=e;this.info=g}D(a,[{key:"getSources",value:function(a){return this.info.getSources(this.chunkManager,
{baseUrls:this.baseUrls,nodeKey:this.nodeKey,dataInstanceKey:this.dataInstanceKey},a)}},{key:"getMeshSource",value:function(){return null}},{key:"dataType",get:function(){return this.info.dataType}},{key:"numChannels",get:function(){return this.info.numChannels}},{key:"volumeType",get:function(){return this.info.volumeType}}]);return a}(),ba=/^((?:http|https):\/\/[^\/]+)\/([^\/]+)\/([^\/]+)$/,ha=function(a){function b(){t(this,b);return q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}
n(b,a);D(b,[{key:"getVolume",value:function(a,b){return p(a,b)}},{key:"volumeCompleter",value:function(a,b){return g(a,b)}},{key:"description",get:function(){return"DVID"}}]);return b}(f.a)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&
null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){var c=Object(E.a)(a,E.u);if(1>c.length)throw Error("No stacks found for owner object.");a=new Map;var d=Object(E.w)(c[0],"stackId",l);c=$jscomp.makeIterator(c);for(var e=c.next();!e.done;e=c.next()){var g=e.value;
e=Object(E.w)(g,"stackId",b);Object(E.u)(g);var f=Object(E.w)(g,"state",E.B);if(V.has(f)){f=Object(E.w)(g,"stats",E.u);var h=f;Object(E.u)(h);h=Object(E.w)(h,"stackBounds",E.u);var k=H.p.create();k[0]=Object(E.w)(h,"minX",E.q);k[1]=Object(E.w)(h,"minY",E.q);k[2]=Object(E.w)(h,"minZ",E.q);h=k;k=f;Object(E.u)(k);k=Object(E.w)(k,"stackBounds",E.u);var w=H.p.create();w[0]=Object(E.w)(k,"maxX",E.q);w[1]=Object(E.w)(k,"maxY",E.q);w[2]=Object(E.w)(k,"maxZ",E.q);k=w;w=[];f.hasOwnProperty("channelNames")&&
(w=r(f));f=Object(E.w)(g,"currentVersion",v);g=Object(E.w)(g,"stackId",p);g={lowerVoxelBound:h,upperVoxelBound:k,voxelResolution:f,project:g,channels:w}}else g=void 0;void 0!==g&&(f=g.project,h=a.get(f),void 0===h&&(h=new Map,a.set(f,{stacks:h}),h=a.get(f)),h.stacks.set(e,g))}return{owner:d,projects:a}}function b(a){Object(E.u)(a);return Object(E.w)(a,"stack",E.B)}function l(a){Object(E.u)(a);return Object(E.w)(a,"owner",E.B)}function r(a){Object(E.u)(a);return Object(E.w)(a,"channelNames",function(a){return Object(E.a)(a,
E.B)})}function v(a){Object(E.u)(a);var b=H.p.create();try{b[0]=Object(E.w)(a,"stackResolutionX",E.q),b[1]=Object(E.w)(a,"stackResolutionY",E.q),b[2]=Object(E.w)(a,"stackResolutionZ",E.q)}catch(Wa){b[0]=1,b[1]=1,b[2]=1}return b}function p(a){Object(E.u)(a);return Object(E.w)(a,"project",E.B)}function k(a,b){for(var c=0,d=0;2>d;d++)c<a.upperVoxelBound[d]&&(c=a.upperVoxelBound[d]);for(a=0;c>b;)c/=2,a++;return a}function h(b,c,d){return b.memoize.getUncounted({type:"render:getOwnerInfo",hostnames:c,
owner:d},function(){return Object(J.d)(Object(J.b)(c,"/render-ws/v1/owner/"+d+"/stacks"),"json").then(a)})}function g(a,b,c){var d=c.match(R);if(null===d)throw Error("Invalid volume path "+JSON.stringify(c));var e=d[1],g=d[2],f=d[3],k=d[4],l=Object(E.e)(d[5]||"");return a.memoize.getUncounted({type:"render:MultiscaleVolumeChunkSource",hostnames:b,path:c},function(){return h(a,b,e).then(function(c){return new M(a,b,c,f,g,k,l)})})}function d(a,b){var c=b.match(ba);if(null===c)throw Error("Invalid render volume path: "+
JSON.stringify(b));b=c[1].split(",");return g(a,b,c[2])}function e(a,b,c){var d=c.match(/^(?:([^\/]+)(?:\/([^\/]*))?(?:\/([^\/]*))?(\/.*?)?)?$/);if(null===d||void 0===d[2])return Promise.reject(null);if(void 0===d[3]){var e=d[2]||"";return h(a,b,d[1]).then(function(a){a=Object(C.c)(e,a.projects,function(a){return a[0]+"/"},function(){});return{offset:d[1].length+1,completions:a}})}if(void 0===d[4]){var g=d[3]||"";return h(a,b,d[1]).then(function(a){a=a.projects.get(d[2]);if(void 0===a)return Promise.reject(null);
a=Object(C.c)(g,a.stacks,function(a){return a[0]+"/"},function(a){return"("+a[1].project+")"});return{offset:d[1].length+d[2].length+2,completions:a}})}var f=d[4].substr(1)||"";return h(a,b,d[1]).then(function(a){a=a.projects.get(d[2]);if(void 0===a)return Promise.reject(null);a=a.stacks.get(d[3]);if(void 0===a)return Promise.reject(null);a=a.channels;if(0===a.length)return Promise.reject(null);a=Object(C.c)(f,a,function(a){return a},function(){});return{offset:d[1].length+d[2].length+d[3].length+
3,completions:a}})}function w(a,b){var c=a.match(ba);if(null===c)return Promise.reject(null);a=c[1].split(",");return e(b,a,c[2]).then(function(a){return Object(C.a)(c[1].length+1,a)})}function B(a,b){var c=b.match(ba);if(null===c)throw Error("Invalid render point path: "+JSON.stringify(b));return F(a,[c[1]],c[2])}function F(a,b,c){var d=c.match(R);if(null===d)throw Error("Invalid point path "+JSON.stringify(c));var e=d[1],g=d[2],f=d[3],k=Object(E.e)(d[4]||"");return a.memoize.getUncounted({type:"render:MultiscaleVectorGraphicsChunkSource",
hostnames:b,path:c},function(){return h(a,b,e).then(function(c){return new ha(a,b,c,f,g,k)})})}Object.defineProperty(f,"__esModule",{value:!0});c.d(f,"getVolume",function(){return d});c.d(f,"volumeCompleter",function(){return w});c.d(f,"MultiscaleVolumeChunkSource",function(){return M});f.computeStackHierarchy=k;f.getOwnerInfo=h;f.getShardedVolume=g;f.stackAndProjectCompleter=e;c.d(f,"MultiscaleVectorGraphicsChunkSource",function(){return ha});f.getPointMatches=B;f.getShardedPointMatches=F;c.d(f,
"RenderDataSource",function(){return I});m=c(10);f=c(24);var G=c(153),A=c(56),x=c(90),D=c(8),z=c(18),C=c(30),H=c(1),J=c(31),E=c(2),S=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),K=new Set(["jpg"]),U=function(a){function b(){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}
t(b,a);return b}(Object(m.f)(z.b,G.b)),W=function(a){function b(){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}t(b,a);return b}(Object(m.f)(x.b,G.a)),V=new Set(["COMPLETE"]),M=function(){function a(b,c,d,e,g,f,h){q(this,a);this.chunkManager=b;this.baseUrls=c;this.ownerInfo=d;this.project=g;this.parameters=h;b=d.projects.get(g);if(void 0===b)throw Error("Specified project "+JSON.stringify(g)+" does not exist for "+("specified owner "+JSON.stringify(d.owner)));
if(void 0===e){e=Array.from(b.stacks.keys());if(1!==e.length)throw Error("Dataset contains multiple stacks: "+JSON.stringify(e));e=e[0]}d=b.stacks.get(e);if(void 0===d)throw Error("Specified stack "+JSON.stringify(e)+" is not one of the supported stacks: "+JSON.stringify(Array.from(b.stacks.keys())));this.stack=e;this.stackInfo=d;void 0!==f&&0<f.length&&(this.channel=f);this.minIntensity=Object(E.y)(h.minIntensity);this.maxIntensity=Object(E.y)(h.maxIntensity);this.maxTileSpecsToRender=Object(E.y)(h.maxTileSpecsToRender);
this.filter=Object(E.x)(h.filter);f=Object(E.z)(h.encoding);if(void 0===f)f="jpg";else if(!K.has(f))throw Error("Invalid encoding: "+JSON.stringify(f)+".");this.encoding=f;this.numLevels=Object(E.y)(h.numlevels);this.dims=H.p.create();h=Object(E.y)(h.tilesize);void 0===h&&(h=1024);this.dims[0]=h;this.dims[1]=h;this.dims[2]=1}S(a,[{key:"getSources",value:function(a){var b=[],c=this.numLevels;void 0===c&&(c=k(this.stackInfo,this.dims[0]));for(var d=H.p.create(),e=H.p.create(),g=0;3>g;g++)d[g]=this.stackInfo.lowerVoxelBound[g]*
this.stackInfo.voxelResolution[g],e[g]=this.stackInfo.upperVoxelBound[g]*this.stackInfo.voxelResolution[g];for(g=0;g<c;g++){for(var f=H.p.clone(this.stackInfo.voxelResolution),h=H.p.fromValues(1,1,1),l=0;2>l;++l)f[l]*=Math.pow(2,g),h[l]=this.dims[l];l=H.p.create();for(var w=H.p.create(),r=0;3>r;r++)l[r]=Math.floor(this.stackInfo.voxelResolution[r]/f[r]*this.stackInfo.lowerVoxelBound[r]),w[r]=Math.ceil(this.stackInfo.voxelResolution[r]/f[r]*this.stackInfo.upperVoxelBound[r]);f=D.c.make({voxelSize:f,
chunkDataSize:h,numChannels:this.numChannels,dataType:this.dataType,lowerClipBound:d,upperClipBound:e,lowerVoxelBound:l,upperVoxelBound:w,volumeSourceOptions:a});f=this.chunkManager.getChunkSource(U,{spec:f,parameters:{baseUrls:this.baseUrls,owner:this.ownerInfo.owner,project:this.stackInfo.project,stack:this.stack,channel:this.channel,minIntensity:this.minIntensity,maxIntensity:this.maxIntensity,maxTileSpecsToRender:this.maxTileSpecsToRender,filter:this.filter,dims:this.dims[0]+"_"+this.dims[1],
level:g,encoding:this.encoding}});b.push([f])}return b}},{key:"getMeshSource",value:function(){return null}},{key:"dataType",get:function(){return D.a.UINT8}},{key:"numChannels",get:function(){return 3}},{key:"volumeType",get:function(){return D.d.IMAGE}}]);return a}(),R=/^([^\/?]+)(?:\/([^\/?]+))?(?:\/([^\/?]+))(?:\/([^\/?]*))?(?:\?(.*))?$/,ba=/^((?:(?:(?:http|https):\/\/[^,\/]+)[^\/?])+)\/(.*)$/,ha=function(){function a(b,c,d,e,g,f){q(this,a);this.chunkManager=b;this.baseUrls=c;this.ownerInfo=d;
this.project=g;this.parameters=f;b=d.projects.get(g);if(void 0===b)throw Error("Specified project "+JSON.stringify(g)+" does not exist for "+("specified owner "+JSON.stringify(d.owner)));if(void 0===e){e=Array.from(b.stacks.keys());if(1!==e.length)throw Error("Dataset contains multiple stacks: "+JSON.stringify(e));e=e[0]}d=b.stacks.get(e);if(void 0===d)throw Error("Specified stack "+JSON.stringify(e)+" is not one of the supported stacks: "+JSON.stringify(Array.from(b.stacks.keys())));this.stack=e;
this.stackInfo=d;d=Object(E.z)(f.matchCollection);void 0===d&&(d=e);this.matchCollection=d;e=Object(E.y)(f.zoffset);void 0===e&&(e=1);this.zoffset=e;this.dims=H.p.create();f=Object(E.y)(f.tilesize);void 0===f&&(f=1024);this.dims[0]=f;this.dims[1]=f;this.dims[2]=1}S(a,[{key:"getSources",value:function(a){for(var b=H.p.clone(this.stackInfo.voxelResolution),c=H.p.create(),d=H.p.create(),e=0;3>e;e++)c[e]=Math.floor(this.stackInfo.voxelResolution[e]/b[e]*this.stackInfo.lowerVoxelBound[e]),d[e]=Math.ceil(this.stackInfo.voxelResolution[e]/
b[e]*this.stackInfo.upperVoxelBound[e]);e=H.p.clone(d);e[0]+=Math.abs(c[0]);e[1]+=Math.abs(c[1]);e[2]=1;a=A.b.make({voxelSize:b,lowerVoxelBound:c,upperVoxelBound:d,chunkDataSize:e,vectorGraphicsSourceOptions:a});return[[this.chunkManager.getChunkSource(W,{spec:a,parameters:{baseUrls:this.baseUrls,owner:this.ownerInfo.owner,project:this.stackInfo.project,stack:this.stack,encoding:"points",matchCollection:this.matchCollection,zoffset:this.zoffset}})]]}}]);return a}(),I=function(a){function b(){q(this,
b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}t(b,a);S(b,[{key:"getVolume",value:function(a,b){return d(a,b)}},{key:"volumeCompleter",value:function(a,b){return w(a,b)}},{key:"getVectorGraphicsSource",value:function(a,b){return B(a,b)}},{key:"description",get:function(){return"Render"}}]);return b}(f.a)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return p});c.d(f,"b",function(){return h});m=c(35);f=c(51);var a=c(56),b=c(17),l=c(6),r=function d(a,b,c){null===
a&&(a=Function.prototype);var e=Object.getOwnPropertyDescriptor(a,b);if(void 0===e){if(a=Object.getPrototypeOf(a),null!==a)return d(a,b,c)}else{if("value"in e)return e.value;b=e.get;return void 0===b?void 0:b.call(c)}},v=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),p=function(b){function c(b,d){d=void 0===
d?{}:d;d=void 0===d.sourceOptions?{}:d.sourceOptions;q(this,c);b=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,b.chunkManager,b.getSources(d)));b.shader=void 0;b.shaderUpdated=!0;b.rpcId=null;d=b.registerDisposer(new l.b);d.RPC_TYPE_ID=a.a;d.initializeCounterpart(b.chunkManager.rpc,{sources:b.sourceIds});b.rpcId=d.rpcId;return b}t(c,b);v(c,[{key:"defineShader",value:function(a){a.addFragmentCode("\nvoid emit(vec4 color) {\n  gl_FragColor = color;\n}\nvoid emitRGBA(vec4 rgba) {\n  emit(vec4(rgba.rgb, rgba.a * uOpacity));\n}\nvoid emitRGB(vec3 rgb) {\n  emit(vec4(rgb, uOpacity));\n}\nvoid emitGrayscale(float value) {\n  emit(vec4(value, value, value, uOpacity));\n}\nvoid emitTransparent() {\n  emit(vec4(0.0, 0.0, 0.0, 0.0));\n}\n")}},
{key:"beginSlice",value:function(a){a=this.shader;a.bind();return a}}]);return c}(f.a),k=function(a){function c(a,b){q(this,c);a=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,a,b));a.vertexPositions=b.vertexPositions;a.numPoints=Math.floor(a.vertexPositions.length/3);return a}t(c,a);v(c,[{key:"copyToGPU",value:function(a){r(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"copyToGPU",this).call(this,a);this.vertexBuffer=b.a.fromData(a,this.vertexPositions,a.ARRAY_BUFFER,a.STATIC_DRAW)}},
{key:"freeGPUMemory",value:function(a){r(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"freeGPUMemory",this).call(this,a);this.vertexBuffer.dispose()}}]);return c}(m.b),h=function(a){function b(){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}t(b,a);v(b,[{key:"getChunk",value:function(a){return new k(this,a)}},{key:"vectorGraphicsCoordinatesInVoxels",get:function(){return!0}}]);return b}(m.c)},function(m,f,c){function q(a,c){if("function"!==typeof c&&
null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}Object.defineProperty(f,"__esModule",{value:!0});c.d(f,"OpenConnectomeDataSource",function(){return a});var n=c(87),t=["http://openconnecto.me","http://www.openconnecto.me"],a=function(a){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");
var a=(b.__proto__||Object.getPrototypeOf(b)).call(this,"NDstore server hosted at openconnecto.me",t,n.a);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!a||"object"!==typeof a&&"function"!==typeof a?this:a}q(b,a);return b}(c(55).SingleServerDataSource)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){return a.getChunkSource(F,{parameters:b})}function b(a,b,c){return a.memoize.getUncounted({type:"precomputed:MultiscaleVolumeChunkSource",
baseUrls:b,path:c},function(){return Object(d.d)(Object(d.b)(b,c+"/info"),"json").then(function(d){return new A(a,b,c,d)})})}function l(b,c){var e=$jscomp.makeIterator(Object(d.c)(c));c=e.next().value;e=e.next().value;return a(b,{baseUrls:c,path:e,lod:0})}function r(a,c){var e=$jscomp.makeIterator(Object(d.c)(c));c=e.next().value;e=e.next().value;return b(a,c,e)}Object.defineProperty(f,"__esModule",{value:!0});c.d(f,"getMeshSource",function(){return l});c.d(f,"getVolume",function(){return r});c.d(f,
"MultiscaleVolumeChunkSource",function(){return A});f.getShardedMeshSource=a;f.getShardedVolume=b;c.d(f,"PrecomputedDataSource",function(){return x});m=c(10);f=c(24);var v=c(156),p=c(48),k=c(8),h=c(18),g=c(1),d=c(31),e=c(2),w=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),B=function(a){function b(){q(this,
b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}t(b,a);return b}(Object(m.f)(h.b,v.c)),F=function(a){function b(){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}t(b,a);return b}(Object(m.f)(p.b,v.a)),G=function z(a){q(this,z);Object(e.u)(a);this.resolution=Object(e.w)(a,"resolution",function(a){return Object(e.c)(g.p.create(),a,e.p)});this.voxelOffset=Object(e.w)(a,"voxel_offset",function(a){return Object(e.d)(g.p.create(),a)});
this.size=Object(e.w)(a,"size",function(a){return Object(e.c)(g.p.create(),a,e.A)});this.chunkSizes=Object(e.w)(a,"chunk_sizes",function(a){return Object(e.a)(a,function(a){return Object(e.c)(g.p.create(),a,e.A)})});if(0===this.chunkSizes.length)throw Error("No chunk sizes specified.");(this.encoding=Object(e.w)(a,"encoding",function(a){return Object(e.n)(a,v.b)}))===v.b.COMPRESSED_SEGMENTATION&&(this.compressedSegmentationBlockSize=Object(e.w)(a,"compressed_segmentation_block_size",function(a){return Object(e.c)(g.p.create(),
a,e.A)}));this.key=Object(e.w)(a,"key",e.B)},A=function(){function b(a,c,d,g){q(this,b);this.chunkManager=a;this.baseUrls=c;this.path=d;Object(e.u)(g);this.dataType=Object(e.w)(g,"data_type",function(a){return Object(e.n)(a,k.a)});this.numChannels=Object(e.w)(g,"num_channels",e.A);this.volumeType=Object(e.w)(g,"type",function(a){return Object(e.n)(a,k.d)});this.mesh=Object(e.w)(g,"mesh",e.z);this.scales=Object(e.w)(g,"scales",function(a){return Object(e.a)(a,function(a){return new G(a)})})}w(b,[{key:"getMeshSource",
value:function(){var b=this.mesh;return void 0===b?null:a(this.chunkManager,{baseUrls:this.baseUrls,path:this.path+"/"+b,lod:0})}},{key:"getSources",value:function(a){var b=this;return this.scales.map(function(c){return k.c.getDefaults({voxelSize:c.resolution,dataType:b.dataType,numChannels:b.numChannels,transform:g.j.fromTranslation(g.j.create(),g.p.multiply(g.p.create(),c.resolution,c.voxelOffset)),upperVoxelBound:c.size,volumeType:b.volumeType,chunkDataSizes:c.chunkSizes,baseVoxelOffset:c.voxelOffset,
compressedSegmentationBlockSize:c.compressedSegmentationBlockSize,volumeSourceOptions:a}).map(function(a){return b.chunkManager.getChunkSource(B,{spec:a,parameters:{baseUrls:b.baseUrls,path:b.path+"/"+c.key,encoding:c.encoding}})})})}}]);return b}(),x=function(a){function b(){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}t(b,a);w(b,[{key:"getVolume",value:function(a,b){return r(a,b)}},{key:"getMeshSource",value:function(a,b){return l(a,b)}},{key:"description",
get:function(){return"Precomputed file-backed data source"}}]);return b}(f.a)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=
Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b,c){return a.rpc.promiseInvoke(l.a,{chunkManager:a.addCounterpartRef(),url:b},c)}function b(b,c){return b.memoize.getUncounted({type:"nifti/getVolume",url:c},function(){return a(b,c,p.e).then(function(a){return new d(b,c,a)})})}Object.defineProperty(f,"__esModule",{value:!0});c.d(f,"getVolume",function(){return b});c.d(f,
"MultiscaleVolumeChunkSource",function(){return d});c.d(f,"NiftiDataSource",function(){return e});m=c(10);f=c(24);var l=c(158),r=c(8),v=c(18),p=c(14),k=c(1),h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),g=function(a){function b(){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,
arguments))}t(b,a);return b}(Object(m.f)(v.b,l.b)),d=function(){function a(b,c,d){q(this,a);this.chunkManager=b;this.url=c;this.info=d}h(a,[{key:"getSources",value:function(a){var b=this.info;a=r.c.withDefaultCompression({volumeType:b.volumeType,chunkDataSize:b.volumeSize,dataType:b.dataType,voxelSize:b.voxelSize,numChannels:b.numChannels,upperVoxelBound:b.volumeSize,transform:Object(k.o)(k.j.create(),b.qoffset,b.quatern,k.g,b.qfac),volumeSourceOptions:a});return[[this.chunkManager.getChunkSource(g,
{spec:a,parameters:{url:this.url}})]]}},{key:"getMeshSource",value:function(){return null}},{key:"numChannels",get:function(){return this.info.numChannels}},{key:"dataType",get:function(){return this.info.dataType}},{key:"volumeType",get:function(){return this.info.volumeType}}]);return a}(),e=function(a){function c(){q(this,c);return n(this,(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments))}t(c,a);h(c,[{key:"getVolume",value:function(a,c){return b(a,c)}},{key:"description",get:function(){return"Single NIfTI file"}}]);
return c}(f.a)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,
writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){for(var b=0,c=0;3>c;++c)0>a[c]&&(b+=1<<c);return b}c.d(f,"a",function(){return G});var b=c(23);m=c(51);var l=c(8);f=c(0);var r=c(1),v=c(17),p=c(28),k=c(7),h=c(6),g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,
d);return b}}(),d=r.p.create(),e=r.p.create(),w=r.j.create(),B=function(a){function b(a){q(this,b);var c=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.outputVertexIndices=c.registerDisposer(v.a.fromData(a,new Float32Array([0,1,2,3,4,5]),a.ARRAY_BUFFER,a.STATIC_DRAW));c.vertexBasePositions=[0,0,0,1,0,0,0,1,0,1,1,0,0,0,1,1,0,1,0,1,1,1,1,1];a=[0,1,2,4,5,3,6,7];for(var d=[0,1,2,5,3,4,6,7],e=[0,1,1,4,4,7,4,7,1,5,0,1,1,4,4,7,0,2,2,5,5,7,5,7,2,6,0,2,2,5,5,7,0,3,3,6,6,7,6,7,3,4,0,3,3,6,6,7],
g=[0,1,2,3,4,5,6,7,1,4,5,0,3,7,2,6,2,6,0,5,7,3,1,4,3,0,6,4,1,2,7,5,4,3,7,1,0,6,5,2,5,2,1,7,6,0,4,3,6,7,3,2,5,4,0,1,7,5,4,6,2,1,3,0],f=[],h=0;8>h;++h)for(var k=0;k<e.length;++k)f.push(a[g[8*d[h]+e[k]]]);c.vertexIndices=new Int32Array(f);return c}t(b,a);g(b,null,[{key:"get",value:function(a){return a.memoize.get("SliceViewShaderBuffers",function(){return new b(a)})}}]);return b}(f.a),F=function(b){function c(a){q(this,c);var b=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));b.data=b.registerDisposer(B.get(a));
return b}t(c,b);g(c,null,[{key:"get",value:function(a){return a.memoize.get("volume.VolumeSliceVertexComputationManager",function(){return new c(a)})}}]);g(c,[{key:"defineShader",value:function(a){var b=this.data;a.addAttribute("highp float","aVertexIndexFloat");a.addUniform("highp vec3","uTranslation");a.addUniform("highp mat4","uProjectionMatrix");a.addUniform("highp vec3","uPlaneNormal");a.addUniform("highp float","uPlaneDistance");a.addUniform("highp ivec2","uVertexIndex",24);a.addUniform("highp vec3",
"uVertexBasePosition",8);a.addInitializer(function(a){a.gl.uniform3fv(a.uniform("uVertexBasePosition"),new Float32Array(b.vertexBasePositions))});a.addUniform("highp vec3","uChunkDataSize");a.addUniform("highp vec3","uVoxelSize");a.addUniform("highp vec3","uLowerClipBound");a.addUniform("highp vec3","uUpperClipBound");a.addVarying("highp vec3","vChunkPosition");a.setVertexMain("\nvec3 chunkSize = uChunkDataSize * uVoxelSize;\nint vertexIndex = int(aVertexIndexFloat);\nfor (int e = 0; e < 4; ++e) {\n  highp ivec2 vidx = uVertexIndex[vertexIndex*4 + e];\n  highp vec3 v1 = max(uLowerClipBound, min(uUpperClipBound, chunkSize * uVertexBasePosition[vidx.x] + uTranslation));\n  highp vec3 v2 = max(uLowerClipBound, min(uUpperClipBound, chunkSize * uVertexBasePosition[vidx.y] + uTranslation));\n  highp vec3 vDir = v2 - v1;\n  highp float denom = dot(vDir, uPlaneNormal);\n  if (abs(denom) > 0.001) {\n    highp float lambda = (uPlaneDistance - dot(v1, uPlaneNormal)) / denom;\n    if ((lambda >= -0.001) && (lambda <= (1.0 + 0.001))) {\n      lambda = clamp(lambda, 0.0, 1.0);\n      highp vec3 position = v1 + lambda * vDir;\n      gl_Position = uProjectionMatrix * vec4(position, 1.0);\n      vChunkPosition = (position - uTranslation) / uVoxelSize + 0.001 * abs(uPlaneNormal);\n      break;\n    }\n  }\n}\n");
a.addFragmentCode("\nvec3 getPositionWithinChunk () {\n  return floor(min(vChunkPosition, uChunkDataSize - 1.0));\n}\n")}},{key:"computeVerticesDebug",value:function(b,c,d,e,g,f,h,k){b=r.p.multiply(r.p.create(),b,c);var l=a(f);l=this.data.vertexIndices.subarray(48*l,48*(l+1));for(var p=[0,0],w=[r.p.create(),r.p.create()],v=r.p.create(),n=r.p.create(),z=r.p.create(),q=r.p.create(),t=r.p.fromValues(Math.abs(f[0]),Math.abs(f[1]),Math.abs(f[2])),m=new Float32Array(this.data.vertexBasePositions),D=function(a){return m.subarray(3*
a,3*a+3)},C=0;6>C;++C)for(var B=0;4>B;++B){for(var x=0;2>x;++x)p[x]=l[2*(4*C+B)+x],r.p.multiply(w[x],b,D(p[x])),r.p.add(w[x],w[x],h),r.p.min(w[x],w[x],e),r.p.max(w[x],w[x],d);r.p.subtract(v,w[1],w[0]);x=r.p.dot(v,f);if(.001<Math.abs(x)){var A=(g-r.p.dot(w[0],f))/x;if(-.001<=A&&1.001>=A){A=Math.max(0,Math.min(1,A));r.p.scaleAndAdd(n,w[0],v,A);r.p.transformMat4(z,n,k);r.p.sub(q,n,h);r.p.divide(q,q,c);r.p.scaleAndAdd(q,q,t,.001);console.log("vertex "+C+", e = "+B+", at "+z+", "+("vChunkPosition = "+
q+", edge dir = "+v+", denom = "+x));break}else console.log("vertex "+C+", e = "+B+", skipped, deom = "+x+", "+("vDir = "+Object(r.q)(v)+", ")+("uPlaneNormal = "+Object(r.q)(f)+", ")+("lambda="+A))}else console.log("vertex "+C+", e = "+B+", skipped, deom = "+x+", "+("vDir = "+Object(r.q)(v)+", uPlaneNormal = "+Object(r.q)(f)))}}},{key:"beginSlice",value:function(a,b){a=b.attribute("aVertexIndexFloat");this.data.outputVertexIndices.bindToVertexAttrib(a,1)}},{key:"endSlice",value:function(a,b){b=b.attribute("aVertexIndexFloat");
a.disableVertexAttribArray(b)}},{key:"beginSource",value:function(b,c,g,f,h){var k=h.chunkLayout,l=k.globalToLocalSpatialVector(d,g.viewportAxes[2]);g=r.p.dot(k.globalToLocalSpatial(e,g.centerDataPosition),l);b.uniform3fv(c.uniform("uPlaneNormal"),l);b.uniform1f(c.uniform("uPlaneDistance"),g);l=a(l);b.uniform2iv(c.uniform("uVertexIndex"),this.data.vertexIndices.subarray(48*l,48*(l+1)));b.uniformMatrix4fv(c.uniform("uProjectionMatrix"),!1,r.j.multiply(w,f,k.transform));b.uniform3fv(c.uniform("uVoxelSize"),
h.voxelSize);b.uniform3fv(c.uniform("uLowerClipBound"),h.lowerClipBound);b.uniform3fv(c.uniform("uUpperClipBound"),h.upperClipBound)}},{key:"setupChunkDataSize",value:function(a,b,c){a.uniform3fv(b.uniform("uChunkDataSize"),c)}},{key:"drawChunk",value:function(a,b,c){a.uniform3fv(b.uniform("uTranslation"),c);a.drawArrays(a.TRIANGLE_FAN,0,6)}}]);return c}(f.a),G=function(a){function c(a,b){var d=void 0===b?{}:b;b=void 0===d.shaderError?Object(p.b)():d.shaderError;d=void 0===d.sourceOptions?{}:d.sourceOptions;
q(this,c);a=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,a.chunkManager,a.getSources(d),{shaderError:b}));a.vertexComputationManager=F.get(a.gl);b=a.registerDisposer(new h.b);b.RPC_TYPE_ID=l.b;b.initializeCounterpart(a.chunkManager.rpc,{sources:a.sourceIds});a.rpcId=b.rpcId;return a}t(c,a);g(c,[{key:"getValueAt",value:function(a){for(var b=$jscomp.makeIterator(this.sources),c=b.next();!c.done;c=b.next()){c=$jscomp.makeIterator(c.value);for(var d=c.next();!d.done;d=c.next())if(d=d.value.getValueAt(a),
null!=d)return d}return null}},{key:"getShader",value:function(){var a=this,b=this.getShaderKey()+"/"+this.chunkFormat.shaderKey;return this.gl.memoize.get(b,function(){return a.buildShader()})}},{key:"defineShader",value:function(a){this.vertexComputationManager.defineShader(a);a.addFragmentCode("\nvoid emit(vec4 color) {\n  gl_FragData[0] = color;\n}\n");this.chunkFormat.defineShader(a);a.addFragmentCode("\n"+Object(k.a)(this.dataType)+" getDataValue() { return getDataValue(0); }\n")}},{key:"beginSlice",
value:function(a){a=this.gl;var b=this.shader;b.bind();this.vertexComputationManager.beginSlice(a,b);return b}},{key:"endSlice",value:function(a){this.vertexComputationManager.endSlice(this.gl,a)}},{key:"draw",value:function(a){var c=a.visibleLayers.get(this);if(0!==c.length&&(this.initializeShader(),void 0!==this.shader)){var d=this.gl,e=r.p.create(),g=this.beginSlice(a),f=this.vertexComputationManager,h=this.chunkFormat;h.beginDrawing(d,g);var k={};c=$jscomp.makeIterator(c);for(var l=c.next();!l.done;k=
{chunkDataSize:k.chunkDataSize},l=c.next()){var p=l.value,w=p.spec.chunkLayout;l=p.chunks;var v=w.size;k.chunkDataSize=void 0;var n=a.visibleChunks.get(w);if(n){f.beginSource(d,g,a,a.dataToDevice,p.spec);p=p.chunkFormat;p.beginSource(d,g);w=function(a){return function(b){a.chunkDataSize=b;f.setupChunkDataSize(d,g,a.chunkDataSize)}}(k);n=$jscomp.makeIterator(n);for(var q=n.next();!q.done;q=n.next())if((q=l.get(q.value))&&q.state===b.d.GPU_MEMORY){var t=q.chunkDataSize;t!==k.chunkDataSize&&w(t);r.p.multiply(e,
v,q.chunkGridPosition);p.bindChunk(d,g,q);f.drawChunk(d,g,e)}}}h.endDrawing(d,g);this.endSlice(g)}}},{key:"dataType",get:function(){return this.sources[0][0].spec.dataType}},{key:"chunkFormat",get:function(){return this.sources[0][0].chunkFormat}}]);return c}(m.a)},function(m,f,c){(function(c,f){m.exports=f()})(this,function(){function c(a){return new RegExp("(^|\\s)"+a+"(?:$|\\s)\\s*")}function f(a){for(var b=a.childNodes.length;0<b;--b)a.removeChild(a.firstChild);return a}function t(a,b){return f(a).appendChild(b)}
function a(a,b,c,d){a=document.createElement(a);c&&(a.className=c);d&&(a.style.cssText=d);if("string"==typeof b)a.appendChild(document.createTextNode(b));else if(b)for(c=0;c<b.length;++c)a.appendChild(b[c]);return a}function b(b,c,d,e){b=a(b,c,d,e);b.setAttribute("role","presentation");return b}function l(a,b){3==b.nodeType&&(b=b.parentNode);if(a.contains)return a.contains(b);do if(11==b.nodeType&&(b=b.host),b==a)return!0;while(b=b.parentNode)}function r(){try{var a=document.activeElement}catch(y){a=
document.body||null}for(;a&&a.shadowRoot&&a.shadowRoot.activeElement;)a=a.shadowRoot.activeElement;return a}function v(a,b){var d=a.className;c(b).test(d)||(a.className+=(d?" ":"")+b)}function p(a,b){a=a.split(" ");for(var d=0;d<a.length;d++)a[d]&&!c(a[d]).test(b)&&(b+=" "+a[d]);return b}function k(a){var b=Array.prototype.slice.call(arguments,1);return function(){return a.apply(null,b)}}function h(a,b,c){b||(b={});for(var d in a)!a.hasOwnProperty(d)||!1===c&&b.hasOwnProperty(d)||(b[d]=a[d]);return b}
function g(a,b,c,d,e){null==b&&(b=a.search(/[^\s\u00a0]/),-1==b&&(b=a.length));d=d||0;for(e=e||0;;){var u=a.indexOf("\t",d);if(0>u||u>=b)return e+(b-d);e+=u-d;e+=c-e%c;d=u+1}}function d(a,b){for(var c=0;c<a.length;++c)if(a[c]==b)return c;return-1}function e(a,b,c){for(var d=0,u=0;;){var e=a.indexOf("\t",d);-1==e&&(e=a.length);var y=e-d;if(e==a.length||u+y>=b)return d+Math.min(y,b-u);u+=e-d;u+=c-u%c;d=e+1;if(u>=b)return d}}function w(a){for(;vc.length<=a;)vc.push(m(vc)+" ");return vc[a]}function m(a){return a[a.length-
1]}function F(a,b){for(var c=[],d=0;d<a.length;d++)c[d]=b(a[d],d);return c}function G(a,b,c){for(var d=0,u=c(b);d<a.length&&c(a[d])<=u;)d++;a.splice(d,0,b)}function A(){}function x(a,b){Object.create?a=Object.create(a):(A.prototype=a,a=new A);b&&h(b,a);return a}function D(a){return/\w/.test(a)||"\u0080"<a&&(a.toUpperCase()!=a.toLowerCase()||bg.test(a))}function z(a,b){return b?-1<b.source.indexOf("\\w")&&D(a)?!0:b.test(a):D(a)}function C(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b])return!1;return!0}
function H(a){return 768<=a.charCodeAt(0)&&cg.test(a)}function J(a,b,c){for(;(0>c?0<b:b<a.length)&&H(a.charAt(b));)b+=c;return b}function E(a,b,c){for(var d=b>c?-1:1;;){if(b==c)return b;var u=(b+c)/2;u=0>d?Math.ceil(u):Math.floor(u);if(u==b)return a(u)?b:c;a(u)?c=u:b=u+d}}function S(c,d,e){this.input=e;this.scrollbarFiller=a("div",null,"CodeMirror-scrollbar-filler");this.scrollbarFiller.setAttribute("cm-not-content","true");this.gutterFiller=a("div",null,"CodeMirror-gutter-filler");this.gutterFiller.setAttribute("cm-not-content",
"true");this.lineDiv=b("div",null,"CodeMirror-code");this.selectionDiv=a("div",null,null,"position: relative; z-index: 1");this.cursorDiv=a("div",null,"CodeMirror-cursors");this.measure=a("div",null,"CodeMirror-measure");this.lineMeasure=a("div",null,"CodeMirror-measure");this.lineSpace=b("div",[this.measure,this.lineMeasure,this.selectionDiv,this.cursorDiv,this.lineDiv],null,"position: relative; outline: none");var u=b("div",[this.lineSpace],"CodeMirror-lines");this.mover=a("div",[u],null,"position: relative");
this.sizer=a("div",[this.mover],"CodeMirror-sizer");this.sizerWidth=null;this.heightForcer=a("div",null,null,"position: absolute; height: 30px; width: 1px;");this.gutters=a("div",null,"CodeMirror-gutters");this.lineGutter=null;this.scroller=a("div",[this.sizer,this.heightForcer,this.gutters],"CodeMirror-scroll");this.scroller.setAttribute("tabIndex","-1");this.wrapper=a("div",[this.scrollbarFiller,this.gutterFiller,this.scroller],"CodeMirror");X&&8>aa&&(this.gutters.style.zIndex=-1,this.scroller.style.paddingRight=
0);na||Oa&&Eb||(this.scroller.draggable=!0);c&&(c.appendChild?c.appendChild(this.wrapper):c(this.wrapper));this.reportedViewFrom=this.reportedViewTo=this.viewFrom=this.viewTo=d.first;this.view=[];this.externalMeasured=this.renderedView=null;this.lastWrapHeight=this.lastWrapWidth=this.viewOffset=0;this.updateLineNumbers=null;this.nativeBarWidth=this.barHeight=this.barWidth=0;this.scrollbarsClipped=!1;this.lineNumWidth=this.lineNumInnerWidth=this.lineNumChars=null;this.alignWidgets=!1;this.maxLine=
this.cachedCharWidth=this.cachedTextHeight=this.cachedPaddingH=null;this.maxLineLength=0;this.maxLineChanged=!1;this.wheelDX=this.wheelDY=this.wheelStartX=this.wheelStartY=null;this.shift=!1;this.activeTouch=this.selForContextMenu=null;e.init(this)}function K(a,b){b-=a.first;if(0>b||b>=a.size)throw Error("There is no line "+(b+a.first)+" in the document.");for(;!a.lines;)for(var c=0;;++c){var d=a.children[c],u=d.chunkSize();if(b<u){a=d;break}b-=u}return a.lines[b]}function U(a,b,c){var d=[],u=b.line;
a.iter(b.line,c.line+1,function(a){a=a.text;u==c.line&&(a=a.slice(0,c.ch));u==b.line&&(a=a.slice(b.ch));d.push(a);++u});return d}function W(a,b,c){var d=[];a.iter(b,c,function(a){d.push(a.text)});return d}function V(a,b){if(b-=a.height)for(;a;a=a.parent)a.height+=b}function M(a){if(null==a.parent)return null;var b=a.parent;a=d(b.lines,a);for(var c=b.parent;c;b=c,c=c.parent)for(var u=0;c.children[u]!=b;++u)a+=c.children[u].chunkSize();return a+b.first}function R(a,b){var c=a.first;a:do{for(var d=0;d<
a.children.length;++d){var u=a.children[d],e=u.height;if(b<e){a=u;continue a}b-=e;c+=u.chunkSize()}return c}while(!a.lines);for(d=0;d<a.lines.length;++d){u=a.lines[d].height;if(b<u)break;b-=u}return c+d}function ba(a,b){return b>=a.first&&b<a.first+a.size}function ha(a,b){return String(a.lineNumberFormatter(b+a.firstLineNumber))}function I(a,b,c){void 0===c&&(c=null);if(!(this instanceof I))return new I(a,b,c);this.line=a;this.ch=b;this.sticky=c}function P(a,b){return a.line-b.line||a.ch-b.ch}function Va(a,
b){return a.sticky==b.sticky&&0==P(a,b)}function Wa(a){return I(a.line,a.ch)}function tc(a,b){return 0>P(a,b)?b:a}function rc(a,b){return 0>P(a,b)?a:b}function T(a,b){if(b.line<a.first)return I(a.first,0);var c=a.first+a.size-1;if(b.line>c)return I(c,K(a,c).text.length);a=K(a,b.line).text.length;c=b.ch;b=null==c||c>a?I(b.line,a):0>c?I(b.line,0):b;return b}function uc(a,b){for(var c=[],d=0;d<b.length;d++)c[d]=T(a,b[d]);return c}function Db(a,b,c){this.marker=a;this.from=b;this.to=c}function Ja(a,b){if(a)for(var c=
0;c<a.length;++c){var d=a[c];if(d.marker==b)return d}}function qc(a,b){if(b.full)return null;var c=ba(a,b.from.line)&&K(a,b.from.line).markedSpans,d=ba(a,b.to.line)&&K(a,b.to.line).markedSpans;if(!c&&!d)return null;a=b.from.ch;var u=b.to.ch,e=0==P(b.from,b.to),y;if(c)for(var g=0;g<c.length;++g){var f=c[g],h=f.marker;if(null==f.from||(h.inclusiveLeft?f.from<=a:f.from<a)||!(f.from!=a||"bookmark"!=h.type||e&&f.marker.insertLeft)){var k=null==f.to||(h.inclusiveRight?f.to>=a:f.to>a);(y||(y=[])).push(new Db(h,
f.from,k?null:f.to))}}c=y;var l;if(d)for(y=0;y<d.length;++y)if(g=d[y],f=g.marker,null==g.to||(f.inclusiveRight?g.to>=u:g.to>u)||g.from==u&&"bookmark"==f.type&&(!e||g.marker.insertLeft))h=null==g.from||(f.inclusiveLeft?g.from<=u:g.from<u),(l||(l=[])).push(new Db(f,h?null:g.from-u,null==g.to?null:g.to-u));d=1==b.text.length;u=m(b.text).length+(d?a:0);if(c)for(e=0;e<c.length;++e)if(y=c[e],null==y.to)(g=Ja(l,y.marker),g)?d&&(y.to=null==g.to?null:g.to+u):y.to=a;if(l)for(a=0;a<l.length;++a)e=l[a],null!=
e.to&&(e.to+=u),null==e.from?Ja(c,e.marker)||(e.from=u,d&&(c||(c=[])).push(e)):(e.from+=u,d&&(c||(c=[])).push(e));c&&(c=Vd(c));l&&l!=c&&(l=Vd(l));a=[c];if(!d){b=b.text.length-2;var r;if(0<b&&c)for(d=0;d<c.length;++d)null==c[d].to&&(r||(r=[])).push(new Db(c[d].marker,null,null));for(c=0;c<b;++c)a.push(r);a.push(l)}return a}function Vd(a){for(var b=0;b<a.length;++b){var c=a[b];null!=c.from&&c.from==c.to&&!1!==c.marker.clearWhenEmpty&&a.splice(b--,1)}return a.length?a:null}function ag(a,b,c){var u=null;
a.iter(b.line,c.line+1,function(a){if(a.markedSpans)for(var b=0;b<a.markedSpans.length;++b){var c=a.markedSpans[b].marker;!c.readOnly||u&&-1!=d(u,c)||(u||(u=[])).push(c)}});if(!u)return null;a=[{from:b,to:c}];for(b=0;b<u.length;++b){c=u[b];for(var e=c.find(0),y=0;y<a.length;++y){var g=a[y];if(!(0>P(g.to,e.from)||0<P(g.from,e.to))){var f=[y,1],h=P(g.from,e.from),Q=P(g.to,e.to);(0>h||!c.inclusiveLeft&&!h)&&f.push({from:g.from,to:e.from});(0<Q||!c.inclusiveRight&&!Q)&&f.push({from:e.to,to:g.to});a.splice.apply(a,
f);y+=f.length-3}}}return a}function mb(a){var b=a.markedSpans;if(b){for(var c=0;c<b.length;++c)b[c].marker.detachLine(a);a.markedSpans=null}}function Wd(a,b){if(b){for(var c=0;c<b.length;++c)b[c].marker.attachLine(a);a.markedSpans=b}}function Xd(a,b){var c=a.lines.length-b.lines.length;if(0!=c)return c;c=a.find();var d=b.find(),u=P(c.from,d.from)||(a.inclusiveLeft?-1:0)-(b.inclusiveLeft?-1:0);return u?-u:(c=P(c.to,d.to)||(a.inclusiveRight?1:0)-(b.inclusiveRight?1:0))?c:b.id-a.id}function Ka(a,b){a=
Pa&&a.markedSpans;if(a)for(var c,d=0;d<a.length;++d)if(c=a[d],c.marker.collapsed&&null==(b?c.from:c.to)&&(!u||0>Xd(u,c.marker)))var u=c.marker;return u}function sc(a,b,c,d,e){a=K(a,b);if(a=Pa&&a.markedSpans)for(b=0;b<a.length;++b){var u=a[b];if(u.marker.collapsed){var y=u.marker.find(0),g=P(y.from,c)||(u.marker.inclusiveLeft?-1:0)-(e.inclusiveLeft?-1:0),f=P(y.to,d)||(u.marker.inclusiveRight?1:0)-(e.inclusiveRight?1:0);if(!(0<=g&&0>=f||0>=g&&0<=f)&&(0>=g&&(u.marker.inclusiveRight&&e.inclusiveLeft?
0<=P(y.to,c):0<P(y.to,c))||0<=g&&(u.marker.inclusiveRight&&e.inclusiveLeft?0>=P(y.from,d):0>P(y.from,d))))return!0}}}function Ea(a){for(var b;b=Ka(a,!0);)a=b.find(-1,!0).line;return a}function Xc(a,b){a=K(a,b);var c=Ea(a);return a==c?b:M(c)}function Yd(a,b){if(b>a.lastLine())return b;var c=K(a,b);if(!Xa(a,c))return b;for(;a=Ka(c,!1);)c=a.find(1,!0).line;return M(c)+1}function Xa(a,b){var c=Pa&&b.markedSpans;if(c)for(var d,u=0;u<c.length;++u)if(d=c[u],d.marker.collapsed&&(null==d.from||!d.marker.widgetNode&&
0==d.from&&d.marker.inclusiveLeft&&Yc(a,b,d)))return!0}function Yc(a,b,c){if(null==c.to)return b=c.marker.find(1,!0),Yc(a,b.line,Ja(b.line.markedSpans,c.marker));if(c.marker.inclusiveRight&&c.to==b.text.length)return!0;for(var d,u=0;u<b.markedSpans.length;++u)if(d=b.markedSpans[u],d.marker.collapsed&&!d.marker.widgetNode&&d.from==c.to&&(null==d.to||d.to!=c.from)&&(d.marker.inclusiveLeft||c.marker.inclusiveRight)&&Yc(a,b,d))return!0}function Fa(a){a=Ea(a);for(var b=0,c=a.parent,d=0;d<c.lines.length;++d){var u=
c.lines[d];if(u==a)break;else b+=u.height}for(a=c.parent;a;c=a,a=c.parent)for(d=0;d<a.children.length&&(u=a.children[d],u!=c);++d)b+=u.height;return b}function wc(a){if(0==a.height)return 0;for(var b=a.text.length,c,d=a;c=Ka(d,!0);)c=c.find(0,!0),d=c.from.line,b+=c.from.ch-c.to.ch;for(d=a;c=Ka(d,!1);)a=c.find(0,!0),b-=d.text.length-a.from.ch,d=a.to.line,b+=d.text.length-a.to.ch;return b}function Zc(a){var b=a.display;a=a.doc;b.maxLine=K(a,a.first);b.maxLineLength=wc(b.maxLine);b.maxLineChanged=!0;
a.iter(function(a){var c=wc(a);c>b.maxLineLength&&(b.maxLineLength=c,b.maxLine=a)})}function dg(a,b,c,d){if(!a)return d(b,c,"ltr",0);for(var u=!1,e=0;e<a.length;++e){var y=a[e];if(y.from<c&&y.to>b||b==c&&y.to==b)d(Math.max(y.from,b),Math.min(y.to,c),1==y.level?"rtl":"ltr",e),u=!0}u||d(b,c,"ltr")}function Fb(a,b,c){var d;Gb=null;for(var u=0;u<a.length;++u){var e=a[u];if(e.from<b&&e.to>b)return u;e.to==b&&(e.from!=e.to&&"before"==c?d=u:Gb=u);e.from==b&&(e.from!=e.to&&"before"!=c?d=u:Gb=u)}return null!=
d?d:Gb}function La(a,b){var c=a.order;null==c&&(c=a.order=eg(a.text,b));return c}function va(a,b,c){if(a.removeEventListener)a.removeEventListener(b,c,!1);else if(a.detachEvent)a.detachEvent("on"+b,c);else{var u=(a=a._handlers)&&a[b];u&&(c=d(u,c),-1<c&&(a[b]=u.slice(0,c).concat(u.slice(c+1))))}}function da(a,b){var c=a._handlers&&a._handlers[b]||xc;if(c.length)for(var d=Array.prototype.slice.call(arguments,2),u=0;u<c.length;++u)c[u].apply(null,d)}function ia(a,b,c){"string"==typeof b&&(b={type:b,
preventDefault:function(){this.defaultPrevented=!0}});da(a,c||b.type,a,b);return $c(b)||b.codemirrorIgnore}function $d(a){var b=a._handlers&&a._handlers.cursorActivity;if(b){a=a.curOp.cursorActivityHandlers||(a.curOp.cursorActivityHandlers=[]);for(var c=0;c<b.length;++c)-1==d(a,b[c])&&a.push(b[c])}}function ya(a,b){return 0<(a._handlers&&a._handlers[b]||xc).length}function nb(a){a.prototype.on=function(a,b){O(this,a,b)};a.prototype.off=function(a,b){va(this,a,b)}}function qa(a){a.preventDefault?a.preventDefault():
a.returnValue=!1}function ae(a){a.stopPropagation?a.stopPropagation():a.cancelBubble=!0}function $c(a){return null!=a.defaultPrevented?a.defaultPrevented:0==a.returnValue}function Hb(a){qa(a);ae(a)}function be(a){var b=a.which;null==b&&(a.button&1?b=1:a.button&2?b=3:a.button&4&&(b=2));za&&a.ctrlKey&&1==b&&(b=3);return b}function fg(b){if(null==ad){var c=a("span","\u200b");t(b,a("span",[c,document.createTextNode("x")]));0!=b.firstChild.offsetHeight&&(ad=1>=c.offsetWidth&&2<c.offsetHeight&&!(X&&8>aa))}b=
ad?a("span","\u200b"):a("span","\u00a0",null,"display: inline-block; width: 1px; margin-right: -1px");b.setAttribute("cm-text","");return b}function gg(a,b){2<arguments.length&&(b.dependencies=Array.prototype.slice.call(arguments,2));bd[a]=b}function yc(a){if("string"==typeof a&&ob.hasOwnProperty(a))a=ob[a];else if(a&&"string"==typeof a.name&&ob.hasOwnProperty(a.name)){var b=ob[a.name];"string"==typeof b&&(b={name:b});a=x(b,a);a.name=b.name}else{if("string"==typeof a&&/^[\w\-]+\/[\w\-]+\+xml$/.test(a))return yc("application/xml");
if("string"==typeof a&&/^[\w\-]+\/[\w\-]+\+json$/.test(a))return yc("application/json")}return"string"==typeof a?{name:a}:a||{name:"null"}}function cd(a,b){b=yc(b);var c=bd[b.name];if(!c)return cd(a,"text/plain");a=c(a,b);if(pb.hasOwnProperty(b.name)){c=pb[b.name];for(var d in c)c.hasOwnProperty(d)&&(a.hasOwnProperty(d)&&(a["_"+d]=a[d]),a[d]=c[d])}a.name=b.name;b.helperType&&(a.helperType=b.helperType);if(b.modeProps)for(var u in b.modeProps)a[u]=b.modeProps[u];return a}function hg(a,b){a=pb.hasOwnProperty(a)?
pb[a]:pb[a]={};h(b,a)}function Ya(a,b){if(!0===b)return b;if(a.copyState)return a.copyState(b);a={};for(var c in b){var d=b[c];d instanceof Array&&(d=d.concat([]));a[c]=d}return a}function dd(a,b){for(var c;a.innerMode;){c=a.innerMode(b);if(!c||c.mode==a)break;b=c.state;a=c.mode}return c||{mode:a,state:b}}function ce(a,b,c){return a.startState?a.startState(b,c):!0}function de(a,b,c,d){var u=[a.state.modeGen],e={};ee(a,b.text,a.doc.mode,c,function(a,b){return u.push(a,b)},e,d);var y=c.state;d=function(d){c.baseTokens=
u;var g=a.state.overlays[d],f=1,h=0;c.state=!0;ee(a,b.text,g.mode,c,function(a,b){for(var c=f;h<a;){var d=u[f];d>a&&u.splice(f,1,a,u[f+1],d);f+=2;h=Math.min(a,d)}if(b)if(g.opaque)u.splice(c,f-c,a,"overlay "+b),f=c+2;else for(;c<f;c+=2)a=u[c+1],u[c+1]=(a?a+" ":"")+"overlay "+b},e);c.state=y;c.baseTokens=null;c.baseTokenPos=1};for(var g=0;g<a.state.overlays.length;++g)d(g);return{styles:u,classes:e.bgClass||e.textClass?e:null}}function fe(a,b,c){if(!b.styles||b.styles[0]!=a.state.modeGen){var d=Ib(a,
M(b)),u=b.text.length>a.options.maxHighlightLength&&Ya(a.doc.mode,d.state),e=de(a,b,d);u&&(d.state=u);b.stateAfter=d.save(!u);b.styles=e.styles;e.classes?b.styleClasses=e.classes:b.styleClasses&&(b.styleClasses=null);c===a.doc.highlightFrontier&&(a.doc.modeFrontier=Math.max(a.doc.modeFrontier,++a.doc.highlightFrontier))}return b.styles}function Ib(a,b,c){var d=a.doc,u=a.display;if(!d.mode.startState)return new Ga(d,!0,b);var e=ig(a,b,c),g=e>d.first&&K(d,e-1).stateAfter,y=g?Ga.fromSaved(d,g,e):new Ga(d,
ce(d.mode),e);d.iter(e,b,function(c){ed(a,c.text,y);var d=y.line;c.stateAfter=d==b-1||0==d%5||d>=u.viewFrom&&d<u.viewTo?y.save():null;y.nextLine()});c&&(d.modeFrontier=y.line);return y}function ed(a,b,c,d){var u=a.doc.mode;a=new ea(b,a.options.tabSize,c);a.start=a.pos=d||0;for(""==b&&ge(u,c.state);!a.eol();)fd(u,a,c.state),a.start=a.pos}function ge(a,b){if(a.blankLine)return a.blankLine(b);if(a.innerMode&&(a=dd(a,b),a.mode.blankLine))return a.mode.blankLine(a.state)}function fd(a,b,c,d){for(var u=
0;10>u;u++){d&&(d[0]=dd(a,c).mode);var e=a.token(b,c);if(b.pos>b.start)return e}throw Error("Mode "+a.name+" failed to advance stream.");}function he(a,b,c,d){var u=a.doc,e=u.mode;b=T(u,b);var g=K(u,b.line);c=Ib(a,b.line,c);a=new ea(g.text,a.options.tabSize,c);var f;for(d&&(f=[]);(d||a.pos<b.ch)&&!a.eol();){a.start=a.pos;var y=fd(e,a,c.state);d&&f.push(new ie(a,y,Ya(u.mode,c.state)))}return d?f:new ie(a,y,c.state)}function je(a,b){if(a)for(;;){var c=a.match(/(?:^|\s+)line-(background-)?(\S+)/);if(!c)break;
a=a.slice(0,c.index)+a.slice(c.index+c[0].length);var d=c[1]?"bgClass":"textClass";null==b[d]?b[d]=c[2]:(new RegExp("(?:^|s)"+c[2]+"(?:$|s)")).test(b[d])||(b[d]+=" "+c[2])}return a}function ee(a,b,c,d,e,g,f){var u=c.flattenSpans;null==u&&(u=a.options.flattenSpans);var y=0,h=null,L=new ea(b,a.options.tabSize,d),k=a.options.addModeClass&&[null];for(""==b&&je(ge(c,d.state),g);!L.eol();){if(L.pos>a.options.maxHighlightLength){u=!1;f&&ed(a,b,d,L.pos);L.pos=b.length;var Q=null}else Q=je(fd(c,L,d.state,
k),g);if(k){var N=k[0].name;N&&(Q="m-"+(Q?N+" "+Q:N))}if(!u||h!=Q){for(;y<L.start;)y=Math.min(L.start,y+5E3),e(y,h);h=Q}L.start=L.pos}for(;y<L.pos;)a=Math.min(L.pos,y+5E3),e(a,h),y=a}function ig(a,b,c){for(var d,u,e=a.doc,f=c?-1:b-(a.doc.mode.innerMode?1E3:100);b>f;--b){if(b<=e.first)return e.first;var y=K(e,b-1),h=y.stateAfter;if(h&&(!c||b+(h instanceof zc?h.lookAhead:0)<=e.modeFrontier))return b;y=g(y.text,null,a.options.tabSize);if(null==u||d>y)u=b-1,d=y}return u}function jg(a,b){a.modeFrontier=
Math.min(a.modeFrontier,b);if(!(a.highlightFrontier<b-10)){for(var c=a.first,d=b-1;d>c;d--){var u=K(a,d).stateAfter;if(u&&(!(u instanceof zc)||d+u.lookAhead<b)){c=d+1;break}}a.highlightFrontier=Math.min(a.highlightFrontier,c)}}function ke(a,b){if(!a||/^\s*$/.test(a))return null;b=b.addModeClass?kg:lg;return b[a]||(b[a]=a.replace(/\S+/g,"cm-$&"))}function le(a,c){var d=b("span",null,null,na?"padding-right: .1px":null);d={pre:b("pre",[d],"CodeMirror-line"),content:d,col:0,pos:0,cm:a,trailingSpace:!1,
splitSpaces:(X||na)&&a.getOption("lineWrapping")};c.measure={};for(var u=0;u<=(c.rest?c.rest.length:0);u++){var e=u?c.rest[u-1]:c.line,g=void 0;d.pos=0;d.addToken=mg;var y=a.display.measure;if(null!=gd)y=gd;else{var h=t(y,document.createTextNode("A\u062eA")),k=Jb(h,0,1).getBoundingClientRect();h=Jb(h,1,2).getBoundingClientRect();f(y);y=k&&k.left!=k.right?gd=3>h.right-k.right:!1}y&&(g=La(e,a.doc.direction))&&(d.addToken=ng(d.addToken,g));d.map=[];var l=c!=a.display.externalMeasured&&M(e);a:{var r=
h=k=y=void 0,w=void 0,v=void 0,n=void 0;g=d;l=fe(a,e,l);var q=e.markedSpans,z=e.text,m=0;if(q)for(var C=z.length,D=0,x=1,B="",A=0;;){if(A==D){w=r=h=k=v="";y=null;A=Infinity;for(var G=[],F=void 0,H=0;H<q.length;++H){var J=q[H],E=J.marker;"bookmark"==E.type&&J.from==D&&E.widgetNode?G.push(E):J.from<=D&&(null==J.to||J.to>D||E.collapsed&&J.to==D&&J.from==D)?(null!=J.to&&J.to!=D&&A>J.to&&(A=J.to,r=""),E.className&&(w+=" "+E.className),E.css&&(v=(v?v+";":"")+E.css),E.startStyle&&J.from==D&&(h+=" "+E.startStyle),
E.endStyle&&J.to==A&&(F||(F=[])).push(E.endStyle,J.to),E.title&&!k&&(k=E.title),E.collapsed&&(!y||0>Xd(y.marker,E))&&(y=J)):J.from>D&&A>J.from&&(A=J.from)}if(F)for(H=0;H<F.length;H+=2)F[H+1]==A&&(r+=" "+F[H]);if(!y||y.from==D)for(F=0;F<G.length;++F)me(g,0,G[F]);if(y&&(y.from||0)==D){me(g,(null==y.to?C+1:y.to)-D,y.marker,null==y.from);if(null==y.to)break a;y.to==D&&(y=!1)}}if(D>=C)break;for(G=Math.min(C,A);;){if(B){F=D+B.length;y||(H=F>G?B.slice(0,G-D):B,g.addToken(g,H,n?n+w:w,h,D+H.length==A?r:"",
k,v));if(F>=G){B=B.slice(G-D);D=G;break}D=F;h=""}B=z.slice(m,m=l[x++]);n=ke(l[x++],g.cm.options)}}else for(y=1;y<l.length;y+=2)g.addToken(g,z.slice(m,m=l[y]),ke(l[y+1],g.cm.options))}e.styleClasses&&(e.styleClasses.bgClass&&(d.bgClass=p(e.styleClasses.bgClass,d.bgClass||"")),e.styleClasses.textClass&&(d.textClass=p(e.styleClasses.textClass,d.textClass||"")));0==d.map.length&&d.map.push(0,0,d.content.appendChild(fg(a.display.measure)));0==u?(c.measure.map=d.map,c.measure.cache={}):((c.measure.maps||
(c.measure.maps=[])).push(d.map),(c.measure.caches||(c.measure.caches=[])).push({}))}na&&(u=d.content.lastChild,/\bcm-tab\b/.test(u.className)||u.querySelector&&u.querySelector(".cm-tab"))&&(d.content.className="cm-tab-wrap-hack");da(a,"renderLine",a,c.line,d.pre);d.pre.className&&(d.textClass=p(d.pre.className,d.textClass||""));return d}function og(b){var c=a("span","\u2022","cm-invalidchar");c.title="\\u"+b.charCodeAt(0).toString(16);c.setAttribute("aria-label",c.title);return c}function mg(b,c,
d,e,g,f,h){if(c){if(b.splitSpaces){var u=b.trailingSpace;if(1<c.length&&!/  /.test(c))u=c;else{for(var y="",k=0;k<c.length;k++){var L=c.charAt(k);" "!=L||!u||k!=c.length-1&&32!=c.charCodeAt(k+1)||(L="\u00a0");y+=L;u=" "==L}u=y}}else u=c;y=u;k=b.cm.state.specialChars;L=!1;if(k.test(c)){u=document.createDocumentFragment();for(var Q=0;;){k.lastIndex=Q;var N=k.exec(c),l=N?N.index-Q:c.length-Q;if(l){var r=document.createTextNode(y.slice(Q,Q+l));X&&9>aa?u.appendChild(a("span",[r])):u.appendChild(r);b.map.push(b.pos,
b.pos+l,r);b.col+=l;b.pos+=l}if(!N)break;Q+=l+1;"\t"==N[0]?(N=b.cm.options.tabSize,N-=b.col%N,l=u.appendChild(a("span",w(N),"cm-tab")),l.setAttribute("role","presentation"),l.setAttribute("cm-text","\t"),b.col+=N):("\r"==N[0]||"\n"==N[0]?(l=u.appendChild(a("span","\r"==N[0]?"\u240d":"\u2424","cm-invalidchar")),l.setAttribute("cm-text",N[0])):(l=b.cm.options.specialCharPlaceholder(N[0]),l.setAttribute("cm-text",N[0]),X&&9>aa?u.appendChild(a("span",[l])):u.appendChild(l)),b.col+=1);b.map.push(b.pos,
b.pos+1,l);b.pos++}}else b.col+=c.length,u=document.createTextNode(y),b.map.push(b.pos,b.pos+c.length,u),X&&9>aa&&(L=!0),b.pos+=c.length;b.trailingSpace=32==y.charCodeAt(c.length-1);if(d||e||g||L||h)return c=d||"",e&&(c+=e),g&&(c+=g),e=a("span",[u],c,h),f&&(e.title=f),b.content.appendChild(e);b.content.appendChild(u)}}function ng(a,b){return function(c,d,u,e,g,f,y){u=u?u+" cm-force-border":"cm-force-border";for(var h=c.pos,k=h+d.length;;){for(var L=void 0,Q=0;Q<b.length&&!(L=b[Q],L.to>h&&L.from<=
h);Q++);if(L.to>=k)return a(c,d,u,e,g,f,y);a(c,d.slice(0,L.to-h),u,e,null,f,y);e=null;d=d.slice(L.to-h);h=L.to}}}function me(a,b,c,d){var u=!d&&c.widgetNode;u&&a.map.push(a.pos,a.pos+b,u);!d&&a.cm.display.input.needsContentAttribute&&(u||(u=a.content.appendChild(document.createElement("span"))),u.setAttribute("cm-marker",c.id));u&&(a.cm.display.input.setUneditable(u),a.content.appendChild(u));a.pos+=b;a.trailingSpace=!1}function ne(a,b,c){for(var d=this.line=b,u;d=Ka(d,!1);)d=d.find(1,!0).line,(u||
(u=[])).push(d);this.size=(this.rest=u)?M(m(this.rest))-c+1:1;this.node=this.text=null;this.hidden=Xa(a,b)}function Ac(a,b,c){var d=[],u;for(u=b;u<c;)b=new ne(a.doc,K(a.doc,u),u),u+=b.size,d.push(b);return d}function pg(a,b){if(a=a.ownsGroup)try{var c=a.delayedCallbacks,d=0;do{for(;d<c.length;d++)c[d].call(null);for(var u=0;u<a.ops.length;u++){var e=a.ops[u];if(e.cursorActivityHandlers)for(;e.cursorActivityCalled<e.cursorActivityHandlers.length;)e.cursorActivityHandlers[e.cursorActivityCalled++].call(null,
e.cm)}}while(d<c.length)}finally{qb=null,b(a)}}function la(a,b){var c=a._handlers&&a._handlers[b]||xc;if(c.length){var d=Array.prototype.slice.call(arguments,2);if(qb)var u=qb.delayedCallbacks;else Kb?u=Kb:(u=Kb=[],setTimeout(qg,0));for(var e=function(a){u.push(function(){return c[a].apply(null,d)})},g=0;g<c.length;++g)e(g)}}function qg(){var a=Kb;Kb=null;for(var b=0;b<a.length;++b)a[b]()}function oe(a,b,c,d){for(var u=0;u<b.changes.length;u++){var e=b.changes[u];if("text"==e){e=a;var g=b,f=g.text.className,
y=pe(e,g);g.text==g.node&&(g.node=y.pre);g.text.parentNode.replaceChild(y.pre,g.text);g.text=y.pre;y.bgClass!=g.bgClass||y.textClass!=g.textClass?(g.bgClass=y.bgClass,g.textClass=y.textClass,hd(e,g)):f&&(g.text.className=f)}else if("gutter"==e)qe(a,b,c,d);else if("class"==e)hd(a,b);else if("widget"==e){e=a;g=b;f=d;g.alignable&&(g.alignable=null);y=g.node.firstChild;for(var h;y;y=h)h=y.nextSibling,"CodeMirror-linewidget"==y.className&&g.node.removeChild(y);re(e,g,f)}}b.changes=null}function Lb(b){b.node==
b.text&&(b.node=a("div",null,null,"position: relative"),b.text.parentNode&&b.text.parentNode.replaceChild(b.node,b.text),b.node.appendChild(b.text),X&&8>aa&&(b.node.style.zIndex=2));return b.node}function pe(a,b){var c=a.display.externalMeasured;return c&&c.line==b.line?(a.display.externalMeasured=null,b.measure=c.measure,c.built):le(a,b)}function hd(b,c){var d=c.bgClass?c.bgClass+" "+(c.line.bgClass||""):c.line.bgClass;d&&(d+=" CodeMirror-linebackground");if(c.background)d?c.background.className=
d:(c.background.parentNode.removeChild(c.background),c.background=null);else if(d){var u=Lb(c);c.background=u.insertBefore(a("div",null,d),u.firstChild);b.display.input.setUneditable(c.background)}c.line.wrapClass?Lb(c).className=c.line.wrapClass:c.node!=c.text&&(c.node.className="");c.text.className=(c.textClass?c.textClass+" "+(c.line.textClass||""):c.line.textClass)||""}function qe(b,c,d,e){c.gutter&&(c.node.removeChild(c.gutter),c.gutter=null);c.gutterBackground&&(c.node.removeChild(c.gutterBackground),
c.gutterBackground=null);if(c.line.gutterClass){var u=Lb(c);c.gutterBackground=a("div",null,"CodeMirror-gutter-background "+c.line.gutterClass,"left: "+(b.options.fixedGutter?e.fixedPos:-e.gutterTotalWidth)+"px; width: "+e.gutterTotalWidth+"px");b.display.input.setUneditable(c.gutterBackground);u.insertBefore(c.gutterBackground,c.text)}u=c.line.gutterMarkers;if(b.options.lineNumbers||u){var g=Lb(c),f=c.gutter=a("div",null,"CodeMirror-gutter-wrapper","left: "+(b.options.fixedGutter?e.fixedPos:-e.gutterTotalWidth)+
"px");b.display.input.setUneditable(f);g.insertBefore(f,c.text);c.line.gutterClass&&(f.className+=" "+c.line.gutterClass);!b.options.lineNumbers||u&&u["CodeMirror-linenumbers"]||(c.lineNumber=f.appendChild(a("div",ha(b.options,d),"CodeMirror-linenumber CodeMirror-gutter-elt","left: "+e.gutterLeft["CodeMirror-linenumbers"]+"px; width: "+b.display.lineNumInnerWidth+"px")));if(u)for(c=0;c<b.options.gutters.length;++c)d=b.options.gutters[c],(g=u.hasOwnProperty(d)&&u[d])&&f.appendChild(a("div",[g],"CodeMirror-gutter-elt",
"left: "+e.gutterLeft[d]+"px; width: "+e.gutterWidth[d]+"px"))}}function rg(a,b,c,d){var u=pe(a,b);b.text=b.node=u.pre;u.bgClass&&(b.bgClass=u.bgClass);u.textClass&&(b.textClass=u.textClass);hd(a,b);qe(a,b,c,d);re(a,b,d);return b.node}function re(a,b,c){se(a,b.line,b,c,!0);if(b.rest)for(var d=0;d<b.rest.length;d++)se(a,b.rest[d],b,c,!1)}function se(b,c,d,e,g){if(c.widgets){var u=Lb(d),f=0;for(c=c.widgets;f<c.length;++f){var y=c[f],h=a("div",[y.node],"CodeMirror-linewidget");y.handleMouseEvents||h.setAttribute("cm-ignore-events",
"true");var k=y,L=h,Q=e;if(k.noHScroll){(d.alignable||(d.alignable=[])).push(L);var l=Q.wrapperWidth;L.style.left=Q.fixedPos+"px";k.coverGutter||(l-=Q.gutterTotalWidth,L.style.paddingLeft=Q.gutterTotalWidth+"px");L.style.width=l+"px"}k.coverGutter&&(L.style.zIndex=5,L.style.position="relative",k.noHScroll||(L.style.marginLeft=-Q.gutterTotalWidth+"px"));b.display.input.setUneditable(h);g&&y.above?u.insertBefore(h,d.gutter||d.text):u.appendChild(h);la(y,"redraw")}}}function Mb(b){if(null!=b.height)return b.height;
var c=b.doc.cm;if(!c)return 0;if(!l(document.body,b.node)){var d="position: relative;";b.coverGutter&&(d+="margin-left: -"+c.display.gutters.offsetWidth+"px;");b.noHScroll&&(d+="width: "+c.display.wrapper.clientWidth+"px;");t(c.display.measure,a("div",[b.node],null,d))}return b.height=b.node.parentNode.offsetHeight}function Ma(a,b){for(b=b.target||b.srcElement;b!=a.wrapper;b=b.parentNode)if(!b||1==b.nodeType&&"true"==b.getAttribute("cm-ignore-events")||b.parentNode==a.sizer&&b!=a.mover)return!0}function id(a){return a.mover.offsetHeight-
a.lineSpace.offsetHeight}function te(b){if(b.cachedPaddingH)return b.cachedPaddingH;var c=t(b.measure,a("pre","x"));c=window.getComputedStyle?window.getComputedStyle(c):c.currentStyle;c={left:parseInt(c.paddingLeft),right:parseInt(c.paddingRight)};isNaN(c.left)||isNaN(c.right)||(b.cachedPaddingH=c);return c}function Ha(a){return 30-a.display.nativeBarWidth}function Za(a){return a.display.scroller.clientWidth-Ha(a)-a.display.barWidth}function jd(a){return a.display.scroller.clientHeight-Ha(a)-a.display.barHeight}
function ue(a,b,c){if(a.line==b)return{map:a.measure.map,cache:a.measure.cache};for(var d=0;d<a.rest.length;d++)if(a.rest[d]==b)return{map:a.measure.maps[d],cache:a.measure.caches[d]};for(b=0;b<a.rest.length;b++)if(M(a.rest[b])>c)return{map:a.measure.maps[b],cache:a.measure.caches[b],before:!0}}function kd(a,b){if(b>=a.display.viewFrom&&b<a.display.viewTo)return a.display.view[$a(a,b)];if((a=a.display.externalMeasured)&&b>=a.lineN&&b<a.lineN+a.size)return a}function ab(a,b){var c=M(b),d=kd(a,c);d&&
!d.text?d=null:d&&d.changes&&(oe(a,d,c,ld(a)),a.curOp.forceUpdate=!0);if(!d){var u=Ea(b);d=M(u);u=a.display.externalMeasured=new ne(a.doc,u,d);u.lineN=d;d=u.built=le(a,u);u.text=d.pre;t(a.display.lineMeasure,d.pre);d=u}a=ue(d,b,c);return{line:b,view:d,rect:null,map:a.map,cache:a.cache,before:a.before,hasHeights:!1}}function Aa(b,c,d,e,g){c.before&&(d=-1);var u=d+(e||"");if(c.cache.hasOwnProperty(u))b=c.cache[u];else{c.rect||(c.rect=c.view.text.getBoundingClientRect());if(!c.hasHeights){var f=c.view,
y=c.rect,h=b.options.lineWrapping,k=h&&Za(b);if(!f.measure.heights||h&&f.measure.width!=k){var L=f.measure.heights=[];if(h)for(f.measure.width=k,f=f.text.firstChild.getClientRects(),h=0;h<f.length-1;h++){k=f[h];var Q=f[h+1];2<Math.abs(k.bottom-Q.bottom)&&L.push((k.bottom+Q.top)/2-y.top)}L.push(y.bottom-y.top)}c.hasHeights=!0}L=e;f=ve(c.map,d,L);e=f.node;y=f.start;h=f.end;d=f.collapse;if(3==e.nodeType){for(var l=0;4>l;l++){for(;y&&H(c.line.text.charAt(f.coverStart+y));)--y;for(;f.coverStart+h<f.coverEnd&&
H(c.line.text.charAt(f.coverStart+h));)++h;if(X&&9>aa&&0==y&&h==f.coverEnd-f.coverStart)var N=e.parentNode.getBoundingClientRect();else{N=Jb(e,y,h).getClientRects();h=we;if("left"==L)for(k=0;k<N.length&&(h=N[k]).left==h.right;k++);else for(k=N.length-1;0<=k&&(h=N[k]).left==h.right;k--);N=h}if(N.left||N.right||0==y)break;h=y;--y;d="right"}X&&11>aa&&((l=!window.screen||null==screen.logicalXDPI||screen.logicalXDPI==screen.deviceXDPI)||(null!=md?l=md:(L=t(b.display.measure,a("span","x")),l=L.getBoundingClientRect(),
L=Jb(L,0,1).getBoundingClientRect(),l=md=1<Math.abs(l.left-L.left)),l=!l),l||(l=screen.logicalXDPI/screen.deviceXDPI,L=screen.logicalYDPI/screen.deviceYDPI,N={left:N.left*l,right:N.right*l,top:N.top*L,bottom:N.bottom*L}))}else 0<y&&(d=L="right"),N=b.options.lineWrapping&&1<(l=e.getClientRects()).length?l["right"==L?l.length-1:0]:e.getBoundingClientRect();!(X&&9>aa)||y||N&&(N.left||N.right)||(N=(N=e.parentNode.getClientRects()[0])?{left:N.left,right:N.left+Nb(b.display),top:N.top,bottom:N.bottom}:
we);e=N.top-c.rect.top;y=N.bottom-c.rect.top;l=(e+y)/2;L=c.view.measure.heights;for(f=0;f<L.length-1&&!(l<L[f]);f++);d={left:("right"==d?N.right:N.left)-c.rect.left,right:("left"==d?N.left:N.right)-c.rect.left,top:f?L[f-1]:0,bottom:L[f]};N.left||N.right||(d.bogus=!0);b.options.singleCursorHeightPerLine||(d.rtop=e,d.rbottom=y);b=d;b.bogus||(c.cache[u]=b)}return{left:b.left,right:b.right,top:g?b.rtop:b.top,bottom:g?b.rbottom:b.bottom}}function ve(a,b,c){for(var d,u,e,g,f,y,h=0;h<a.length;h+=3){f=a[h];
y=a[h+1];if(b<f)u=0,e=1,g="left";else if(b<y)u=b-f,e=u+1;else if(h==a.length-3||b==y&&a[h+3]>b)e=y-f,u=e-1,b>=y&&(g="right");if(null!=u){d=a[h+2];f==y&&c==(d.insertLeft?"left":"right")&&(g=c);if("left"==c&&0==u)for(;h&&a[h-2]==a[h-3]&&a[h-1].insertLeft;)d=a[(h-=3)+2],g="left";if("right"==c&&u==y-f)for(;h<a.length-3&&a[h+3]==a[h+4]&&!a[h+5].insertLeft;)d=a[(h+=3)+2],g="right";break}}return{node:d,start:u,end:e,collapse:g,coverStart:f,coverEnd:y}}function xe(a){if(a.measure&&(a.measure.cache={},a.measure.heights=
null,a.rest))for(var b=0;b<a.rest.length;b++)a.measure.caches[b]={}}function ye(a){a.display.externalMeasure=null;f(a.display.lineMeasure);for(var b=0;b<a.display.view.length;b++)xe(a.display.view[b])}function Ob(a){ye(a);a.display.cachedCharWidth=a.display.cachedTextHeight=a.display.cachedPaddingH=null;a.options.lineWrapping||(a.display.maxLineChanged=!0);a.display.lineNumChars=null}function ze(){return Bc&&Cc?-(document.body.getBoundingClientRect().left-parseInt(getComputedStyle(document.body).marginLeft)):
window.pageXOffset||(document.documentElement||document.body).scrollLeft}function Ae(){return Bc&&Cc?-(document.body.getBoundingClientRect().top-parseInt(getComputedStyle(document.body).marginTop)):window.pageYOffset||(document.documentElement||document.body).scrollTop}function nd(a){var b=0;if(a.widgets)for(var c=0;c<a.widgets.length;++c)a.widgets[c].above&&(b+=Mb(a.widgets[c]));return b}function Dc(a,b,c,d,e){e||(e=nd(b),c.top+=e,c.bottom+=e);if("line"==d)return c;d||(d="local");b=Fa(b);b="local"==
d?b+a.display.lineSpace.offsetTop:b-a.display.viewOffset;if("page"==d||"window"==d)a=a.display.lineSpace.getBoundingClientRect(),b+=a.top+("window"==d?0:Ae()),d=a.left+("window"==d?0:ze()),c.left+=d,c.right+=d;c.top+=b;c.bottom+=b;return c}function Be(a,b,c){if("div"==c)return b;var d=b.left;b=b.top;"page"==c?(d-=ze(),b-=Ae()):"local"!=c&&c||(c=a.display.sizer.getBoundingClientRect(),d+=c.left,b+=c.top);a=a.display.lineSpace.getBoundingClientRect();return{left:d-a.left,top:b-a.top}}function od(a,
b,c,d,e){d||(d=K(a.doc,b.line));var u=d;b=b.ch;d=Aa(a,ab(a,d),b,e);return Dc(a,u,d,c)}function Ba(a,b,c,d,e,g){function u(b,u){b=Aa(a,e,b,u?"right":"left",g);u?b.left=b.right:b.right=b.left;return Dc(a,d,b,c)}function f(a,b,c){return u(c?a-1:a,1==y[b].level!=c)}d=d||K(a.doc,b.line);e||(e=ab(a,d));var y=La(d,a.doc.direction),h=b.ch;b=b.sticky;h>=d.text.length?(h=d.text.length,b="before"):0>=h&&(h=0,b="after");if(!y)return u("before"==b?h-1:h,"before"==b);var k=Fb(y,h,b),L=Gb;k=f(h,k,"before"==b);null!=
L&&(k.other=f(h,L,"before"!=b));return k}function Ce(a,b){var c=0;b=T(a.doc,b);a.options.lineWrapping||(c=Nb(a.display)*b.ch);b=K(a.doc,b.line);a=Fa(b)+a.display.lineSpace.offsetTop;return{left:c,right:c,top:a,bottom:a+b.height}}function pd(a,b,c,d,e){a=I(a,b,c);a.xRel=e;d&&(a.outside=!0);return a}function qd(a,b,c){var d=a.doc;c+=a.display.viewOffset;if(0>c)return pd(d.first,0,null,!0,-1);var e=R(d,c),u=d.first+d.size-1;if(e>u)return pd(d.first+d.size-1,K(d,u).text.length,null,!0,1);0>b&&(b=0);for(d=
K(d,e);;)if(e=sg(a,d,e,b,c),u=(d=Ka(d,!1))&&d.find(0,!0),d&&(e.ch>u.from.ch||e.ch==u.from.ch&&0<e.xRel))e=M(d=u.to.line);else return e}function De(a,b,c,d){d-=nd(b);b=b.text.length;var e=E(function(b){return Aa(a,c,b-1).bottom<=d},b,0);b=E(function(b){return Aa(a,c,b).top>d},e,b);return{begin:e,end:b}}function Ee(a,b,c,d){c||(c=ab(a,b));d=Dc(a,b,Aa(a,c,d),"line").top;return De(a,b,c,d)}function rd(a,b,c,d){return a.bottom<=c?!1:a.top>c?!0:(d?a.left:a.right)>b}function sg(a,b,c,d,e){e-=Fa(b);var u=
ab(a,b),g=nd(b),f=0,y=b.text.length,h=!0,k=La(b,a.doc.direction);k&&(k=(a.options.lineWrapping?tg:ug)(a,b,c,u,k,d,e),f=(h=1!=k.level)?k.from:k.to-1,y=h?k.to:k.from-1);var L=null,l=null;k=E(function(b){var c=Aa(a,u,b);c.top+=g;c.bottom+=g;if(!rd(c,d,e,!1))return!1;c.top<=e&&c.left<=d&&(L=b,l=c);return!0},f,y);var Q=!1;l?(f=d-l.left<l.right-d,h=f==h,k=L+(h?0:1),h=h?"after":"before",f=f?l.left:l.right):(h||k!=y&&k!=f||k++,h=0==k?"after":k==b.text.length?"before":Aa(a,u,k-(h?1:0)).bottom+g<=e==h?"after":
"before",Q=Ba(a,I(c,k,h),"line",b,u),f=Q.left,Q=e<Q.top||e>=Q.bottom);k=J(b.text,k,1);return pd(c,k,h,Q,d-f)}function ug(a,b,c,d,e,g,f){var u=E(function(u){u=e[u];var y=1!=u.level;return rd(Ba(a,I(c,y?u.to:u.from,y?"before":"after"),"line",b,d),g,f,!0)},0,e.length-1),y=e[u];if(0<u){var h=1!=y.level;h=Ba(a,I(c,h?y.from:y.to,h?"after":"before"),"line",b,d);rd(h,g,f,!0)&&h.top>f&&(y=e[u-1])}return y}function tg(a,b,c,d,e,g,f){f=De(a,b,d,f);c=f.begin;f=f.end;/\s/.test(b.text.charAt(f-1))&&f--;for(var u=
b=null,y=0;y<e.length;y++){var h=e[y];if(!(h.from>=f||h.to<=c)){var k=Aa(a,d,1!=h.level?Math.min(f,h.to)-1:Math.max(c,h.from)).right;k=k<g?g-k+1E9:k-g;if(!b||u>k)b=h,u=k}}b||(b=e[e.length-1]);b.from<c&&(b={from:c,to:b.to,level:b.level});b.to>f&&(b={from:b.from,to:f,level:b.level});return b}function bb(b){if(null!=b.cachedTextHeight)return b.cachedTextHeight;if(null==cb){cb=a("pre");for(var c=0;49>c;++c)cb.appendChild(document.createTextNode("x")),cb.appendChild(a("br"));cb.appendChild(document.createTextNode("x"))}t(b.measure,
cb);c=cb.offsetHeight/50;3<c&&(b.cachedTextHeight=c);f(b.measure);return c||1}function Nb(b){if(null!=b.cachedCharWidth)return b.cachedCharWidth;var c=a("span","xxxxxxxxxx"),d=a("pre",[c]);t(b.measure,d);c=c.getBoundingClientRect();c=(c.right-c.left)/10;2<c&&(b.cachedCharWidth=c);return c||10}function ld(a){for(var b=a.display,c={},d={},e=b.gutters.clientLeft,u=b.gutters.firstChild,g=0;u;u=u.nextSibling,++g)c[a.options.gutters[g]]=u.offsetLeft+u.clientLeft+e,d[a.options.gutters[g]]=u.clientWidth;
return{fixedPos:sd(b),gutterTotalWidth:b.gutters.offsetWidth,gutterLeft:c,gutterWidth:d,wrapperWidth:b.wrapper.clientWidth}}function sd(a){return a.scroller.getBoundingClientRect().left-a.sizer.getBoundingClientRect().left}function Fe(a){var b=bb(a.display),c=a.options.lineWrapping,d=c&&Math.max(5,a.display.scroller.clientWidth/Nb(a.display)-3);return function(e){if(Xa(a.doc,e))return 0;var u=0;if(e.widgets)for(var g=0;g<e.widgets.length;g++)e.widgets[g].height&&(u+=e.widgets[g].height);return c?
u+(Math.ceil(e.text.length/d)||1)*b:u+b}}function td(a){var b=a.doc,c=Fe(a);b.iter(function(a){var b=c(a);b!=a.height&&V(a,b)})}function db(a,b,c,d){var e=a.display;if(!c&&"true"==(b.target||b.srcElement).getAttribute("cm-not-content"))return null;c=e.lineSpace.getBoundingClientRect();try{var u=b.clientX-c.left;var f=b.clientY-c.top}catch(Zd){return null}b=qd(a,u,f);var h;d&&1==b.xRel&&(h=K(a.doc,b.line).text).length==b.ch&&(d=g(h,h.length,a.options.tabSize)-h.length,b=I(b.line,Math.max(0,Math.round((u-
te(a.display).left)/Nb(a.display))-d)));return b}function $a(a,b){if(b>=a.display.viewTo)return null;b-=a.display.viewFrom;if(0>b)return null;a=a.display.view;for(var c=0;c<a.length;c++)if(b-=a[c].size,0>b)return c}function Pb(a){a.display.input.showSelection(a.display.input.prepareSelection())}function Ge(a,b){void 0===b&&(b=!0);for(var c=a.doc,d={},e=d.cursors=document.createDocumentFragment(),u=d.selection=document.createDocumentFragment(),g=0;g<c.sel.ranges.length;g++)if(b||g!=c.sel.primIndex){var f=
c.sel.ranges[g];if(!(f.from().line>=a.display.viewTo||f.to().line<a.display.viewFrom)){var h=f.empty();(h||a.options.showCursorWhenSelecting)&&He(a,f.head,e);h||vg(a,f,u)}}return d}function He(b,c,d){c=Ba(b,c,"div",null,null,!b.options.singleCursorHeightPerLine);var e=d.appendChild(a("div","\u00a0","CodeMirror-cursor"));e.style.left=c.left+"px";e.style.top=c.top+"px";e.style.height=Math.max(0,c.bottom-c.top)*b.options.cursorHeight+"px";c.other&&(b=d.appendChild(a("div","\u00a0","CodeMirror-cursor CodeMirror-secondarycursor")),
b.style.display="",b.style.left=c.other.left+"px",b.style.top=c.other.top+"px",b.style.height=.85*(c.other.bottom-c.other.top)+"px")}function Ec(a,b){return a.top-b.top||a.left-b.left}function vg(b,c,d){function e(b,c,d,e){0>c&&(c=0);c=Math.round(c);e=Math.round(e);h.appendChild(a("div",null,"CodeMirror-selected","position: absolute; left: "+b+"px;\n                             top: "+c+"px; width: "+(null==d?l-b:d)+"px;\n                             height: "+(e-c)+"px"))}function u(a,c,d){function u(c,
d){return od(b,I(a,c),"div",h,d)}function g(a,c,d){a=Ee(b,h,null,a);c="ltr"==c==("after"==d)?"left":"right";d="after"==d?a.begin:a.end-(/\s/.test(h.text.charAt(a.end-1))?2:1);return u(d,c)[c]}var h=K(f,a),y=h.text.length,L,N,r=La(h,f.direction);dg(r,c||0,null==d?y:d,function(a,b,f,h){var p="ltr"==f,w=u(a,p?"left":"right"),v=u(b-1,p?"right":"left"),n=null==c&&0==a,q=null==d&&b==y,t=0==h;h=!r||h==r.length-1;3>=v.top-w.top?(b=(Q?n:q)&&t?k:(p?w:v).left,e(b,w.top,((Q?q:n)&&h?l:(p?v:w).right)-b,w.bottom)):
(p?(p=Q&&n&&t?k:w.left,n=Q?l:g(a,f,"before"),a=Q?k:g(b,f,"after"),q=Q&&q&&h?l:v.right):(p=Q?g(a,f,"before"):k,n=!Q&&n&&t?l:w.right,a=!Q&&q&&h?k:v.left,q=Q?g(b,f,"after"):l),e(p,w.top,n-p,w.bottom),w.bottom<v.top&&e(k,w.bottom,null,v.top),e(a,v.top,q-a,v.bottom));if(!L||0>Ec(w,L))L=w;0>Ec(v,L)&&(L=v);if(!N||0>Ec(w,N))N=w;0>Ec(v,N)&&(N=v)});return{start:L,end:N}}var g=b.display,f=b.doc,h=document.createDocumentFragment(),y=te(b.display),k=y.left,l=Math.max(g.sizerWidth,Za(b)-g.sizer.offsetLeft)-y.right,
Q="ltr"==f.direction;g=c.from();c=c.to();if(g.line==c.line)u(g.line,g.ch,c.ch);else{var r=K(f,g.line);y=K(f,c.line);y=Ea(r)==Ea(y);g=u(g.line,g.ch,y?r.text.length+1:null).end;c=u(c.line,y?0:null,c.ch).start;y&&(g.top<c.top-2?(e(g.right,g.top,null,g.bottom),e(k,c.top,c.left,c.bottom)):e(g.right,g.top,c.left-g.right,g.bottom));g.bottom<c.top&&e(k,g.bottom,null,c.top)}d.appendChild(h)}function ud(a){if(a.state.focused){var b=a.display;clearInterval(b.blinker);var c=!0;b.cursorDiv.style.visibility="";
0<a.options.cursorBlinkRate?b.blinker=setInterval(function(){return b.cursorDiv.style.visibility=(c=!c)?"":"hidden"},a.options.cursorBlinkRate):0>a.options.cursorBlinkRate&&(b.cursorDiv.style.visibility="hidden")}}function Ie(a){a.state.focused||(a.display.input.focus(),vd(a))}function Je(a){a.state.delayingBlurEvent=!0;setTimeout(function(){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1,Qb(a))},100)}function vd(a,b){a.state.delayingBlurEvent&&(a.state.delayingBlurEvent=!1);"nocursor"!=
a.options.readOnly&&(a.state.focused||(da(a,"focus",a,b),a.state.focused=!0,v(a.display.wrapper,"CodeMirror-focused"),a.curOp||a.display.selForContextMenu==a.doc.sel||(a.display.input.reset(),na&&setTimeout(function(){return a.display.input.reset(!0)},20)),a.display.input.receivedFocus()),ud(a))}function Qb(a,b){a.state.delayingBlurEvent||(a.state.focused&&(da(a,"blur",a,b),a.state.focused=!1,eb(a.display.wrapper,"CodeMirror-focused")),clearInterval(a.display.blinker),setTimeout(function(){a.state.focused||
(a.display.shift=!1)},150))}function Fc(a){a=a.display;for(var b=a.lineDiv.offsetTop,c=0;c<a.view.length;c++){var d=a.view[c];if(!d.hidden){if(X&&8>aa){var e=d.node.offsetTop+d.node.offsetHeight;var u=e-b;b=e}else u=d.node.getBoundingClientRect(),u=u.bottom-u.top;e=d.line.height-u;2>u&&(u=bb(a));if(.005<e||-.005>e)if(V(d.line,u),Ke(d.line),d.rest)for(u=0;u<d.rest.length;u++)Ke(d.rest[u])}}}function Ke(a){if(a.widgets)for(var b=0;b<a.widgets.length;++b){var c=a.widgets[b],d=c.node.parentNode;d&&(c.height=
d.offsetHeight)}}function wd(a,b,c){var d=c&&null!=c.top?Math.max(0,c.top):a.scroller.scrollTop;d=Math.floor(d-a.lineSpace.offsetTop);var e=c&&null!=c.bottom?c.bottom:d+a.wrapper.clientHeight;d=R(b,d);e=R(b,e);if(c&&c.ensure){var u=c.ensure.from.line;c=c.ensure.to.line;u<d?(d=u,e=R(b,Fa(K(b,u))+a.wrapper.clientHeight)):Math.min(c,b.lastLine())>=e&&(d=R(b,Fa(K(b,c))-a.wrapper.clientHeight),e=c)}return{from:d,to:Math.max(e,d+1)}}function Le(a){var b=a.display,c=b.view;if(b.alignWidgets||b.gutters.firstChild&&
a.options.fixedGutter){for(var d=sd(b)-b.scroller.scrollLeft+a.doc.scrollLeft,e=b.gutters.offsetWidth,u=d+"px",g=0;g<c.length;g++)if(!c[g].hidden){a.options.fixedGutter&&(c[g].gutter&&(c[g].gutter.style.left=u),c[g].gutterBackground&&(c[g].gutterBackground.style.left=u));var f=c[g].alignable;if(f)for(var h=0;h<f.length;h++)f[h].style.left=u}a.options.fixedGutter&&(b.gutters.style.left=d+e+"px")}}function Me(b){if(!b.options.lineNumbers)return!1;var c=b.doc;c=ha(b.options,c.first+c.size-1);var d=b.display;
if(c.length!=d.lineNumChars){var e=d.measure.appendChild(a("div",[a("div",c)],"CodeMirror-linenumber CodeMirror-gutter-elt")),u=e.firstChild.offsetWidth;e=e.offsetWidth-u;d.lineGutter.style.width="";d.lineNumInnerWidth=Math.max(u,d.lineGutter.offsetWidth-e)+1;d.lineNumWidth=d.lineNumInnerWidth+e;d.lineNumChars=d.lineNumInnerWidth?c.length:-1;d.lineGutter.style.width=d.lineNumWidth+"px";xd(b);return!0}return!1}function yd(a,b){var c=a.display,d=bb(a.display);0>b.top&&(b.top=0);var e=a.curOp&&null!=
a.curOp.scrollTop?a.curOp.scrollTop:c.scroller.scrollTop,u=jd(a),g={};b.bottom-b.top>u&&(b.bottom=b.top+u);var f=a.doc.height+id(c),h=b.top<d;d=b.bottom>f-d;b.top<e?g.scrollTop=h?0:b.top:b.bottom>e+u&&(u=Math.min(b.top,(d?f:b.bottom)-u),u!=e&&(g.scrollTop=u));e=a.curOp&&null!=a.curOp.scrollLeft?a.curOp.scrollLeft:c.scroller.scrollLeft;a=Za(a)-(a.options.fixedGutter?c.gutters.offsetWidth:0);if(c=b.right-b.left>a)b.right=b.left+a;10>b.left?g.scrollLeft=0:b.left<e?g.scrollLeft=Math.max(0,b.left-(c?0:
10)):b.right>a+e-3&&(g.scrollLeft=b.right+(c?0:10)-a);return g}function Gc(a,b){null!=b&&(Hc(a),a.curOp.scrollTop=(null==a.curOp.scrollTop?a.doc.scrollTop:a.curOp.scrollTop)+b)}function rb(a){Hc(a);var b=a.getCursor();a.curOp.scrollToPos={from:b,to:b,margin:a.options.cursorScrollMargin}}function Rb(a,b,c){null==b&&null==c||Hc(a);null!=b&&(a.curOp.scrollLeft=b);null!=c&&(a.curOp.scrollTop=c)}function Hc(a){var b=a.curOp.scrollToPos;if(b){a.curOp.scrollToPos=null;var c=Ce(a,b.from),d=Ce(a,b.to);Ne(a,
c,d,b.margin)}}function Ne(a,b,c,d){b=yd(a,{left:Math.min(b.left,c.left),top:Math.min(b.top,c.top)-d,right:Math.max(b.right,c.right),bottom:Math.max(b.bottom,c.bottom)+d});Rb(a,b.scrollLeft,b.scrollTop)}function Sb(a,b){2>Math.abs(a.doc.scrollTop-b)||(Oa||zd(a,{top:b}),Oe(a,b,!0),Oa&&zd(a),Tb(a,100))}function Oe(a,b,c){b=Math.min(a.display.scroller.scrollHeight-a.display.scroller.clientHeight,b);if(a.display.scroller.scrollTop!=b||c)a.doc.scrollTop=b,a.display.scrollbars.setScrollTop(b),a.display.scroller.scrollTop!=
b&&(a.display.scroller.scrollTop=b)}function fb(a,b,c,d){b=Math.min(b,a.display.scroller.scrollWidth-a.display.scroller.clientWidth);(c?b==a.doc.scrollLeft:2>Math.abs(a.doc.scrollLeft-b))&&!d||(a.doc.scrollLeft=b,Le(a),a.display.scroller.scrollLeft!=b&&(a.display.scroller.scrollLeft=b),a.display.scrollbars.setScrollLeft(b))}function Ub(a){var b=a.display,c=b.gutters.offsetWidth,d=Math.round(a.doc.height+id(a.display));return{clientHeight:b.scroller.clientHeight,viewHeight:b.wrapper.clientHeight,scrollWidth:b.scroller.scrollWidth,
clientWidth:b.scroller.clientWidth,viewWidth:b.wrapper.clientWidth,barLeft:a.options.fixedGutter?c:0,docHeight:d,scrollHeight:d+Ha(a)+b.barHeight,nativeBarWidth:b.nativeBarWidth,gutterWidth:c}}function sb(a,b){b||(b=Ub(a));var c=a.display.barWidth,d=a.display.barHeight;Pe(a,b);for(b=0;4>b&&c!=a.display.barWidth||d!=a.display.barHeight;b++)c!=a.display.barWidth&&a.options.lineWrapping&&Fc(a),Pe(a,Ub(a)),c=a.display.barWidth,d=a.display.barHeight}function Pe(a,b){var c=a.display,d=c.scrollbars.update(b);
c.sizer.style.paddingRight=(c.barWidth=d.right)+"px";c.sizer.style.paddingBottom=(c.barHeight=d.bottom)+"px";c.heightForcer.style.borderBottom=d.bottom+"px solid transparent";d.right&&d.bottom?(c.scrollbarFiller.style.display="block",c.scrollbarFiller.style.height=d.bottom+"px",c.scrollbarFiller.style.width=d.right+"px"):c.scrollbarFiller.style.display="";d.bottom&&a.options.coverGutterNextToScrollbar&&a.options.fixedGutter?(c.gutterFiller.style.display="block",c.gutterFiller.style.height=d.bottom+
"px",c.gutterFiller.style.width=b.gutterWidth+"px"):c.gutterFiller.style.display=""}function Qe(a){a.display.scrollbars&&(a.display.scrollbars.clear(),a.display.scrollbars.addClass&&eb(a.display.wrapper,a.display.scrollbars.addClass));a.display.scrollbars=new Re[a.options.scrollbarStyle](function(b){a.display.wrapper.insertBefore(b,a.display.scrollbarFiller);O(b,"mousedown",function(){a.state.focused&&setTimeout(function(){return a.display.input.focus()},0)});b.setAttribute("cm-not-content","true")},
function(b,c){"horizontal"==c?fb(a,b):Sb(a,b)},a);a.display.scrollbars.addClass&&v(a.display.wrapper,a.display.scrollbars.addClass)}function gb(a){a.curOp={cm:a,viewChanged:!1,startHeight:a.doc.height,forceUpdate:!1,updateInput:null,typing:!1,changeObjs:null,cursorActivityHandlers:null,cursorActivityCalled:0,selectionChanged:!1,updateMaxLine:!1,scrollLeft:null,scrollTop:null,scrollToPos:null,focus:!1,id:++wg};a=a.curOp;qb?qb.ops.push(a):a.ownsGroup=qb={ops:[a],delayedCallbacks:[]}}function hb(b){pg(b.curOp,
function(b){for(var c=0;c<b.ops.length;c++)b.ops[c].cm.curOp=null;b=b.ops;for(c=0;c<b.length;c++){var d=b[c],e=d.cm,u=e.display,g=e.display;!g.scrollbarsClipped&&g.scroller.offsetWidth&&(g.nativeBarWidth=g.scroller.offsetWidth-g.scroller.clientWidth,g.heightForcer.style.height=Ha(e)+"px",g.sizer.style.marginBottom=-g.nativeBarWidth+"px",g.sizer.style.borderRightWidth=Ha(e)+"px",g.scrollbarsClipped=!0);d.updateMaxLine&&Zc(e);d.mustUpdate=d.viewChanged||d.forceUpdate||null!=d.scrollTop||d.scrollToPos&&
(d.scrollToPos.from.line<u.viewFrom||d.scrollToPos.to.line>=u.viewTo)||u.maxLineChanged&&e.options.lineWrapping;d.update=d.mustUpdate&&new Ic(e,d.mustUpdate&&{top:d.scrollTop,ensure:d.scrollToPos},d.forceUpdate)}for(c=0;c<b.length;c++)d=b[c],d.updatedDisplay=d.mustUpdate&&Ad(d.cm,d.update);for(c=0;c<b.length;c++)if(d=b[c],e=d.cm,u=e.display,d.updatedDisplay&&Fc(e),d.barMeasure=Ub(e),u.maxLineChanged&&!e.options.lineWrapping&&(g=u.maxLine.text.length,g=Aa(e,ab(e,u.maxLine),g,void 0),d.adjustWidthTo=
g.left+3,e.display.sizerWidth=d.adjustWidthTo,d.barMeasure.scrollWidth=Math.max(u.scroller.clientWidth,u.sizer.offsetLeft+d.adjustWidthTo+Ha(e)+e.display.barWidth),d.maxScrollLeft=Math.max(0,u.sizer.offsetLeft+d.adjustWidthTo-Za(e))),d.updatedDisplay||d.selectionChanged)d.preparedSelection=u.input.prepareSelection();for(c=0;c<b.length;c++)d=b[c],e=d.cm,null!=d.adjustWidthTo&&(e.display.sizer.style.minWidth=d.adjustWidthTo+"px",d.maxScrollLeft<e.doc.scrollLeft&&fb(e,Math.min(e.display.scroller.scrollLeft,
d.maxScrollLeft),!0),e.display.maxLineChanged=!1),u=d.focus&&d.focus==r(),d.preparedSelection&&e.display.input.showSelection(d.preparedSelection,u),(d.updatedDisplay||d.startHeight!=e.doc.height)&&sb(e,d.barMeasure),d.updatedDisplay&&Bd(e,d.barMeasure),d.selectionChanged&&ud(e),e.state.focused&&d.updateInput&&e.display.input.reset(d.typing),u&&Ie(d.cm);for(c=0;c<b.length;c++){var f=void 0;d=b[c];e=d.cm;u=e.display;g=e.doc;d.updatedDisplay&&Se(e,d.update);null==u.wheelStartX||null==d.scrollTop&&null==
d.scrollLeft&&!d.scrollToPos||(u.wheelStartX=u.wheelStartY=null);null!=d.scrollTop&&Oe(e,d.scrollTop,d.forceScroll);null!=d.scrollLeft&&fb(e,d.scrollLeft,!0,!0);if(d.scrollToPos){var h=T(g,d.scrollToPos.from),y=T(g,d.scrollToPos.to),k=d.scrollToPos.margin;null==k&&(k=0);e.options.lineWrapping||h!=y||(h=h.ch?I(h.line,"before"==h.sticky?h.ch-1:h.ch,"after"):h,y="before"==h.sticky?I(h.line,h.ch+1,"before"):h);for(var l=0;5>l;l++){var p=!1;f=Ba(e,h);var w=y&&y!=h?Ba(e,y):f;f={left:Math.min(f.left,w.left),
top:Math.min(f.top,w.top)-k,right:Math.max(f.left,w.left),bottom:Math.max(f.bottom,w.bottom)+k};w=yd(e,f);var v=e.doc.scrollTop,n=e.doc.scrollLeft;null!=w.scrollTop&&(Sb(e,w.scrollTop),1<Math.abs(e.doc.scrollTop-v)&&(p=!0));null!=w.scrollLeft&&(fb(e,w.scrollLeft),1<Math.abs(e.doc.scrollLeft-n)&&(p=!0));if(!p)break}y=f;ia(e,"scrollCursorIntoView")||(k=e.display,l=k.sizer.getBoundingClientRect(),h=null,0>y.top+l.top?h=!0:y.bottom+l.top>(window.innerHeight||document.documentElement.clientHeight)&&(h=
!1),null==h||xg||(y=a("div","\u200b",null,"position: absolute;\n                         top: "+(y.top-k.viewOffset-e.display.lineSpace.offsetTop)+"px;\n                         height: "+(y.bottom-y.top+Ha(e)+k.barHeight)+"px;\n                         left: "+y.left+"px; width: "+Math.max(2,y.right-y.left)+"px;"),e.display.lineSpace.appendChild(y),y.scrollIntoView(h),e.display.lineSpace.removeChild(y)))}y=d.maybeHiddenMarkers;h=d.maybeUnhiddenMarkers;if(y)for(k=0;k<y.length;++k)y[k].lines.length||
da(y[k],"hide");if(h)for(y=0;y<h.length;++y)h[y].lines.length&&da(h[y],"unhide");u.wrapper.offsetHeight&&(g.scrollTop=e.display.scroller.scrollTop);d.changeObjs&&da(e,"changes",e,d.changeObjs);d.update&&d.update.finish()}})}function ta(a,b){if(a.curOp)return b();gb(a);try{return b()}finally{hb(a)}}function ja(a,b){return function(){if(a.curOp)return b.apply(a,arguments);gb(a);try{return b.apply(a,arguments)}finally{hb(a)}}}function oa(a){return function(){if(this.curOp)return a.apply(this,arguments);
gb(this);try{return a.apply(this,arguments)}finally{hb(this)}}}function ka(a){return function(){var b=this.cm;if(!b||b.curOp)return a.apply(this,arguments);gb(b);try{return a.apply(this,arguments)}finally{hb(b)}}}function ra(a,b,c,d){null==b&&(b=a.doc.first);null==c&&(c=a.doc.first+a.doc.size);d||(d=0);var e=a.display;d&&c<e.viewTo&&(null==e.updateLineNumbers||e.updateLineNumbers>b)&&(e.updateLineNumbers=b);a.curOp.viewChanged=!0;if(b>=e.viewTo)Pa&&Xc(a.doc,b)<e.viewTo&&Qa(a);else if(c<=e.viewFrom)Pa&&
Yd(a.doc,c+d)>e.viewFrom?Qa(a):(e.viewFrom+=d,e.viewTo+=d);else if(b<=e.viewFrom&&c>=e.viewTo)Qa(a);else if(b<=e.viewFrom){var u=Jc(a,c,c+d,1);u?(e.view=e.view.slice(u.index),e.viewFrom=u.lineN,e.viewTo+=d):Qa(a)}else if(c>=e.viewTo)(u=Jc(a,b,b,-1))?(e.view=e.view.slice(0,u.index),e.viewTo=u.lineN):Qa(a);else{u=Jc(a,b,b,-1);var g=Jc(a,c,c+d,1);u&&g?(e.view=e.view.slice(0,u.index).concat(Ac(a,u.lineN,g.lineN)).concat(e.view.slice(g.index)),e.viewTo+=d):Qa(a)}if(a=e.externalMeasured)c<a.lineN?a.lineN+=
d:b<a.lineN+a.size&&(e.externalMeasured=null)}function Ra(a,b,c){a.curOp.viewChanged=!0;var e=a.display,u=a.display.externalMeasured;u&&b>=u.lineN&&b<u.lineN+u.size&&(e.externalMeasured=null);b<e.viewFrom||b>=e.viewTo||(a=e.view[$a(a,b)],null!=a.node&&(a=a.changes||(a.changes=[]),-1==d(a,c)&&a.push(c)))}function Qa(a){a.display.viewFrom=a.display.viewTo=a.doc.first;a.display.view=[];a.display.viewOffset=0}function Jc(a,b,c,d){var e=$a(a,b),u=a.display.view;if(!Pa||c==a.doc.first+a.doc.size)return{index:e,
lineN:c};for(var g=a.display.viewFrom,f=0;f<e;f++)g+=u[f].size;if(g!=b){if(0<d){if(e==u.length-1)return null;b=g+u[e].size-b;e++}else b=g-b;c+=b}for(;Xc(a.doc,c)!=c;){if(e==(0>d?0:u.length-1))return null;c+=d*u[e-(0>d?1:0)].size;e+=d}return{index:e,lineN:c}}function Te(a){a=a.display.view;for(var b=0,c=0;c<a.length;c++){var d=a[c];d.hidden||d.node&&!d.changes||++b}return b}function Tb(a,b){a.doc.highlightFrontier<a.display.viewTo&&a.state.highlight.set(b,k(yg,a))}function yg(a){var b=a.doc;if(!(b.highlightFrontier>=
a.display.viewTo)){var c=+new Date+a.options.workTime,d=Ib(a,b.highlightFrontier),e=[];b.iter(d.line,Math.min(b.first+b.size,a.display.viewTo+500),function(u){if(d.line>=a.display.viewFrom){var g=u.styles,f=u.text.length>a.options.maxHighlightLength?Ya(b.mode,d.state):null,h=de(a,u,d,!0);f&&(d.state=f);u.styles=h.styles;f=u.styleClasses;(h=h.classes)?u.styleClasses=h:f&&(u.styleClasses=null);h=!g||g.length!=u.styles.length||f!=h&&(!f||!h||f.bgClass!=h.bgClass||f.textClass!=h.textClass);for(f=0;!h&&
f<g.length;++f)h=g[f]!=u.styles[f];h&&e.push(d.line);u.stateAfter=d.save()}else u.text.length<=a.options.maxHighlightLength&&ed(a,u.text,d),u.stateAfter=0==d.line%5?d.save():null;d.nextLine();if(+new Date>c)return Tb(a,a.options.workDelay),!0});b.highlightFrontier=d.line;b.modeFrontier=Math.max(b.modeFrontier,d.line);e.length&&ta(a,function(){for(var b=0;b<e.length;b++)Ra(a,e[b],"text")})}}function Ad(a,b){var c=a.display,d=a.doc;if(b.editorIsHidden)return Qa(a),!1;if(!b.force&&b.visible.from>=c.viewFrom&&
b.visible.to<=c.viewTo&&(null==c.updateLineNumbers||c.updateLineNumbers>=c.viewTo)&&c.renderedView==c.view&&0==Te(a))return!1;Me(a)&&(Qa(a),b.dims=ld(a));var e=d.first+d.size,u=Math.max(b.visible.from-a.options.viewportMargin,d.first),g=Math.min(e,b.visible.to+a.options.viewportMargin);c.viewFrom<u&&20>u-c.viewFrom&&(u=Math.max(d.first,c.viewFrom));c.viewTo>g&&20>c.viewTo-g&&(g=Math.min(e,c.viewTo));Pa&&(u=Xc(a.doc,u),g=Yd(a.doc,g));d=u!=c.viewFrom||g!=c.viewTo||c.lastWrapHeight!=b.wrapperHeight||
c.lastWrapWidth!=b.wrapperWidth;e=a.display;0==e.view.length||u>=e.viewTo||g<=e.viewFrom?(e.view=Ac(a,u,g),e.viewFrom=u):(e.viewFrom>u?e.view=Ac(a,u,e.viewFrom).concat(e.view):e.viewFrom<u&&(e.view=e.view.slice($a(a,u))),e.viewFrom=u,e.viewTo<g?e.view=e.view.concat(Ac(a,e.viewTo,g)):e.viewTo>g&&(e.view=e.view.slice(0,$a(a,g))));e.viewTo=g;c.viewOffset=Fa(K(a.doc,c.viewFrom));a.display.mover.style.top=c.viewOffset+"px";g=Te(a);if(!d&&0==g&&!b.force&&c.renderedView==c.view&&(null==c.updateLineNumbers||
c.updateLineNumbers>=c.viewTo))return!1;a.hasFocus()?u=null:(u=r())&&l(a.display.lineDiv,u)?(u={activeElt:u},window.getSelection&&(e=window.getSelection(),e.anchorNode&&e.extend&&l(a.display.lineDiv,e.anchorNode)&&(u.anchorNode=e.anchorNode,u.anchorOffset=e.anchorOffset,u.focusNode=e.focusNode,u.focusOffset=e.focusOffset))):u=null;4<g&&(c.lineDiv.style.display="none");zg(a,c.updateLineNumbers,b.dims);4<g&&(c.lineDiv.style.display="");c.renderedView=c.view;(g=u)&&g.activeElt&&g.activeElt!=r()&&(g.activeElt.focus(),
g.anchorNode&&l(document.body,g.anchorNode)&&l(document.body,g.focusNode)&&(u=window.getSelection(),e=document.createRange(),e.setEnd(g.anchorNode,g.anchorOffset),e.collapse(!1),u.removeAllRanges(),u.addRange(e),u.extend(g.focusNode,g.focusOffset)));f(c.cursorDiv);f(c.selectionDiv);c.gutters.style.height=c.sizer.style.minHeight=0;d&&(c.lastWrapHeight=b.wrapperHeight,c.lastWrapWidth=b.wrapperWidth,Tb(a,400));c.updateLineNumbers=null;return!0}function Se(a,b){for(var c=b.viewport,d=!0;;d=!1){if(!d||
!a.options.lineWrapping||b.oldDisplayWidth==Za(a))if(c&&null!=c.top&&(c={top:Math.min(a.doc.height+id(a.display)-jd(a),c.top)}),b.visible=wd(a.display,a.doc,c),b.visible.from>=a.display.viewFrom&&b.visible.to<=a.display.viewTo)break;if(!Ad(a,b))break;Fc(a);d=Ub(a);Pb(a);sb(a,d);Bd(a,d);b.force=!1}b.signal(a,"update",a);if(a.display.viewFrom!=a.display.reportedViewFrom||a.display.viewTo!=a.display.reportedViewTo)b.signal(a,"viewportChange",a,a.display.viewFrom,a.display.viewTo),a.display.reportedViewFrom=
a.display.viewFrom,a.display.reportedViewTo=a.display.viewTo}function zd(a,b){b=new Ic(a,b);if(Ad(a,b)){Fc(a);Se(a,b);var c=Ub(a);Pb(a);sb(a,c);Bd(a,c);b.finish()}}function zg(a,b,c){function e(b){var c=b.nextSibling;na&&za&&a.display.currentWheelTarget==b?b.style.display="none":b.parentNode.removeChild(b);return c}var u=a.display,g=a.options.lineNumbers,h=u.lineDiv,k=h.firstChild,y=u.view;u=u.viewFrom;for(var l=0;l<y.length;l++){var r=y[l];if(!r.hidden)if(r.node&&r.node.parentNode==h){for(;k!=r.node;)k=
e(k);k=g&&null!=b&&b<=u&&r.lineNumber;r.changes&&(-1<d(r.changes,"gutter")&&(k=!1),oe(a,r,u,c));k&&(f(r.lineNumber),r.lineNumber.appendChild(document.createTextNode(ha(a.options,u))));k=r.node.nextSibling}else{var p=rg(a,r,u,c);h.insertBefore(p,k)}u+=r.size}for(;k;)k=e(k)}function xd(a){a.display.sizer.style.marginLeft=a.display.gutters.offsetWidth+"px"}function Bd(a,b){a.display.sizer.style.minHeight=b.docHeight+"px";a.display.heightForcer.style.top=b.docHeight+"px";a.display.gutters.style.height=
b.docHeight+a.display.barHeight+Ha(a)+"px"}function Ue(b){var c=b.display.gutters,d=b.options.gutters;f(c);for(var e=0;e<d.length;++e){var u=d[e],g=c.appendChild(a("div",null,"CodeMirror-gutter "+u));"CodeMirror-linenumbers"==u&&(b.display.lineGutter=g,g.style.width=(b.display.lineNumWidth||1)+"px")}c.style.display=e?"":"none";xd(b)}function Cd(a){var b=d(a.gutters,"CodeMirror-linenumbers");-1==b&&a.lineNumbers?a.gutters=a.gutters.concat(["CodeMirror-linenumbers"]):-1<b&&!a.lineNumbers&&(a.gutters=
a.gutters.slice(0),a.gutters.splice(b,1))}function Ve(a){var b=a.wheelDeltaX,c=a.wheelDeltaY;null==b&&a.detail&&a.axis==a.HORIZONTAL_AXIS&&(b=a.detail);null==c&&a.detail&&a.axis==a.VERTICAL_AXIS?c=a.detail:null==c&&(c=a.wheelDelta);return{x:b,y:c}}function Ag(a){a=Ve(a);a.x*=wa;a.y*=wa;return a}function We(a,b){var c=Ve(b),d=c.x;c=c.y;var e=a.display,u=e.scroller,g=u.scrollWidth>u.clientWidth,f=u.scrollHeight>u.clientHeight;if(d&&g||c&&f){if(c&&za&&na){g=b.target;var h=e.view;a:for(;g!=u;g=g.parentNode)for(var k=
0;k<h.length;k++)if(h[k].node==g){a.display.currentWheelTarget=g;break a}}!d||Oa||Ca||null==wa?(c&&null!=wa&&(b=c*wa,f=a.doc.scrollTop,g=f+e.wrapper.clientHeight,0>b?f=Math.max(0,f+b-50):g=Math.min(a.doc.height,g+b+50),zd(a,{top:f,bottom:g})),20>Kc&&(null==e.wheelStartX?(e.wheelStartX=u.scrollLeft,e.wheelStartY=u.scrollTop,e.wheelDX=d,e.wheelDY=c,setTimeout(function(){if(null!=e.wheelStartX){var a=u.scrollLeft-e.wheelStartX,b=u.scrollTop-e.wheelStartY;a=b&&e.wheelDY&&b/e.wheelDY||a&&e.wheelDX&&a/
e.wheelDX;e.wheelStartX=e.wheelStartY=null;a&&(wa=(wa*Kc+a)/(Kc+1),++Kc)}},200)):(e.wheelDX+=d,e.wheelDY+=c))):(c&&f&&Sb(a,Math.max(0,u.scrollTop+c*wa)),fb(a,Math.max(0,u.scrollLeft+d*wa)),(!c||c&&f)&&qa(b),e.wheelStartX=null)}}function Da(a,b){b=a[b];a.sort(function(a,b){return P(a.from(),b.from())});b=d(a,b);for(var c=1;c<a.length;c++){var e=a[c],u=a[c-1];if(0<=P(u.to(),e.from())){var g=rc(u.from(),e.from()),f=tc(u.to(),e.to());e=u.empty()?e.from()==e.head:u.from()==u.head;c<=b&&--b;a.splice(--c,
2,new Y(e?f:g,e?g:f))}}return new xa(a,b)}function Na(a,b){return new xa([new Y(a,b||a)],0)}function Sa(a){return a.text?I(a.from.line+a.text.length-1,m(a.text).length+(1==a.text.length?a.from.ch:0)):a.to}function Xe(a,b){if(0>P(a,b.from))return a;if(0>=P(a,b.to))return Sa(b);var c=a.line+b.text.length-(b.to.line-b.from.line)-1,d=a.ch;a.line==b.to.line&&(d+=Sa(b).ch-b.to.ch);return I(c,d)}function Dd(a,b){for(var c=[],d=0;d<a.sel.ranges.length;d++){var e=a.sel.ranges[d];c.push(new Y(Xe(e.anchor,b),
Xe(e.head,b)))}return Da(c,a.sel.primIndex)}function Ye(a,b,c){return a.line==b.line?I(c.line,a.ch-b.ch+c.ch):I(c.line+(a.line-b.line),a.ch)}function Ed(a){a.doc.mode=cd(a.options,a.doc.modeOption);Vb(a)}function Vb(a){a.doc.iter(function(a){a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null)});a.doc.modeFrontier=a.doc.highlightFrontier=a.doc.first;Tb(a,100);a.state.modeGen++;a.curOp&&ra(a)}function Ze(a,b){return 0==b.from.ch&&0==b.to.ch&&""==m(b.text)&&(!a.cm||a.cm.options.wholeLineUpdateBefore)}
function Fd(a,b,c,d){function e(a,c,e){a.text=c;a.stateAfter&&(a.stateAfter=null);a.styles&&(a.styles=null);null!=a.order&&(a.order=null);mb(a);Wd(a,e);c=d?d(a):1;c!=a.height&&V(a,c);la(a,"change",a,b)}function g(a,b){for(var e=[];a<b;++a)e.push(new tb(h[a],c?c[a]:null,d));return e}var u=b.from,f=b.to,h=b.text,k=K(a,u.line),y=K(a,f.line),l=m(h),L=c?c[h.length-1]:null,r=f.line-u.line;b.full?(a.insert(0,g(0,h.length)),a.remove(h.length,a.size-h.length)):Ze(a,b)?(f=g(0,h.length-1),e(y,y.text,L),r&&a.remove(u.line,
r),f.length&&a.insert(u.line,f)):k==y?1==h.length?e(k,k.text.slice(0,u.ch)+l+k.text.slice(f.ch),L):(r=g(1,h.length-1),r.push(new tb(l+k.text.slice(f.ch),L,d)),e(k,k.text.slice(0,u.ch)+h[0],c?c[0]:null),a.insert(u.line+1,r)):1==h.length?(e(k,k.text.slice(0,u.ch)+h[0]+y.text.slice(f.ch),c?c[0]:null),a.remove(u.line+1,r)):(e(k,k.text.slice(0,u.ch)+h[0],c?c[0]:null),e(y,l+y.text.slice(f.ch),L),L=g(1,h.length-1),1<r&&a.remove(u.line+1,r-1),a.insert(u.line+1,L));la(a,"change",a,b)}function ib(a,b,c){function d(a,
e,g){if(a.linked)for(var u=0;u<a.linked.length;++u){var f=a.linked[u];if(f.doc!=e){var h=g&&f.sharedHist;if(!c||h)b(f.doc,h),d(f.doc,a,h)}}}d(a,null,!0)}function $e(a,b){if(b.cm)throw Error("This document is already in use.");a.doc=b;b.cm=a;td(a);Ed(a);af(a);a.options.lineWrapping||Zc(a);a.options.mode=b.modeOption;ra(a)}function af(a){("rtl"==a.doc.direction?v:eb)(a.display.lineDiv,"CodeMirror-rtl")}function Bg(a){ta(a,function(){af(a);ra(a)})}function Lc(a){this.done=[];this.undone=[];this.undoDepth=
Infinity;this.lastModTime=this.lastSelTime=0;this.lastOrigin=this.lastSelOrigin=this.lastOp=this.lastSelOp=null;this.generation=this.maxGeneration=a||1}function Gd(a,b){var c={from:Wa(b.from),to:Sa(b),text:U(a,b.from,b.to)};bf(a,c,b.from.line,b.to.line+1);ib(a,function(a){return bf(a,c,b.from.line,b.to.line+1)},!0);return c}function cf(a){for(;a.length;)if(m(a).ranges)a.pop();else break}function df(a,b,c,d){var e=a.history;e.undone.length=0;var g=+new Date,f;if(f=e.lastOp==d||e.lastOrigin==b.origin&&
b.origin&&("+"==b.origin.charAt(0)&&a.cm&&e.lastModTime>g-a.cm.options.historyEventDelay||"*"==b.origin.charAt(0))){if(e.lastOp==d){cf(e.done);var u=m(e.done)}else e.done.length&&!m(e.done).ranges?u=m(e.done):1<e.done.length&&!e.done[e.done.length-2].ranges?(e.done.pop(),u=m(e.done)):u=void 0;f=u}if(f){var h=m(u.changes);0==P(b.from,b.to)&&0==P(b.from,h.to)?h.to=Sa(b):u.changes.push(Gd(a,b))}else for((u=m(e.done))&&u.ranges||Mc(a.sel,e.done),u={changes:[Gd(a,b)],generation:e.generation},e.done.push(u);e.done.length>
e.undoDepth;)e.done.shift(),e.done[0].ranges||e.done.shift();e.done.push(c);e.generation=++e.maxGeneration;e.lastModTime=e.lastSelTime=g;e.lastOp=e.lastSelOp=d;e.lastOrigin=e.lastSelOrigin=b.origin;h||da(a,"historyAdded")}function Mc(a,b){var c=m(b);c&&c.ranges&&c.equals(a)||b.push(a)}function bf(a,b,c,d){var e=b["spans_"+a.id],g=0;a.iter(Math.max(a.first,c),Math.min(a.first+a.size,d),function(c){c.markedSpans&&((e||(e=b["spans_"+a.id]={}))[g]=c.markedSpans);++g})}function Cg(a){if(!a)return null;
for(var b,c=0;c<a.length;++c)a[c].marker.explicitlyCleared?b||(b=a.slice(0,c)):b&&b.push(a[c]);return b?b.length?b:null:a}function ef(a,b){var c;if(c=b["spans_"+a.id]){for(var d=[],e=0;e<b.text.length;++e)d.push(Cg(c[e]));c=d}else c=null;a=qc(a,b);if(!c)return a;if(!a)return c;for(b=0;b<c.length;++b)if(d=c[b],e=a[b],d&&e){var g=0;a:for(;g<e.length;++g){for(var f=e[g],u=0;u<d.length;++u)if(d[u].marker==f.marker)continue a;d.push(f)}}else e&&(c[b]=e);return c}function ub(a,b,c){for(var e=[],g=0;g<a.length;++g){var f=
a[g];if(f.ranges)e.push(c?xa.prototype.deepCopy.call(f):f);else{f=f.changes;var u=[];e.push({changes:u});for(var h=0;h<f.length;++h){var k=f[h],y;u.push({from:k.from,to:k.to,text:k.text});if(b)for(var l in k)(y=l.match(/^spans_(\d+)$/))&&-1<d(b,Number(y[1]))&&(m(u)[l]=k[l],delete k[l])}}}return e}function Hd(a,b,c,d){return d?(a=a.anchor,c&&(d=0>P(b,a),d!=0>P(c,a)?(a=b,b=c):d!=0>P(b,c)&&(b=c)),new Y(a,b)):new Y(c||b,b)}function Nc(a,b,c,d,e){null==e&&(e=a.cm&&(a.cm.display.shift||a.extend));ma(a,
new xa([Hd(a.sel.primary(),b,c,e)],0),d)}function ff(a,b,c){for(var d=[],e=a.cm&&(a.cm.display.shift||a.extend),g=0;g<a.sel.ranges.length;g++)d[g]=Hd(a.sel.ranges[g],b[g],null,e);b=Da(d,a.sel.primIndex);ma(a,b,c)}function Id(a,b,c,d){var e=a.sel.ranges.slice(0);e[b]=c;ma(a,Da(e,a.sel.primIndex),d)}function Dg(a,b,c){c={ranges:b.ranges,update:function(b){this.ranges=[];for(var c=0;c<b.length;c++)this.ranges[c]=new Y(T(a,b[c].anchor),T(a,b[c].head))},origin:c&&c.origin};da(a,"beforeSelectionChange",
a,c);a.cm&&da(a.cm,"beforeSelectionChange",a.cm,c);return c.ranges!=b.ranges?Da(c.ranges,c.ranges.length-1):b}function gf(a,b,c){var d=a.history.done,e=m(d);e&&e.ranges?(d[d.length-1]=b,Oc(a,b,c)):ma(a,b,c)}function ma(a,b,c){Oc(a,b,c);b=a.sel;var d=a.cm?a.cm.curOp.id:NaN,e=a.history,g=c&&c.origin,f;if(!(f=d==e.lastSelOp)&&(f=g&&e.lastSelOrigin==g)&&!(f=e.lastModTime==e.lastSelTime&&e.lastOrigin==g)){f=m(e.done);var u=g.charAt(0);f="*"==u||"+"==u&&f.ranges.length==b.ranges.length&&f.somethingSelected()==
b.somethingSelected()&&new Date-a.history.lastSelTime<=(a.cm?a.cm.options.historyEventDelay:500)}f?e.done[e.done.length-1]=b:Mc(b,e.done);e.lastSelTime=+new Date;e.lastSelOrigin=g;e.lastSelOp=d;c&&!1!==c.clearRedo&&cf(e.undone)}function Oc(a,b,c){if(ya(a,"beforeSelectionChange")||a.cm&&ya(a.cm,"beforeSelectionChange"))b=Dg(a,b,c);var d=c&&c.bias||(0>P(b.primary().head,a.sel.primary().head)?-1:1);hf(a,jf(a,b,d,!0));c&&!1===c.scroll||!a.cm||rb(a.cm)}function hf(a,b){b.equals(a.sel)||(a.sel=b,a.cm&&
(a.cm.curOp.updateInput=a.cm.curOp.selectionChanged=!0,$d(a.cm)),la(a,"cursorActivity",a))}function kf(a){hf(a,jf(a,a.sel,null,!1))}function jf(a,b,c,d){for(var e,g=0;g<b.ranges.length;g++){var f=b.ranges[g],u=b.ranges.length==a.sel.ranges.length&&a.sel.ranges[g],h=Jd(a,f.anchor,u&&u.anchor,c,d);u=Jd(a,f.head,u&&u.head,c,d);if(e||h!=f.anchor||u!=f.head)e||(e=b.ranges.slice(0,g)),e[g]=new Y(h,u)}return e?Da(e,b.primIndex):b}function vb(a,b,c,d,e){var g=K(a,b.line);if(g.markedSpans)for(var f=0;f<g.markedSpans.length;++f){var u=
g.markedSpans[f],h=u.marker;if((null==u.from||(h.inclusiveLeft?u.from<=b.ch:u.from<b.ch))&&(null==u.to||(h.inclusiveRight?u.to>=b.ch:u.to>b.ch))){if(e&&(da(h,"beforeCursorEnter"),h.explicitlyCleared))if(g.markedSpans){--f;continue}else break;if(h.atomic){if(c){f=h.find(0>d?1:-1);u=void 0;if(0>d?h.inclusiveRight:h.inclusiveLeft)f=lf(a,f,-d,f&&f.line==b.line?g:null);if(f&&f.line==b.line&&(u=P(f,c))&&(0>d?0>u:0<u))return vb(a,f,b,d,e)}c=h.find(0>d?-1:1);if(0>d?h.inclusiveLeft:h.inclusiveRight)c=lf(a,
c,d,c.line==b.line?g:null);return c?vb(a,c,b,d,e):null}}}return b}function Jd(a,b,c,d,e){d=d||1;b=vb(a,b,c,d,e)||!e&&vb(a,b,c,d,!0)||vb(a,b,c,-d,e)||!e&&vb(a,b,c,-d,!0);return b?b:(a.cantEdit=!0,I(a.first,0))}function lf(a,b,c,d){return 0>c&&0==b.ch?b.line>a.first?T(a,I(b.line-1)):null:0<c&&b.ch==(d||K(a,b.line)).text.length?b.line<a.first+a.size-1?I(b.line+1,0):null:new I(b.line,b.ch+c)}function mf(a){a.setSelection(I(a.firstLine(),0),I(a.lastLine()),Ia)}function nf(a,b,c){var d={canceled:!1,from:b.from,
to:b.to,text:b.text,origin:b.origin,cancel:function(){return d.canceled=!0}};c&&(d.update=function(b,c,e,g){b&&(d.from=T(a,b));c&&(d.to=T(a,c));e&&(d.text=e);void 0!==g&&(d.origin=g)});da(a,"beforeChange",a,d);a.cm&&da(a.cm,"beforeChange",a.cm,d);return d.canceled?null:{from:d.from,to:d.to,text:d.text,origin:d.origin}}function wb(a,b,c){if(a.cm){if(!a.cm.curOp)return ja(a.cm,wb)(a,b,c);if(a.cm.state.suppressEdits)return}if(ya(a,"beforeChange")||a.cm&&ya(a.cm,"beforeChange"))if(b=nf(a,b,!0),!b)return;
if(c=of&&!c&&ag(a,b.from,b.to))for(var d=c.length-1;0<=d;--d)pf(a,{from:c[d].from,to:c[d].to,text:d?[""]:b.text,origin:b.origin});else pf(a,b)}function pf(a,b){if(1!=b.text.length||""!=b.text[0]||0!=P(b.from,b.to)){var c=Dd(a,b);df(a,b,c,a.cm?a.cm.curOp.id:NaN);Wb(a,b,c,qc(a,b));var e=[];ib(a,function(a,c){c||-1!=d(e,a.history)||(qf(a.history,b),e.push(a.history));Wb(a,b,null,qc(a,b))})}}function Pc(a,b,c){if(!a.cm||!a.cm.state.suppressEdits||c){for(var e=a.history,g,f=a.sel,u="undo"==b?e.done:e.undone,
h="undo"==b?e.undone:e.done,k=0;k<u.length&&(g=u[k],c?!g.ranges||g.equals(a.sel):g.ranges);k++);if(k!=u.length){for(e.lastOrigin=e.lastSelOrigin=null;;)if(g=u.pop(),g.ranges){Mc(g,h);if(c&&!g.equals(a.sel)){ma(a,g,{clearRedo:!1});return}f=g}else break;var y=[];Mc(f,h);h.push({changes:y,generation:e.generation});e.generation=g.generation||++e.maxGeneration;var l=ya(a,"beforeChange")||a.cm&&ya(a.cm,"beforeChange");c=function(c){var e=g.changes[c];e.origin=b;if(l&&!nf(a,e,!1))return u.length=0,{};y.push(Gd(a,
e));var f=c?Dd(a,e):m(u);Wb(a,e,f,ef(a,e));!c&&a.cm&&a.cm.scrollIntoView({from:e.from,to:Sa(e)});var h=[];ib(a,function(a,b){b||-1!=d(h,a.history)||(qf(a.history,e),h.push(a.history));Wb(a,e,null,ef(a,e))})};for(e=g.changes.length-1;0<=e;--e)if(f=c(e))return f.v}}}function rf(a,b){if(0!=b&&(a.first+=b,a.sel=new xa(F(a.sel.ranges,function(a){return new Y(I(a.anchor.line+b,a.anchor.ch),I(a.head.line+b,a.head.ch))}),a.sel.primIndex),a.cm)){ra(a.cm,a.first,a.first-b,b);for(var c=a.cm.display,d=c.viewFrom;d<
c.viewTo;d++)Ra(a.cm,d,"gutter")}}function Wb(a,b,c,d){if(a.cm&&!a.cm.curOp)return ja(a.cm,Wb)(a,b,c,d);if(b.to.line<a.first)rf(a,b.text.length-1-(b.to.line-b.from.line));else if(!(b.from.line>a.lastLine())){if(b.from.line<a.first){var e=b.text.length-1-(a.first-b.from.line);rf(a,e);b={from:I(a.first,0),to:I(b.to.line+e,b.to.ch),text:[m(b.text)],origin:b.origin}}e=a.lastLine();b.to.line>e&&(b={from:b.from,to:I(e,K(a,e).text.length),text:[b.text[0]],origin:b.origin});b.removed=U(a,b.from,b.to);c||
(c=Dd(a,b));a.cm?Eg(a.cm,b,d):Fd(a,b,d);Oc(a,c,Ia)}}function Eg(a,b,c){var d=a.doc,e=a.display,g=b.from,f=b.to,u=!1,h=g.line;a.options.lineWrapping||(h=M(Ea(K(d,g.line))),d.iter(h,f.line+1,function(a){if(a==e.maxLine)return u=!0}));-1<d.sel.contains(b.from,b.to)&&$d(a);Fd(d,b,c,Fe(a));a.options.lineWrapping||(d.iter(h,g.line+b.text.length,function(a){var b=wc(a);b>e.maxLineLength&&(e.maxLine=a,e.maxLineLength=b,e.maxLineChanged=!0,u=!1)}),u&&(a.curOp.updateMaxLine=!0));jg(d,g.line);Tb(a,400);c=b.text.length-
(f.line-g.line)-1;b.full?ra(a):g.line!=f.line||1!=b.text.length||Ze(a.doc,b)?ra(a,g.line,f.line+1,c):Ra(a,g.line,"text");c=ya(a,"changes");if((d=ya(a,"change"))||c)b={from:g,to:f,text:b.text,removed:b.removed,origin:b.origin},d&&la(a,"change",a,b),c&&(a.curOp.changeObjs||(a.curOp.changeObjs=[])).push(b);a.display.selForContextMenu=null}function xb(a,b,c,d,e){d||(d=c);if(0>P(d,c)){var g=[d,c];c=g[0];d=g[1];g}"string"==typeof b&&(b=a.splitLines(b));wb(a,{from:c,to:d,text:b,origin:e})}function sf(a,
b,c,d){c<a.line?a.line+=d:b<a.line&&(a.line=b,a.ch=0)}function tf(a,b,c,d){for(var e=0;e<a.length;++e){var g=a[e],f=!0;if(g.ranges)for(g.copied||(g=a[e]=g.deepCopy(),g.copied=!0),f=0;f<g.ranges.length;f++)sf(g.ranges[f].anchor,b,c,d),sf(g.ranges[f].head,b,c,d);else{for(var u=0;u<g.changes.length;++u){var h=g.changes[u];if(c<h.from.line)h.from=I(h.from.line+d,h.from.ch),h.to=I(h.to.line+d,h.to.ch);else if(b<=h.to.line){f=!1;break}}f||(a.splice(0,e+1),e=0)}}}function qf(a,b){var c=b.from.line,d=b.to.line;
b=b.text.length-(d-c)-1;tf(a.done,c,d,b);tf(a.undone,c,d,b)}function Xb(a,b,c,d){var e=b,g=b;"number"==typeof b?g=K(a,Math.max(a.first,Math.min(b,a.first+a.size-1))):e=M(b);if(null==e)return null;d(g,e)&&a.cm&&Ra(a.cm,e,c);return g}function Yb(a){this.lines=a;this.parent=null;for(var b=0,c=0;c<a.length;++c)a[c].parent=this,b+=a[c].height;this.height=b}function Zb(a){this.children=a;for(var b=0,c=0,d=0;d<a.length;++d){var e=a[d];b+=e.chunkSize();c+=e.height;e.parent=this}this.size=b;this.height=c;
this.parent=null}function Fg(a,b,c,d){var e=new $b(a,c,d),g=a.cm;g&&e.noHScroll&&(g.display.alignWidgets=!0);Xb(a,b,"widget",function(b){var c=b.widgets||(b.widgets=[]);null==e.insertAt?c.push(e):c.splice(Math.min(c.length-1,Math.max(0,e.insertAt)),0,e);e.line=b;g&&!Xa(a,b)&&(c=Fa(b)<a.scrollTop,V(b,b.height+Mb(e)),c&&Gc(g,e.height),g.curOp.forceUpdate=!0);return!0});la(g,"lineWidgetAdded",g,e,"number"==typeof b?b:M(b));return e}function yb(a,c,d,e,g){if(e&&e.shared)return Gg(a,c,d,e,g);if(a.cm&&
!a.cm.curOp)return ja(a.cm,yb)(a,c,d,e,g);var f=new Ta(a,g);g=P(c,d);e&&h(e,f,!1);if(0<g||0==g&&!1!==f.clearWhenEmpty)return f;f.replacedWith&&(f.collapsed=!0,f.widgetNode=b("span",[f.replacedWith],"CodeMirror-widget"),e.handleMouseEvents||f.widgetNode.setAttribute("cm-ignore-events","true"),e.insertLeft&&(f.widgetNode.insertLeft=!0));if(f.collapsed){if(sc(a,c.line,c,d,f)||c.line!=d.line&&sc(a,d.line,c,d,f))throw Error("Inserting collapsed marker partially overlapping an existing one");Pa=!0}f.addToHistory&&
df(a,{from:c,to:d,origin:"markText"},a.sel,NaN);var u=c.line,k=a.cm,l;a.iter(u,d.line+1,function(a){k&&f.collapsed&&!k.options.lineWrapping&&Ea(a)==k.display.maxLine&&(l=!0);f.collapsed&&u!=c.line&&V(a,0);var b=new Db(f,u==c.line?c.ch:null,u==d.line?d.ch:null);a.markedSpans=a.markedSpans?a.markedSpans.concat([b]):[b];b.marker.attachLine(a);++u});f.collapsed&&a.iter(c.line,d.line+1,function(b){Xa(a,b)&&V(b,0)});f.clearOnEnter&&O(f,"beforeCursorEnter",function(){return f.clear()});f.readOnly&&(of=!0,
(a.history.done.length||a.history.undone.length)&&a.clearHistory());f.collapsed&&(f.id=++uf,f.atomic=!0);if(k){l&&(k.curOp.updateMaxLine=!0);if(f.collapsed)ra(k,c.line,d.line+1);else if(f.className||f.title||f.startStyle||f.endStyle||f.css)for(e=c.line;e<=d.line;e++)Ra(k,e,"text");f.atomic&&kf(k.doc);la(k,"markerAdded",k,f)}return f}function Gg(a,b,c,d,e){d=h(d);d.shared=!1;var g=[yb(a,b,c,d,e)],f=g[0],u=d.widgetNode;ib(a,function(a){u&&(d.widgetNode=u.cloneNode(!0));g.push(yb(a,T(a,b),T(a,c),d,e));
for(var h=0;h<a.linked.length;++h)if(a.linked[h].isParent)return;f=m(g)});return new ac(g,f)}function vf(a){return a.findMarks(I(a.first,0),a.clipPos(I(a.lastLine())),function(a){return a.parent})}function Hg(a){for(var b=function(b){b=a[b];var c=[b.primary.doc];ib(b.primary.doc,function(a){return c.push(a)});for(var e=0;e<b.markers.length;e++){var g=b.markers[e];-1==d(c,g.doc)&&(g.parent=null,b.markers.splice(e--,1))}},c=0;c<a.length;c++)b(c)}function Ig(a){var b=this;wf(b);if(!ia(b,a)&&!Ma(b.display,
a)){qa(a);X&&(xf=+new Date);var c=db(b,a,!0),e=a.dataTransfer.files;if(c&&!b.isReadOnly())if(e&&e.length&&window.FileReader&&window.File)for(var g=e.length,f=Array(g),u=0,h=function(a,e){if(!b.options.allowDropFileTypes||-1!=d(b.options.allowDropFileTypes,a.type)){var h=new FileReader;h.onload=ja(b,function(){var a=h.result;/[\x00-\x08\x0e-\x1f]{2}/.test(a)&&(a="");f[e]=a;++u==g&&(c=T(b.doc,c),a={from:c,to:c,text:b.doc.splitLines(f.join(b.doc.lineSeparator())),origin:"paste"},wb(b.doc,a),gf(b.doc,
Na(c,Sa(a))))});h.readAsText(a)}},k=0;k<g;++k)h(e[k],k);else if(b.state.draggingText&&-1<b.doc.sel.contains(c))b.state.draggingText(a),setTimeout(function(){return b.display.input.focus()},20);else try{if(h=a.dataTransfer.getData("Text")){b.state.draggingText&&!b.state.draggingText.copy&&(k=b.listSelections());Oc(b.doc,Na(c,c));if(k)for(e=0;e<k.length;++e)xb(b.doc,"",k[e].anchor,k[e].head,"drag");b.replaceSelection(h,"around","paste");b.display.input.focus()}}catch(mh){}}}function wf(a){a.display.dragCursor&&
(a.display.lineSpace.removeChild(a.display.dragCursor),a.display.dragCursor=null)}function yf(a){if(document.getElementsByClassName)for(var b=document.getElementsByClassName("CodeMirror"),c=0;c<b.length;c++){var d=b[c].CodeMirror;d&&a(d)}}function Jg(){var a;O(window,"resize",function(){null==a&&(a=setTimeout(function(){a=null;yf(Kg)},100))});O(window,"blur",function(){return yf(Qb)})}function Kg(a){var b=a.display;if(b.lastWrapHeight!=b.wrapper.clientHeight||b.lastWrapWidth!=b.wrapper.clientWidth)b.cachedCharWidth=
b.cachedTextHeight=b.cachedPaddingH=null,b.scrollbarsClipped=!1,a.setSize()}function Lg(a){var b=a.split(/-(?!$)/);a=b[b.length-1];for(var c,d,e,g,f=0;f<b.length-1;f++){var u=b[f];if(/^(cmd|meta|m)$/i.test(u))g=!0;else if(/^a(lt)?$/i.test(u))c=!0;else if(/^(c|ctrl|control)$/i.test(u))d=!0;else if(/^s(hift)?$/i.test(u))e=!0;else throw Error("Unrecognized modifier name: "+u);}c&&(a="Alt-"+a);d&&(a="Ctrl-"+a);g&&(a="Cmd-"+a);e&&(a="Shift-"+a);return a}function Mg(a){var b={},c;for(c in a)if(a.hasOwnProperty(c)){var d=
a[c];if(!/^(name|fallthrough|(de|at)tach)$/.test(c)){if("..."!=d)for(var e=F(c.split(" "),Lg),g=0;g<e.length;g++){if(g==e.length-1){var f=e.join(" ");var u=d}else f=e.slice(0,g+1).join(" "),u="...";var h=b[f];if(!h)b[f]=u;else if(h!=u)throw Error("Inconsistent bindings for "+f);}delete a[c]}}for(var k in b)a[k]=b[k];return a}function zb(a,b,c,d){b=Qc(b);var e=b.call?b.call(a,d):b[a];if(!1===e)return"nothing";if("..."===e)return"multi";if(null!=e&&c(e))return"handled";if(b.fallthrough){if("[object Array]"!=
Object.prototype.toString.call(b.fallthrough))return zb(a,b.fallthrough,c,d);for(e=0;e<b.fallthrough.length;e++){var g=zb(a,b.fallthrough[e],c,d);if(g)return g}}}function zf(a){a="string"==typeof a?a:Ua[a.keyCode];return"Ctrl"==a||"Alt"==a||"Shift"==a||"Mod"==a}function Af(a,b,c){var d=a;b.altKey&&"Alt"!=d&&(a="Alt-"+a);(Bf?b.metaKey:b.ctrlKey)&&"Ctrl"!=d&&(a="Ctrl-"+a);(Bf?b.ctrlKey:b.metaKey)&&"Cmd"!=d&&(a="Cmd-"+a);!c&&b.shiftKey&&"Shift"!=d&&(a="Shift-"+a);return a}function Cf(a,b){if(Ca&&34==
a.keyCode&&a["char"])return!1;var c=Ua[a.keyCode];return null==c||a.altGraphKey?!1:Af(c,a,b)}function Qc(a){return"string"==typeof a?bc[a]:a}function Ab(a,b){for(var c=a.doc.sel.ranges,d=[],e=0;e<c.length;e++){for(var g=b(c[e]);d.length&&0>=P(g.from,m(d).to);){var f=d.pop();if(0>P(f.from,g.from)){g.from=f.from;break}}d.push(g)}ta(a,function(){for(var b=d.length-1;0<=b;b--)xb(a.doc,"",d[b].from,d[b].to,"+delete");rb(a)})}function Kd(a,b,c){b=J(a.text,b+c,c);return 0>b||b>a.text.length?null:b}function Ld(a,
b,c){a=Kd(a,b.ch,c);return null==a?null:new I(b.line,a,0>c?"after":"before")}function Md(a,b,c,d,e){if(a&&(a=La(c,b.doc.direction))){a=0>e?m(a):a[0];var g=0>e==(1==a.level)?"after":"before";if(0<a.level||"rtl"==b.doc.direction){var f=ab(b,c);var h=0>e?c.text.length-1:0;var u=Aa(b,f,h).top;h=E(function(a){return Aa(b,f,a).top==u},0>e==(1==a.level)?a.from:a.to-1,h);"before"==g&&(h=Kd(c,h,1))}else h=0>e?a.to:a.from;return new I(d,h,g)}return new I(d,0>e?c.text.length:0,0>e?"before":"after")}function Ng(a,
b,c,d){var e=La(b,a.doc.direction);if(!e)return Ld(b,c,d);c.ch>=b.text.length?(c.ch=b.text.length,c.sticky="before"):0>=c.ch&&(c.ch=0,c.sticky="after");var g=Fb(e,c.ch,c.sticky),f=e[g];if("ltr"==a.doc.direction&&0==f.level%2&&(0<d?f.to>c.ch:f.from<c.ch))return Ld(b,c,d);var h=function(a,c){return Kd(b,a instanceof I?a.ch:a,c)},u,k=function(c){if(!a.options.lineWrapping)return{begin:0,end:b.text.length};u=u||ab(a,b);return Ee(a,b,u,c)},l=k("before"==c.sticky?h(c,-1):c.ch);if("rtl"==a.doc.direction||
1==f.level){var y=1==f.level==0>d,r=h(c,y?1:-1);if(null!=r&&(y?r<=f.to&&r<=l.end:r>=f.from&&r>=l.begin))return new I(c.line,r,y?"before":"after")}f=function(a,b,d){for(var g=function(a,b){return b?new I(c.line,h(a,1),"before"):new I(c.line,a,"after")};0<=a&&a<e.length;a+=b){var f=e[a],u=0<b==(1!=f.level),k=u?d.begin:h(d.end,-1);if(f.from<=k&&k<f.to)return g(k,u);k=u?f.from:h(f.to,-1);if(d.begin<=k&&k<d.end)return g(k,u)}};if(g=f(g+d,d,l))return g;l=0<d?l.end:h(l.begin,-1);return null==l||0<d&&l==
b.text.length||!(g=f(0<d?0:e.length-1,d,k(l)))?null:g}function Df(a,b){var c=K(a.doc,b),d=Ea(c);d!=c&&(b=M(d));return Md(!0,a,d,b,1)}function Ef(a,b){var c=Df(a,b.line),d=K(a.doc,c.line);a=La(d,a.doc.direction);return a&&0!=a[0].level?c:(d=Math.max(0,d.text.search(/\S/)),I(c.line,b.line==c.line&&b.ch<=d&&b.ch?0:d,c.sticky))}function Rc(a,b,c){if("string"==typeof b&&(b=cc[b],!b))return!1;a.display.input.ensurePolled();var d=a.display.shift,e=!1;try{a.isReadOnly()&&(a.state.suppressEdits=!0),c&&(a.display.shift=
!1),e=b(a)!=Sc}finally{a.display.shift=d,a.state.suppressEdits=!1}return e}function dc(a,b,c,d){var e=a.state.keySeq;if(e){if(zf(b))return"handled";/\'$/.test(b)?a.state.keySeq=null:Og.set(50,function(){a.state.keySeq==e&&(a.state.keySeq=null,a.display.input.reset())});if(Ff(a,e+" "+b,c,d))return!0}return Ff(a,b,c,d)}function Ff(a,b,c,d){a:{for(var e=0;e<a.state.keyMaps.length;e++){var g=zb(b,a.state.keyMaps[e],d,a);if(g){d=g;break a}}d=a.options.extraKeys&&zb(b,a.options.extraKeys,d,a)||zb(b,a.options.keyMap,
d,a)}"multi"==d&&(a.state.keySeq=b);"handled"==d&&la(a,"keyHandled",a,b,c);if("handled"==d||"multi"==d)qa(c),ud(a);return!!d}function Gf(a,b){var c=Cf(b,!0);return c?b.shiftKey&&!a.state.keySeq?dc(a,"Shift-"+c,b,function(b){return Rc(a,b,!0)})||dc(a,c,b,function(b){if("string"==typeof b?/^go[A-Z]/.test(b):b.motion)return Rc(a,b)}):dc(a,c,b,function(b){return Rc(a,b)}):!1}function Pg(a,b,c){return dc(a,"'"+c+"'",b,function(b){return Rc(a,b,!0)})}function Hf(a){this.curOp.focus=r();if(!ia(this,a)){X&&
11>aa&&27==a.keyCode&&(a.returnValue=!1);var b=a.keyCode;this.display.shift=16==b||a.shiftKey;var c=Gf(this,a);Ca&&(Nd=c?b:null,!c&&88==b&&!Qg&&(za?a.metaKey:a.ctrlKey)&&this.replaceSelection("",null,"cut"));18!=b||/\bCodeMirror-crosshair\b/.test(this.display.lineDiv.className)||Rg(this)}}function Rg(a){function b(a){18!=a.keyCode&&a.altKey||(eb(c,"CodeMirror-crosshair"),va(document,"keyup",b),va(document,"mouseover",b))}var c=a.display.lineDiv;v(c,"CodeMirror-crosshair");O(document,"keyup",b);O(document,
"mouseover",b)}function If(a){16==a.keyCode&&(this.doc.sel.shift=!1);ia(this,a)}function Jf(a){if(!(Ma(this.display,a)||ia(this,a)||a.ctrlKey&&!a.altKey||za&&a.metaKey)){var b=a.keyCode,c=a.charCode;if(Ca&&b==Nd)Nd=null,qa(a);else if(!Ca||a.which&&!(10>a.which)||!Gf(this,a))if(b=String.fromCharCode(null==c?b:c),"\b"!=b&&!Pg(this,a,b))this.display.input.onKeyPress(a)}}function Sg(a,b){var c=+new Date;if(ec&&ec.compare(c,a,b))return fc=ec=null,"triple";if(fc&&fc.compare(c,a,b))return ec=new Od(c,a,
b),fc=null,"double";fc=new Od(c,a,b);ec=null;return"single"}function Kf(a){var b=this.display;if(!(ia(this,a)||b.activeTouch&&b.input.supportsTouch()))if(b.input.ensurePolled(),b.shift=a.shiftKey,Ma(b,a))na||(b.scroller.draggable=!1,setTimeout(function(){return b.scroller.draggable=!0},100));else if(!Tc(this,a,"gutterClick",!0)){var c=db(this,a),d=be(a),e=c?Sg(c,d):"single";window.focus();1==d&&this.state.selectingText&&this.state.selectingText(a);c&&Tg(this,d,c,e,a)||(1==d?c?Ug(this,c,e,a):(a.target||
a.srcElement)==b.scroller&&qa(a):2==d?(c&&Nc(this.doc,c),setTimeout(function(){return b.input.focus()},20)):3==d&&(Pd?Lf(this,a):Je(this)))}}function Tg(a,b,c,d,e){var g="Click";"double"==d?g="Double"+g:"triple"==d&&(g="Triple"+g);return dc(a,Af((1==b?"Left":2==b?"Middle":"Right")+g,e),e,function(b){"string"==typeof b&&(b=cc[b]);if(!b)return!1;var d=!1;try{a.isReadOnly()&&(a.state.suppressEdits=!0),d=b(a,c)!=Sc}finally{a.state.suppressEdits=!1}return d})}function Ug(a,b,c,d){X?setTimeout(k(Ie,a),
0):a.curOp.focus=r();var e=a.getOption("configureMouse");e=e?e(a,c,d):{};null==e.unit&&(e.unit=(Vg?d.shiftKey&&d.metaKey:d.altKey)?"rectangle":"single"==c?"char":"double"==c?"word":"line");if(null==e.extend||a.doc.extend)e.extend=a.doc.extend||d.shiftKey;null==e.addNew&&(e.addNew=za?d.metaKey:d.ctrlKey);null==e.moveOnDrag&&(e.moveOnDrag=!(za?d.altKey:d.ctrlKey));var g=a.doc.sel,f;a.options.dragDrop&&Wg&&!a.isReadOnly()&&"single"==c&&-1<(f=g.contains(b))&&(0>P((f=g.ranges[f]).from(),b)||0<b.xRel)&&
(0<P(f.to(),b)||0>b.xRel)?Xg(a,d,b,e):Yg(a,d,b,e)}function Xg(a,b,c,d){var e=a.display,g=!1,f=ja(a,function(b){na&&(e.scroller.draggable=!1);a.state.draggingText=!1;va(document,"mouseup",f);va(document,"mousemove",h);va(e.scroller,"dragstart",u);va(e.scroller,"drop",f);g||(qa(b),d.addNew||Nc(a.doc,c,null,null,d.extend),na||X&&9==aa?setTimeout(function(){document.body.focus();e.input.focus()},20):e.input.focus())}),h=function(a){g=g||10<=Math.abs(b.clientX-a.clientX)+Math.abs(b.clientY-a.clientY)},
u=function(){return g=!0};na&&(e.scroller.draggable=!0);a.state.draggingText=f;f.copy=!d.moveOnDrag;e.scroller.dragDrop&&e.scroller.dragDrop();O(document,"mouseup",f);O(document,"mousemove",h);O(e.scroller,"dragstart",u);O(e.scroller,"drop",f);Je(a);setTimeout(function(){return e.input.focus()},20)}function Mf(a,b,c){if("char"==c)return new Y(b,b);if("word"==c)return a.findWordAt(b);if("line"==c)return new Y(I(b.line,0),T(a.doc,I(b.line+1,0)));a=c(a,b);return new Y(a.from,a.to)}function Yg(a,b,c,
d){function f(b){if(0!=P(n,b))if(n=b,"rectangle"==d.unit){var f=[],h=a.options.tabSize,u=g(K(l,c.line).text,c.ch,h),k=g(K(l,b.line).text,b.ch,h),r=Math.min(u,k);u=Math.max(u,k);k=Math.min(c.line,b.line);for(var p=Math.min(a.lastLine(),Math.max(c.line,b.line));k<=p;k++){var q=K(l,k).text,t=e(q,r,h);r==u?f.push(new Y(I(k,t),I(k,t))):q.length>t&&f.push(new Y(I(k,t),I(k,e(q,u,h))))}f.length||f.push(new Y(c,c));ma(l,Da(y.ranges.slice(0,w).concat(f),w),{origin:"*mouse",scroll:!1});a.scrollIntoView(b)}else f=
v,r=Mf(a,b,d.unit),b=f.anchor,0<P(r.anchor,b)?(h=r.head,b=rc(f.from(),r.anchor)):(h=r.anchor,b=tc(f.to(),r.head)),f=y.ranges.slice(0),f[w]=Zg(a,new Y(T(l,b),h)),ma(l,Da(f,w),Qd)}function h(b){var c=++t,e=db(a,b,!0,"rectangle"==d.unit);if(e)if(0!=P(e,n)){a.curOp.focus=r();f(e);var g=wd(k,l);(e.line>=g.to||e.line<g.from)&&setTimeout(ja(a,function(){t==c&&h(b)}),150)}else{var u=b.clientY<q.top?-20:b.clientY>q.bottom?20:0;u&&setTimeout(ja(a,function(){t==c&&(k.scroller.scrollTop+=u,h(b))}),50)}}function u(b){a.state.selectingText=
!1;t=Infinity;qa(b);k.input.focus();va(document,"mousemove",z);va(document,"mouseup",m);l.history.lastSelOrigin=null}var k=a.display,l=a.doc;qa(b);var y=l.sel,p=y.ranges;if(d.addNew&&!d.extend){var w=l.sel.contains(c);var v=-1<w?p[w]:new Y(c,c)}else v=l.sel.primary(),w=l.sel.primIndex;"rectangle"==d.unit?(d.addNew||(v=new Y(c,c)),c=db(a,b,!0,!0),w=-1):(b=Mf(a,c,d.unit),v=d.extend?Hd(v,b.anchor,b.head,d.extend):b);d.addNew?-1==w?(w=p.length,ma(l,Da(p.concat([v]),w),{scroll:!1,origin:"*mouse"})):1<
p.length&&p[w].empty()&&"char"==d.unit&&!d.extend?(ma(l,Da(p.slice(0,w).concat(p.slice(w+1)),0),{scroll:!1,origin:"*mouse"}),y=l.sel):Id(l,w,v,Qd):(w=0,ma(l,new xa([v],0),Qd),y=l.sel);var n=c,q=k.wrapper.getBoundingClientRect(),t=0,z=ja(a,function(a){be(a)?h(a):u(a)}),m=ja(a,u);a.state.selectingText=m;O(document,"mousemove",z);O(document,"mouseup",m)}function Zg(a,b){var c=b.anchor,d=b.head,e=K(a.doc,c.line);if(0==P(c,d)&&c.sticky==d.sticky)return b;e=La(e);if(!e)return b;var g=Fb(e,c.ch,c.sticky),
f=e[g];if(f.from!=c.ch&&f.to!=c.ch)return b;var h=g+(f.from==c.ch==(1!=f.level)?0:1);if(0==h||h==e.length)return b;d.line!=c.line?a=0<(d.line-c.line)*("ltr"==a.doc.direction?1:-1):(a=Fb(e,d.ch,d.sticky),g=a-g||(d.ch-c.ch)*(1==f.level?-1:1),a=a==h-1||a==h?0>g:0<g);e=e[h+(a?-1:0)];e=(h=a==(1==e.level))?e.from:e.to;h=h?"after":"before";return c.ch==e&&c.sticky==h?b:new Y(new I(c.line,e,h),d)}function Tc(a,b,c,d){if(b.touches){var e=b.touches[0].clientX;var g=b.touches[0].clientY}else try{e=b.clientX,
g=b.clientY}catch(Zd){return!1}if(e>=Math.floor(a.display.gutters.getBoundingClientRect().right))return!1;d&&qa(b);d=a.display;var f=d.lineDiv.getBoundingClientRect();if(g>f.bottom||!ya(a,c))return $c(b);g-=f.top-d.viewOffset;for(f=0;f<a.options.gutters.length;++f){var h=d.gutters.childNodes[f];if(h&&h.getBoundingClientRect().right>=e)return e=R(a.doc,g),da(a,c,a,e,a.options.gutters[f],b),$c(b)}}function Lf(a,b){var c;(c=Ma(a.display,b))||(c=ya(a,"gutterContextMenu")?Tc(a,b,"gutterContextMenu",!1):
!1);if(!c&&!ia(a,b,"contextmenu"))a.display.input.onContextMenu(b)}function Nf(a){a.display.wrapper.className=a.display.wrapper.className.replace(/\s*cm-s-\S+/g,"")+a.options.theme.replace(/(^|\s)\s*/g," cm-s-");Ob(a)}function gc(a){Ue(a);ra(a);Le(a)}function $g(a,b,c){!b!=!(c&&c!=Bb)&&(c=a.display.dragFunctions,b=b?O:va,b(a.display.scroller,"dragstart",c.start),b(a.display.scroller,"dragenter",c.enter),b(a.display.scroller,"dragover",c.over),b(a.display.scroller,"dragleave",c.leave),b(a.display.scroller,
"drop",c.drop))}function ah(a){a.options.lineWrapping?(v(a.display.wrapper,"CodeMirror-wrap"),a.display.sizer.style.minWidth="",a.display.sizerWidth=null):(eb(a.display.wrapper,"CodeMirror-wrap"),Zc(a));td(a);ra(a);Ob(a);setTimeout(function(){return sb(a)},100)}function ca(a,b){var c=this;if(!(this instanceof ca))return new ca(a,b);this.options=b=b?h(b):{};h(Of,b,!1);Cd(b);var d=b.value;"string"==typeof d&&(d=new sa(d,b.mode,null,b.lineSeparator,b.direction));this.doc=d;var e=new ca.inputStyles[b.inputStyle](this);
a=this.display=new S(a,d,e);a.wrapper.CodeMirror=this;Ue(this);Nf(this);b.lineWrapping&&(this.display.wrapper.className+=" CodeMirror-wrap");Qe(this);this.state={keyMaps:[],overlays:[],modeGen:0,overwrite:!1,delayingBlurEvent:!1,focused:!1,suppressEdits:!1,pasteIncoming:!1,cutIncoming:!1,selectingText:!1,draggingText:!1,highlight:new jb,keySeq:null,specialChars:null};b.autofocus&&!Eb&&a.input.focus();X&&11>aa&&setTimeout(function(){return c.display.input.reset(!0)},20);bh(this);Pf||(Jg(),Pf=!0);gb(this);
this.curOp.forceUpdate=!0;$e(this,d);b.autofocus&&!Eb||this.hasFocus()?setTimeout(k(vd,this),20):Qb(this);for(var g in Uc)if(Uc.hasOwnProperty(g))Uc[g](c,b[g],Bb);Me(this);b.finishInit&&b.finishInit(this);for(d=0;d<Rd.length;++d)Rd[d](c);hb(this);na&&b.lineWrapping&&"optimizelegibility"==getComputedStyle(a.lineDiv).textRendering&&(a.lineDiv.style.textRendering="auto")}function bh(b){function c(){e.activeTouch&&(g=setTimeout(function(){return e.activeTouch=null},1E3),f=e.activeTouch,f.end=+new Date)}
function d(a,b){if(null==b.left)return!0;var c=b.left-a.left;a=b.top-a.top;return 400<c*c+a*a}var e=b.display;O(e.scroller,"mousedown",ja(b,Kf));X&&11>aa?O(e.scroller,"dblclick",ja(b,function(a){if(!ia(b,a)){var c=db(b,a);!c||Tc(b,a,"gutterClick",!0)||Ma(b.display,a)||(qa(a),a=b.findWordAt(c),Nc(b.doc,a.anchor,a.head))}})):O(e.scroller,"dblclick",function(a){return ia(b,a)||qa(a)});Pd||O(e.scroller,"contextmenu",function(a){return Lf(b,a)});var g,f={end:0};O(e.scroller,"touchstart",function(a){var c;
if(c=!ia(b,a))1!=a.touches.length?c=!1:(c=a.touches[0],c=1>=c.radiusX&&1>=c.radiusY),c=!c;c&&!Tc(b,a,"gutterClick",!0)&&(e.input.ensurePolled(),clearTimeout(g),c=+new Date,e.activeTouch={start:c,moved:!1,prev:300>=c-f.end?f:null},1==a.touches.length&&(e.activeTouch.left=a.touches[0].pageX,e.activeTouch.top=a.touches[0].pageY))});O(e.scroller,"touchmove",function(){e.activeTouch&&(e.activeTouch.moved=!0)});O(e.scroller,"touchend",function(a){var g=e.activeTouch;if(g&&!Ma(e,a)&&null!=g.left&&!g.moved&&
300>new Date-g.start){var f=b.coordsChar(e.activeTouch,"page");g=!g.prev||d(g,g.prev)?new Y(f,f):!g.prev.prev||d(g,g.prev.prev)?b.findWordAt(f):new Y(I(f.line,0),T(b.doc,I(f.line+1,0)));b.setSelection(g.anchor,g.head);b.focus();qa(a)}c()});O(e.scroller,"touchcancel",c);O(e.scroller,"scroll",function(){e.scroller.clientHeight&&(Sb(b,e.scroller.scrollTop),fb(b,e.scroller.scrollLeft,!0),da(b,"scroll",b))});O(e.scroller,"mousewheel",function(a){return We(b,a)});O(e.scroller,"DOMMouseScroll",function(a){return We(b,
a)});O(e.wrapper,"scroll",function(){return e.wrapper.scrollTop=e.wrapper.scrollLeft=0});e.dragFunctions={enter:function(a){ia(b,a)||Hb(a)},over:function(c){if(!ia(b,c)){var d=db(b,c);if(d){var e=document.createDocumentFragment();He(b,d,e);b.display.dragCursor||(b.display.dragCursor=a("div",null,"CodeMirror-cursors CodeMirror-dragcursors"),b.display.lineSpace.insertBefore(b.display.dragCursor,b.display.cursorDiv));t(b.display.dragCursor,e)}Hb(c)}},start:function(c){if(X&&(!b.state.draggingText||100>
+new Date-xf))Hb(c);else if(!ia(b,c)&&!Ma(b.display,c)&&(c.dataTransfer.setData("Text",b.getSelection()),c.dataTransfer.effectAllowed="copyMove",c.dataTransfer.setDragImage&&!Qf)){var d=a("img",null,null,"position: fixed; left: 0; top: 0;");d.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==";Ca&&(d.width=d.height=1,b.display.wrapper.appendChild(d),d._top=d.offsetTop);c.dataTransfer.setDragImage(d,0,0);Ca&&d.parentNode.removeChild(d)}},drop:ja(b,Ig),leave:function(a){ia(b,
a)||wf(b)}};var h=e.input.getField();O(h,"keyup",function(a){return If.call(b,a)});O(h,"keydown",ja(b,Hf));O(h,"keypress",ja(b,Jf));O(h,"focus",function(a){return vd(b,a)});O(h,"blur",function(a){return Qb(b,a)})}function hc(a,b,c,d){var e=a.doc,f;null==c&&(c="add");"smart"==c&&(e.mode.indent?f=Ib(a,b).state:c="prev");var h=a.options.tabSize,u=K(e,b),k=g(u.text,null,h);u.stateAfter&&(u.stateAfter=null);var l=u.text.match(/^\s*/)[0];if(!d&&!/\S/.test(u.text)){var r=0;c="not"}else if("smart"==c&&(r=
e.mode.indent(f,u.text.slice(l.length),u.text),r==Sc||150<r)){if(!d)return;c="prev"}"prev"==c?r=b>e.first?g(K(e,b-1).text,null,h):0:"add"==c?r=k+a.options.indentUnit:"subtract"==c?r=k-a.options.indentUnit:"number"==typeof c&&(r=k+c);r=Math.max(0,r);c="";d=0;if(a.options.indentWithTabs)for(a=Math.floor(r/h);a;--a)d+=h,c+="\t";d<r&&(c+=w(r-d));if(c!=l)return xb(e,c,I(b,0),I(b,l.length),"+input"),u.stateAfter=null,!0;for(h=0;h<e.sel.ranges.length;h++)if(u=e.sel.ranges[h],u.head.line==b&&u.head.ch<l.length){b=
I(b,l.length);Id(e,h,new Y(b,b));break}}function Sd(a,b,c,d,e){var g=a.doc;a.display.shift=!1;d||(d=g.sel);var f=a.state.pasteIncoming||"paste"==e,h=Td(b),k=null;if(f&&1<d.ranges.length)if(ua&&ua.text.join("\n")==b){if(0==d.ranges.length%ua.text.length){k=[];for(var u=0;u<ua.text.length;u++)k.push(g.splitLines(ua.text[u]))}}else h.length==d.ranges.length&&a.options.pasteLinesPerSelection&&(k=F(h,function(a){return[a]}));for(u=d.ranges.length-1;0<=u;u--){var l=d.ranges[u];var r=l.from(),p=l.to();l.empty()&&
(c&&0<c?r=I(r.line,r.ch-c):a.state.overwrite&&!f?p=I(p.line,Math.min(K(g,p.line).text.length,p.ch+m(h).length)):ua&&ua.lineWise&&ua.text.join("\n")==b&&(r=p=I(r.line,0)));l=a.curOp.updateInput;r={from:r,to:p,text:k?k[u%k.length]:h,origin:e||(f?"paste":a.state.cutIncoming?"cut":"+input")};wb(a.doc,r);la(a,"inputRead",a,r)}b&&!f&&Rf(a,b);rb(a);a.curOp.updateInput=l;a.curOp.typing=!0;a.state.pasteIncoming=a.state.cutIncoming=!1}function Sf(a,b){var c=a.clipboardData&&a.clipboardData.getData("Text");
if(c)return a.preventDefault(),b.isReadOnly()||b.options.disableInput||ta(b,function(){return Sd(b,c,0,null,"paste")}),!0}function Rf(a,b){if(a.options.electricChars&&a.options.smartIndent)for(var c=a.doc.sel,d=c.ranges.length-1;0<=d;d--){var e=c.ranges[d];if(!(100<e.head.ch||d&&c.ranges[d-1].head.line==e.head.line)){var g=a.getModeAt(e.head),f=!1;if(g.electricChars)for(var h=0;h<g.electricChars.length;h++){if(-1<b.indexOf(g.electricChars.charAt(h))){f=hc(a,e.head.line,"smart");break}}else g.electricInput&&
g.electricInput.test(K(a.doc,e.head.line).text.slice(0,e.head.ch))&&(f=hc(a,e.head.line,"smart"));f&&la(a,"electricInput",a,e.head.line)}}}function Tf(a){for(var b=[],c=[],d=0;d<a.doc.sel.ranges.length;d++){var e=a.doc.sel.ranges[d].head.line;e={anchor:I(e,0),head:I(e+1,0)};c.push(e);b.push(a.getRange(e.anchor,e.head))}return{text:b,ranges:c}}function Uf(a,b){a.setAttribute("autocorrect","off");a.setAttribute("autocapitalize","off");a.setAttribute("spellcheck",!!b)}function Vf(){var b=a("textarea",
null,null,"position: absolute; bottom: -1em; padding: 0; width: 1px; height: 1em; outline: none"),c=a("div",[b],null,"overflow: hidden; position: relative; width: 3px; height: 0px;");na?b.style.width="1000px":b.setAttribute("wrap","off");ic&&(b.style.border="1px solid black");Uf(b);return c}function Ud(a,b,c,d,e){function g(d){var g=e?Ng(a.cm,k,b,c):Ld(k,b,c);if(null==g){if(d=!d)d=b.line+c,d<a.first||d>=a.first+a.size?d=!1:(b=new I(d,b.ch,b.sticky),d=k=K(a,d));if(d)b=Md(e,a.cm,k,b.line,c);else return!1}else b=
g;return!0}var f=b,h=c,k=K(a,b.line);if("char"==d)g();else if("column"==d)g(!0);else if("word"==d||"group"==d){var u=null;d="group"==d;for(var l=a.cm&&a.cm.getHelper(b,"wordChars"),r=!0;!(0>c)||g(!r);r=!1){var p=k.text.charAt(b.ch)||"\n";p=z(p,l)?"w":d&&"\n"==p?"n":!d||/\s/.test(p)?null:"p";!d||r||p||(p="s");if(u&&u!=p){0>c&&(c=1,g(),b.sticky="after");break}p&&(u=p);if(0<c&&!g(!r))break}}h=Jd(a,b,f,h,!0);Va(f,h)&&(h.hitSide=!0);return h}function Wf(a,b,c,d){var e=a.doc,g=b.left;if("page"==d){var f=
Math.max(Math.min(a.display.wrapper.clientHeight,window.innerHeight||document.documentElement.clientHeight)-.5*bb(a.display),3);f=(0<c?b.bottom:b.top)+c*f}else"line"==d&&(f=0<c?b.bottom+3:b.top-3);for(;;){b=qd(a,g,f);if(!b.outside)break;if(0>c?0>=f:f>=e.height){b.hitSide=!0;break}f+=5*c}return b}function Xf(a,b){var c=kd(a,b.line);if(!c||c.hidden)return null;var d=K(a.doc,b.line);c=ue(c,d,b.line);a=La(d,a.doc.direction);d="left";a&&(d=Fb(a,b.ch)%2?"right":"left");b=ve(c.map,b.ch,d);b.offset="right"==
b.collapse?b.end:b.start;return b}function ch(a){for(;a;a=a.parentNode)if(/CodeMirror-gutter-wrapper/.test(a.className))return!0;return!1}function Cb(a,b){b&&(a.bad=!0);return a}function dh(a,b,c,d,e){function g(a){return function(b){return b.id==a}}function f(a){a&&(u&&(k+=l,u=!1),k+=a)}function h(b){if(1==b.nodeType){var c=b.getAttribute("cm-text");if(null!=c)f(c||b.textContent.replace(/\u200b/g,""));else{c=b.getAttribute("cm-marker");var r;if(c)b=a.findMarks(I(d,0),I(e+1,0),g(+c)),b.length&&(r=
b[0].find(0))&&f(U(a.doc,r.from,r.to).join(l));else if("false"!=b.getAttribute("contenteditable")){(r=/^(pre|div|p)$/i.test(b.nodeName))&&u&&(k+=l,u=!1);for(c=0;c<b.childNodes.length;c++)h(b.childNodes[c]);r&&(u=!0)}}}else 3==b.nodeType&&f(b.nodeValue)}for(var k="",u=!1,l=a.doc.lineSeparator();;){h(b);if(b==c)break;b=b.nextSibling}return k}function Vc(a,b,c){if(b==a.display.lineDiv){var d=a.display.lineDiv.childNodes[c];if(!d)return Cb(a.clipPos(I(a.display.viewTo-1)),!0);b=null;c=0}else for(d=b;;d=
d.parentNode){if(!d||d==a.display.lineDiv)return null;if(d.parentNode&&d.parentNode==a.display.lineDiv)break}for(var e=0;e<a.display.view.length;e++){var g=a.display.view[e];if(g.node==d)return eh(g,b,c)}}function eh(a,b,c){function d(b,c,d){for(var e=-1;e<(u?u.length:0);e++)for(var g=0>e?k.map:u[e],f=0;f<g.length;f+=3){var h=g[f+2];if(h==b||h==c){c=M(0>e?a.line:a.rest[e]);e=g[f]+d;if(0>d||h!=b)e=g[f+(d?1:0)];return I(c,e)}}}var e=a.text.firstChild,g=!1;if(!b||!l(e,b))return Cb(I(M(a.line),0),!0);
if(b==e&&(g=!0,b=e.childNodes[c],c=0,!b))return c=a.rest?m(a.rest):a.line,Cb(I(M(c),c.text.length),g);var f=3==b.nodeType?b:null,h=b;f||1!=b.childNodes.length||3!=b.firstChild.nodeType||(f=b.firstChild,c&&(c=f.nodeValue.length));for(;h.parentNode!=e;)h=h.parentNode;var k=a.measure,u=k.maps;if(b=d(f,h,c))return Cb(b,g);e=h.nextSibling;for(f=f?f.nodeValue.length-c:0;e;e=e.nextSibling){if(b=d(e,e.firstChild,0))return Cb(I(b.line,b.ch-f),g);f+=e.textContent.length}for(h=h.previousSibling;h;h=h.previousSibling){if(b=
d(h,h.firstChild,-1))return Cb(I(b.line,b.ch+c),g);c+=h.textContent.length}}var pa=navigator.userAgent,Yf=navigator.platform,Oa=/gecko\/\d/i.test(pa),Zf=/MSIE \d/.test(pa),$f=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(pa),jc=/Edge\/(\d+)/.exec(pa),X=Zf||$f||jc,aa=X&&(Zf?document.documentMode||6:+(jc||$f)[1]),na=!jc&&/WebKit\//.test(pa),fh=na&&/Qt\/\d+\.\d+/.test(pa),Bc=!jc&&/Chrome\//.test(pa),Ca=/Opera\//.test(pa),Qf=/Apple Computer/.test(navigator.vendor),gh=/Mac OS X 1\d\D([8-9]|\d\d)\D/.test(pa),
xg=/PhantomJS/.test(pa),ic=!jc&&/AppleWebKit/.test(pa)&&/Mobile\/\w+/.test(pa),Cc=/Android/.test(pa),Eb=ic||Cc||/webOS|BlackBerry|Opera Mini|Opera Mobi|IEMobile/i.test(pa),za=ic||/Mac/.test(Yf),Vg=/\bCrOS\b/.test(pa),hh=/win/i.test(Yf),kb=Ca&&pa.match(/Version\/(\d*\.\d*)/);kb&&(kb=Number(kb[1]));kb&&15<=kb&&(Ca=!1,na=!0);var Bf=za&&(fh||Ca&&(null==kb||12.11>kb)),Pd=Oa||X&&9<=aa,eb=function(a,b){var d=a.className;if(b=c(b).exec(d)){var e=d.slice(b.index+b[0].length);a.className=d.slice(0,b.index)+
(e?b[1]+e:"")}};var Jb=document.createRange?function(a,b,c,d){var e=document.createRange();e.setEnd(d||a,c);e.setStart(a,b);return e}:function(a,b,c){var d=document.body.createTextRange();try{d.moveToElementText(a.parentNode)}catch(N){return d}d.collapse(!0);d.moveEnd("character",c);d.moveStart("character",b);return d};var kc=function(a){a.select()};ic?kc=function(a){a.selectionStart=0;a.selectionEnd=a.value.length}:X&&(kc=function(a){try{a.select()}catch(y){}});var jb=function(){this.id=null};jb.prototype.set=
function(a,b){clearTimeout(this.id);this.id=setTimeout(b,a)};var Sc={toString:function(){return"CodeMirror.Pass"}},Ia={scroll:!1},Qd={origin:"*mouse"},lc={origin:"+move"},vc=[""],bg=/[\u00df\u0587\u0590-\u05f4\u0600-\u06ff\u3040-\u309f\u30a0-\u30ff\u3400-\u4db5\u4e00-\u9fcc\uac00-\ud7af]/,cg=/[\u0300-\u036f\u0483-\u0489\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065e\u0670\u06d6-\u06dc\u06de-\u06e4\u06e7\u06e8\u06ea-\u06ed\u0711\u0730-\u074a\u07a6-\u07b0\u07eb-\u07f3\u0816-\u0819\u081b-\u0823\u0825-\u0827\u0829-\u082d\u0900-\u0902\u093c\u0941-\u0948\u094d\u0951-\u0955\u0962\u0963\u0981\u09bc\u09be\u09c1-\u09c4\u09cd\u09d7\u09e2\u09e3\u0a01\u0a02\u0a3c\u0a41\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a70\u0a71\u0a75\u0a81\u0a82\u0abc\u0ac1-\u0ac5\u0ac7\u0ac8\u0acd\u0ae2\u0ae3\u0b01\u0b3c\u0b3e\u0b3f\u0b41-\u0b44\u0b4d\u0b56\u0b57\u0b62\u0b63\u0b82\u0bbe\u0bc0\u0bcd\u0bd7\u0c3e-\u0c40\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c62\u0c63\u0cbc\u0cbf\u0cc2\u0cc6\u0ccc\u0ccd\u0cd5\u0cd6\u0ce2\u0ce3\u0d3e\u0d41-\u0d44\u0d4d\u0d57\u0d62\u0d63\u0dca\u0dcf\u0dd2-\u0dd4\u0dd6\u0ddf\u0e31\u0e34-\u0e3a\u0e47-\u0e4e\u0eb1\u0eb4-\u0eb9\u0ebb\u0ebc\u0ec8-\u0ecd\u0f18\u0f19\u0f35\u0f37\u0f39\u0f71-\u0f7e\u0f80-\u0f84\u0f86\u0f87\u0f90-\u0f97\u0f99-\u0fbc\u0fc6\u102d-\u1030\u1032-\u1037\u1039\u103a\u103d\u103e\u1058\u1059\u105e-\u1060\u1071-\u1074\u1082\u1085\u1086\u108d\u109d\u135f\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17b7-\u17bd\u17c6\u17c9-\u17d3\u17dd\u180b-\u180d\u18a9\u1920-\u1922\u1927\u1928\u1932\u1939-\u193b\u1a17\u1a18\u1a56\u1a58-\u1a5e\u1a60\u1a62\u1a65-\u1a6c\u1a73-\u1a7c\u1a7f\u1b00-\u1b03\u1b34\u1b36-\u1b3a\u1b3c\u1b42\u1b6b-\u1b73\u1b80\u1b81\u1ba2-\u1ba5\u1ba8\u1ba9\u1c2c-\u1c33\u1c36\u1c37\u1cd0-\u1cd2\u1cd4-\u1ce0\u1ce2-\u1ce8\u1ced\u1dc0-\u1de6\u1dfd-\u1dff\u200c\u200d\u20d0-\u20f0\u2cef-\u2cf1\u2de0-\u2dff\u302a-\u302f\u3099\u309a\ua66f-\ua672\ua67c\ua67d\ua6f0\ua6f1\ua802\ua806\ua80b\ua825\ua826\ua8c4\ua8e0-\ua8f1\ua926-\ua92d\ua947-\ua951\ua980-\ua982\ua9b3\ua9b6-\ua9b9\ua9bc\uaa29-\uaa2e\uaa31\uaa32\uaa35\uaa36\uaa43\uaa4c\uaab0\uaab2-\uaab4\uaab7\uaab8\uaabe\uaabf\uaac1\uabe5\uabe8\uabed\udc00-\udfff\ufb1e\ufe00-\ufe0f\ufe20-\ufe26\uff9e\uff9f]/,
of=!1,Pa=!1,Gb=null,eg=function(){function a(a){return 247>=a?"bbbbbbbbbtstwsbbbbbbbbbbbbbbssstwNN%%%NNNNNN,N,N1111111111NNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNNNLLLLLLLLLLLLLLLLLLLLLLLLLLNNNNbbbbbbsbbbbbbbbbbbbbbbbbbbbbbbbbb,N%%%%NNNNLNNNNN%%11NLNNN1LNNNNNLLLLLLLLLLLLLLLLLLLLLLLNLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLLN".charAt(a):1424<=a&&1524>=a?"R":1536<=a&&1785>=a?"nnnnnnNNr%%r,rNNmmmmmmmmmmmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmmmmmmmmmmmmmmmnnnnnnnnnn%nnrrrmrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrrmmmmmmmnNmmmmmmrrmmNmmmmrr1111111111".charAt(a-
1536):1774<=a&&2220>=a?"r":8192<=a&&8203>=a?"w":8204==a?"b":"L"}function b(a,b,c){this.level=a;this.from=b;this.to=c}var c=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/,d=/[stwN]/,e=/[LRr]/,g=/[Lb1n]/,f=/[1n]/;return function(h,k){var u="ltr"==k?"L":"R";if(0==h.length||"ltr"==k&&!c.test(h))return!1;for(var l=h.length,r=[],p=0;p<l;++p)r.push(a(h.charCodeAt(p)));p=0;for(var w=u;p<l;++p){var v=r[p];"m"==v?r[p]=w:w=v}p=0;for(w=u;p<l;++p)v=r[p],"1"==v&&"r"==w?r[p]="n":e.test(v)&&(w=v,"r"==v&&(r[p]="R"));
p=1;for(w=r[0];p<l-1;++p)v=r[p],"+"==v&&"1"==w&&"1"==r[p+1]?r[p]="1":","!=v||w!=r[p+1]||"1"!=w&&"n"!=w||(r[p]=w),w=v;for(p=0;p<l;++p)if(w=r[p],","==w)r[p]="N";else if("%"==w){for(w=p+1;w<l&&"%"==r[w];++w);for(v=p&&"!"==r[p-1]||w<l&&"1"==r[w]?"1":"N";p<w;++p)r[p]=v;p=w-1}p=0;for(w=u;p<l;++p)v=r[p],"L"==w&&"1"==v?r[p]="L":e.test(v)&&(w=v);for(w=0;w<l;++w)if(d.test(r[w])){for(p=w+1;p<l&&d.test(r[p]);++p);v="L"==(w?r[w-1]:u);for(v=v==("L"==(p<l?r[p]:u))?v?"L":"R":u;w<p;++w)r[w]=v;w=p-1}u=[];var n;for(p=
0;p<l;)if(g.test(r[p])){w=p;for(++p;p<l&&g.test(r[p]);++p);u.push(new b(0,w,p))}else{var q=p;w=u.length;for(++p;p<l&&"L"!=r[p];++p);for(v=q;v<p;)if(f.test(r[v])){q<v&&u.splice(w,0,new b(1,q,v));q=v;for(++v;v<p&&f.test(r[v]);++v);u.splice(w,0,new b(2,q,v));q=v}else++v;q<p&&u.splice(w,0,new b(1,q,p))}"ltr"==k&&(1==u[0].level&&(n=h.match(/^\s+/))&&(u[0].from=n[0].length,u.unshift(new b(0,0,n[0].length))),1==m(u).level&&(n=h.match(/\s+$/))&&(m(u).to-=n[0].length,u.push(new b(0,l-n[0].length,l))));return"rtl"==
k?u.reverse():u}}(),xc=[],O=function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):(a=a._handlers||(a._handlers={}),a[b]=(a[b]||xc).concat(c))},Wg=function(){if(X&&9>aa)return!1;var b=a("div");return"draggable"in b||"dragDrop"in b}(),ad,gd,Td=3!="\n\nb".split(/\n/).length?function(a){for(var b=0,c=[],d=a.length;b<=d;){var e=a.indexOf("\n",b);-1==e&&(e=a.length);var g=a.slice(b,"\r"==a.charAt(e-1)?e-1:e),f=g.indexOf("\r");-1!=f?(c.push(g.slice(0,f)),b+=
f+1):(c.push(g),b=e+1)}return c}:function(a){return a.split(/\r\n?|\n/)},ih=window.getSelection?function(a){try{return a.selectionStart!=a.selectionEnd}catch(y){return!1}}:function(a){try{var b=a.ownerDocument.selection.createRange()}catch(Q){}return b&&b.parentElement()==a?0!=b.compareEndPoints("StartToEnd",b):!1},Qg=function(){var b=a("div");if("oncopy"in b)return!0;b.setAttribute("oncopy","return;");return"function"==typeof b.oncopy}(),md=null,bd={},ob={},pb={},ea=function(a,b,c){this.pos=this.start=
0;this.string=a;this.tabSize=b||8;this.lineStart=this.lastColumnPos=this.lastColumnValue=0;this.lineOracle=c};ea.prototype.eol=function(){return this.pos>=this.string.length};ea.prototype.sol=function(){return this.pos==this.lineStart};ea.prototype.peek=function(){return this.string.charAt(this.pos)||void 0};ea.prototype.next=function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)};ea.prototype.eat=function(a){var b=this.string.charAt(this.pos);if("string"==typeof a?b==a:b&&
(a.test?a.test(b):a(b)))return++this.pos,b};ea.prototype.eatWhile=function(a){for(var b=this.pos;this.eat(a););return this.pos>b};ea.prototype.eatSpace=function(){for(var a=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>a};ea.prototype.skipToEnd=function(){this.pos=this.string.length};ea.prototype.skipTo=function(a){a=this.string.indexOf(a,this.pos);if(-1<a)return this.pos=a,!0};ea.prototype.backUp=function(a){this.pos-=a};ea.prototype.column=function(){this.lastColumnPos<
this.start&&(this.lastColumnValue=g(this.string,this.start,this.tabSize,this.lastColumnPos,this.lastColumnValue),this.lastColumnPos=this.start);return this.lastColumnValue-(this.lineStart?g(this.string,this.lineStart,this.tabSize):0)};ea.prototype.indentation=function(){return g(this.string,null,this.tabSize)-(this.lineStart?g(this.string,this.lineStart,this.tabSize):0)};ea.prototype.match=function(a,b,c){if("string"==typeof a){var d=function(a){return c?a.toLowerCase():a},e=this.string.substr(this.pos,
a.length);if(d(e)==d(a))return!1!==b&&(this.pos+=a.length),!0}else{if((a=this.string.slice(this.pos).match(a))&&0<a.index)return null;a&&!1!==b&&(this.pos+=a[0].length);return a}};ea.prototype.current=function(){return this.string.slice(this.start,this.pos)};ea.prototype.hideFirstChars=function(a,b){this.lineStart+=a;try{return b()}finally{this.lineStart-=a}};ea.prototype.lookAhead=function(a){var b=this.lineOracle;return b&&b.lookAhead(a)};ea.prototype.baseToken=function(){var a=this.lineOracle;
return a&&a.baseToken(this.pos)};var zc=function(a,b){this.state=a;this.lookAhead=b},Ga=function(a,b,c,d){this.state=b;this.doc=a;this.line=c;this.maxLookAhead=d||0;this.baseTokens=null;this.baseTokenPos=1};Ga.prototype.lookAhead=function(a){var b=this.doc.getLine(this.line+a);null!=b&&a>this.maxLookAhead&&(this.maxLookAhead=a);return b};Ga.prototype.baseToken=function(a){if(!this.baseTokens)return null;for(;this.baseTokens[this.baseTokenPos]<=a;)this.baseTokenPos+=2;var b=this.baseTokens[this.baseTokenPos+
1];return{type:b&&b.replace(/( |^)overlay .*/,""),size:this.baseTokens[this.baseTokenPos]-a}};Ga.prototype.nextLine=function(){this.line++;0<this.maxLookAhead&&this.maxLookAhead--};Ga.fromSaved=function(a,b,c){return b instanceof zc?new Ga(a,Ya(a.mode,b.state),c,b.lookAhead):new Ga(a,Ya(a.mode,b),c)};Ga.prototype.save=function(a){a=!1!==a?Ya(this.doc.mode,this.state):this.state;return 0<this.maxLookAhead?new zc(a,this.maxLookAhead):a};var ie=function(a,b,c){this.start=a.start;this.end=a.pos;this.string=
a.current();this.type=b||null;this.state=c},tb=function(a,b,c){this.text=a;Wd(this,b);this.height=c?c(this):1};tb.prototype.lineNo=function(){return M(this)};nb(tb);var lg={},kg={},qb=null,Kb=null,we={left:0,right:0,top:0,bottom:0},cb,lb=function(b,c,d){this.cm=d;var e=this.vert=a("div",[a("div",null,null,"min-width: 1px")],"CodeMirror-vscrollbar"),g=this.horiz=a("div",[a("div",null,null,"height: 100%; min-height: 1px")],"CodeMirror-hscrollbar");b(e);b(g);O(e,"scroll",function(){e.clientHeight&&c(e.scrollTop,
"vertical")});O(g,"scroll",function(){g.clientWidth&&c(g.scrollLeft,"horizontal")});this.checkedZeroWidth=!1;X&&8>aa&&(this.horiz.style.minHeight=this.vert.style.minWidth="18px")};lb.prototype.update=function(a){var b=a.scrollWidth>a.clientWidth+1,c=a.scrollHeight>a.clientHeight+1,d=a.nativeBarWidth;c?(this.vert.style.display="block",this.vert.style.bottom=b?d+"px":"0",this.vert.firstChild.style.height=Math.max(0,a.scrollHeight-a.clientHeight+(a.viewHeight-(b?d:0)))+"px"):(this.vert.style.display=
"",this.vert.firstChild.style.height="0");b?(this.horiz.style.display="block",this.horiz.style.right=c?d+"px":"0",this.horiz.style.left=a.barLeft+"px",this.horiz.firstChild.style.width=Math.max(0,a.scrollWidth-a.clientWidth+(a.viewWidth-a.barLeft-(c?d:0)))+"px"):(this.horiz.style.display="",this.horiz.firstChild.style.width="0");!this.checkedZeroWidth&&0<a.clientHeight&&(0==d&&this.zeroWidthHack(),this.checkedZeroWidth=!0);return{right:c?d:0,bottom:b?d:0}};lb.prototype.setScrollLeft=function(a){this.horiz.scrollLeft!=
a&&(this.horiz.scrollLeft=a);this.disableHoriz&&this.enableZeroWidthBar(this.horiz,this.disableHoriz,"horiz")};lb.prototype.setScrollTop=function(a){this.vert.scrollTop!=a&&(this.vert.scrollTop=a);this.disableVert&&this.enableZeroWidthBar(this.vert,this.disableVert,"vert")};lb.prototype.zeroWidthHack=function(){this.horiz.style.height=this.vert.style.width=za&&!gh?"12px":"18px";this.horiz.style.pointerEvents=this.vert.style.pointerEvents="none";this.disableHoriz=new jb;this.disableVert=new jb};lb.prototype.enableZeroWidthBar=
function(a,b,c){function d(){var e=a.getBoundingClientRect();("vert"==c?document.elementFromPoint(e.right-1,(e.top+e.bottom)/2):document.elementFromPoint((e.right+e.left)/2,e.bottom-1))!=a?a.style.pointerEvents="none":b.set(1E3,d)}a.style.pointerEvents="auto";b.set(1E3,d)};lb.prototype.clear=function(){var a=this.horiz.parentNode;a.removeChild(this.horiz);a.removeChild(this.vert)};var mc=function(){};mc.prototype.update=function(){return{bottom:0,right:0}};mc.prototype.setScrollLeft=function(){};
mc.prototype.setScrollTop=function(){};mc.prototype.clear=function(){};var Re={"native":lb,"null":mc},wg=0,Ic=function(a,b,c){var d=a.display;this.viewport=b;this.visible=wd(d,a.doc,b);this.editorIsHidden=!d.wrapper.offsetWidth;this.wrapperHeight=d.wrapper.clientHeight;this.wrapperWidth=d.wrapper.clientWidth;this.oldDisplayWidth=Za(a);this.force=c;this.dims=ld(a);this.events=[]};Ic.prototype.signal=function(a,b){ya(a,b)&&this.events.push(arguments)};Ic.prototype.finish=function(){for(var a=0;a<this.events.length;a++)da.apply(null,
this.events[a])};var Kc=0,wa=null;X?wa=-.53:Oa?wa=15:Bc?wa=-.7:Qf&&(wa=-1/3);var xa=function(a,b){this.ranges=a;this.primIndex=b};xa.prototype.primary=function(){return this.ranges[this.primIndex]};xa.prototype.equals=function(a){if(a==this)return!0;if(a.primIndex!=this.primIndex||a.ranges.length!=this.ranges.length)return!1;for(var b=0;b<this.ranges.length;b++){var c=this.ranges[b],d=a.ranges[b];if(!Va(c.anchor,d.anchor)||!Va(c.head,d.head))return!1}return!0};xa.prototype.deepCopy=function(){for(var a=
[],b=0;b<this.ranges.length;b++)a[b]=new Y(Wa(this.ranges[b].anchor),Wa(this.ranges[b].head));return new xa(a,this.primIndex)};xa.prototype.somethingSelected=function(){for(var a=0;a<this.ranges.length;a++)if(!this.ranges[a].empty())return!0;return!1};xa.prototype.contains=function(a,b){b||(b=a);for(var c=0;c<this.ranges.length;c++){var d=this.ranges[c];if(0<=P(b,d.from())&&0>=P(a,d.to()))return c}return-1};var Y=function(a,b){this.anchor=a;this.head=b};Y.prototype.from=function(){return rc(this.anchor,
this.head)};Y.prototype.to=function(){return tc(this.anchor,this.head)};Y.prototype.empty=function(){return this.head.line==this.anchor.line&&this.head.ch==this.anchor.ch};Yb.prototype={chunkSize:function(){return this.lines.length},removeInner:function(a,b){for(var c=a,d=a+b;c<d;++c){var e=this.lines[c];this.height-=e.height;var g=e;g.parent=null;mb(g);la(e,"delete")}this.lines.splice(a,b)},collapse:function(a){a.push.apply(a,this.lines)},insertInner:function(a,b,c){this.height+=c;this.lines=this.lines.slice(0,
a).concat(b).concat(this.lines.slice(a));for(a=0;a<b.length;++a)b[a].parent=this},iterN:function(a,b,c){for(b=a+b;a<b;++a)if(c(this.lines[a]))return!0}};Zb.prototype={chunkSize:function(){return this.size},removeInner:function(a,b){this.size-=b;for(var c=0;c<this.children.length;++c){var d=this.children[c],e=d.chunkSize();if(a<e){var g=Math.min(b,e-a),f=d.height;d.removeInner(a,g);this.height-=f-d.height;e==g&&(this.children.splice(c--,1),d.parent=null);if(0==(b-=g))break;a=0}else a-=e}25>this.size-
b&&(1<this.children.length||!(this.children[0]instanceof Yb))&&(a=[],this.collapse(a),this.children=[new Yb(a)],this.children[0].parent=this)},collapse:function(a){for(var b=0;b<this.children.length;++b)this.children[b].collapse(a)},insertInner:function(a,b,c){this.size+=b.length;this.height+=c;for(var d=0;d<this.children.length;++d){var e=this.children[d],g=e.chunkSize();if(a<=g){e.insertInner(a,b,c);if(e.lines&&50<e.lines.length){for(b=a=e.lines.length%25+25;b<e.lines.length;)c=new Yb(e.lines.slice(b,
b+=25)),e.height-=c.height,this.children.splice(++d,0,c),c.parent=this;e.lines=e.lines.slice(0,a);this.maybeSpill()}break}a-=g}},maybeSpill:function(){if(!(10>=this.children.length)){var a=this;do{var b=a.children.splice(a.children.length-5,5);b=new Zb(b);if(a.parent){a.size-=b.size;a.height-=b.height;var c=d(a.parent.children,a);a.parent.children.splice(c+1,0,b)}else c=new Zb(a.children),c.parent=a,a.children=[c,b],a=c;b.parent=a.parent}while(10<a.children.length);a.parent.maybeSpill()}},iterN:function(a,
b,c){for(var d=0;d<this.children.length;++d){var e=this.children[d],g=e.chunkSize();if(a<g){g=Math.min(b,g-a);if(e.iterN(a,g,c))return!0;if(0==(b-=g))break;a=0}else a-=g}}};var $b=function(a,b,c){if(c)for(var d in c)c.hasOwnProperty(d)&&(this[d]=c[d]);this.doc=a;this.node=b};$b.prototype.clear=function(){var a=this.doc.cm,b=this.line.widgets,c=this.line,d=M(c);if(null!=d&&b){for(var e=0;e<b.length;++e)b[e]==this&&b.splice(e--,1);b.length||(c.widgets=null);var g=Mb(this);V(c,Math.max(0,c.height-g));
a&&(ta(a,function(){var b=-g;Fa(c)<(a.curOp&&a.curOp.scrollTop||a.doc.scrollTop)&&Gc(a,b);Ra(a,d,"widget")}),la(a,"lineWidgetCleared",a,this,d))}};$b.prototype.changed=function(){var a=this,b=this.height,c=this.doc.cm,d=this.line;this.height=null;var e=Mb(this)-b;e&&(V(d,d.height+e),c&&ta(c,function(){c.curOp.forceUpdate=!0;Fa(d)<(c.curOp&&c.curOp.scrollTop||c.doc.scrollTop)&&Gc(c,e);la(c,"lineWidgetChanged",c,a,M(d))}))};nb($b);var uf=0,Ta=function(a,b){this.lines=[];this.type=b;this.doc=a;this.id=
++uf};Ta.prototype.clear=function(){if(!this.explicitlyCleared){var a=this.doc.cm,b=a&&!a.curOp;b&&gb(a);if(ya(this,"clear")){var c=this.find();c&&la(this,"clear",c.from,c.to)}for(var d=c=null,e=0;e<this.lines.length;++e){var g=this.lines[e],f=Ja(g.markedSpans,this);a&&!this.collapsed?Ra(a,M(g),"text"):a&&(null!=f.to&&(d=M(g)),null!=f.from&&(c=M(g)));for(var h=g,k=void 0,l=g.markedSpans,r=f,p=0;p<l.length;++p)l[p]!=r&&(k||(k=[])).push(l[p]);h.markedSpans=k;null==f.from&&this.collapsed&&!Xa(this.doc,
g)&&a&&V(g,bb(a.display))}if(a&&this.collapsed&&!a.options.lineWrapping)for(e=0;e<this.lines.length;++e)g=Ea(this.lines[e]),f=wc(g),f>a.display.maxLineLength&&(a.display.maxLine=g,a.display.maxLineLength=f,a.display.maxLineChanged=!0);null!=c&&a&&this.collapsed&&ra(a,c,d+1);this.lines.length=0;this.explicitlyCleared=!0;this.atomic&&this.doc.cantEdit&&(this.doc.cantEdit=!1,a&&kf(a.doc));a&&la(a,"markerCleared",a,this,c,d);b&&hb(a);this.parent&&this.parent.clear()}};Ta.prototype.find=function(a,b){null==
a&&"bookmark"==this.type&&(a=1);for(var c,d,e=0;e<this.lines.length;++e){var g=this.lines[e],f=Ja(g.markedSpans,this);if(null!=f.from&&(c=I(b?g:M(g),f.from),-1==a))return c;if(null!=f.to&&(d=I(b?g:M(g),f.to),1==a))return d}return c&&{from:c,to:d}};Ta.prototype.changed=function(){var a=this,b=this.find(-1,!0),c=this,d=this.doc.cm;b&&d&&ta(d,function(){var e=b.line,g=M(b.line);if(g=kd(d,g))xe(g),d.curOp.selectionChanged=d.curOp.forceUpdate=!0;d.curOp.updateMaxLine=!0;Xa(c.doc,e)||null==c.height||(g=
c.height,c.height=null,(g=Mb(c)-g)&&V(e,e.height+g));la(d,"markerChanged",d,a)})};Ta.prototype.attachLine=function(a){if(!this.lines.length&&this.doc.cm){var b=this.doc.cm.curOp;b.maybeHiddenMarkers&&-1!=d(b.maybeHiddenMarkers,this)||(b.maybeUnhiddenMarkers||(b.maybeUnhiddenMarkers=[])).push(this)}this.lines.push(a)};Ta.prototype.detachLine=function(a){this.lines.splice(d(this.lines,a),1);!this.lines.length&&this.doc.cm&&(a=this.doc.cm.curOp,(a.maybeHiddenMarkers||(a.maybeHiddenMarkers=[])).push(this))};
nb(Ta);var ac=function(a,b){this.markers=a;this.primary=b;for(b=0;b<a.length;++b)a[b].parent=this};ac.prototype.clear=function(){if(!this.explicitlyCleared){this.explicitlyCleared=!0;for(var a=0;a<this.markers.length;++a)this.markers[a].clear();la(this,"clear")}};ac.prototype.find=function(a,b){return this.primary.find(a,b)};nb(ac);var jh=0,sa=function(a,b,c,d,e){if(!(this instanceof sa))return new sa(a,b,c,d,e);null==c&&(c=0);Zb.call(this,[new Yb([new tb("",null)])]);this.first=c;this.scrollTop=
this.scrollLeft=0;this.cantEdit=!1;this.cleanGeneration=1;this.modeFrontier=this.highlightFrontier=c;c=I(c,0);this.sel=Na(c);this.history=new Lc(null);this.id=++jh;this.modeOption=b;this.lineSep=d;this.direction="rtl"==e?"rtl":"ltr";this.extend=!1;"string"==typeof a&&(a=this.splitLines(a));Fd(this,{from:c,to:c,text:a});ma(this,Na(c),Ia)};sa.prototype=x(Zb.prototype,{constructor:sa,iter:function(a,b,c){c?this.iterN(a-this.first,b-a,c):this.iterN(this.first,this.first+this.size,a)},insert:function(a,
b){for(var c=0,d=0;d<b.length;++d)c+=b[d].height;this.insertInner(a-this.first,b,c)},remove:function(a,b){this.removeInner(a-this.first,b)},getValue:function(a){var b=W(this,this.first,this.first+this.size);return!1===a?b:b.join(a||this.lineSeparator())},setValue:ka(function(a){var b=I(this.first,0),c=this.first+this.size-1;wb(this,{from:b,to:I(c,K(this,c).text.length),text:this.splitLines(a),origin:"setValue",full:!0},!0);this.cm&&Rb(this.cm,0,0);ma(this,Na(b),Ia)}),replaceRange:function(a,b,c,d){b=
T(this,b);c=c?T(this,c):b;xb(this,a,b,c,d)},getRange:function(a,b,c){a=U(this,T(this,a),T(this,b));return!1===c?a:a.join(c||this.lineSeparator())},getLine:function(a){return(a=this.getLineHandle(a))&&a.text},getLineHandle:function(a){if(ba(this,a))return K(this,a)},getLineNumber:function(a){return M(a)},getLineHandleVisualStart:function(a){"number"==typeof a&&(a=K(this,a));return Ea(a)},lineCount:function(){return this.size},firstLine:function(){return this.first},lastLine:function(){return this.first+
this.size-1},clipPos:function(a){return T(this,a)},getCursor:function(a){var b=this.sel.primary();return null==a||"head"==a?b.head:"anchor"==a?b.anchor:"end"==a||"to"==a||!1===a?b.to():b.from()},listSelections:function(){return this.sel.ranges},somethingSelected:function(){return this.sel.somethingSelected()},setCursor:ka(function(a,b,c){a=T(this,"number"==typeof a?I(a,b||0):a);ma(this,Na(a,null),c)}),setSelection:ka(function(a,b,c){var d=T(this,a);a=T(this,b||a);ma(this,Na(d,a),c)}),extendSelection:ka(function(a,
b,c){Nc(this,T(this,a),b&&T(this,b),c)}),extendSelections:ka(function(a,b){ff(this,uc(this,a),b)}),extendSelectionsBy:ka(function(a,b){a=F(this.sel.ranges,a);ff(this,uc(this,a),b)}),setSelections:ka(function(a,b,c){if(a.length){for(var d=[],e=0;e<a.length;e++)d[e]=new Y(T(this,a[e].anchor),T(this,a[e].head));null==b&&(b=Math.min(a.length-1,this.sel.primIndex));ma(this,Da(d,b),c)}}),addSelection:ka(function(a,b,c){var d=this.sel.ranges.slice(0);d.push(new Y(T(this,a),T(this,b||a)));ma(this,Da(d,d.length-
1),c)}),getSelection:function(a){for(var b=this.sel.ranges,c,d=0;d<b.length;d++){var e=U(this,b[d].from(),b[d].to());c=c?c.concat(e):e}return!1===a?c:c.join(a||this.lineSeparator())},getSelections:function(a){for(var b=[],c=this.sel.ranges,d=0;d<c.length;d++){var e=U(this,c[d].from(),c[d].to());!1!==a&&(e=e.join(a||this.lineSeparator()));b[d]=e}return b},replaceSelection:function(a,b,c){for(var d=[],e=0;e<this.sel.ranges.length;e++)d[e]=a;this.replaceSelections(d,b,c||"+input")},replaceSelections:ka(function(a,
b,c){for(var d=[],e=this.sel,g=0;g<e.ranges.length;g++){var f=e.ranges[g];d[g]={from:f.from(),to:f.to(),text:this.splitLines(a[g]),origin:c}}if(a=b&&"end"!=b){a=[];e=c=I(this.first,0);for(g=0;g<d.length;g++){var h=d[g];f=Ye(h.from,c,e);var k=Ye(Sa(h),c,e);c=h.to;e=k;"around"==b?(h=this.sel.ranges[g],h=0>P(h.head,h.anchor),a[g]=new Y(h?k:f,h?f:k)):a[g]=new Y(f,f)}a=new xa(a,this.sel.primIndex)}b=a;for(a=d.length-1;0<=a;a--)wb(this,d[a]);b?gf(this,b):this.cm&&rb(this.cm)}),undo:ka(function(){Pc(this,
"undo")}),redo:ka(function(){Pc(this,"redo")}),undoSelection:ka(function(){Pc(this,"undo",!0)}),redoSelection:ka(function(){Pc(this,"redo",!0)}),setExtending:function(a){this.extend=a},getExtending:function(){return this.extend},historySize:function(){for(var a=this.history,b=0,c=0,d=0;d<a.done.length;d++)a.done[d].ranges||++b;for(d=0;d<a.undone.length;d++)a.undone[d].ranges||++c;return{undo:b,redo:c}},clearHistory:function(){this.history=new Lc(this.history.maxGeneration)},markClean:function(){this.cleanGeneration=
this.changeGeneration(!0)},changeGeneration:function(a){a&&(this.history.lastOp=this.history.lastSelOp=this.history.lastOrigin=null);return this.history.generation},isClean:function(a){return this.history.generation==(a||this.cleanGeneration)},getHistory:function(){return{done:ub(this.history.done),undone:ub(this.history.undone)}},setHistory:function(a){var b=this.history=new Lc(this.history.maxGeneration);b.done=ub(a.done.slice(0),null,!0);b.undone=ub(a.undone.slice(0),null,!0)},setGutterMarker:ka(function(a,
b,c){return Xb(this,a,"gutter",function(a){var d=a.gutterMarkers||(a.gutterMarkers={});d[b]=c;!c&&C(d)&&(a.gutterMarkers=null);return!0})}),clearGutter:ka(function(a){var b=this;this.iter(function(c){c.gutterMarkers&&c.gutterMarkers[a]&&Xb(b,c,"gutter",function(){c.gutterMarkers[a]=null;C(c.gutterMarkers)&&(c.gutterMarkers=null);return!0})})}),lineInfo:function(a){if("number"==typeof a){if(!ba(this,a))return null;var b=a;a=K(this,a);if(!a)return null}else if(b=M(a),null==b)return null;return{line:b,
handle:a,text:a.text,gutterMarkers:a.gutterMarkers,textClass:a.textClass,bgClass:a.bgClass,wrapClass:a.wrapClass,widgets:a.widgets}},addLineClass:ka(function(a,b,d){return Xb(this,a,"gutter"==b?"gutter":"class",function(a){var e="text"==b?"textClass":"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass";if(a[e]){if(c(d).test(a[e]))return!1;a[e]+=" "+d}else a[e]=d;return!0})}),removeLineClass:ka(function(a,b,d){return Xb(this,a,"gutter"==b?"gutter":"class",function(a){var e="text"==b?"textClass":
"background"==b?"bgClass":"gutter"==b?"gutterClass":"wrapClass",g=a[e];if(g)if(null==d)a[e]=null;else{var f=g.match(c(d));if(!f)return!1;var h=f.index+f[0].length;a[e]=g.slice(0,f.index)+(f.index&&h!=g.length?" ":"")+g.slice(h)||null}else return!1;return!0})}),addLineWidget:ka(function(a,b,c){return Fg(this,a,b,c)}),removeLineWidget:function(a){a.clear()},markText:function(a,b,c){return yb(this,T(this,a),T(this,b),c,c&&c.type||"range")},setBookmark:function(a,b){b={replacedWith:b&&(null==b.nodeType?
b.widget:b),insertLeft:b&&b.insertLeft,clearWhenEmpty:!1,shared:b&&b.shared,handleMouseEvents:b&&b.handleMouseEvents};a=T(this,a);return yb(this,a,a,b,"bookmark")},findMarksAt:function(a){a=T(this,a);var b=[],c=K(this,a.line).markedSpans;if(c)for(var d=0;d<c.length;++d){var e=c[d];(null==e.from||e.from<=a.ch)&&(null==e.to||e.to>=a.ch)&&b.push(e.marker.parent||e.marker)}return b},findMarks:function(a,b,c){a=T(this,a);b=T(this,b);var d=[],e=a.line;this.iter(a.line,b.line+1,function(g){if(g=g.markedSpans)for(var f=
0;f<g.length;f++){var h=g[f];null!=h.to&&e==a.line&&a.ch>=h.to||null==h.from&&e!=a.line||null!=h.from&&e==b.line&&h.from>=b.ch||c&&!c(h.marker)||d.push(h.marker.parent||h.marker)}++e});return d},getAllMarks:function(){var a=[];this.iter(function(b){if(b=b.markedSpans)for(var c=0;c<b.length;++c)null!=b[c].from&&a.push(b[c].marker)});return a},posFromIndex:function(a){var b,c=this.first,d=this.lineSeparator().length;this.iter(function(e){e=e.text.length+d;if(e>a)return b=a,!0;a-=e;++c});return T(this,
I(c,b))},indexFromPos:function(a){a=T(this,a);var b=a.ch;if(a.line<this.first||0>a.ch)return 0;var c=this.lineSeparator().length;this.iter(this.first,a.line,function(a){b+=a.text.length+c});return b},copy:function(a){var b=new sa(W(this,this.first,this.first+this.size),this.modeOption,this.first,this.lineSep,this.direction);b.scrollTop=this.scrollTop;b.scrollLeft=this.scrollLeft;b.sel=this.sel;b.extend=!1;a&&(b.history.undoDepth=this.history.undoDepth,b.setHistory(this.getHistory()));return b},linkedDoc:function(a){a||
(a={});var b=this.first,c=this.first+this.size;null!=a.from&&a.from>b&&(b=a.from);null!=a.to&&a.to<c&&(c=a.to);b=new sa(W(this,b,c),a.mode||this.modeOption,b,this.lineSep,this.direction);a.sharedHist&&(b.history=this.history);(this.linked||(this.linked=[])).push({doc:b,sharedHist:a.sharedHist});b.linked=[{doc:this,isParent:!0,sharedHist:a.sharedHist}];a=vf(this);for(c=0;c<a.length;c++){var d=a[c],e=d.find(),g=b.clipPos(e.from);e=b.clipPos(e.to);P(g,e)&&(g=yb(b,g,e,d.primary,d.primary.type),d.markers.push(g),
g.parent=d)}return b},unlinkDoc:function(a){a instanceof ca&&(a=a.doc);if(this.linked)for(var b=0;b<this.linked.length;++b)if(this.linked[b].doc==a){this.linked.splice(b,1);a.unlinkDoc(this);Hg(vf(this));break}if(a.history==this.history){var c=[a.id];ib(a,function(a){return c.push(a.id)},!0);a.history=new Lc(null);a.history.done=ub(this.history.done,c);a.history.undone=ub(this.history.undone,c)}},iterLinkedDocs:function(a){ib(this,a)},getMode:function(){return this.mode},getEditor:function(){return this.cm},
splitLines:function(a){return this.lineSep?a.split(this.lineSep):Td(a)},lineSeparator:function(){return this.lineSep||"\n"},setDirection:ka(function(a){"rtl"!=a&&(a="ltr");a!=this.direction&&(this.direction=a,this.iter(function(a){return a.order=null}),this.cm&&Bg(this.cm))})});sa.prototype.eachLine=sa.prototype.iter;for(var xf=0,Pf=!1,Ua={3:"Enter",8:"Backspace",9:"Tab",13:"Enter",16:"Shift",17:"Ctrl",18:"Alt",19:"Pause",20:"CapsLock",27:"Esc",32:"Space",33:"PageUp",34:"PageDown",35:"End",36:"Home",
37:"Left",38:"Up",39:"Right",40:"Down",44:"PrintScrn",45:"Insert",46:"Delete",59:";",61:"=",91:"Mod",92:"Mod",93:"Mod",106:"*",107:"=",109:"-",110:".",111:"/",127:"Delete",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",63232:"Up",63233:"Down",63234:"Left",63235:"Right",63272:"Delete",63273:"Home",63275:"End",63276:"PageUp",63277:"PageDown",63302:"Insert"},nc=0;10>nc;nc++)Ua[nc+48]=Ua[nc+96]=String(nc);for(var Wc=65;90>=Wc;Wc++)Ua[Wc]=String.fromCharCode(Wc);
for(var oc=1;12>=oc;oc++)Ua[oc+111]=Ua[oc+63235]="F"+oc;var bc={basic:{Left:"goCharLeft",Right:"goCharRight",Up:"goLineUp",Down:"goLineDown",End:"goLineEnd",Home:"goLineStartSmart",PageUp:"goPageUp",PageDown:"goPageDown",Delete:"delCharAfter",Backspace:"delCharBefore","Shift-Backspace":"delCharBefore",Tab:"defaultTab","Shift-Tab":"indentAuto",Enter:"newlineAndIndent",Insert:"toggleOverwrite",Esc:"singleSelection"},pcDefault:{"Ctrl-A":"selectAll","Ctrl-D":"deleteLine","Ctrl-Z":"undo","Shift-Ctrl-Z":"redo",
"Ctrl-Y":"redo","Ctrl-Home":"goDocStart","Ctrl-End":"goDocEnd","Ctrl-Up":"goLineUp","Ctrl-Down":"goLineDown","Ctrl-Left":"goGroupLeft","Ctrl-Right":"goGroupRight","Alt-Left":"goLineStart","Alt-Right":"goLineEnd","Ctrl-Backspace":"delGroupBefore","Ctrl-Delete":"delGroupAfter","Ctrl-S":"save","Ctrl-F":"find","Ctrl-G":"findNext","Shift-Ctrl-G":"findPrev","Shift-Ctrl-F":"replace","Shift-Ctrl-R":"replaceAll","Ctrl-[":"indentLess","Ctrl-]":"indentMore","Ctrl-U":"undoSelection","Shift-Ctrl-U":"redoSelection",
"Alt-U":"redoSelection",fallthrough:"basic"},emacsy:{"Ctrl-F":"goCharRight","Ctrl-B":"goCharLeft","Ctrl-P":"goLineUp","Ctrl-N":"goLineDown","Alt-F":"goWordRight","Alt-B":"goWordLeft","Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd","Ctrl-V":"goPageDown","Shift-Ctrl-V":"goPageUp","Ctrl-D":"delCharAfter","Ctrl-H":"delCharBefore","Alt-D":"delWordAfter","Alt-Backspace":"delWordBefore","Ctrl-K":"killLine","Ctrl-T":"transposeChars","Ctrl-O":"openLine"},macDefault:{"Cmd-A":"selectAll","Cmd-D":"deleteLine","Cmd-Z":"undo",
"Shift-Cmd-Z":"redo","Cmd-Y":"redo","Cmd-Home":"goDocStart","Cmd-Up":"goDocStart","Cmd-End":"goDocEnd","Cmd-Down":"goDocEnd","Alt-Left":"goGroupLeft","Alt-Right":"goGroupRight","Cmd-Left":"goLineLeft","Cmd-Right":"goLineRight","Alt-Backspace":"delGroupBefore","Ctrl-Alt-Backspace":"delGroupAfter","Alt-Delete":"delGroupAfter","Cmd-S":"save","Cmd-F":"find","Cmd-G":"findNext","Shift-Cmd-G":"findPrev","Cmd-Alt-F":"replace","Shift-Cmd-Alt-F":"replaceAll","Cmd-[":"indentLess","Cmd-]":"indentMore","Cmd-Backspace":"delWrappedLineLeft",
"Cmd-Delete":"delWrappedLineRight","Cmd-U":"undoSelection","Shift-Cmd-U":"redoSelection","Ctrl-Up":"goDocStart","Ctrl-Down":"goDocEnd",fallthrough:["basic","emacsy"]}};bc["default"]=za?bc.macDefault:bc.pcDefault;var cc={selectAll:mf,singleSelection:function(a){return a.setSelection(a.getCursor("anchor"),a.getCursor("head"),Ia)},killLine:function(a){return Ab(a,function(b){if(b.empty()){var c=K(a.doc,b.head.line).text.length;return b.head.ch==c&&b.head.line<a.lastLine()?{from:b.head,to:I(b.head.line+
1,0)}:{from:b.head,to:I(b.head.line,c)}}return{from:b.from(),to:b.to()}})},deleteLine:function(a){return Ab(a,function(b){return{from:I(b.from().line,0),to:T(a.doc,I(b.to().line+1,0))}})},delLineLeft:function(a){return Ab(a,function(a){return{from:I(a.from().line,0),to:a.from()}})},delWrappedLineLeft:function(a){return Ab(a,function(b){var c=a.charCoords(b.head,"div").top+5;return{from:a.coordsChar({left:0,top:c},"div"),to:b.from()}})},delWrappedLineRight:function(a){return Ab(a,function(b){var c=
a.charCoords(b.head,"div").top+5;c=a.coordsChar({left:a.display.lineDiv.offsetWidth+100,top:c},"div");return{from:b.from(),to:c}})},undo:function(a){return a.undo()},redo:function(a){return a.redo()},undoSelection:function(a){return a.undoSelection()},redoSelection:function(a){return a.redoSelection()},goDocStart:function(a){return a.extendSelection(I(a.firstLine(),0))},goDocEnd:function(a){return a.extendSelection(I(a.lastLine()))},goLineStart:function(a){return a.extendSelectionsBy(function(b){return Df(a,
b.head.line)},{origin:"+move",bias:1})},goLineStartSmart:function(a){return a.extendSelectionsBy(function(b){return Ef(a,b.head)},{origin:"+move",bias:1})},goLineEnd:function(a){return a.extendSelectionsBy(function(b){b=b.head.line;var c=K(a.doc,b);var d=c;for(var e;e=Ka(d,!1);)d=e.find(1,!0).line;d!=c&&(b=M(d));return Md(!0,a,c,b,-1)},{origin:"+move",bias:-1})},goLineRight:function(a){return a.extendSelectionsBy(function(b){b=a.cursorCoords(b.head,"div").top+5;return a.coordsChar({left:a.display.lineDiv.offsetWidth+
100,top:b},"div")},lc)},goLineLeft:function(a){return a.extendSelectionsBy(function(b){b=a.cursorCoords(b.head,"div").top+5;return a.coordsChar({left:0,top:b},"div")},lc)},goLineLeftSmart:function(a){return a.extendSelectionsBy(function(b){var c=a.cursorCoords(b.head,"div").top+5;c=a.coordsChar({left:0,top:c},"div");return c.ch<a.getLine(c.line).search(/\S/)?Ef(a,b.head):c},lc)},goLineUp:function(a){return a.moveV(-1,"line")},goLineDown:function(a){return a.moveV(1,"line")},goPageUp:function(a){return a.moveV(-1,
"page")},goPageDown:function(a){return a.moveV(1,"page")},goCharLeft:function(a){return a.moveH(-1,"char")},goCharRight:function(a){return a.moveH(1,"char")},goColumnLeft:function(a){return a.moveH(-1,"column")},goColumnRight:function(a){return a.moveH(1,"column")},goWordLeft:function(a){return a.moveH(-1,"word")},goGroupRight:function(a){return a.moveH(1,"group")},goGroupLeft:function(a){return a.moveH(-1,"group")},goWordRight:function(a){return a.moveH(1,"word")},delCharBefore:function(a){return a.deleteH(-1,
"char")},delCharAfter:function(a){return a.deleteH(1,"char")},delWordBefore:function(a){return a.deleteH(-1,"word")},delWordAfter:function(a){return a.deleteH(1,"word")},delGroupBefore:function(a){return a.deleteH(-1,"group")},delGroupAfter:function(a){return a.deleteH(1,"group")},indentAuto:function(a){return a.indentSelection("smart")},indentMore:function(a){return a.indentSelection("add")},indentLess:function(a){return a.indentSelection("subtract")},insertTab:function(a){return a.replaceSelection("\t")},
insertSoftTab:function(a){for(var b=[],c=a.listSelections(),d=a.options.tabSize,e=0;e<c.length;e++){var f=c[e].from();f=g(a.getLine(f.line),f.ch,d);b.push(w(d-f%d))}a.replaceSelections(b)},defaultTab:function(a){a.somethingSelected()?a.indentSelection("add"):a.execCommand("insertTab")},transposeChars:function(a){return ta(a,function(){for(var b=a.listSelections(),c=[],d=0;d<b.length;d++)if(b[d].empty()){var e=b[d].head,g=K(a.doc,e.line).text;if(g)if(e.ch==g.length&&(e=new I(e.line,e.ch-1)),0<e.ch)e=
new I(e.line,e.ch+1),a.replaceRange(g.charAt(e.ch-1)+g.charAt(e.ch-2),I(e.line,e.ch-2),e,"+transpose");else if(e.line>a.doc.first){var f=K(a.doc,e.line-1).text;f&&(e=new I(e.line,1),a.replaceRange(g.charAt(0)+a.doc.lineSeparator()+f.charAt(f.length-1),I(e.line-1,f.length-1),e,"+transpose"))}c.push(new Y(e,e))}a.setSelections(c)})},newlineAndIndent:function(a){return ta(a,function(){for(var b=a.listSelections(),c=b.length-1;0<=c;c--)a.replaceRange(a.doc.lineSeparator(),b[c].anchor,b[c].head,"+input");
b=a.listSelections();for(c=0;c<b.length;c++)a.indentLine(b[c].from().line,null,!0);rb(a)})},openLine:function(a){return a.replaceSelection("\n","start")},toggleOverwrite:function(a){return a.toggleOverwrite()}},Og=new jb,Nd=null,Od=function(a,b,c){this.time=a;this.pos=b;this.button=c};Od.prototype.compare=function(a,b,c){return this.time+400>a&&0==P(b,this.pos)&&c==this.button};var fc,ec,Bb={toString:function(){return"CodeMirror.Init"}},Of={},Uc={};ca.defaults=Of;ca.optionHandlers=Uc;var Rd=[];ca.defineInitHook=
function(a){return Rd.push(a)};var ua=null,Z=function(a){this.cm=a;this.lastAnchorNode=this.lastAnchorOffset=this.lastFocusNode=this.lastFocusOffset=null;this.polling=new jb;this.composing=null;this.gracePeriod=!1;this.readDOMTimeout=null};Z.prototype.init=function(a){function b(a){if(!ia(e,a)){if(e.somethingSelected())ua={lineWise:!1,text:e.getSelections()},"cut"==a.type&&e.replaceSelection("",null,"cut");else if(e.options.lineWiseCopyCut){var b=Tf(e);ua={lineWise:!0,text:b.text};"cut"==a.type&&
e.operation(function(){e.setSelections(b.ranges,0,Ia);e.replaceSelection("",null,"cut")})}else return;if(a.clipboardData){a.clipboardData.clearData();var c=ua.text.join("\n");a.clipboardData.setData("Text",c);if(a.clipboardData.getData("Text")==c){a.preventDefault();return}}var f=Vf();a=f.firstChild;e.display.lineSpace.insertBefore(f,e.display.lineSpace.firstChild);a.value=ua.text.join("\n");var h=document.activeElement;kc(a);setTimeout(function(){e.display.lineSpace.removeChild(f);h.focus();h==g&&
d.showPrimarySelection()},50)}}var c=this,d=this,e=d.cm,g=d.div=a.lineDiv;Uf(g,e.options.spellcheck);O(g,"paste",function(a){ia(e,a)||Sf(a,e)||11>=aa&&setTimeout(ja(e,function(){return c.updateFromDOM()}),20)});O(g,"compositionstart",function(a){c.composing={data:a.data,done:!1}});O(g,"compositionupdate",function(a){c.composing||(c.composing={data:a.data,done:!1})});O(g,"compositionend",function(a){c.composing&&(a.data!=c.composing.data&&c.readFromDOMSoon(),c.composing.done=!0)});O(g,"touchstart",
function(){return d.forceCompositionEnd()});O(g,"input",function(){c.composing||c.readFromDOMSoon()});O(g,"copy",b);O(g,"cut",b)};Z.prototype.prepareSelection=function(){var a=Ge(this.cm,!1);a.focus=this.cm.state.focused;return a};Z.prototype.showSelection=function(a,b){a&&this.cm.display.view.length&&((a.focus||b)&&this.showPrimarySelection(),this.showMultipleSelections(a))};Z.prototype.showPrimarySelection=function(){var a=window.getSelection(),b=this.cm,c=b.doc.sel.primary(),d=c.from();c=c.to();
if(b.display.viewTo==b.display.viewFrom||d.line>=b.display.viewTo||c.line<b.display.viewFrom)a.removeAllRanges();else{var e=Vc(b,a.anchorNode,a.anchorOffset),g=Vc(b,a.focusNode,a.focusOffset);if(!e||e.bad||!g||g.bad||0!=P(rc(e,g),d)||0!=P(tc(e,g),c))if(e=b.display.view,d=d.line>=b.display.viewFrom&&Xf(b,d)||{node:e[0].measure.map[2],offset:0},c=c.line<b.display.viewTo&&Xf(b,c),c||(c=e[e.length-1].measure,c=c.maps?c.maps[c.maps.length-1]:c.map,c={node:c[c.length-1],offset:c[c.length-2]-c[c.length-
3]}),d&&c){e=a.rangeCount&&a.getRangeAt(0);try{var f=Jb(d.node,d.offset,c.offset,c.node)}catch(lh){}f&&(!Oa&&b.state.focused?(a.collapse(d.node,d.offset),f.collapsed||(a.removeAllRanges(),a.addRange(f))):(a.removeAllRanges(),a.addRange(f)),e&&null==a.anchorNode?a.addRange(e):Oa&&this.startGracePeriod());this.rememberSelection()}else a.removeAllRanges()}};Z.prototype.startGracePeriod=function(){var a=this;clearTimeout(this.gracePeriod);this.gracePeriod=setTimeout(function(){a.gracePeriod=!1;a.selectionChanged()&&
a.cm.operation(function(){return a.cm.curOp.selectionChanged=!0})},20)};Z.prototype.showMultipleSelections=function(a){t(this.cm.display.cursorDiv,a.cursors);t(this.cm.display.selectionDiv,a.selection)};Z.prototype.rememberSelection=function(){var a=window.getSelection();this.lastAnchorNode=a.anchorNode;this.lastAnchorOffset=a.anchorOffset;this.lastFocusNode=a.focusNode;this.lastFocusOffset=a.focusOffset};Z.prototype.selectionInEditor=function(){var a=window.getSelection();if(!a.rangeCount)return!1;
a=a.getRangeAt(0).commonAncestorContainer;return l(this.div,a)};Z.prototype.focus=function(){"nocursor"!=this.cm.options.readOnly&&(this.selectionInEditor()||this.showSelection(this.prepareSelection(),!0),this.div.focus())};Z.prototype.blur=function(){this.div.blur()};Z.prototype.getField=function(){return this.div};Z.prototype.supportsTouch=function(){return!0};Z.prototype.receivedFocus=function(){function a(){b.cm.state.focused&&(b.pollSelection(),b.polling.set(b.cm.options.pollInterval,a))}var b=
this;this.selectionInEditor()?this.pollSelection():ta(this.cm,function(){return b.cm.curOp.selectionChanged=!0});this.polling.set(this.cm.options.pollInterval,a)};Z.prototype.selectionChanged=function(){var a=window.getSelection();return a.anchorNode!=this.lastAnchorNode||a.anchorOffset!=this.lastAnchorOffset||a.focusNode!=this.lastFocusNode||a.focusOffset!=this.lastFocusOffset};Z.prototype.pollSelection=function(){if(null==this.readDOMTimeout&&!this.gracePeriod&&this.selectionChanged()){var a=window.getSelection(),
b=this.cm;if(Cc&&Bc&&this.cm.options.gutters.length&&ch(a.anchorNode))this.cm.triggerOnKeyDown({type:"keydown",keyCode:8,preventDefault:Math.abs}),this.blur(),this.focus();else if(!this.composing){this.rememberSelection();var c=Vc(b,a.anchorNode,a.anchorOffset),d=Vc(b,a.focusNode,a.focusOffset);c&&d&&ta(b,function(){ma(b.doc,Na(c,d),Ia);if(c.bad||d.bad)b.curOp.selectionChanged=!0})}}};Z.prototype.pollContent=function(){null!=this.readDOMTimeout&&(clearTimeout(this.readDOMTimeout),this.readDOMTimeout=
null);var a=this.cm,b=a.display,c=a.doc.sel.primary(),d=c.from(),e=c.to();0==d.ch&&d.line>a.firstLine()&&(d=I(d.line-1,K(a.doc,d.line-1).length));e.ch==K(a.doc,e.line).text.length&&e.line<a.lastLine()&&(e=I(e.line+1,0));if(d.line<b.viewFrom||e.line>b.viewTo-1)return!1;var g;d.line==b.viewFrom||0==(g=$a(a,d.line))?(c=M(b.view[0].line),g=b.view[0].node):(c=M(b.view[g].line),g=b.view[g-1].node.nextSibling);var f=$a(a,e.line);f==b.view.length-1?(e=b.viewTo-1,b=b.lineDiv.lastChild):(e=M(b.view[f+1].line)-
1,b=b.view[f+1].node.previousSibling);if(!g)return!1;b=a.doc.splitLines(dh(a,g,b,c,e));for(g=U(a.doc,I(c,0),I(e,K(a.doc,e).text.length));1<b.length&&1<g.length;)if(m(b)==m(g))b.pop(),g.pop(),e--;else if(b[0]==g[0])b.shift(),g.shift(),c++;else break;var h=0;f=0;for(var k=b[0],l=g[0],r=Math.min(k.length,l.length);h<r&&k.charCodeAt(h)==l.charCodeAt(h);)++h;k=m(b);l=m(g);for(r=Math.min(k.length-(1==b.length?h:0),l.length-(1==g.length?h:0));f<r&&k.charCodeAt(k.length-f-1)==l.charCodeAt(l.length-f-1);)++f;
if(1==b.length&&1==g.length&&c==d.line)for(;h&&h>d.ch&&k.charCodeAt(k.length-f-1)==l.charCodeAt(l.length-f-1);)h--,f++;b[b.length-1]=k.slice(0,k.length-f).replace(/^\u200b+/,"");b[0]=b[0].slice(h).replace(/\u200b+$/,"");d=I(c,h);c=I(e,g.length?m(g).length-f:0);if(1<b.length||b[0]||P(d,c))return xb(a.doc,b,d,c,"+input"),!0};Z.prototype.ensurePolled=function(){this.forceCompositionEnd()};Z.prototype.reset=function(){this.forceCompositionEnd()};Z.prototype.forceCompositionEnd=function(){this.composing&&
(clearTimeout(this.readDOMTimeout),this.composing=null,this.updateFromDOM(),this.div.blur(),this.div.focus())};Z.prototype.readFromDOMSoon=function(){var a=this;null==this.readDOMTimeout&&(this.readDOMTimeout=setTimeout(function(){a.readDOMTimeout=null;if(a.composing)if(a.composing.done)a.composing=null;else return;a.updateFromDOM()},80))};Z.prototype.updateFromDOM=function(){var a=this;!this.cm.isReadOnly()&&this.pollContent()||ta(this.cm,function(){return ra(a.cm)})};Z.prototype.setUneditable=function(a){a.contentEditable=
"false"};Z.prototype.onKeyPress=function(a){0!=a.charCode&&(a.preventDefault(),this.cm.isReadOnly()||ja(this.cm,Sd)(this.cm,String.fromCharCode(null==a.charCode?a.keyCode:a.charCode),0))};Z.prototype.readOnlyChanged=function(a){this.div.contentEditable=String("nocursor"!=a)};Z.prototype.onContextMenu=function(){};Z.prototype.resetPosition=function(){};Z.prototype.needsContentAttribute=!0;var fa=function(a){this.cm=a;this.prevInput="";this.pollingFast=!1;this.polling=new jb;this.hasSelection=!1;this.composing=
null};fa.prototype.init=function(a){function b(a){if(!ia(e,a)){if(e.somethingSelected())ua={lineWise:!1,text:e.getSelections()};else if(e.options.lineWiseCopyCut){var b=Tf(e);ua={lineWise:!0,text:b.text};"cut"==a.type?e.setSelections(b.ranges,null,Ia):(d.prevInput="",f.value=b.text.join("\n"),kc(f))}else return;"cut"==a.type&&(e.state.cutIncoming=!0)}}var c=this,d=this,e=this.cm,g=this.wrapper=Vf(),f=this.textarea=g.firstChild;a.wrapper.insertBefore(g,a.wrapper.firstChild);ic&&(f.style.width="0px");
O(f,"input",function(){X&&9<=aa&&c.hasSelection&&(c.hasSelection=null);d.poll()});O(f,"paste",function(a){ia(e,a)||Sf(a,e)||(e.state.pasteIncoming=!0,d.fastPoll())});O(f,"cut",b);O(f,"copy",b);O(a.scroller,"paste",function(b){Ma(a,b)||ia(e,b)||(e.state.pasteIncoming=!0,d.focus())});O(a.lineSpace,"selectstart",function(b){Ma(a,b)||qa(b)});O(f,"compositionstart",function(){var a=e.getCursor("from");d.composing&&d.composing.range.clear();d.composing={start:a,range:e.markText(a,e.getCursor("to"),{className:"CodeMirror-composing"})}});
O(f,"compositionend",function(){d.composing&&(d.poll(),d.composing.range.clear(),d.composing=null)})};fa.prototype.prepareSelection=function(){var a=this.cm,b=a.display,c=a.doc,d=Ge(a);if(a.options.moveInputWithCursor){a=Ba(a,c.sel.primary().head,"div");c=b.wrapper.getBoundingClientRect();var e=b.lineDiv.getBoundingClientRect();d.teTop=Math.max(0,Math.min(b.wrapper.clientHeight-10,a.top+e.top-c.top));d.teLeft=Math.max(0,Math.min(b.wrapper.clientWidth-10,a.left+e.left-c.left))}return d};fa.prototype.showSelection=
function(a){var b=this.cm.display;t(b.cursorDiv,a.cursors);t(b.selectionDiv,a.selection);null!=a.teTop&&(this.wrapper.style.top=a.teTop+"px",this.wrapper.style.left=a.teLeft+"px")};fa.prototype.reset=function(a){if(!this.contextMenuPending&&!this.composing){var b=this.cm;b.somethingSelected()?(this.prevInput="",a=b.getSelection(),this.textarea.value=a,b.state.focused&&kc(this.textarea),X&&9<=aa&&(this.hasSelection=a)):a||(this.prevInput=this.textarea.value="",X&&9<=aa&&(this.hasSelection=null))}};
fa.prototype.getField=function(){return this.textarea};fa.prototype.supportsTouch=function(){return!1};fa.prototype.focus=function(){if("nocursor"!=this.cm.options.readOnly&&(!Eb||r()!=this.textarea))try{this.textarea.focus()}catch(u){}};fa.prototype.blur=function(){this.textarea.blur()};fa.prototype.resetPosition=function(){this.wrapper.style.top=this.wrapper.style.left=0};fa.prototype.receivedFocus=function(){this.slowPoll()};fa.prototype.slowPoll=function(){var a=this;this.pollingFast||this.polling.set(this.cm.options.pollInterval,
function(){a.poll();a.cm.state.focused&&a.slowPoll()})};fa.prototype.fastPoll=function(){function a(){c.poll()||b?(c.pollingFast=!1,c.slowPoll()):(b=!0,c.polling.set(60,a))}var b=!1,c=this;c.pollingFast=!0;c.polling.set(20,a)};fa.prototype.poll=function(){var a=this,b=this.cm,c=this.textarea,d=this.prevInput;if(this.contextMenuPending||!b.state.focused||ih(c)&&!d&&!this.composing||b.isReadOnly()||b.options.disableInput||b.state.keySeq)return!1;var e=c.value;if(e==d&&!b.somethingSelected())return!1;
if(X&&9<=aa&&this.hasSelection===e||za&&/[\uf700-\uf7ff]/.test(e))return b.display.input.reset(),!1;if(b.doc.sel==b.display.selForContextMenu){var g=e.charCodeAt(0);8203!=g||d||(d="\u200b");if(8666==g)return this.reset(),this.cm.execCommand("undo")}var f=0;for(g=Math.min(d.length,e.length);f<g&&d.charCodeAt(f)==e.charCodeAt(f);)++f;ta(b,function(){Sd(b,e.slice(f),d.length-f,null,a.composing?"*compose":null);1E3<e.length||-1<e.indexOf("\n")?c.value=a.prevInput="":a.prevInput=e;a.composing&&(a.composing.range.clear(),
a.composing.range=b.markText(a.composing.start,b.getCursor("to"),{className:"CodeMirror-composing"}))});return!0};fa.prototype.ensurePolled=function(){this.pollingFast&&this.poll()&&(this.pollingFast=!1)};fa.prototype.onKeyPress=function(){X&&9<=aa&&(this.hasSelection=null);this.fastPoll()};fa.prototype.onContextMenu=function(a){function b(){if(null!=f.selectionStart){var a=e.somethingSelected(),b="\u200b"+(a?f.value:"");f.value="\u21da";f.value=b;d.prevInput=a?"":"\u200b";f.selectionStart=1;f.selectionEnd=
b.length;g.selForContextMenu=e.doc.sel}}function c(){d.contextMenuPending=!1;d.wrapper.style.cssText=r;f.style.cssText=l;X&&9>aa&&g.scrollbars.setScrollTop(g.scroller.scrollTop=k);if(null!=f.selectionStart){(!X||X&&9>aa)&&b();var a=0,c=function(){g.selForContextMenu==e.doc.sel&&0==f.selectionStart&&0<f.selectionEnd&&"\u200b"==d.prevInput?ja(e,mf)(e):10>a++?g.detectingSelectAll=setTimeout(c,500):(g.selForContextMenu=null,g.input.reset())};g.detectingSelectAll=setTimeout(c,200)}}var d=this,e=d.cm,g=
e.display,f=d.textarea,h=db(e,a),k=g.scroller.scrollTop;if(h&&!Ca){e.options.resetSelectionOnContextMenu&&-1==e.doc.sel.contains(h)&&ja(e,ma)(e.doc,Na(h),Ia);var l=f.style.cssText,r=d.wrapper.style.cssText;d.wrapper.style.cssText="position: absolute";h=d.wrapper.getBoundingClientRect();f.style.cssText="position: absolute; width: 30px; height: 30px;\n      top: "+(a.clientY-h.top-5)+"px; left: "+(a.clientX-h.left-5)+"px;\n      z-index: 1000; background: "+(X?"rgba(255, 255, 255, .05)":"transparent")+
";\n      outline: none; border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);";if(na)var p=window.scrollY;g.input.focus();na&&window.scrollTo(null,p);g.input.reset();e.somethingSelected()||(f.value=d.prevInput=" ");d.contextMenuPending=!0;g.selForContextMenu=e.doc.sel;clearTimeout(g.detectingSelectAll);X&&9<=aa&&b();if(Pd){Hb(a);var w=function(){va(window,"mouseup",w);setTimeout(c,20)};O(window,"mouseup",w)}else setTimeout(c,50)}};fa.prototype.readOnlyChanged=
function(a){a||this.reset();this.textarea.disabled="nocursor"==a};fa.prototype.setUneditable=function(){};fa.prototype.needsContentAttribute=!1;(function(a){function b(b,d,e,g){a.defaults[b]=d;e&&(c[b]=g?function(a,b,c){c!=Bb&&e(a,b,c)}:e)}var c=a.optionHandlers;a.defineOption=b;a.Init=Bb;b("value","",function(a,b){return a.setValue(b)},!0);b("mode",null,function(a,b){a.doc.modeOption=b;Ed(a)},!0);b("indentUnit",2,Ed,!0);b("indentWithTabs",!1);b("smartIndent",!0);b("tabSize",4,function(a){Vb(a);Ob(a);
ra(a)},!0);b("lineSeparator",null,function(a,b){if(a.doc.lineSep=b){var c=[],d=a.doc.first;a.doc.iter(function(a){for(var e=0;;){var g=a.text.indexOf(b,e);if(-1==g)break;e=g+b.length;c.push(I(d,g))}d++});for(var e=c.length-1;0<=e;e--)xb(a.doc,b,c[e],I(c[e].line,c[e].ch+b.length))}});b("specialChars",/[\u0000-\u001f\u007f-\u009f\u00ad\u061c\u200b-\u200f\u2028\u2029\ufeff]/g,function(a,b,c){a.state.specialChars=new RegExp(b.source+(b.test("\t")?"":"|\t"),"g");c!=Bb&&a.refresh()});b("specialCharPlaceholder",
og,function(a){return a.refresh()},!0);b("electricChars",!0);b("inputStyle",Eb?"contenteditable":"textarea",function(){throw Error("inputStyle can not (yet) be changed in a running editor");},!0);b("spellcheck",!1,function(a,b){return a.getInputField().spellcheck=b},!0);b("rtlMoveVisually",!hh);b("wholeLineUpdateBefore",!0);b("theme","default",function(a){Nf(a);gc(a)},!0);b("keyMap","default",function(a,b,c){b=Qc(b);(c=c!=Bb&&Qc(c))&&c.detach&&c.detach(a,b);b.attach&&b.attach(a,c||null)});b("extraKeys",
null);b("configureMouse",null);b("lineWrapping",!1,ah,!0);b("gutters",[],function(a){Cd(a.options);gc(a)},!0);b("fixedGutter",!0,function(a,b){a.display.gutters.style.left=b?sd(a.display)+"px":"0";a.refresh()},!0);b("coverGutterNextToScrollbar",!1,function(a){return sb(a)},!0);b("scrollbarStyle","native",function(a){Qe(a);sb(a);a.display.scrollbars.setScrollTop(a.doc.scrollTop);a.display.scrollbars.setScrollLeft(a.doc.scrollLeft)},!0);b("lineNumbers",!1,function(a){Cd(a.options);gc(a)},!0);b("firstLineNumber",
1,gc,!0);b("lineNumberFormatter",function(a){return a},gc,!0);b("showCursorWhenSelecting",!1,Pb,!0);b("resetSelectionOnContextMenu",!0);b("lineWiseCopyCut",!0);b("pasteLinesPerSelection",!0);b("readOnly",!1,function(a,b){"nocursor"==b&&(Qb(a),a.display.input.blur());a.display.input.readOnlyChanged(b)});b("disableInput",!1,function(a,b){b||a.display.input.reset()},!0);b("dragDrop",!0,$g);b("allowDropFileTypes",null);b("cursorBlinkRate",530);b("cursorScrollMargin",0);b("cursorHeight",1,Pb,!0);b("singleCursorHeightPerLine",
!0,Pb,!0);b("workTime",100);b("workDelay",100);b("flattenSpans",!0,Vb,!0);b("addModeClass",!1,Vb,!0);b("pollInterval",100);b("undoDepth",200,function(a,b){return a.doc.history.undoDepth=b});b("historyEventDelay",1250);b("viewportMargin",10,function(a){return a.refresh()},!0);b("maxHighlightLength",1E4,Vb,!0);b("moveInputWithCursor",!0,function(a,b){b||a.display.input.resetPosition()});b("tabindex",null,function(a,b){return a.display.input.getField().tabIndex=b||""});b("autofocus",null);b("direction",
"ltr",function(a,b){return a.doc.setDirection(b)},!0)})(ca);(function(a){var b=a.optionHandlers,c=a.helpers={};a.prototype={constructor:a,focus:function(){window.focus();this.display.input.focus()},setOption:function(a,c){var d=this.options,e=d[a];if(d[a]!=c||"mode"==a)d[a]=c,b.hasOwnProperty(a)&&ja(this,b[a])(this,c,e),da(this,"optionChange",this,a)},getOption:function(a){return this.options[a]},getDoc:function(){return this.doc},addKeyMap:function(a,b){this.state.keyMaps[b?"push":"unshift"](Qc(a))},
removeKeyMap:function(a){for(var b=this.state.keyMaps,c=0;c<b.length;++c)if(b[c]==a||b[c].name==a)return b.splice(c,1),!0},addOverlay:oa(function(b,c){var d=b.token?b:a.getMode(this.options,b);if(d.startState)throw Error("Overlays may not be stateful.");G(this.state.overlays,{mode:d,modeSpec:b,opaque:c&&c.opaque,priority:c&&c.priority||0},function(a){return a.priority});this.state.modeGen++;ra(this)}),removeOverlay:oa(function(a){for(var b=this.state.overlays,c=0;c<b.length;++c){var d=b[c].modeSpec;
if(d==a||"string"==typeof a&&d.name==a){b.splice(c,1);this.state.modeGen++;ra(this);break}}}),indentLine:oa(function(a,b,c){"string"!=typeof b&&"number"!=typeof b&&(b=null==b?this.options.smartIndent?"smart":"prev":b?"add":"subtract");ba(this.doc,a)&&hc(this,a,b,c)}),indentSelection:oa(function(a){for(var b=this.doc.sel.ranges,c=-1,d=0;d<b.length;d++){var e=b[d];if(e.empty())e.head.line>c&&(hc(this,e.head.line,a,!0),c=e.head.line,d==this.doc.sel.primIndex&&rb(this));else{var g=e.from();e=e.to();var f=
Math.max(c,g.line);c=Math.min(this.lastLine(),e.line-(e.ch?0:1))+1;for(e=f;e<c;++e)hc(this,e,a);e=this.doc.sel.ranges;0==g.ch&&b.length==e.length&&0<e[d].from().ch&&Id(this.doc,d,new Y(g,e[d].to()),Ia)}}}),getTokenAt:function(a,b){return he(this,a,b)},getLineTokens:function(a,b){return he(this,I(a),b,!0)},getTokenTypeAt:function(a){a=T(this.doc,a);var b=fe(this,K(this.doc,a.line)),c=0,d=(b.length-1)/2;a=a.ch;if(0==a)b=b[2];else for(;;){var e=c+d>>1;if((e?b[2*e-1]:0)>=a)d=e;else if(b[2*e+1]<a)c=e+
1;else{b=b[2*e+2];break}}c=b?b.indexOf("overlay "):-1;return 0>c?b:0==c?null:b.slice(0,c-1)},getModeAt:function(b){var c=this.doc.mode;return c.innerMode?a.innerMode(c,this.getTokenAt(b).state).mode:c},getHelper:function(a,b){return this.getHelpers(a,b)[0]},getHelpers:function(a,b){var e=[];if(!c.hasOwnProperty(b))return e;var g=c[b];a=this.getModeAt(a);if("string"==typeof a[b])g[a[b]]&&e.push(g[a[b]]);else if(a[b])for(var f=0;f<a[b].length;f++){var h=g[a[b][f]];h&&e.push(h)}else a.helperType&&g[a.helperType]?
e.push(g[a.helperType]):g[a.name]&&e.push(g[a.name]);for(b=0;b<g._global.length;b++)f=g._global[b],f.pred(a,this)&&-1==d(e,f.val)&&e.push(f.val);return e},getStateAfter:function(a,b){var c=this.doc;a=Math.max(c.first,Math.min(null==a?c.first+c.size-1:a,c.first+c.size-1));return Ib(this,a+1,b).state},cursorCoords:function(a,b){var c=this.doc.sel.primary();a=null==a?c.head:"object"==typeof a?T(this.doc,a):a?c.from():c.to();return Ba(this,a,b||"page")},charCoords:function(a,b){return od(this,T(this.doc,
a),b||"page")},coordsChar:function(a,b){a=Be(this,a,b||"page");return qd(this,a.left,a.top)},lineAtHeight:function(a,b){a=Be(this,{top:a,left:0},b||"page").top;return R(this.doc,a+this.display.viewOffset)},heightAtLine:function(a,b,c){var d=!1;if("number"==typeof a){var e=this.doc.first+this.doc.size-1;a<this.doc.first?a=this.doc.first:a>e&&(a=e,d=!0);a=K(this.doc,a)}return Dc(this,a,{top:0,left:0},b||"page",c||d).top+(d?this.doc.height-Fa(a):0)},defaultTextHeight:function(){return bb(this.display)},
defaultCharWidth:function(){return Nb(this.display)},getViewport:function(){return{from:this.display.viewFrom,to:this.display.viewTo}},addWidget:function(a,b,c,d,e){var g=this.display;a=Ba(this,T(this.doc,a));var f=a.bottom,h=a.left;b.style.position="absolute";b.setAttribute("cm-ignore-events","true");this.display.input.setUneditable(b);g.sizer.appendChild(b);if("over"==d)f=a.top;else if("above"==d||"near"==d){var k=Math.max(g.wrapper.clientHeight,this.doc.height),l=Math.max(g.sizer.clientWidth,g.lineSpace.clientWidth);
("above"==d||a.bottom+b.offsetHeight>k)&&a.top>b.offsetHeight?f=a.top-b.offsetHeight:a.bottom+b.offsetHeight<=k&&(f=a.bottom);h+b.offsetWidth>l&&(h=l-b.offsetWidth)}b.style.top=f+"px";b.style.left=b.style.right="";"right"==e?(h=g.sizer.clientWidth-b.offsetWidth,b.style.right="0px"):("left"==e?h=0:"middle"==e&&(h=(g.sizer.clientWidth-b.offsetWidth)/2),b.style.left=h+"px");c&&(a=yd(this,{left:h,top:f,right:h+b.offsetWidth,bottom:f+b.offsetHeight}),null!=a.scrollTop&&Sb(this,a.scrollTop),null!=a.scrollLeft&&
fb(this,a.scrollLeft))},triggerOnKeyDown:oa(Hf),triggerOnKeyPress:oa(Jf),triggerOnKeyUp:If,triggerOnMouseDown:oa(Kf),execCommand:function(a){if(cc.hasOwnProperty(a))return cc[a].call(null,this)},triggerElectric:oa(function(a){Rf(this,a)}),findPosH:function(a,b,c,d){var e=1;0>b&&(e=-1,b=-b);a=T(this.doc,a);for(var g=0;g<b&&(a=Ud(this.doc,a,e,c,d),!a.hitSide);++g);return a},moveH:oa(function(a,b){var c=this;this.extendSelectionsBy(function(d){return c.display.shift||c.doc.extend||d.empty()?Ud(c.doc,
d.head,a,b,c.options.rtlMoveVisually):0>a?d.from():d.to()},lc)}),deleteH:oa(function(a,b){var c=this.doc;this.doc.sel.somethingSelected()?c.replaceSelection("",null,"+delete"):Ab(this,function(d){var e=Ud(c,d.head,a,b,!1);return 0>a?{from:e,to:d.head}:{from:d.head,to:e}})}),findPosV:function(a,b,c,d){var e=1;0>b&&(e=-1,b=-b);var g=T(this.doc,a);for(a=0;a<b&&(g=Ba(this,g,"div"),null==d?d=g.left:g.left=d,g=Wf(this,g,e,c),!g.hitSide);++a);return g},moveV:oa(function(a,b){var c=this,d=this.doc,e=[],g=
!this.display.shift&&!d.extend&&d.sel.somethingSelected();d.extendSelectionsBy(function(f){if(g)return 0>a?f.from():f.to();var h=Ba(c,f.head,"div");null!=f.goalColumn&&(h.left=f.goalColumn);e.push(h.left);var k=Wf(c,h,a,b);"page"==b&&f==d.sel.primary()&&Gc(c,od(c,k,"div").top-h.top);return k},lc);if(e.length)for(var f=0;f<d.sel.ranges.length;f++)d.sel.ranges[f].goalColumn=e[f]}),findWordAt:function(a){var b=K(this.doc,a.line).text,c=a.ch,d=a.ch;if(b){var e=this.getHelper(a,"wordChars");"before"!=
a.sticky&&d!=b.length||!c?++d:--c;var g=b.charAt(c);for(g=z(g,e)?function(a){return z(a,e)}:/\s/.test(g)?function(a){return/\s/.test(a)}:function(a){return!/\s/.test(a)&&!z(a)};0<c&&g(b.charAt(c-1));)--c;for(;d<b.length&&g(b.charAt(d));)++d}return new Y(I(a.line,c),I(a.line,d))},toggleOverwrite:function(a){if(null==a||a!=this.state.overwrite)(this.state.overwrite=!this.state.overwrite)?v(this.display.cursorDiv,"CodeMirror-overwrite"):eb(this.display.cursorDiv,"CodeMirror-overwrite"),da(this,"overwriteToggle",
this,this.state.overwrite)},hasFocus:function(){return this.display.input.getField()==r()},isReadOnly:function(){return!(!this.options.readOnly&&!this.doc.cantEdit)},scrollTo:oa(function(a,b){Rb(this,a,b)}),getScrollInfo:function(){var a=this.display.scroller;return{left:a.scrollLeft,top:a.scrollTop,height:a.scrollHeight-Ha(this)-this.display.barHeight,width:a.scrollWidth-Ha(this)-this.display.barWidth,clientHeight:jd(this),clientWidth:Za(this)}},scrollIntoView:oa(function(a,b){null==a?(a={from:this.doc.sel.primary().head,
to:null},null==b&&(b=this.options.cursorScrollMargin)):"number"==typeof a?a={from:I(a,0),to:null}:null==a.from&&(a={from:a,to:null});a.to||(a.to=a.from);a.margin=b||0;null!=a.from.line?(Hc(this),this.curOp.scrollToPos=a):Ne(this,a.from,a.to,a.margin)}),setSize:oa(function(a,b){var c=this,d=function(a){return"number"==typeof a||/^\d+$/.test(String(a))?a+"px":a};null!=a&&(this.display.wrapper.style.width=d(a));null!=b&&(this.display.wrapper.style.height=d(b));this.options.lineWrapping&&ye(this);var e=
this.display.viewFrom;this.doc.iter(e,this.display.viewTo,function(a){if(a.widgets)for(var b=0;b<a.widgets.length;b++)if(a.widgets[b].noHScroll){Ra(c,e,"widget");break}++e});this.curOp.forceUpdate=!0;da(this,"refresh",this)}),operation:function(a){return ta(this,a)},startOperation:function(){return gb(this)},endOperation:function(){return hb(this)},refresh:oa(function(){var a=this.display.cachedTextHeight;ra(this);this.curOp.forceUpdate=!0;Ob(this);Rb(this,this.doc.scrollLeft,this.doc.scrollTop);
xd(this);(null==a||.5<Math.abs(a-bb(this.display)))&&td(this);da(this,"refresh",this)}),swapDoc:oa(function(a){var b=this.doc;b.cm=null;$e(this,a);Ob(this);this.display.input.reset();Rb(this,a.scrollLeft,a.scrollTop);this.curOp.forceScroll=!0;la(this,"swapDoc",this,b);return b}),getInputField:function(){return this.display.input.getField()},getWrapperElement:function(){return this.display.wrapper},getScrollerElement:function(){return this.display.scroller},getGutterElement:function(){return this.display.gutters}};
nb(a);a.registerHelper=function(b,d,e){c.hasOwnProperty(b)||(c[b]=a[b]={_global:[]});c[b][d]=e};a.registerGlobalHelper=function(b,d,e,g){a.registerHelper(b,d,g);c[b]._global.push({pred:e,val:g})}})(ca);var kh="iter insert remove copy getEditor constructor".split(" "),pc;for(pc in sa.prototype)sa.prototype.hasOwnProperty(pc)&&0>d(kh,pc)&&(ca.prototype[pc]=function(a){return function(){return a.apply(this.doc,arguments)}}(sa.prototype[pc]));nb(sa);ca.inputStyles={textarea:fa,contenteditable:Z};ca.defineMode=
function(a){ca.defaults.mode||"null"==a||(ca.defaults.mode=a);gg.apply(this,arguments)};ca.defineMIME=function(a,b){ob[a]=b};ca.defineMode("null",function(){return{token:function(a){return a.skipToEnd()}}});ca.defineMIME("text/plain","null");ca.defineExtension=function(a,b){ca.prototype[a]=b};ca.defineDocExtension=function(a,b){sa.prototype[a]=b};ca.fromTextArea=function(a,b){function c(){a.value=k.getValue()}b=b?h(b):{};b.value=a.value;!b.tabindex&&a.tabIndex&&(b.tabindex=a.tabIndex);!b.placeholder&&
a.placeholder&&(b.placeholder=a.placeholder);if(null==b.autofocus){var d=r();b.autofocus=d==a||null!=a.getAttribute("autofocus")&&d==document.body}if(a.form&&(O(a.form,"submit",c),!b.leaveSubmitMethodAlone)){var e=a.form;var g=e.submit;try{var f=e.submit=function(){c();e.submit=g;e.submit();e.submit=f}}catch(Zd){}}b.finishInit=function(b){b.save=c;b.getTextArea=function(){return a};b.toTextArea=function(){b.toTextArea=isNaN;c();a.parentNode.removeChild(b.getWrapperElement());a.style.display="";a.form&&
(va(a.form,"submit",c),"function"==typeof a.form.submit&&(a.form.submit=g))}};a.style.display="none";var k=ca(function(b){return a.parentNode.insertBefore(b,a.nextSibling)},b);return k};(function(a){a.off=va;a.on=O;a.wheelEventPixels=Ag;a.Doc=sa;a.splitLines=Td;a.countColumn=g;a.findColumn=e;a.isWordChar=D;a.Pass=Sc;a.signal=da;a.Line=tb;a.changeEnd=Sa;a.scrollbarModel=Re;a.Pos=I;a.cmpPos=P;a.modes=bd;a.mimeModes=ob;a.resolveMode=yc;a.getMode=cd;a.modeExtensions=pb;a.extendMode=hg;a.copyState=Ya;
a.startState=ce;a.innerMode=dd;a.commands=cc;a.keyMap=bc;a.keyName=Cf;a.isModifierKey=zf;a.lookupKey=zb;a.normalizeKeyMap=Mg;a.StringStream=ea;a.SharedTextMarker=ac;a.TextMarker=Ta;a.LineWidget=$b;a.e_preventDefault=qa;a.e_stopPropagation=ae;a.e_stop=Hb;a.addClass=v;a.contains=l;a.rmClass=eb;a.keyNames=Ua})(ca);ca.version="5.32.0";return ca})},function(m,f){},function(m,f){},function(m,f,c){f.a=function(c){return new q.a(void 0===c?1:c,n.o)};var q=c(5),n=c(2)},function(m,f,c){f.a=function(a){a=void 0===
a?q.p.create():a;return new b(a,a)};var q=c(1),n=c(2),t=c(3),a=function(){function a(a,b){for(var c=0;c<b.length;c++){var f=b[c];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),b=function(){function b(a,c){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");this.value_=a;this.defaultValue=c;this.changed=new t.a}a(b,[{key:"toJSON",value:function(){if(this.value_!==
this.defaultValue)return this.value_.toString()}},{key:"restoreState",value:function(a){try{this.value=Object(n.l)(a.split(","))}catch(v){this.value=this.defaultValue}}},{key:"reset",value:function(){this.value=this.defaultValue}},{key:"value",get:function(){return this.value_},set:function(a){a!==this.value_&&(this.value_=a,this.changed.dispatch())}}]);return b}()},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a){return a-
Math.floor(a)}c.d(f,"b",function(){return p});c.d(f,"a",function(){return g});var t=c(61),a=c(101),b=c(176),l=c(3),r=c(7),v=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),p=function(){function b(a){q(this,b);this.prefix=a;this.aName=this.prefix+"_a";this.bName=this.prefix+"_b"}v(b,[{key:"defineShader",value:function(b){var c=
this.aName,d=this.bName;b.addUniform("highp vec4",c,4);b.addUniform("highp float",d,4);b.addFragmentCode(r.l);b.addFragmentCode(a.d);b.addFragmentCode(r.g);for(var e="\nvec3 "+this.prefix+"(uint64_t x) {\n  vec2 v;\n  float primeModulus = float("+t.b+");\n",g=0;2>g;++g){var f=2*g,h=2*g;e+="\n  v["+g+"] = computeHash(x,\n                        "+c+"["+h+"], "+c+"["+(h+1)+"],\n                        "+d+"["+f+"], "+d+"["+(f+1)+"],\n                        primeModulus, 1.0 / 256.0);\n"}b.addFragmentCode(e+
"\n  vec3 hsv = vec3(v.x, 0.5 + v.y * 0.5, 1.0);\n  return hsvToRgb(hsv);\n}\n")}},{key:"enable",value:function(a,b,c){a.uniform4fv(b.uniform(this.aName),c.a_);a.uniform1fv(b.uniform(this.bName),c.b_)}}]);return b}(),k=new Float32Array(2),h=new Float32Array(3),g=function(){function a(b){q(this,a);this.a_=new Float32Array(16);this.b_=new Float32Array(4);this.changed=new l.a;null==b?(this.hashFunctions=Array(2),this.randomize_()):this.hashFunctions=b;this.computeGPUCoefficients_()}v(a,[{key:"compute",
value:function(a,c){var d=c.low;c=c.high;for(var e=this.hashFunctions,g=0;2>g;++g)k[g]=n(e[g].compute(d,c)/256);Object(b.a)(a,k[0],.5+.5*k[1],1);return a}},{key:"computeCssColor",value:function(a){this.compute(h,a);return"rgb("+100*h[0]+"%,"+100*h[1]+"%,"+100*h[2]+"%)"}},{key:"debugCompute",value:function(a,b){var c=b.low;b=b.high;for(var d=this.b_,e=t.b,g=0;2>g;++g){for(var f=2*g,h=2*g,k=new Float32Array(2),l=0;4>l;++l)k[0]+=this.a_[4*h+l]*(c>>8*l&255),k[1]+=this.a_[4*(h+1)+l]*(b>>8*l&255);h=(k[0]+
k[1])%e;l=h*h%e;var r=l*d[f+1]%e,p=(d[f]+h+r)%e;console.log("b = "+d[f]+", sums="+k[0]+" "+k[1]+", dotResult="+h+", "+("prod = "+h*h+" dotResult2="+l+", y="+r+", ")+("modResult="+p));a[g]=n(1/256*p)}return a}},{key:"randomize_",value:function(){for(var a=0;2>a;++a)this.hashFunctions[a]=t.a.generate()}},{key:"randomize",value:function(){this.randomize_();this.computeGPUCoefficients_();this.changed.dispatch()}},{key:"toString",value:function(){return"new SegmentColorHash(["+this.hashFunctions+"])"}},
{key:"computeGPUCoefficients_",value:function(){for(var a=this.hashFunctions,b=this.a_,c=this.b_,d=0;2>d;++d){var g=a[d],f=2*d,h=8*d;c[f]=1*g.b;c[f+1]=1*g.c;for(f=0;4>f;++f)b[h+f]=1*g.a0[f],b[h+4+f]=1*g.a1[f]}}}],[{key:"getDefault",value:function(){return new a([new t.a(Float32Array.of(609,2364,3749,2289),Float32Array.of(2840,1186,3660,1833),1718,1109),new t.a(Float32Array.of(3466,3835,3345,2040),Float32Array.of(3382,901,18,3444),1534,1432)])}}]);return a}()},function(m,f,c){function q(a,b){if(!(a instanceof
b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,
b):a.__proto__=b)}c.d(f,"a",function(){return h});c.d(f,"c",function(){return g});c.d(f,"b",function(){return d});var a=c(61),b=c(62);m=c(0);var l=c(7),r=c(40),v=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),p=function w(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);
if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return w(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},k=[l.o,l.l,l.d,l.h,"\nfloat computeHash(uint64_t x, vec4 a0, vec4 a1, float b, float c, float modulus, float scalar) {\n  x.low = unnormalizeUint8(x.low);\n  x.high = unnormalizeUint8(x.high);\n  float dotResult = imod(exactDot(a0, x.low) + exactDot(a1, x.high), modulus);\n  float dotResult2 = imod(dotResult * dotResult, modulus);\n  float y = imod(dotResult2 * c, modulus);\n  float modResult = imod(dotResult + y + b, modulus);\n  return fract(modResult * scalar);\n}\n"];
f.d=k;var h=function(b){function c(a,b){q(this,c);var d=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));d.gl=a;d.hashTable=b;d.hashFunctions=null;d.generation=-1;d.texture=null;b=b.hashFunctions.length;d.a=new Float32Array(16*b);d.b=new Float32Array(4*b+5);d.texture=a.createTexture();return d}t(c,b);v(c,[{key:"computeCoefficients",value:function(){var b=this.hashTable,c=b.hashFunctions;if(this.hashFunctions!==c){this.hashFunctions=c;for(var d=this.a,g=this.b,f=c.length,h=b.width,k=[1/h,
1/b.height],l=0;2>l;++l)g[4*f+l]=a.b,g[4*f+3+l]=k[l];g[4*f+2]=1/(b.entryStride*h);for(h=0;h<f;++h)for(k=c[h],l=0;2>l;++l){var r=k[l],p=4*h+2*l,w=4*(4*h+2*l);g[p]=r.b+(0===l?.5/b.entryStride:.5);g[p+1]=r.c;for(p=0;4>p;++p)d[w+p]=r.a0[p],d[w+4+p]=r.a1[p]}}}},{key:"copyToGPU",value:function(){this.computeCoefficients();var a=this.hashTable,b=a.generation;if(this.generation!==b){this.generation=b;var c=a.width,d=a.height,g=this.gl;b=this.texture;g.activeTexture(g.TEXTURE0+g.tempTextureUnit);g.bindTexture(g.TEXTURE_2D,
b);g.pixelStorei(g.UNPACK_ALIGNMENT,1);Object(r.b)(g);var f=g.RGBA;a.tableWithMungedEmptyKey(function(b){g.texImage2D(g.TEXTURE_2D,0,f,c*a.entryStride,d,0,f,g.UNSIGNED_BYTE,new Uint8Array(b.buffer))});g.bindTexture(g.TEXTURE_2D,null)}}},{key:"disposed",value:function(){this.gl.deleteTexture(this.texture);this.texture=null;this.hashTable=this.gl=void 0;this.hashFunctions=null;p(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"disposed",this).call(this)}}],[{key:"get",value:function(a,b){var c=
this;return a.memoize.get(b,function(){return new c(a,b)})}}]);return c}(m.a),g=function(){function a(c,d){d=void 0===d?b.c:d;q(this,a);this.prefix=c;this.numAlternatives=d;$jscomp.initSymbol();this.textureUnitSymbol=Symbol.for("gpuhashtable:"+this.prefix);this.aName=this.prefix+"_a";this.bName=this.prefix+"_b";this.samplerName=this.prefix+"_sampler"}v(a,[{key:"defineShader",value:function(a){var b=this.aName,c=this.bName,d=this.samplerName,g=this.numAlternatives;a.addUniform("highp vec4",b,4*g);
a.addUniform("highp float",c,4*g+5);a.addTextureSampler2D(d,this.textureUnitSymbol);a.addFragmentCode(k);for(var f="",h=0;h<g;++h){for(var l=0;2>l;++l){var r=4*h+2*l,p=4*h+2*l;f+="\nfloat "+this.prefix+"_computeHash_"+h+"_"+l+"(uint64_t x) {\n  float primeModulus = "+c+"["+(4*g+l)+"];\n  float scalar = "+c+"["+(4*g+3+l)+"];\n  return computeHash(x,\n                     "+b+"["+p+"], "+b+"["+(p+1)+"],\n                     "+c+"["+r+"], "+c+"["+(r+1)+"],\n                     primeModulus, scalar);\n}\n"}f+=
"\nvec2 "+this.prefix+"_computeHash_"+h+"(uint64_t x) {\n  vec2 v;\n  v[0] = "+this.prefix+"_computeHash_"+h+"_0(x);\n  v[1] = "+this.prefix+"_computeHash_"+h+"_1(x);\n  return v;\n}\n"}f+="\nbool "+this.hasFunctionName+"(uint64_t x) {\n  float highOffset = "+c+"["+(4*g+2)+"];\n";for(b=0;b<g;++b)f+="\n  {\n    vec2 v = "+this.prefix+"_computeHash_"+b+"(x);\n    vec4 lowResult = texture2D("+d+", v);\n    vec4 highResult = texture2D("+d+", vec2(v.x + highOffset, v.y));\n    if (lowResult == x.low && highResult == x.high) {\n      return true;\n    }\n  }\n";
a.addFragmentCode(f+"\n  return false;\n}\n")}},{key:"enable",value:function(a,b,c){c.copyToGPU();var d=b.textureUnit(this.textureUnitSymbol);a.activeTexture(a.TEXTURE0+d);a.bindTexture(a.TEXTURE_2D,c.texture);a.uniform4fv(b.uniform(this.aName),c.a);a.uniform1fv(b.uniform(this.bName),c.b)}},{key:"disable",value:function(a,b){b=b.textureUnit(this.textureUnitSymbol);a.activeTexture(a.TEXTURE0+b);a.bindTexture(a.TEXTURE_2D,null)}},{key:"hasFunctionName",get:function(){return this.prefix+"_has"}}]);return a}(),
d=function(a){function b(){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}t(b,a);v(b,[{key:"defineShader",value:function(a){p(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"defineShader",this).call(this,a);for(var c=this.samplerName,d=this.numAlternatives,g="\nbool "+this.getFunctionName+"(uint64_t x, out uint64_t value) {\n  float highOffset = "+this.bName+"["+(4*d+2)+"];\n",f=0;f<d;++f)g+="\n  {\n    vec2 v = "+this.prefix+"_computeHash_"+f+"(x);\n    vec4 lowResult = texture2D("+
c+", v);\n    vec4 highResult = texture2D("+c+", vec2(v.x + highOffset, v.y));\n    if (lowResult == x.low && highResult == x.high) {\n      value.low = texture2D("+c+", vec2(v.x + 2.0 * highOffset, v.y));\n      value.high = texture2D("+c+", vec2(v.x + 3.0 * highOffset, v.y));\n      return true;\n    }\n  }\n";a.addFragmentCode(g+"\n  return false;\n}\n")}},{key:"getFunctionName",get:function(){return this.prefix+"_get"}}]);return b}(g)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");
}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}f.c=function(a,b,c){c=void 0===c?!1:c;b=b.attribute("aIndexRaw");0<=b&&(c&&a.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(b,0),a.disableVertexAttribArray(b))};f.d=function(a){return a.memoize.get("IndexBuffer",
function(){return new r(a)})};f.b=function(a){a.addAttribute("highp vec3","aIndexRaw");a.addVertexCode(b.k);a.addVertexCode("\nuint32_t getPrimitiveIndex() {\n  uint32_t result;\n  result.value = vec4(aIndexRaw, 0.0);\n  return result;\n}\n")};c.d(f,"a",function(){return v});f.e=function(b,c){return t.a.fromData(b,new Uint8Array(c.buffer,c.byteOffset,c.byteLength),a.a,a.k)};m=c(0);var t=c(17),a=c(20),b=c(7),l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||
!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,g){c&&a(b.prototype,c);g&&a(b,g);return b}}(),r=function(b){function c(a){q(this,c);var b=(c.__proto__||Object.getPrototypeOf(c)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");b=!b||"object"!==typeof b&&"function"!==typeof b?this:b;b.gl=a;b.buffer=b.registerDisposer(new t.a(a));return b}n(c,b);l(c,[{key:"resize",value:function(a){var b;
if(256>a){var c=b=new Uint8Array(a);for(var e=0;e<a;++e)c[e]=e;c=1}else if(65536>a){c=b=new Uint8Array(2*a);e=0;for(var f=2*a,h=0;h<f;h+=2)c[h]=e,c[h+1]=e>>8,++e;c=2}else if(16777216>a){c=b=new Uint8Array(3*a);e=3*a;for(h=f=0;h<e;h+=3)c[h]=f,c[h+1]=f>>8,c[h+2]=f>>16,++f;c=3}else throw Error("Length of index buffer must not exceed 2^24.");this.buffer.setData(b);this.numComponents=c;this.length=a}},{key:"ensure",value:function(a){(void 0===this.length||this.length<a)&&this.resize(a);return this}},{key:"bindToVertexAttrib",
value:function(b){this.buffer.bindToVertexAttrib(b,this.numComponents,a.t,!0)}},{key:"bind",value:function(a,b){b=void 0===b?0:b;a=a.attribute("aIndexRaw");0<=a&&(this.bindToVertexAttrib(a),0!==b&&this.gl.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(a,b))}}]);return c}(m.a),v=function(){function b(a){q(this,b);this.name=a;this.attributeName="a"+this.name;this.getterName="get"+this.name}l(b,[{key:"defineShader",value:function(a){a.addAttribute("highp vec4",this.attributeName);a.addVertexCode("\nfloat "+
this.getterName+" () {\n  vec4 temp = "+this.attributeName+";\n  return temp.x + temp.y * 256.0 + temp.z * 65536.0;\n}\n")}},{key:"bind",value:function(b,c){b.bindToVertexAttrib(c.attribute(this.attributeName),4,a.t,!1)}},{key:"disable",value:function(a){a.gl.disableVertexAttribArray(a.attribute(this.attributeName))}}]);return b}()},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return v});c.d(f,"b",function(){return p});m=c(18);c=c(0);var a=function h(a,b,c){null===a&&(a=Function.prototype);
var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return h(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},b=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}();$jscomp.initSymbol();var l=Symbol("SingleTextureVolumeChunk.textureUnit");
$jscomp.initSymbol();var r=Symbol("SingleTextureVolumeChunk.textureLayout"),v=function(a){function c(a){q(this,c);var b=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));b.shaderKey=a;return b}t(c,a);b(c,[{key:"defineShader",value:function(a){a.addTextureSampler2D("uVolumeChunkSampler",l)}},{key:"beginDrawing",value:function(a,b){var c=b.textureUnit(l);a.activeTexture(a.TEXTURE0+c);b[r]=null}},{key:"endDrawing",value:function(a,b){a.bindTexture(a.TEXTURE_2D,null);b[r]=null}},{key:"bindChunk",
value:function(a,b,c){var d=c.textureLayout;b[r]!==d&&(b[r]=d,this.setupTextureLayout(a,b,d));a.bindTexture(a.TEXTURE_2D,c.texture)}},{key:"beginSource",value:function(a,b){}}]);return c}(c.a),p=function(c){function g(a,b){q(this,g);a=n(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,a,b));a.texture=null;a.data=b.data;return a}t(g,c);b(g,[{key:"copyToGPU",value:function(b){a(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"copyToGPU",this).call(this,b);var c=this.texture=b.createTexture();
b.bindTexture(b.TEXTURE_2D,c);this.setTextureData(b);b.bindTexture(b.TEXTURE_2D,null)}},{key:"freeGPUMemory",value:function(b){a(g.prototype.__proto__||Object.getPrototypeOf(g.prototype),"freeGPUMemory",this).call(this,b);b.deleteTexture(this.texture);this.texture=null;this.textureLayout.dispose();this.textureLayout=null}}]);return g}(m.a)},function(m,f,c){f.a=function(c,f,t,a,b,l){for(var r=0,v=0,p=1,k=1,h=0;3>h;++h){var g=b[h],d=a[h],e=g%d;r+=Math.floor(g/d)*p;p*=Math.ceil(t[h]/d);v+=e*k;k*=d}a=
f+2*r;t=c[a];a=c[a+1];b=t&16777215;t=t>>24&255;0<t&&(b+=l*(c[(f+a&16777215)+Math.floor(v*t/32)]>>v*t%32&(1<<t)-1));return b}},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,
enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function t(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function a(a,b){b=void 0===b?a.navigationState:new e.e(new e.g(a.navigationState.pose.position,e.f.makeRelative(a.navigationState.pose.orientation,b)),a.navigationState.zoomFactor);return new B.a(a.chunkManager,a.layerManager,b)}function b(b){return new Map([["xy",a(b,J.get("xy"))],["xz",a(b,
J.get("xz"))],["yz",a(b,J.get("yz"))]])}function l(a){return{mouseState:a.mouseState,layerManager:a.layerManager,showAxisLines:a.showAxisLines,visibility:a.visibility}}function r(a){return Object.assign({},l(a),{navigationState:a.perspectiveNavigationState,inputEventMap:a.inputEventBindings.perspectiveView})}function v(a){return Object.assign({},l(a),{navigationState:a.navigationState,inputEventMap:a.inputEventBindings.sliceView})}function p(a,b,c){for(var d={},e=0;2>e;d={relatedLayout:d.relatedLayout},
++e)d.relatedLayout=c[Math.min(c.length-1,e)],a.registerDisposer(Object(D.c)(b.element,0===e?"toggle-layout":"toggle-layout-alternative",function(b){return function(c){a.container.name=b.relatedLayout;c.stopPropagation()}}(d)))}function k(a){var b=W.get(a);if(void 0===b)throw Error("Invalid layout name: "+JSON.stringify(a)+".");return b}function h(a){k(a);return a}c.d(f,"b",function(){return H});c.d(f,"a",function(){return M});m=c(13);var g=c.n(m),d=c(207),e=c(42),w=c(209),B=c(35),F=c(50),G=c(41),
A=c(5);m=c(0);var x=c(4),D=c(15);f=c(1);var z=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),C=function ba(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return ba(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===
b?void 0:b.call(c)}};c(43);var H=function ha(){t(this,ha);this.perspectiveView=new D.a;this.sliceView=new D.a},J=new Map([["xy",void 0],["xz",f.l.rotateX(f.l.create(),f.l.create(),Math.PI/2)],["yz",f.l.rotateY(f.l.create(),f.l.create(),Math.PI/2)]]),E=function(a){function c(a,e,g){t(this,c);var f=q(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));f.container=a;f.rootElement=e;f.viewer=g;var h=b(g),k=g.display,l=Object.assign({},v(g),{showScaleBar:g.showScaleBar}),r=Object.assign({},v(g),{showScaleBar:new G.a(!1,
!1)}),w=function(a,b,c){b=f.registerDisposer(new F.a(k,b,h.get(a),c));p(f,b,[a,a+"-3d"]);return b};a=[d.b(1,d.a("column",[d.b(1,d.a("row",[d.b(1,function(a){w("xy",a,l)}),d.b(1,function(a){w("xz",a,r)}),d.b(1,function(a){w("yz",a,r)})]))]))];d.a("row",a)(e);k.onResize();return f}n(c,a);z(c,[{key:"disposed",value:function(){Object(x.a)(this.rootElement);C(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"disposed",this).call(this)}}]);return c}(m.a),S=function(b){function c(b,e,g,f,h){t(this,
c);var k=q(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));k.container=b;k.rootElement=e;k.viewer=g;k.direction=f;var l=a(g,J.get(h)),n=g.display,m=Object.assign({},r(g),{showSliceViews:g.showPerspectiveSliceViews,showSliceViewsCheckbox:!0}),z=Object.assign({},v(g),{showScaleBar:g.showScaleBar});d.b(1,d.a(f,[d.b(1,function(a){a=k.registerDisposer(new F.a(n,a,l,z));p(k,a,[h,"4panel"])}),d.b(1,function(a){a=k.registerDisposer(new w.a(n,a,m));a.sliceViews.add(l.addRef());p(k,a,["3d","4panel"])})]))(e);
n.onResize();return k}n(c,b);z(c,[{key:"disposed",value:function(){Object(x.a)(this.rootElement);C(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"disposed",this).call(this)}}]);return c}(m.a),K=function(b){function c(b,e,g,f){t(this,c);var h=q(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));h.container=b;h.rootElement=e;h.viewer=g;var k=a(g,J.get(f)),l=Object.assign({},v(g),{showScaleBar:g.showScaleBar});d.a("row",[d.b(1,function(a){a=h.registerDisposer(new F.a(g.display,a,k,
l));p(h,a,["4panel",f+"-3d"])})])(e);g.display.onResize();return h}n(c,b);z(c,[{key:"disposed",value:function(){Object(x.a)(this.rootElement);C(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"disposed",this).call(this)}}]);return c}(m.a),U=function(a){function b(a,c,e){t(this,b);var g=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));g.container=a;g.rootElement=c;g.viewer=e;var f=Object.assign({},r(e),{showSliceViews:new G.a(!1,!1)});d.a("row",[d.b(1,function(a){a=g.registerDisposer(new w.a(e.display,
a,f));p(g,a,["4panel"])})])(c);e.display.onResize();return g}n(b,a);z(b,[{key:"disposed",value:function(){Object(x.a)(this.rootElement);C(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"disposed",this).call(this)}}]);return b}(m.a),W=new Map([["4panel",{factory:function(a,b,c){return new E(a,b,c)}}],["3d",{factory:function(a,b,c){return new U(a,b,c)}}]]);c={};f=$jscomp.makeIterator(J.keys());for(var V=f.next();!V.done;c={axes:c.axes},V=f.next())c.axes=V.value,W.set(c.axes,{factory:function(a){return function(b,
c,d){return new K(b,c,d,a.axes)}}(c)}),W.set(c.axes+"-3d",{factory:function(a){return function(b,c,d){return new S(b,c,d,"row",a.axes)}}(c)});var M=function(a){function b(a,c){c=void 0===c?"xy":c;t(this,b);var d=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));d.viewer=a;d.element=document.createElement("div");d.element.style.flex="1";d.layoutName=new A.a(c,h);var e=d.registerCancellable(g()(function(){return d.updateLayout()},0));d.layoutName.changed.add(e);d.registerDisposer(d.viewer.display.updateStarted.add(function(){return e.flush()}));
e();return d}n(b,a);z(b,[{key:"toJSON",value:function(){return this.layoutName.toJSON()}},{key:"restoreState",value:function(a){this.layoutName.restoreState(a)}},{key:"reset",value:function(){this.layoutName.reset()}},{key:"disposeLayout",value:function(){var a=this.layout;void 0!==a&&(a.dispose(),this.layout=void 0)}},{key:"updateLayout",value:function(){this.disposeLayout();this.layout=k(this.layoutName.value).factory(this,this.element,this.viewer)}},{key:"disposed",value:function(){this.disposeLayout();
C(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"disposed",this).call(this)}},{key:"name",get:function(){return this.layoutName.value},set:function(a){this.layoutName.value=a}},{key:"changed",get:function(){return this.layoutName.changed}}]);return b}(m.a)},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return k});var t=c(9);m=c(29);var a=c(8),b=c(14),l=c(107),r=c(213),v=c(218),p=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,e){c&&a(b.prototype,
c);e&&a(b,e);return b}}();c(219);var k=function(c){function g(a,b){if(!(this instanceof g))throw new TypeError("Cannot call a class as a function");var c=q(this,(g.__proto__||Object.getPrototypeOf(g)).call(this));c.manager=a;c.existingLayer=b;c.statusElement=document.createElement("div");c.submitElement=document.createElement("button");c.namePromptElement=document.createElement("label");c.nameInputElement=document.createElement("input");c.volumeCancellationSource=void 0;c.sourceValid=!1;c.nameValid=
!0;var d=c.content;d.classList.add("add-layer-overlay");var e=document.createElement("form");e.className="source-form";c.registerEventListener(e,"submit",function(a){a.preventDefault();c.validateSource(!0)});var f=document.createElement("label");f.textContent="Source:";a=c.sourceInput=c.registerDisposer(new r.a({completer:function(a,b){return c.manager.dataSourceProvider.volumeCompleter(a,c.manager.chunkManager,b).then(function(a){return{completions:a.completions,makeElement:r.b,offset:a.offset,showSingleResult:!0}})},
delay:0}));a.element.classList.add("add-layer-source");a.inputElement.addEventListener("blur",function(){c.validateSource(!1)});c.submitElement.disabled=!0;a.inputChanged.add(function(){var a=c.volumeCancellationSource;void 0!==a&&(a.cancel(),c.volumeCancellationSource=void 0);c.sourceValid=!1;c.submitElement.disabled=!0;c.statusElement.textContent=""});e.appendChild(f);e.appendChild(a.element);Object(l.a)(f,a.inputElement);f=Object(v.a)();e.appendChild(f);d.appendChild(e);var h=c.statusElement,k=
c.namePromptElement,p=c.nameInputElement;e=c.submitElement;h.className="dialog-status";f=document.createElement("form");f.className="name-form";k.textContent="Name:";p.className="add-layer-name";p.autocomplete="off";p.spellcheck=!1;p.type="text";c.registerEventListener(p,"input",function(){c.validateName()});e.type="submit";Object(l.a)(k,p);f.appendChild(k);f.appendChild(p);f.appendChild(e);d.appendChild(f);d.appendChild(h);void 0!==b?(void 0!==b.sourceUrl?(a.value=b.sourceUrl,c.validateSource()):
c.sourceValid=!0,a.disabled=!0,p.value=b.name,c.validateName(),e.textContent="Save",p.focus()):(b=c.manager.layerManager.managedLayers,0<b.length&&(b=b[b.length-1],b instanceof t.b&&(b=b.sourceUrl,void 0!==b&&(d=c.manager.dataSourceProvider.findSourceGroup(b),a.value=b.substring(0,d),a.inputElement.setSelectionRange(0,d)))),a.inputElement.focus(),e.textContent="Add Layer");c.registerEventListener(f,"submit",function(a){a.preventDefault();c.submit()});return c}n(g,c);p(g,[{key:"isNameValid",value:function(){var a=
this.nameInputElement.value;if(""===a)return!1;a=this.manager.layerManager.getLayerByName(a);return void 0===a||a===this.existingLayer}},{key:"submit",value:function(){this.sourceValid&&this.isNameValid()&&(this.existingLayer?(this.existingLayer.name=this.nameInputElement.value,this.manager.layerManager.layersChanged.dispatch()):this.manager.add(this.manager.getLayer(this.nameInputElement.value,this.sourceInput.value)),this.dispose())}},{key:"validateName",value:function(){var a=this.nameInputElement;
(this.nameValid=this.isNameValid())?(a.classList.add("valid-input"),a.classList.remove("invalid-input")):(a.classList.remove("valid-input"),a.classList.add("invalid-input"));this.validityChanged()}},{key:"validityChanged",value:function(){this.submitElement.disabled=!(this.nameValid&&this.sourceValid)}},{key:"validateSource",value:function(c){var d=this;c=void 0===c?!1:c;var g=this.sourceInput.value;if(""!==g){try{var f=this.manager.dataSourceProvider.suggestLayerName(g),h=this.nameInputElement;if(""===
this.nameInputElement.value){var k=this.manager.layerManager.getUniqueLayerName(f);h.value=k;h.setSelectionRange(0,k.length);this.validateName()}c&&h.focus()}catch(x){this.setError(x.message);return}this.setInfo("Validating volume source...");var l=this.volumeCancellationSource=new b.b;this.manager.dataSourceProvider.getVolume(this.manager.chunkManager,g,void 0,l).then(function(b){l.isCanceled||(d.volumeCancellationSource=void 0,d.sourceValid=!0,d.setInfo(a.d[b.volumeType].toLowerCase()+": "+(b.numChannels+
"-channel "+a.a[b.dataType].toLowerCase())),d.validityChanged())}).catch(function(a){l.isCanceled||(d.volumeCancellationSource=void 0,d.setError(a.message))})}}},{key:"setInfo",value:function(a){this.statusElement.className="dialog-status dialog-status-info";this.statusElement.textContent=a}},{key:"setError",value:function(a){this.statusElement.className="dialog-status dialog-status-error";this.statusElement.textContent=a}}]);return g}(m.a)},function(m,f,c){f.a=function(c,f){""===f.id&&(f.id="unique-id-for-association-"+
q++);c.setAttribute("for",f.id)};var q=0},function(m,f,c){f.a=function(c){var f=-1;return Object.assign(function(){-1===f&&(f=requestAnimationFrame(function(){f=-1;c()}))},{flush:function(){-1!==f&&(f=-1,c())},cancel:function(){-1!==f&&(cancelAnimationFrame(f),f=-1)}})}},function(m,f,c){f.a=function(c){if(!window.getSelection().isCollapsed)return!0;c=c.target.tagName;return"TEXTAREA"===c||"INPUT"===c?!0:!1};f.b=function(c,f){f=void 0===f?"text/plain":f;var a=!1,b=Object(q.c)(document,"copy",function(b){b.clipboardData.setData(f,
c);a=!0;b.stopPropagation();b.preventDefault()},!0);try{document.execCommand("copy")}finally{b()}return a};var q=c(0)},function(m,f,c){f.a=function(c,a){var b=Object(q.c)(c,"drop",function(b){b.preventDefault();if(-1!==b.dataTransfer.types.indexOf(n.d)){var c=JSON.parse(b.dataTransfer.getData(n.d));a.restoreState(c);b.stopPropagation()}}),f=Object(q.c)(c,"dragover",function(a){-1!==a.dataTransfer.types.indexOf(n.d)&&(a.dataTransfer.dropEffect="link",a.preventDefault(),a.stopPropagation())});return function(){f();
b()}};var q=c(0),n=c(67)},function(m,f,c){c(68);c(145);c(149);c(55);c(150);c(88);c(152);c(89);c(154);c(91);c(155);c(92);c(157);c(93);c(159);c(160);c(161);c(162);c(171);c(175);c(186);c(190);m.exports=c(197)},function(m,f,c){c(16)},function(m,f,c){c(16)},function(m,f,c){function q(a,b,c){var f=b[0],l=b[1],p=b[2],k=b[3],h=b[4],g=b[5],d=b[6],e=b[7],w=b[8],n=b[9],q=b[10],t=b[11],m=b[12],x=b[13],D=b[14];b=b[15];var z=c[0],C=c[1],H=c[2],J=c[3];a[0]=z*f+C*h+H*w+J*m;a[1]=z*l+C*g+H*n+J*x;a[2]=z*p+C*d+H*q+J*
D;a[3]=z*k+C*e+H*t+J*b;z=c[4];C=c[5];H=c[6];J=c[7];a[4]=z*f+C*h+H*w+J*m;a[5]=z*l+C*g+H*n+J*x;a[6]=z*p+C*d+H*q+J*D;a[7]=z*k+C*e+H*t+J*b;z=c[8];C=c[9];H=c[10];J=c[11];a[8]=z*f+C*h+H*w+J*m;a[9]=z*l+C*g+H*n+J*x;a[10]=z*p+C*d+H*q+J*D;a[11]=z*k+C*e+H*t+J*b;z=c[12];C=c[13];H=c[14];J=c[15];a[12]=z*f+C*h+H*w+J*m;a[13]=z*l+C*g+H*n+J*x;a[14]=z*p+C*d+H*q+J*D;a[15]=z*k+C*e+H*t+J*b;return a}function n(a,b,c){a[0]=b[0]-c[0];a[1]=b[1]-c[1];a[2]=b[2]-c[2];a[3]=b[3]-c[3];a[4]=b[4]-c[4];a[5]=b[5]-c[5];a[6]=b[6]-c[6];
a[7]=b[7]-c[7];a[8]=b[8]-c[8];a[9]=b[9]-c[9];a[10]=b[10]-c[10];a[11]=b[11]-c[11];a[12]=b[12]-c[12];a[13]=b[13]-c[13];a[14]=b[14]-c[14];a[15]=b[15]-c[15];return a}Object.defineProperty(f,"__esModule",{value:!0});f.create=function(){var a=new t.a(16);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};f.clone=function(a){var b=new t.a(16);b[0]=a[0];b[1]=a[1];b[2]=a[2];b[3]=a[3];b[4]=a[4];b[5]=a[5];b[6]=a[6];b[7]=a[7];b[8]=a[8];
b[9]=a[9];b[10]=a[10];b[11]=a[11];b[12]=a[12];b[13]=a[13];b[14]=a[14];b[15]=a[15];return b};f.copy=function(a,b){a[0]=b[0];a[1]=b[1];a[2]=b[2];a[3]=b[3];a[4]=b[4];a[5]=b[5];a[6]=b[6];a[7]=b[7];a[8]=b[8];a[9]=b[9];a[10]=b[10];a[11]=b[11];a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};f.fromValues=function(a,b,c,f,v,p,k,h,g,d,e,w,n,q,m,A){var l=new t.a(16);l[0]=a;l[1]=b;l[2]=c;l[3]=f;l[4]=v;l[5]=p;l[6]=k;l[7]=h;l[8]=g;l[9]=d;l[10]=e;l[11]=w;l[12]=n;l[13]=q;l[14]=m;l[15]=A;return l};f.set=
function(a,b,c,f,v,p,k,h,g,d,e,w,n,q,t,m,x){a[0]=b;a[1]=c;a[2]=f;a[3]=v;a[4]=p;a[5]=k;a[6]=h;a[7]=g;a[8]=d;a[9]=e;a[10]=w;a[11]=n;a[12]=q;a[13]=t;a[14]=m;a[15]=x;return a};f.identity=function(a){a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};f.transpose=function(a,b){if(a===b){var c=b[1],f=b[2],v=b[3],p=b[6],k=b[7],h=b[11];a[1]=b[4];a[2]=b[8];a[3]=b[12];a[4]=c;a[6]=b[9];a[7]=b[13];a[8]=f;a[9]=p;a[11]=b[14];a[12]=v;a[13]=
k;a[14]=h}else a[0]=b[0],a[1]=b[4],a[2]=b[8],a[3]=b[12],a[4]=b[1],a[5]=b[5],a[6]=b[9],a[7]=b[13],a[8]=b[2],a[9]=b[6],a[10]=b[10],a[11]=b[14],a[12]=b[3],a[13]=b[7],a[14]=b[11],a[15]=b[15];return a};f.invert=function(a,b){var c=b[0],f=b[1],v=b[2],p=b[3],k=b[4],h=b[5],g=b[6],d=b[7],e=b[8],w=b[9],n=b[10],q=b[11],t=b[12],m=b[13],x=b[14];b=b[15];var D=c*h-f*k,z=c*g-v*k,C=c*d-p*k,H=f*g-v*h,J=f*d-p*h,E=v*d-p*g,S=e*m-w*t,K=e*x-n*t,U=e*b-q*t,W=w*x-n*m,V=w*b-q*m,M=n*b-q*x,R=D*M-z*V+C*W+H*U-J*K+E*S;if(!R)return null;
R=1/R;a[0]=(h*M-g*V+d*W)*R;a[1]=(v*V-f*M-p*W)*R;a[2]=(m*E-x*J+b*H)*R;a[3]=(n*J-w*E-q*H)*R;a[4]=(g*U-k*M-d*K)*R;a[5]=(c*M-v*U+p*K)*R;a[6]=(x*C-t*E-b*z)*R;a[7]=(e*E-n*C+q*z)*R;a[8]=(k*V-h*U+d*S)*R;a[9]=(f*U-c*V-p*S)*R;a[10]=(t*J-m*C+b*D)*R;a[11]=(w*C-e*J-q*D)*R;a[12]=(h*K-k*W-g*S)*R;a[13]=(c*W-f*K+v*S)*R;a[14]=(m*z-t*H-x*D)*R;a[15]=(e*H-w*z+n*D)*R;return a};f.adjoint=function(a,b){var c=b[0],f=b[1],v=b[2],p=b[3],k=b[4],h=b[5],g=b[6],d=b[7],e=b[8],w=b[9],n=b[10],q=b[11],t=b[12],m=b[13],x=b[14];b=b[15];
a[0]=h*(n*b-q*x)-w*(g*b-d*x)+m*(g*q-d*n);a[1]=-(f*(n*b-q*x)-w*(v*b-p*x)+m*(v*q-p*n));a[2]=f*(g*b-d*x)-h*(v*b-p*x)+m*(v*d-p*g);a[3]=-(f*(g*q-d*n)-h*(v*q-p*n)+w*(v*d-p*g));a[4]=-(k*(n*b-q*x)-e*(g*b-d*x)+t*(g*q-d*n));a[5]=c*(n*b-q*x)-e*(v*b-p*x)+t*(v*q-p*n);a[6]=-(c*(g*b-d*x)-k*(v*b-p*x)+t*(v*d-p*g));a[7]=c*(g*q-d*n)-k*(v*q-p*n)+e*(v*d-p*g);a[8]=k*(w*b-q*m)-e*(h*b-d*m)+t*(h*q-d*w);a[9]=-(c*(w*b-q*m)-e*(f*b-p*m)+t*(f*q-p*w));a[10]=c*(h*b-d*m)-k*(f*b-p*m)+t*(f*d-p*h);a[11]=-(c*(h*q-d*w)-k*(f*q-p*w)+e*
(f*d-p*h));a[12]=-(k*(w*x-n*m)-e*(h*x-g*m)+t*(h*n-g*w));a[13]=c*(w*x-n*m)-e*(f*x-v*m)+t*(f*n-v*w);a[14]=-(c*(h*x-g*m)-k*(f*x-v*m)+t*(f*g-v*h));a[15]=c*(h*n-g*w)-k*(f*n-v*w)+e*(f*g-v*h);return a};f.determinant=function(a){var b=a[0],c=a[1],f=a[2],v=a[3],p=a[4],k=a[5],h=a[6],g=a[7],d=a[8],e=a[9],w=a[10],n=a[11],q=a[12],m=a[13],t=a[14];a=a[15];return(b*k-c*p)*(w*a-n*t)-(b*h-f*p)*(e*a-n*m)+(b*g-v*p)*(e*t-w*m)+(c*h-f*k)*(d*a-n*q)-(c*g-v*k)*(d*t-w*q)+(f*g-v*h)*(d*m-e*q)};f.multiply=q;f.translate=function(a,
b,c){var f=c[0],l=c[1];c=c[2];if(b===a)a[12]=b[0]*f+b[4]*l+b[8]*c+b[12],a[13]=b[1]*f+b[5]*l+b[9]*c+b[13],a[14]=b[2]*f+b[6]*l+b[10]*c+b[14],a[15]=b[3]*f+b[7]*l+b[11]*c+b[15];else{var p=b[0];var k=b[1];var h=b[2];var g=b[3];var d=b[4];var e=b[5];var w=b[6];var n=b[7];var q=b[8];var m=b[9];var t=b[10];var x=b[11];a[0]=p;a[1]=k;a[2]=h;a[3]=g;a[4]=d;a[5]=e;a[6]=w;a[7]=n;a[8]=q;a[9]=m;a[10]=t;a[11]=x;a[12]=p*f+d*l+q*c+b[12];a[13]=k*f+e*l+m*c+b[13];a[14]=h*f+w*l+t*c+b[14];a[15]=g*f+n*l+x*c+b[15]}return a};
f.scale=function(a,b,c){var f=c[0],l=c[1];c=c[2];a[0]=b[0]*f;a[1]=b[1]*f;a[2]=b[2]*f;a[3]=b[3]*f;a[4]=b[4]*l;a[5]=b[5]*l;a[6]=b[6]*l;a[7]=b[7]*l;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12];a[13]=b[13];a[14]=b[14];a[15]=b[15];return a};f.rotate=function(a,b,c,f){var l=f[0],p=f[1];f=f[2];var k=Math.sqrt(l*l+p*p+f*f);if(Math.abs(k)<t.b)return null;k=1/k;l*=k;p*=k;f*=k;var h=Math.sin(c);var g=Math.cos(c);var d=1-g;c=b[0];k=b[1];var e=b[2];var r=b[3];var n=b[4];var q=b[5];var m=b[6];
var A=b[7];var x=b[8];var D=b[9];var z=b[10];var C=b[11];var H=l*l*d+g;var J=p*l*d+f*h;var E=f*l*d-p*h;var S=l*p*d-f*h;var K=p*p*d+g;var U=f*p*d+l*h;var W=l*f*d+p*h;l=p*f*d-l*h;p=f*f*d+g;a[0]=c*H+n*J+x*E;a[1]=k*H+q*J+D*E;a[2]=e*H+m*J+z*E;a[3]=r*H+A*J+C*E;a[4]=c*S+n*K+x*U;a[5]=k*S+q*K+D*U;a[6]=e*S+m*K+z*U;a[7]=r*S+A*K+C*U;a[8]=c*W+n*l+x*p;a[9]=k*W+q*l+D*p;a[10]=e*W+m*l+z*p;a[11]=r*W+A*l+C*p;b!==a&&(a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);return a};f.rotateX=function(a,b,c){var f=Math.sin(c);
c=Math.cos(c);var l=b[4],p=b[5],k=b[6],h=b[7],g=b[8],d=b[9],e=b[10],n=b[11];b!==a&&(a[0]=b[0],a[1]=b[1],a[2]=b[2],a[3]=b[3],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[4]=l*c+g*f;a[5]=p*c+d*f;a[6]=k*c+e*f;a[7]=h*c+n*f;a[8]=g*c-l*f;a[9]=d*c-p*f;a[10]=e*c-k*f;a[11]=n*c-h*f;return a};f.rotateY=function(a,b,c){var f=Math.sin(c);c=Math.cos(c);var l=b[0],p=b[1],k=b[2],h=b[3],g=b[8],d=b[9],e=b[10],n=b[11];b!==a&&(a[4]=b[4],a[5]=b[5],a[6]=b[6],a[7]=b[7],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);
a[0]=l*c-g*f;a[1]=p*c-d*f;a[2]=k*c-e*f;a[3]=h*c-n*f;a[8]=l*f+g*c;a[9]=p*f+d*c;a[10]=k*f+e*c;a[11]=h*f+n*c;return a};f.rotateZ=function(a,b,c){var f=Math.sin(c);c=Math.cos(c);var l=b[0],p=b[1],k=b[2],h=b[3],g=b[4],d=b[5],e=b[6],n=b[7];b!==a&&(a[8]=b[8],a[9]=b[9],a[10]=b[10],a[11]=b[11],a[12]=b[12],a[13]=b[13],a[14]=b[14],a[15]=b[15]);a[0]=l*c+g*f;a[1]=p*c+d*f;a[2]=k*c+e*f;a[3]=h*c+n*f;a[4]=g*c-l*f;a[5]=d*c-p*f;a[6]=e*c-k*f;a[7]=n*c-h*f;return a};f.fromTranslation=function(a,b){a[0]=1;a[1]=0;a[2]=0;
a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=b[0];a[13]=b[1];a[14]=b[2];a[15]=1;return a};f.fromScaling=function(a,b){a[0]=b[0];a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b[1];a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=b[2];a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};f.fromRotation=function(a,b,c){var f=c[0],l=c[1];c=c[2];var p=Math.sqrt(f*f+l*l+c*c);if(Math.abs(p)<t.b)return null;p=1/p;f*=p;l*=p;c*=p;p=Math.sin(b);b=Math.cos(b);var k=1-b;a[0]=f*f*k+b;a[1]=l*f*k+c*p;a[2]=c*f*k-l*p;a[3]=
0;a[4]=f*l*k-c*p;a[5]=l*l*k+b;a[6]=c*l*k+f*p;a[7]=0;a[8]=f*c*k+l*p;a[9]=l*c*k-f*p;a[10]=c*c*k+b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};f.fromXRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=1;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=c;a[7]=0;a[8]=0;a[9]=-c;a[10]=b;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};f.fromYRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=0;a[2]=-c;a[3]=0;a[4]=0;a[5]=1;a[6]=0;a[7]=0;a[8]=c;a[9]=0;a[10]=b;a[11]=0;a[12]=0;a[13]=0;
a[14]=0;a[15]=1;return a};f.fromZRotation=function(a,b){var c=Math.sin(b);b=Math.cos(b);a[0]=b;a[1]=c;a[2]=0;a[3]=0;a[4]=-c;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=1;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};f.fromRotationTranslation=function(a,b,c){var f=b[0],l=b[1],p=b[2],k=b[3],h=f+f,g=l+l,d=p+p;b=f*h;var e=f*g;f*=d;var n=l*g;l*=d;p*=d;h*=k;g*=k;k*=d;a[0]=1-(n+p);a[1]=e+k;a[2]=f-g;a[3]=0;a[4]=e-k;a[5]=1-(b+p);a[6]=l+h;a[7]=0;a[8]=f+g;a[9]=l-h;a[10]=1-(b+n);a[11]=0;a[12]=c[0];a[13]=c[1];
a[14]=c[2];a[15]=1;return a};f.getTranslation=function(a,b){a[0]=b[12];a[1]=b[13];a[2]=b[14];return a};f.getScaling=function(a,b){var c=b[0],f=b[1],n=b[2],p=b[4],k=b[5],h=b[6],g=b[8],d=b[9];b=b[10];a[0]=Math.sqrt(c*c+f*f+n*n);a[1]=Math.sqrt(p*p+k*k+h*h);a[2]=Math.sqrt(g*g+d*d+b*b);return a};f.getRotation=function(a,b){var c=b[0]+b[5]+b[10];0<c?(c=2*Math.sqrt(c+1),a[3]=.25*c,a[0]=(b[6]-b[9])/c,a[1]=(b[8]-b[2])/c,a[2]=(b[1]-b[4])/c):b[0]>b[5]&b[0]>b[10]?(c=2*Math.sqrt(1+b[0]-b[5]-b[10]),a[3]=(b[6]-
b[9])/c,a[0]=.25*c,a[1]=(b[1]+b[4])/c,a[2]=(b[8]+b[2])/c):b[5]>b[10]?(c=2*Math.sqrt(1+b[5]-b[0]-b[10]),a[3]=(b[8]-b[2])/c,a[0]=(b[1]+b[4])/c,a[1]=.25*c,a[2]=(b[6]+b[9])/c):(c=2*Math.sqrt(1+b[10]-b[0]-b[5]),a[3]=(b[1]-b[4])/c,a[0]=(b[8]+b[2])/c,a[1]=(b[6]+b[9])/c,a[2]=.25*c);return a};f.fromRotationTranslationScale=function(a,b,c,f){var l=b[0],p=b[1],k=b[2],h=b[3],g=l+l,d=p+p,e=k+k;b=l*g;var r=l*d;l*=e;var n=p*d;p*=e;k*=e;g*=h;d*=h;h*=e;e=f[0];var q=f[1];f=f[2];a[0]=(1-(n+k))*e;a[1]=(r+h)*e;a[2]=(l-
d)*e;a[3]=0;a[4]=(r-h)*q;a[5]=(1-(b+k))*q;a[6]=(p+g)*q;a[7]=0;a[8]=(l+d)*f;a[9]=(p-g)*f;a[10]=(1-(b+n))*f;a[11]=0;a[12]=c[0];a[13]=c[1];a[14]=c[2];a[15]=1;return a};f.fromRotationTranslationScaleOrigin=function(a,b,c,f,n){var l=b[0],k=b[1],h=b[2],g=b[3],d=l+l,e=k+k,r=h+h;b=l*d;var q=l*e;l*=r;var v=k*e;k*=r;h*=r;d*=g;e*=g;g*=r;r=f[0];var m=f[1];f=f[2];var t=n[0],x=n[1];n=n[2];a[0]=(1-(v+h))*r;a[1]=(q+g)*r;a[2]=(l-e)*r;a[3]=0;a[4]=(q-g)*m;a[5]=(1-(b+h))*m;a[6]=(k+d)*m;a[7]=0;a[8]=(l+e)*f;a[9]=(k-d)*
f;a[10]=(1-(b+v))*f;a[11]=0;a[12]=c[0]+t-(a[0]*t+a[4]*x+a[8]*n);a[13]=c[1]+x-(a[1]*t+a[5]*x+a[9]*n);a[14]=c[2]+n-(a[2]*t+a[6]*x+a[10]*n);a[15]=1;return a};f.fromQuat=function(a,b){var c=b[0],f=b[1],n=b[2];b=b[3];var p=c+c,k=f+f,h=n+n;c*=p;var g=f*p;f*=k;var d=n*p,e=n*k;n*=h;p*=b;k*=b;b*=h;a[0]=1-f-n;a[1]=g+b;a[2]=d-k;a[3]=0;a[4]=g-b;a[5]=1-c-n;a[6]=e+p;a[7]=0;a[8]=d+k;a[9]=e-p;a[10]=1-c-f;a[11]=0;a[12]=0;a[13]=0;a[14]=0;a[15]=1;return a};f.frustum=function(a,b,c,f,n,p,k){var h=1/(c-b),g=1/(n-f),d=
1/(p-k);a[0]=2*p*h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=2*p*g;a[6]=0;a[7]=0;a[8]=(c+b)*h;a[9]=(n+f)*g;a[10]=(k+p)*d;a[11]=-1;a[12]=0;a[13]=0;a[14]=k*p*2*d;a[15]=0;return a};f.perspective=function(a,b,c,f,n){b=1/Math.tan(b/2);var l=1/(f-n);a[0]=b/c;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=b;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=(n+f)*l;a[11]=-1;a[12]=0;a[13]=0;a[14]=2*n*f*l;a[15]=0;return a};f.perspectiveFromFieldOfView=function(a,b,c,f){var l=Math.tan(b.upDegrees*Math.PI/180),p=Math.tan(b.downDegrees*Math.PI/180),
k=Math.tan(b.leftDegrees*Math.PI/180);b=Math.tan(b.rightDegrees*Math.PI/180);var h=2/(k+b),g=2/(l+p);a[0]=h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=g;a[6]=0;a[7]=0;a[8]=-((k-b)*h*.5);a[9]=(l-p)*g*.5;a[10]=f/(c-f);a[11]=-1;a[12]=0;a[13]=0;a[14]=f*c/(c-f);a[15]=0;return a};f.ortho=function(a,b,c,f,n,p,k){var h=1/(b-c),g=1/(f-n),d=1/(p-k);a[0]=-2*h;a[1]=0;a[2]=0;a[3]=0;a[4]=0;a[5]=-2*g;a[6]=0;a[7]=0;a[8]=0;a[9]=0;a[10]=2*d;a[11]=0;a[12]=(b+c)*h;a[13]=(n+f)*g;a[14]=(k+p)*d;a[15]=1;return a};f.lookAt=function(a,
b,c,f){var l=b[0],p=b[1];b=b[2];var k=f[0];var h=f[1];var g=f[2];var d=c[0];f=c[1];var e=c[2];if(Math.abs(l-d)<t.b&&Math.abs(p-f)<t.b&&Math.abs(b-e)<t.b)return mat4.identity(a);c=l-d;f=p-f;d=b-e;var n=1/Math.sqrt(c*c+f*f+d*d);c*=n;f*=n;d*=n;e=h*d-g*f;g=g*c-k*d;k=k*f-h*c;(n=Math.sqrt(e*e+g*g+k*k))?(n=1/n,e*=n,g*=n,k*=n):k=g=e=0;h=f*k-d*g;var r=d*e-c*k;var q=c*g-f*e;(n=Math.sqrt(h*h+r*r+q*q))?(n=1/n,h*=n,r*=n,q*=n):q=r=h=0;a[0]=e;a[1]=h;a[2]=c;a[3]=0;a[4]=g;a[5]=r;a[6]=f;a[7]=0;a[8]=k;a[9]=q;a[10]=
d;a[11]=0;a[12]=-(e*l+g*p+k*b);a[13]=-(h*l+r*p+q*b);a[14]=-(c*l+f*p+d*b);a[15]=1;return a};f.targetTo=function(a,b,c,f){var l=b[0],p=b[1];b=b[2];var k=f[0],h=f[1],g=f[2];f=l-c[0];var d=p-c[1];c=b-c[2];var e=f*f+d*d+c*c;0<e&&(e=1/Math.sqrt(e),f*=e,d*=e,c*=e);e=h*c-g*d;g=g*f-k*c;k=k*d-h*f;a[0]=e;a[1]=g;a[2]=k;a[3]=0;a[4]=d*k-c*g;a[5]=c*e-f*k;a[6]=f*g-d*e;a[7]=0;a[8]=f;a[9]=d;a[10]=c;a[11]=0;a[12]=l;a[13]=p;a[14]=b;a[15]=1;return a};f.str=function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+
", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};f.frob=function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))};f.add=function(a,b,c){a[0]=b[0]+c[0];a[1]=b[1]+c[1];a[2]=
b[2]+c[2];a[3]=b[3]+c[3];a[4]=b[4]+c[4];a[5]=b[5]+c[5];a[6]=b[6]+c[6];a[7]=b[7]+c[7];a[8]=b[8]+c[8];a[9]=b[9]+c[9];a[10]=b[10]+c[10];a[11]=b[11]+c[11];a[12]=b[12]+c[12];a[13]=b[13]+c[13];a[14]=b[14]+c[14];a[15]=b[15]+c[15];return a};f.subtract=n;f.multiplyScalar=function(a,b,c){a[0]=b[0]*c;a[1]=b[1]*c;a[2]=b[2]*c;a[3]=b[3]*c;a[4]=b[4]*c;a[5]=b[5]*c;a[6]=b[6]*c;a[7]=b[7]*c;a[8]=b[8]*c;a[9]=b[9]*c;a[10]=b[10]*c;a[11]=b[11]*c;a[12]=b[12]*c;a[13]=b[13]*c;a[14]=b[14]*c;a[15]=b[15]*c;return a};f.multiplyScalarAndAdd=
function(a,b,c,f){a[0]=b[0]+c[0]*f;a[1]=b[1]+c[1]*f;a[2]=b[2]+c[2]*f;a[3]=b[3]+c[3]*f;a[4]=b[4]+c[4]*f;a[5]=b[5]+c[5]*f;a[6]=b[6]+c[6]*f;a[7]=b[7]+c[7]*f;a[8]=b[8]+c[8]*f;a[9]=b[9]+c[9]*f;a[10]=b[10]+c[10]*f;a[11]=b[11]+c[11]*f;a[12]=b[12]+c[12]*f;a[13]=b[13]+c[13]*f;a[14]=b[14]+c[14]*f;a[15]=b[15]+c[15]*f;return a};f.exactEquals=function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===
b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]};f.equals=function(a,b){var c=a[0],f=a[1],n=a[2],p=a[3],k=a[4],h=a[5],g=a[6],d=a[7],e=a[8],q=a[9],m=a[10],F=a[11],G=a[12],A=a[13],x=a[14];a=a[15];var D=b[0],z=b[1],C=b[2],H=b[3],J=b[4],E=b[5],S=b[6],K=b[7],U=b[8],W=b[9],V=b[10],M=b[11],R=b[12],ba=b[13],ha=b[14];b=b[15];return Math.abs(c-D)<=t.b*Math.max(1,Math.abs(c),Math.abs(D))&&Math.abs(f-z)<=t.b*Math.max(1,Math.abs(f),Math.abs(z))&&Math.abs(n-C)<=t.b*Math.max(1,Math.abs(n),Math.abs(C))&&
Math.abs(p-H)<=t.b*Math.max(1,Math.abs(p),Math.abs(H))&&Math.abs(k-J)<=t.b*Math.max(1,Math.abs(k),Math.abs(J))&&Math.abs(h-E)<=t.b*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(g-S)<=t.b*Math.max(1,Math.abs(g),Math.abs(S))&&Math.abs(d-K)<=t.b*Math.max(1,Math.abs(d),Math.abs(K))&&Math.abs(e-U)<=t.b*Math.max(1,Math.abs(e),Math.abs(U))&&Math.abs(q-W)<=t.b*Math.max(1,Math.abs(q),Math.abs(W))&&Math.abs(m-V)<=t.b*Math.max(1,Math.abs(m),Math.abs(V))&&Math.abs(F-M)<=t.b*Math.max(1,Math.abs(F),Math.abs(M))&&
Math.abs(G-R)<=t.b*Math.max(1,Math.abs(G),Math.abs(R))&&Math.abs(A-ba)<=t.b*Math.max(1,Math.abs(A),Math.abs(ba))&&Math.abs(x-ha)<=t.b*Math.max(1,Math.abs(x),Math.abs(ha))&&Math.abs(a-b)<=t.b*Math.max(1,Math.abs(a),Math.abs(b))};var t=c(16);f.mul=q;f.sub=n},function(m,f,c){function q(){var a=new l.a(4);a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a}function n(a,b,c){c*=.5;var d=Math.sin(c);a[0]=d*b[0];a[1]=d*b[1];a[2]=d*b[2];a[3]=Math.cos(c);return a}function t(a,b,c){var d=b[0],e=b[1],f=b[2];b=b[3];var g=c[0],
h=c[1],k=c[2];c=c[3];a[0]=d*c+b*g+e*k-f*h;a[1]=e*c+b*h+f*g-d*k;a[2]=f*c+b*k+d*h-e*g;a[3]=b*c-d*g-e*h-f*k;return a}function a(a,b,c,d){var e=b[0],f=b[1],g=b[2];b=b[3];var h=c[0],k=c[1],l=c[2];c=c[3];var p=e*h+f*k+g*l+b*c;0>p&&(p=-p,h=-h,k=-k,l=-l,c=-c);if(1E-6<1-p){var n=Math.acos(p);var r=Math.sin(n);p=Math.sin((1-d)*n)/r;d=Math.sin(d*n)/r}else p=1-d;a[0]=p*e+d*h;a[1]=p*f+d*k;a[2]=p*g+d*l;a[3]=p*b+d*c;return a}function b(a,b){var c=b[0]+b[4]+b[8];if(0<c)c=Math.sqrt(c+1),a[3]=.5*c,c=.5/c,a[0]=(b[5]-
b[7])*c,a[1]=(b[6]-b[2])*c,a[2]=(b[1]-b[3])*c;else{var d=0;b[4]>b[0]&&(d=1);b[8]>b[3*d+d]&&(d=2);var e=(d+1)%3,f=(d+2)%3;c=Math.sqrt(b[3*d+d]-b[3*e+e]-b[3*f+f]+1);a[d]=.5*c;c=.5/c;a[3]=(b[3*e+f]-b[3*f+e])*c;a[e]=(b[3*e+d]+b[3*d+e])*c;a[f]=(b[3*f+d]+b[3*d+f])*c}return a}Object.defineProperty(f,"__esModule",{value:!0});f.create=q;f.identity=function(a){a[0]=0;a[1]=0;a[2]=0;a[3]=1;return a};f.setAxisAngle=n;f.getAxisAngle=function(a,b){var c=2*Math.acos(b[3]),d=Math.sin(c/2);0!=d?(a[0]=b[0]/d,a[1]=b[1]/
d,a[2]=b[2]/d):(a[0]=1,a[1]=0,a[2]=0);return c};f.multiply=t;f.rotateX=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c+b*g;a[1]=e*c+f*g;a[2]=f*c-e*g;a[3]=b*c-d*g;return a};f.rotateY=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c-f*g;a[1]=e*c+b*g;a[2]=f*c+d*g;a[3]=b*c-e*g;return a};f.rotateZ=function(a,b,c){c*=.5;var d=b[0],e=b[1],f=b[2];b=b[3];var g=Math.sin(c);c=Math.cos(c);a[0]=d*c+e*g;a[1]=e*c-d*g;a[2]=
f*c+b*g;a[3]=b*c-f*g;return a};f.calculateW=function(a,b){var c=b[0],d=b[1];b=b[2];a[0]=c;a[1]=d;a[2]=b;a[3]=Math.sqrt(Math.abs(1-c*c-d*d-b*b));return a};f.slerp=a;f.invert=function(a,b){var c=b[0],d=b[1],e=b[2];b=b[3];var f=c*c+d*d+e*e+b*b;f=f?1/f:0;a[0]=-c*f;a[1]=-d*f;a[2]=-e*f;a[3]=b*f;return a};f.conjugate=function(a,b){a[0]=-b[0];a[1]=-b[1];a[2]=-b[2];a[3]=b[3];return a};f.fromMat3=b;f.fromEuler=function(a,b,c,d){var e=.5*Math.PI/180;b*=e;c*=e;d*=e;e=Math.sin(b);b=Math.cos(b);var f=Math.sin(c);
c=Math.cos(c);var g=Math.sin(d);d=Math.cos(d);a[0]=e*c*d-b*f*g;a[1]=b*f*d+e*c*g;a[2]=b*c*g-e*f*d;a[3]=b*c*d+e*f*g;return a};f.str=function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"};var l=c(16),r=c(70),v=c(71);m=c(72);f.clone=m.clone;f.fromValues=m.fromValues;f.copy=m.copy;f.set=m.set;f.add=m.add;f.mul=t;f.scale=m.scale;f.dot=m.dot;f.lerp=m.lerp;c=m.length;f.length=c;f.len=c;c=m.squaredLength;f.squaredLength=c;f.sqrLen=c;var p=m.normalize;f.normalize=p;f.exactEquals=m.exactEquals;f.equals=
m.equals;m=function(){var a=v.create(),b=v.fromValues(1,0,0),c=v.fromValues(0,1,0);return function(d,e,f){var g=v.dot(e,f);if(-.999999>g)return v.cross(a,b,e),1E-6>v.len(a)&&v.cross(a,c,e),v.normalize(a,a),n(d,a,Math.PI),d;if(.999999<g)return d[0]=0,d[1]=0,d[2]=0,d[3]=1,d;v.cross(a,e,f);d[0]=a[0];d[1]=a[1];d[2]=a[2];d[3]=1+g;return p(d,d)}}();f.rotationTo=m;m=function(){var b=q(),c=q();return function(f,d,e,h,k,l){a(b,d,k,l);a(c,e,h,l);a(f,b,c,2*l*(1-l));return f}}();f.sqlerp=m;m=function(){var a=
r.create();return function(c,f,d,e){a[0]=d[0];a[3]=d[1];a[6]=d[2];a[1]=e[0];a[4]=e[1];a[7]=e[2];a[2]=-f[0];a[5]=-f[1];a[8]=-f[2];return p(c,b(c,a))}}();f.setAxes=m},function(m,f,c){function q(){var c=new n.a(2);c[0]=0;c[1]=0;return c}var n=c(16);(function(){var c=q();return function(a,b,f,n,q,p){b||(b=2);f||(f=0);for(n=n?Math.min(n*b+f,a.length):a.length;f<n;f+=b)c[0]=a[f],c[1]=a[f+1],q(c,c,p),a[f]=c[0],a[f+1]=c[1];return a}})()},function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function n(b,c){var f=b.memoize.get({type:"getSharedCredentialsProvider",credentialsProvider:Object(a.a)(c)},function(){return new t.a(c.addRef(),b.rpc)}),k=f.addCounterpartRef();f.dispose();return k}f.a=function(){return function(c){return function(c){function f(a){for(var b=[],c=0;c<arguments.length;++c)b[c-0]=arguments[c];
if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");var d;c=(d=f.__proto__||Object.getPrototypeOf(f)).call.apply(d,[].concat([this],$jscomp.arrayFromIterable(b)));if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");d=!c||"object"!==typeof c&&"function"!==typeof c?this:c;d.credentialsProvider=b[1].credentialsProvider.addRef();return d}q(f,c);b(f,[{key:"initializeCounterpart",value:function(a,b){b.credentialsProvider=n(this.chunkManager,
this.credentialsProvider);l(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"initializeCounterpart",this).call(this,a,b)}}],[{key:"encodeOptions",value:function(b){var c=l(f.__proto__||Object.getPrototypeOf(f),"encodeOptions",this).call(this,b);c.credentialsProvider=Object(a.a)(b.credentialsProvider);return c}}]);return f}(c)}};var t=c(118),a=c(19),b=function(){function a(a,b){for(var c=0;c<b.length;c++){var f=b[c];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=
!0);Object.defineProperty(a,f.key,f)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),l=function v(a,b,c){null===a&&(a=Function.prototype);var f=Object.getOwnPropertyDescriptor(a,b);if(void 0===f){if(a=Object.getPrototypeOf(a),null!==a)return v(a,b,c)}else{if("value"in f)return f.value;b=f.get;return void 0===b?void 0:b.call(c)}}},function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);
a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return t});m=c(119);c=c(6);var n=function(){function a(a,c){for(var b=0;b<c.length;b++){var f=c[b];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}();f=this&&this.__decorate||function(a,
b,c,f){var l=arguments.length,p=3>l?b:null===f?f=Object.getOwnPropertyDescriptor(b,c):f,k;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)p=Reflect.decorate(a,b,c,f);else for(var h=a.length-1;0<=h;h--)if(k=a[h])p=(3>l?k(p):3<l?k(b,c,p):k(b,c))||p;return 3<l&&p&&Object.defineProperty(b,c,p),p};var t=function(a){function b(a,c){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var f=(b.__proto__||Object.getPrototypeOf(b)).call(this);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
f=!f||"object"!==typeof f&&"function"!==typeof f?this:f;f.provider=a;f.registerDisposer(a);f.initializeCounterpart(c);return f}q(b,a);n(b,[{key:"get",value:function(a,b){return this.provider.get(a,b)}}]);return b}(c.b);t=f([Object(c.g)(m.b)],t);Object(c.d)(m.a,function(a,b){return this.get(a.providerId).get(a.invalidCredentials,b).then(function(a){return{value:a}})})},function(m,f,c){f.b="CredentialsProvider";f.a="CredentialsProvider.get"},function(m,f,c){f.a=function(c){for(var f=0,q=c.length,a=
0;a<q;++a)f=31*f+c.charCodeAt(a)|0;return f}},function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function n(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(f,"c",function(){return t});
c.d(f,"d",function(){return a});c.d(f,"a",function(){return b});c.d(f,"b",function(){return l});var t;(function(a){a[a.RAW=0]="RAW";a[a.JPEG=1]="JPEG";a[a.COMPRESSED_SEGMENTATION=2]="COMPRESSED_SEGMENTATION"})(t||(t={}));var a=function v(){n(this,v)};a.RPC_ID="brainmaps/VolumeChunkSource";var b=function p(){n(this,p)};b.RPC_ID="brainmaps/MeshSource";var l=function(a){function b(){n(this,b);var a=(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!a||"object"!==typeof a&&"function"!==typeof a?this:a}q(b,a);return b}(b);l.RPC_ID="brainmaps/SkeletonSource"},function(m,f,c){f.b="mesh/MeshLayer";f.a="mesh/FragmentSource"},function(m,f,c){var q=c(73);m.exports=function(){return q.Date.now()}},function(m,f,c){f=c(125);m.exports="object"==typeof f&&f&&f.Object===Object&&f},function(m,f){f=function(){return this}();try{f=f||Function("return this")()||(0,eval)("this")}catch(c){"object"===typeof window&&(f=window)}m.exports=f},function(m,f,c){var q=
c(49),n=c(127),t=0/0,a=/^\s+|\s+$/g,b=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,r=/^0o[0-7]+$/i,v=parseInt;m.exports=function(c){if("number"==typeof c)return c;if(n(c))return t;q(c)&&(c="function"==typeof c.valueOf?c.valueOf():c,c=q(c)?c+"":c);if("string"!=typeof c)return 0===c?c:+c;c=c.replace(a,"");var f=l.test(c);return f||r.test(c)?v(c.slice(2),f?2:8):b.test(c)?t:+c}},function(m,f,c){var q=c(128),n=c(131);m.exports=function(c){return"symbol"==typeof c||n(c)&&"[object Symbol]"==q(c)}},function(m,f,c){f=
c(74);var q=c(129),n=c(130),t=f?f.toStringTag:void 0;m.exports=function(a){return null==a?void 0===a?"[object Undefined]":"[object Null]":t&&t in Object(a)?q(a):n(a)}},function(m,f,c){f=c(74);c=Object.prototype;var q=c.hasOwnProperty,n=c.toString,t=f?f.toStringTag:void 0;m.exports=function(a){var b=q.call(a,t),c=a[t];try{a[t]=void 0;var f=!0}catch(p){}var m=n.call(a);f&&(b?a[t]=c:delete a[t]);return m}},function(m,f){var c=Object.prototype.toString;m.exports=function(f){return c.call(f)}},function(m,
f){m.exports=function(c){return null!=c&&"object"==typeof c}},function(m,f,c){var q=c(13),n=c(49);m.exports=function(c,a,b){var f=!0,r=!0;if("function"!=typeof c)throw new TypeError("Expected a function");n(b)&&(f="leading"in b?!!b.leading:f,r="trailing"in b?!!b.trailing:r);return q(c,a,{leading:f,maxWait:a,trailing:r})}},function(m,f,c){f.b=function(c,f){c.remove(f)};f.a=function(c,f){c.add(f)}},function(m,f,c){f.b=function(c,f){return c.low+","+c.high+(f?"_"+f.center.toString()+"_"+f.size.toString():
"")};f.a=function(c,f){var n=c.segmentEquivalences;c=$jscomp.makeIterator(c.visibleSegments);for(var a=c.next();!a.done;a=c.next())if(a=a.value,n.disjointSets.isMinElement(a))for(var b=$jscomp.makeIterator(n.setElements(a)),l=b.next();!l.done;l=b.next())f(l.value,a)}},function(m,f,c){c.d(f,"b",function(){return q});var q;(function(c){c[c.LITTLE=0]="LITTLE";c[c.BIG=1]="BIG"})(q||(q={}));m=function(){var c=Uint16Array.of(4386);return 17===(new Uint8Array(c.buffer))[0]?q.BIG:q.LITTLE}();f.a=m},function(m,
f,c){f.a="skeleton/SkeletonLayer"},function(m,f,c){f.a=function(c){var f={antialias:!1,stencil:!0};c=c.getContext("webgl",f)||c.getContext("experimental-webgl",f);if(null==c)throw Error("WebGL not supported.");c.memoize=new q.a;c.maxTextureSize=c.getParameter(c.MAX_TEXTURE_SIZE);c.maxTextureImageUnits=c.getParameter(c.MAX_TEXTURE_IMAGE_UNITS);c.tempTextureUnit=c.maxTextureImageUnits-1;c.WEBGL_draw_buffers=c.getExtension("WEBGL_draw_buffers");if(!c.WEBGL_draw_buffers)throw Error("WEBGL_draw_buffers extension not available");
c.ANGLE_instanced_arrays=c.getExtension("ANGLE_instanced_arrays");if(!c.ANGLE_instanced_arrays)throw Error("ANGLE_instanced_ararys extension not available");f=$jscomp.makeIterator(["OES_texture_float","OES_element_index_uint"]);for(var a=f.next();!a.done;a=f.next())if(a=a.value,!c.getExtension(a))throw Error(a+" extension not available");return c};var q=c(46)},function(m,f,c){var q=function(){function c(c,a){for(var b=0;b<a.length;b++){var f=a[b];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in
f&&(f.writable=!0);Object.defineProperty(c,f.key,f)}}return function(f,a,b){a&&c(f.prototype,a);b&&c(f,b);return f}}();m=function(){function c(){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");}q(c,null,[{key:"insertAfter",value:function(c,a){var b=c.next0;a.next0=b;a.prev0=c;c.next0=a;b.prev0=a}},{key:"insertBefore",value:function(c,a){var b=c.prev0;a.prev0=b;a.next0=c;c.prev0=a;b.next0=a}},{key:"front",value:function(c){var a=c.next0;return a===c?null:a}},{key:"back",
value:function(c){var a=c.prev0;return a===c?null:a}},{key:"pop",value:function(c){var a=c.next0,b=c.prev0;a.prev0=b;b.next0=a;c.next0=null;c.prev0=null;return c}},{key:"iterator",value:function(c){function a(a,l){for(;;)switch(b){case 0:f=c.next0;case 1:if(f===c){b=3;break}b=4;return{value:f,done:!1};case 4:if(void 0===l){b=5;break}b=-1;throw l;case 5:case 2:f=f.next0;b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,f,n={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,
b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();n[Symbol.iterator]=function(){return this};return n}},{key:"reverseIterator",value:function(c){function a(a,l){for(;;)switch(b){case 0:f=c.prev0;case 1:if(f===c){b=3;break}b=4;return{value:f,done:!1};case 4:if(void 0===l){b=5;break}b=-1;throw l;case 5:case 2:f=f.prev0;b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,f,n={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,
b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();n[Symbol.iterator]=function(){return this};return n}},{key:"initializeHead",value:function(c){c.next0=c.prev0=c}}]);return c}();f.a=m},function(m,f,c){c.d(f,"a",function(){return n});var q=function(){function c(a,b){for(var c=0;c<b.length;c++){var f=b[c];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(a,b,f){b&&c(a.prototype,b);f&&
c(a,f);return a}}(),n=function(){function c(a){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");this.parents=[];this.parentPriorities=[];this.bindings=new Map;if(void 0!==a){this.parents.push.apply(this.parents,[].concat($jscomp.arrayFromIterable(a.parents)));this.parentPriorities.push.apply(this.parentPriorities,[].concat($jscomp.arrayFromIterable(a.parentPriorities)));a=$jscomp.makeIterator(a.bindings);for(var b=a.next();!b.done;b=a.next()){var f=$jscomp.makeIterator(b.value);
b=f.next().value;f=f.next().value;this.bindings.set(b,f)}}}q(c,[{key:"addParent",value:function(a,b){for(var c=this,f=this.parents,n=this.parentPriorities,p=0,k=f.length;p<k&&b<n[p];)++p;f.splice(p,0,a);n.splice(p,0,b);return function(){c.removeParent(a)}}},{key:"removeParent",value:function(a){a=this.parents.indexOf(a);if(-1===a)throw Error("Attempt to remove non-existent parent map.");this.parents.splice(a,1);this.parentPriorities.splice(a,1)}},{key:"set",value:function(a,b){this.bindings.set(a,
b)}},{key:"delete",value:function(a){this.bindings.delete(a)}},{key:"clear",value:function(){this.bindings.clear();this.parents.length=0;this.parentPriorities.length=0}},{key:"get",value:function(a){for(var b=this.parents,c=this.parentPriorities,f=c.length,n=0,p;n<f&&0<c[n];++n)if(p=b[n].get(a),void 0!==p)return p;p=this.bindings.get(a);if(void 0!==p)return p;for(;n<f;++n)if(p=b[n].get(a),void 0!==p)return p}},{key:"getAll",value:function(a){function b(b,e){for(;;)switch(c){case 0:g=d,h=g.parents,
k=g.parentPriorities,p=k.length,n=0;case 1:if(!(n<p&&0<k[n])){c=2;break}f=h[n].get(a);if(void 0===f){c=3;break}c=4;return{value:f,done:!1};case 4:if(void 0===e){c=5;break}c=-1;throw e;case 5:case 3:c=1;break;case 2:f=d.bindings.get(a);if(void 0===f){c=6;break}c=7;return{value:f,done:!1};case 7:if(void 0===e){c=8;break}c=-1;throw e;case 8:case 6:case 9:if(!(n<p)){c=10;break}f=h[n].get(a);if(void 0===f){c=11;break}c=12;return{value:f,done:!1};case 12:if(void 0===e){c=13;break}c=-1;throw e;case 13:case 11:c=
9;break;case 10:c=-1;default:return{value:void 0,done:!0}}}var c=0,f,n,p,k,h,g,d=this,e={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();e[Symbol.iterator]=function(){return this};return e}}]);return c}()},function(m,f,c){f.a=function(c){var f=0;switch(c.deltaMode){case 0:f=.005;break;case 1:f=.1;break;case 2:f=2}return Math.exp(c.deltaY*f)}},function(m,f){},function(m,f,c){c.d(f,"a",function(){return t});
var q=c(1),n=function(){function a(a,c){for(var b=0;b<c.length;b++){var f=c[b];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),t=function(){function a(b,c){c=void 0===c?q.d:c;if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.size=q.p.clone(b);this.transform=q.j.clone(c);this.invTransform=q.j.invert(q.j.create(),c)}n(a,[{key:"toObject",
value:function(a){a.size=this.size;a.transform=this.transform}},{key:"localSpatialToGlobal",value:function(a,c){return q.p.transformMat4(a,c,this.transform)}},{key:"globalToLocalSpatial",value:function(a,c){return q.p.transformMat4(a,c,this.invTransform)}},{key:"globalToLocalGrid",value:function(a,c){this.globalToLocalSpatial(a,c);q.p.divide(a,a,this.size);return a}},{key:"localSpatialVectorToGlobal",value:function(a,c){return Object(q.n)(a,c,this.transform)}},{key:"globalToLocalSpatialVector",value:function(a,
c){return Object(q.n)(a,c,this.invTransform)}},{key:"assignLocalSpatialToGlobalMat4",value:function(a){return q.j.copy(a,this.transform)}}],[{key:"get",value:function(b,c){c=void 0===c?q.d:c;var f=a.cache,l=JSON.stringify([Array.from(b),Array.from(c)]),p=f.get(l);void 0===p&&(p=new a(b,c),f.set(l,p));return p}},{key:"fromObject",value:function(b){return a.get(b.size,b.transform)}}]);return a}();t.cache=new Map},function(m,f,c){f.a=function(c,f){return c===f?!0:1E-6>Math.abs(c-f)/Math.min(Math.abs(c),
Math.abs(f))}},function(m,f){},function(m,f,c){Object.defineProperty(f,"__esModule",{value:!0});m=c(85);f=c(47);var q=c(146);m.a.register(f.a,function(){return new q.a})},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=
Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return r});var t=c(86),a=c(26),b=c(14),l=c(147),r=function(c){function f(){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");var c=q(this,(f.__proto__||Object.getPrototypeOf(f)).apply(this,arguments));c.get=Object(t.c)(function(c){var f=new a.a(!0),d;return new Promise(function(a,g){function e(a,
b){b=void 0===b?"Request authorization.":b;f.setText((void 0===a?"Brain Maps authorization required.":a)+"  ");a=document.createElement("button");a.textContent=b;f.element.appendChild(a);a.addEventListener("click",function(){h(!1)});f.setVisible(!0)}function h(c){void 0!==d&&d.cancel();d=new b.b;e("Waiting for Brain Maps authorization...","Retry");Object(l.a)({clientId:"639403125587-4k5hgdfumtrvur8v48e3pr7oo91d765k.apps.googleusercontent.com",scopes:["https://www.googleapis.com/auth/brainmaps"],immediate:c,
authUser:0},d).then(function(b){void 0!==d&&(d=void 0,f.dispose(),a(b))},function(a){void 0!==d&&(d=void 0,c?e():e("Brain Maps authorization failed: "+a+".","Retry"))})}c.add(function(){void 0!==d&&(d.cancel(),d=void 0,f.dispose(),g(b.a))});h(!0)})});return c}n(f,c);return f}(t.b)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){var c=document.createElement("iframe");c.style.display="none";c.id=a;c.name=a;c.src="https://accounts.google.com/o/oauth2/postmessageRelay?"+
("parent="+encodeURIComponent(location.origin)+"#rpctoken="+b);document.body.appendChild(c)}f.a=function(b,c){c=void 0===c?t.e:c;var d=Object(l.a)();void 0===h&&(h=new k);var f=h,g=f.makeAuthRequestUrl({state:d,clientId:b.clientId,scopes:b.scopes,approvalPrompt:b.approvalPrompt,loginHint:b.loginHint,immediate:b.immediate,authUser:b.authUser}),p=f.addPendingRequest(d);d=new Promise(function(a,b){p.finished.add(function(c,d){void 0!==c?a(c):b(d)})});p.finished.add(c.add(function(){p.finished.dispatch(void 0,
t.a)}));if(b.immediate)f.relayReadyPromise.then(function(){if(!c.isCanceled){var b=document.createElement("iframe");b.src=g;b.style.display="none";document.body.appendChild(b);p.finished.add(function(){Object(a.b)(b)})}});else if(!c.isCanceled){var n=open(g);null!==n&&p.finished.add(function(){n.close()})}return d};var t=c(14),a=c(4),b=c(2),l=c(148),r=c(3),v=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);
Object.defineProperty(a,d.key,d)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),p=function d(){q(this,d);this.finished=new r.b},k=function(){function a(){var c=this;q(this,a);this.proxyName="postmessageRelay"+Object(l.a)();this.rpcToken=""+Object(l.a)();this.relayReadyService="oauth2relayReady:"+this.rpcToken;this.oauth2CallbackService="oauth2callback:"+this.rpcToken;this.pendingRequests=new Map;n(this.proxyName,this.rpcToken);this.relayReadyPromise=new Promise(function(a){addEventListener("message",
function(d){if("https://accounts.google.com"===d.origin)try{var e=Object(b.u)(JSON.parse(d.data)),f=Object(b.B)(e.s);f===c.relayReadyService&&a();if(f===c.oauth2CallbackService){var h=Object(b.a)(e.a,function(a){return a}),k=Object(b.B)(h[0]),l=location.origin;if(!k.startsWith(l+"#")&&!k.startsWith(l+"?"))throw Error("oauth2callback: URL "+JSON.stringify(k)+" "+("does not match current origin "+l+"."));for(var p=k.substring(l.length+1).split("&"),n=new Map,q=$jscomp.makeIterator(p),m=q.next();!m.done;m=
q.next()){var r=m.value.match("^([a-z_]+)=(.*)$");if(null===r)throw Error("oauth2callback: URL part "+JSON.stringify(r)+" does not match expected pattern.");n.set(r[1],r[2])}var w=n.get("state");if(void 0===w)throw Error("oauth2callback: State argument is missing.");var t=c.pendingRequests.get(w);if(void 0!==t){var v=n.get("error");if(void 0!==v){var B=n.get("error_subtype");e=v;void 0!==B&&(e+=": "+B);t.finished.dispatch(void 0,Error("Error obtaining Google OAuth2 token: "+e))}else{var V=n.get("access_token"),
M=n.get("token_type"),R=n.get("expires_in"),ba=n.get("scope");if(void 0===V||void 0===M||void 0===R||void 0===ba)throw Error("oauth2callback: URL lacks expected parameters.");t.finished.dispatch({accessToken:V,tokenType:M,expiresIn:R,scope:ba})}}}}catch(ha){throw Error("Invalid message received from https://accounts.google.com: "+JSON.stringify(d.data)+": "+(ha.message+"."));}})})}v(a,[{key:"addPendingRequest",value:function(a){var b=this,c=new p;this.pendingRequests.set(a,c);c.finished.add(function(){b.pendingRequests.delete(a)});
return c}},{key:"makeAuthRequestUrl",value:function(a){var b="https://accounts.google.com/o/oauth2/auth?client_id="+encodeURIComponent(a.clientId);b=b+"&redirect_uri=postmessage&response_type=token"+("&origin="+encodeURIComponent(void 0===a.origin?location.origin:a.origin));b+="&proxy="+this.proxyName;b=b+"&include_granted_scopes=true"+("&scope="+encodeURIComponent(a.scopes.join(" ")));a.state&&(b+="&state="+a.state);a.approvalPrompt&&(b+="&approval_prompt="+encodeURIComponent(a.approvalPrompt));
a.loginHint&&(b+="&login_hint="+encodeURIComponent(a.loginHint));a.immediate&&(b+="&immediate=true");void 0!==a.authUser&&(b+="&authuser="+a.authUser);return b}}]);return a}(),h},function(m,f,c){f.a=function(c){c=Math.ceil((void 0===c?128:c)/32);var f=new Uint32Array(c);crypto.getRandomValues(f);for(var q="",a=0;a<c;++a)q+=("00000000"+f[a].toString(16)).slice(-8);return q}},function(m,f,c){Object.defineProperty(f,"__esModule",{value:!0});var q=c(68),n=c(47);m=c(22);Object(m.b)("brainmaps",function(c){return new q.BrainmapsDataSource(q.productionInstance,
c.credentialsManager.getCredentialsProvider(n.a))})},function(m,f,c){Object.defineProperty(f,"__esModule",{value:!0});var q=c(55);m=c(22);Object(m.b)("ndstore",function(){return new q.NDStoreDataSource})},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function t(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(f,"c",function(){return a});c.d(f,"d",function(){return b});c.d(f,"b",function(){return l});c.d(f,"a",function(){return r});var a;(function(a){a[a.JPEG=0]="JPEG";a[a.COMPRESSED_SEGMENTATION=1]="COMPRESSED_SEGMENTATION"})(a||
(a={}));m=function p(){t(this,p)};var b=function(a){function b(){t(this,b);return q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}n(b,a);return b}(m);b.RPC_ID="dvid/VolumeChunkSource";var l;(function(a){a[a.JPEG=0]="JPEG"})(l||(l={}));var r=function(a){function b(){t(this,b);return q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}n(b,a);return b}(m);r.RPC_ID="dvid/TileChunkSource"},function(m,f,c){Object.defineProperty(f,"__esModule",{value:!0});var q=c(88);
m=c(22);Object(m.b)("dvid",function(){return new q.DVIDDataSource})},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&
(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function t(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(f,"b",function(){return a});c.d(f,"a",function(){return b});m=function(a){function b(){t(this,b);return q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}n(b,a);return b}(function r(){t(this,r)});var a=function(a){function b(){t(this,b);return q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}n(b,
a);return b}(m);a.RPC_ID="render/TileChunkSource";var b=function(a){function b(){t(this,b);return q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}n(b,a);return b}(m);b.RPC_ID="render/PointMatchSource"},function(m,f,c){Object.defineProperty(f,"__esModule",{value:!0});m=c(22);var q=c(89);Object(m.b)("render",function(){return new q.RenderDataSource})},function(m,f,c){Object.defineProperty(f,"__esModule",{value:!0});var q=c(91);m=c(22);Object(m.b)("openconnectome",function(){return new q.OpenConnectomeDataSource})},
function(m,f,c){function q(a,c){if(!(a instanceof c))throw new TypeError("Cannot call a class as a function");}c.d(f,"b",function(){return n});c.d(f,"c",function(){return t});c.d(f,"a",function(){return a});var n;(function(a){a[a.RAW=0]="RAW";a[a.JPEG=1]="JPEG";a[a.COMPRESSED_SEGMENTATION=2]="COMPRESSED_SEGMENTATION"})(n||(n={}));var t=function l(){q(this,l)};t.RPC_ID="precomputed/VolumeChunkSource";var a=function r(){q(this,r)};a.RPC_ID="precomputed/MeshSource"},function(m,f,c){Object.defineProperty(f,
"__esModule",{value:!0});var q=c(92);m=c(22);Object(m.b)("precomputed",function(){return new q.PrecomputedDataSource})},function(m,f,c){c.d(f,"b",function(){return n});f.a="nifti/getNiftiVolumeInfo";var q;(function(c){c[c.NONE=0]="NONE";c[c.BINARY=1]="BINARY";c[c.UINT8=2]="UINT8";c[c.INT16=4]="INT16";c[c.INT32=8]="INT32";c[c.FLOAT32=16]="FLOAT32";c[c.COMPLEX64=32]="COMPLEX64";c[c.FLOAT64=64]="FLOAT64";c[c.RGB24=128]="RGB24";c[c.INT8=256]="INT8";c[c.UINT16=512]="UINT16";c[c.UINT32=768]="UINT32";c[c.INT64=
1024]="INT64";c[c.UINT64=1280]="UINT64";c[c.FLOAT128=1536]="FLOAT128";c[c.COMPLEX128=1792]="COMPLEX128";c[c.COMPLEX256=2048]="COMPLEX256"})(q||(q={}));var n=function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");};n.RPC_ID="nifti/VolumeChunkSource"},function(m,f,c){Object.defineProperty(f,"__esModule",{value:!0});var q=c(93);m=c(22);Object(m.b)("nifti",function(){return new q.NiftiDataSource})},function(m,f){},function(m,f){},function(m,f,c){function q(a,b){if(!(a instanceof
b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,
b):a.__proto__=b)}function a(a){return new d.a({shaderError:a.shaderError,fragmentMain:a.fragmentMain,fragmentMainStartLine:v.a})}Object.defineProperty(f,"__esModule",{value:!0});c.d(f,"ImageUserLayer",function(){return w});var b=c(57);m=c(12);var l=c(9);f=c(29);var r=c(8),v=c(164),p=c(36),k=c(1),h=c(28),g=c(58),d=c(59),e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}
return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();c(96);c(60);c(97);var w=function(a){function c(a,d){q(this,c);var e=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));e.opacity=Object(p.a)(.5);e.fragmentMain=Object(v.c)();e.shaderError=Object(h.b)();e.transform=new b.a;var f=d.source;if("string"!==typeof f)throw Error("Invalid image layer specification");e.opacity.restoreState(d.opacity);e.fragmentMain.restoreState(d.shader);e.transform.restoreState(d.transform);e.registerDisposer(e.fragmentMain.changed.add(function(){e.specificationChanged.dispatch()}));
e.volumePath=f;Object(l.d)(a.dataSourceProvider,a.chunkManager,f).then(function(a){e.wasDisposed||(a=e.renderLayer=new v.b(a,{opacity:e.opacity,fragmentMain:e.fragmentMain,shaderError:e.shaderError,sourceOptions:{transform:k.j.clone(e.transform.transform)}}),e.addRenderLayer(a),e.shaderError.changed.dispatch())});return e}t(c,a);e(c,[{key:"toJSON",value:function(){var a={type:"image"};a.source=this.volumePath;a.opacity=this.opacity.toJSON();a.shader=this.fragmentMain.toJSON();a.transform=this.transform.toJSON();
return a}},{key:"makeDropdown",value:function(a){return new B(a,this)}}]);return c}(m.f),B=function(b){function c(b,d){q(this,c);var e=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));e.element=b;e.layer=d;e.opacityWidget=e.registerDisposer(new g.a(e.layer.opacity));e.codeWidget=e.registerDisposer(a(e.layer));b.classList.add("image-dropdown");var f=e.opacityWidget;d=document.createElement("div");d.className="image-dropdown-top-row";f.promptElement.textContent="Opacity";f=document.createElement("div");
f.style.flex="1";var h=document.createElement("a"),k=document.createElement("button");k.type="button";k.textContent="?";k.className="help-link";h.appendChild(k);h.title="Documentation on image layer rendering";h.target="_blank";h.href="https://github.com/google/neuroglancer/blob/master/src/neuroglancer/sliceview/image_layer_rendering.md";k=document.createElement("button");k.innerHTML="&square;";k.className="maximize-button";k.title="Show larger editor view";e.registerEventListener(k,"click",function(){new F(e.layer)});
d.appendChild(e.opacityWidget.element);d.appendChild(f);d.appendChild(k);d.appendChild(h);b.appendChild(d);b.appendChild(e.codeWidget.element);e.codeWidget.textEditor.refresh();return e}t(c,b);e(c,[{key:"onShow",value:function(){this.codeWidget.textEditor.refresh()}}]);return c}(m.g),F=function(b){function c(b){q(this,c);var d=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));d.layer=b;d.codeWidget=d.registerDisposer(a(d.layer));d.content.classList.add("image-layer-shader-overlay");d.content.appendChild(d.codeWidget.element);
d.codeWidget.textEditor.refresh();return d}t(c,b);return c}(f.a);Object(l.e)("image",w);Object(l.f)(r.d.IMAGE,w)},function(m,f){},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,
enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function t(a){return Object(b.a)(void 0===a?"void main() {\n  emitGrayscale(toNormalized(getDataValue()));\n}\n":a)}f.c=t;c.d(f,"b",function(){return p});m=c(94);var a=c(36),b=c(28),l=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,d){c&&a(b.prototype,
c);d&&a(b,d);return b}}(),r=function h(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return h(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};f.a="//NEUROGLANCER_IMAGE_RENDERLAYER_FRAGMENT_MAIN_START";var v=c(54),p=function(c){function f(c,e){var d=void 0===e?{}:e;e=void 0===d.opacity?Object(a.a)(.5):d.opacity;var g=void 0===d.fragmentMain?t():d.fragmentMain,h=void 0===
d.shaderError?Object(b.b)():d.shaderError;d=void 0===d.sourceOptions?{}:d.sourceOptions;if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");var l=q(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,c,{shaderError:h,sourceOptions:d}));l.fragmentMain=g;l.opacity=e;l.registerDisposer(e.changed.add(function(){l.redrawNeeded.dispatch()}));l.registerDisposer(g.changed.add(function(){l.shaderUpdated=!0;l.redrawNeeded.dispatch()}));return l}n(f,c);l(f,[{key:"getShaderKey",
value:function(){return"volume.ImageRenderLayer:"+JSON.stringify(this.fragmentMain.value)}},{key:"getValueAt",value:function(a){for(var b=$jscomp.makeIterator(this.sources),c=b.next();!c.done;c=b.next()){c=$jscomp.makeIterator(c.value);for(var d=c.next();!d.done;d=c.next())if(d=d.value.getValueAt(a),null!=d)return d}return null}},{key:"defineShader",value:function(a){r(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"defineShader",this).call(this,a);a.addUniform("highp float","uOpacity");
a.addFragmentCode("\nvoid emitRGBA(vec4 rgba) {\n  emit(vec4(rgba.rgb, rgba.a * uOpacity));\n}\nvoid emitRGB(vec3 rgb) {\n  emit(vec4(rgb, uOpacity));\n}\nvoid emitGrayscale(float value) {\n  emit(vec4(value, value, value, uOpacity));\n}\nvoid emitTransparent() {\n  emit(vec4(0.0, 0.0, 0.0, 0.0));\n}\n");a.addFragmentCode(v);a.setFragmentMainFunction("//NEUROGLANCER_IMAGE_RENDERLAYER_FRAGMENT_MAIN_START\n"+this.fragmentMain.value)}},{key:"beginSlice",value:function(a){a=r(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),
"beginSlice",this).call(this,a);this.gl.uniform1f(a.uniform("uOpacity"),this.opacity.value);return a}}]);return f}(m.a)},function(m,f){},function(m,f,c){(function(c){function f(a,b){function d(a){if(!e.parentNode)return c.off(document,"mousemove",d);e.style.top=Math.max(0,a.clientY-e.offsetHeight-5)+"px";e.style.left=a.clientX+5+"px"}var e=document.createElement("div");e.className="CodeMirror-lint-tooltip";e.appendChild(b.cloneNode(!0));document.body.appendChild(e);c.on(document,"mousemove",d);d(a);
null!=e.style.opacity&&(e.style.opacity=1);return e}function q(a){a.parentNode&&(null==a.style.opacity&&a.parentNode&&a.parentNode.removeChild(a),a.style.opacity=0,setTimeout(function(){a.parentNode&&a.parentNode.removeChild(a)},600))}function a(a,b,g){function d(){c.off(g,"mouseout",d);e&&(q(e),e=null)}var e=f(a,b),h=setInterval(function(){if(e)for(var a=g;;a=a.parentNode){a&&11==a.nodeType&&(a=a.host);if(a==document.body)return;if(!a){d();break}}if(!e)return clearInterval(h)},400);c.on(g,"mouseout",
d)}function b(b,c,f){this.marked=[];this.options=c;this.timeout=null;this.hasGutter=f;this.onMouseOver=function(c){var d=c.target||c.srcElement;if(/\bCodeMirror-lint-mark-/.test(d.className)){d=d.getBoundingClientRect();var e=b.findMarksAt(b.coordsChar({left:(d.left+d.right)/2,top:(d.top+d.bottom)/2},"client"));d=[];for(var f=0;f<e.length;++f){var g=e[f].__annotation;g&&d.push(g)}if(d.length){e=c.target||c.srcElement;f=document.createDocumentFragment();for(g=0;g<d.length;g++)f.appendChild(v(d[g]));
a(c,f,e)}}};this.waitingFor=0}function l(a){var b=a.state.lint;b.hasGutter&&a.clearGutter("CodeMirror-lint-markers");for(a=0;a<b.marked.length;++a)b.marked[a].clear();b.marked.length=0}function m(b,e,f,g){var d=document.createElement("div"),h=d;d.className="CodeMirror-lint-marker-"+e;f&&(h=d.appendChild(document.createElement("div")),h.className="CodeMirror-lint-marker-multiple");if(0!=g)c.on(h,"mouseover",function(c){a(c,b,h)});return d}function v(a){var b=a.severity;b||(b="error");var c=document.createElement("div");
c.className="CodeMirror-lint-message-"+b;"undefined"!=typeof a.messageHTML?c.innerHTML=a.messageHTML:c.appendChild(document.createTextNode(a.message));return c}function p(a,b,f){function d(){g=-1;a.off("change",d)}var e=a.state.lint,g=++e.waitingFor;a.on("change",d);b(a.getValue(),function(b,f){a.off("change",d);e.waitingFor==g&&(f&&b instanceof c&&(b=f),h(a,b))},f,a)}function k(a){var b=a.state.lint.options,d=b.options||b,f=b.getAnnotations||a.getHelper(c.Pos(0,0),"lint");f&&(b.async||f.async?p(a,
f,d):(b=f(a.getValue(),d,a))&&(b.then?b.then(function(b){h(a,b)}):h(a,b)))}function h(a,b){l(a);for(var c=a.state.lint,d=c.options,e=[],f=0;f<b.length;++f){var g=b[f],h=g.from.line;(e[h]||(e[h]=[])).push(g)}for(f=0;f<e.length;++f)if(g=e[f]){h=null;for(var k=c.hasGutter&&document.createDocumentFragment(),p=0;p<g.length;++p){var n=g[p],q=n.severity;q||(q="error");"error"!=h&&(h=q);d.formatAnnotation&&(n=d.formatAnnotation(n));c.hasGutter&&k.appendChild(v(n));n.to&&c.marked.push(a.markText(n.from,n.to,
{className:"CodeMirror-lint-mark-"+q,__annotation:n}))}c.hasGutter&&a.setGutterMarker(f,"CodeMirror-lint-markers",m(k,h,1<g.length,c.options.tooltips))}if(d.onUpdateLinting)d.onUpdateLinting(b,e,a)}function g(a){var b=a.state.lint;b&&(clearTimeout(b.timeout),b.timeout=setTimeout(function(){k(a)},b.options.delay||500))}c.defineOption("lint",!1,function(a,e,f){f&&f!=c.Init&&(l(a),!1!==a.state.lint.options.lintOnChange&&a.off("change",g),c.off(a.getWrapperElement(),"mouseover",a.state.lint.onMouseOver),
clearTimeout(a.state.lint.timeout),delete a.state.lint);if(e){var d=a.getOption("gutters");f=!1;for(var h=0;h<d.length;++h)"CodeMirror-lint-markers"==d[h]&&(f=!0);d=a.state;e instanceof Function?e={getAnnotations:e}:e&&!0!==e||(e={});f=d.lint=new b(a,e,f);if(!1!==f.options.lintOnChange)a.on("change",g);if(0!=f.options.tooltips&&"gutter"!=f.options.tooltips)c.on(a.getWrapperElement(),"mouseover",f.onMouseOver);k(a)}});c.defineExtension("performLint",function(){this.state.lint&&k(this)})})(c(95))},
function(m,f){},function(m,f){},function(m,f){},function(m,f){m.exports=function(c){function f(a){var b={};a=a.split(" ");for(var c=0;c<a.length;++c)b[a[c]]=!0;return b}c.defineMode("glsl",function(a,b){function c(a,b){var c=a.next();if(F[c]){var f=F[c](a,b);if(!1!==f)return f}if('"'==c||"'"==c)return b.tokenize=q(c),b.tokenize(a,b);if(/[\[\]{}\(\),;\:\.]/.test(c))return x=c,"bracket";if(/\d/.test(c))return a.eatWhile(/[\w\.]/),"number";if("/"==c){if(a.eat("*"))return b.tokenize=t,t(a,b);if(a.eat("/"))return a.skipToEnd(),
"comment"}if("#"==c)return a.eatWhile(/[\S]+/),a.eatWhile(/[\s]+/),a.eatWhile(/[\S]+/),a.eatWhile(/[\s]+/),"comment";if(A.test(c))return a.eatWhile(A),"operator";a.eatWhile(/[\w\$_]/);a=a.current();return d.propertyIsEnumerable(a)?(w.propertyIsEnumerable(a)&&(x="newstatement"),"keyword"):e.propertyIsEnumerable(a)?"builtin":B.propertyIsEnumerable(a)?"atom":"word"}function q(a){return function(b,d){for(var e=!1,f,g=!1;null!=(f=b.next());){if(f==a&&!e){g=!0;break}e=!e&&"\\"==f}if(g||!e&&!G)d.tokenize=
c;return"string"}}function t(a,b){for(var d=!1,e;e=a.next();){if("/"==e&&d){b.tokenize=c;break}d="*"==e}return"comment"}function p(a,b,c,d,e){this.indented=a;this.column=b;this.type=c;this.align=d;this.prev=e}function k(a,b,c){return a.context=new p(a.indented,b,c,null,a.context)}function h(a){var b=a.context.type;if(")"==b||"]"==b||"}"==b)a.indented=a.context.indented;return a.context=a.context.prev}var g=a.indentUnit,d=b.keywords||f(n),e=b.builtins||f(m),w=b.blockKeywords||f("case do else for if switch while struct"),
B=b.atoms||f("null"),F=b.hooks||{},G=b.multiLineStrings,A=/[+\-*&%=<>!?|\/]/,x;return{startState:function(a){return{tokenize:null,context:new p((a||0)-g,0,"top",!1),indented:0,startOfLine:!0}},token:function(a,b){var d=b.context;a.sol()&&(null==d.align&&(d.align=!1),b.indented=a.indentation(),b.startOfLine=!0);if(a.eatSpace())return null;x=null;var e=(b.tokenize||c)(a,b);if("comment"==e||"meta"==e)return e;null==d.align&&(d.align=!0);if(";"!=x&&":"!=x||"statement"!=d.type)if("{"==x)k(b,a.column(),
"}");else if("["==x)k(b,a.column(),"]");else if("("==x)k(b,a.column(),")");else if("}"==x){for(;"statement"==d.type;)d=h(b);for("}"==d.type&&(d=h(b));"statement"==d.type;)d=h(b)}else x==d.type?h(b):("}"==d.type||"top"==d.type||"statement"==d.type&&"newstatement"==x)&&k(b,a.column(),"statement");else h(b);b.startOfLine=!1;return e},indent:function(a,b){if(a.tokenize!=c&&null!=a.tokenize)return 0;b=b&&b.charAt(0);a=a.context;var d=b==a.type;return"statement"==a.type?a.indented+("{"==b?0:g):a.align?
a.column+(d?0:1):a.indented+(d?0:g)},electricChars:"{}"}});var n="attribute const uniform varying break continue do for while if else in out inout float int void bool true false lowp mediump highp precision invariant discard return mat2 mat3 mat4 vec2 vec3 vec4 ivec2 ivec3 ivec4 bvec2 bvec3 bvec4 sampler2D samplerCube struct gl_FragCoord gl_FragColor",m="radians degrees sin cos tan asin acos atan pow exp log exp2 log2 sqrt inversesqrt abs sign floor ceil fract mod min max clamp mix step smoothstep length distance dot cross normalize faceforward reflect refract matrixCompMult lessThan lessThanEqual greaterThan greaterThanEqual equal notEqual any all not dFdx dFdy fwidth texture2D texture2DProj texture2DLod texture2DProjLod textureCube textureCubeLod require export";
c.defineMIME("text/x-glsl",{name:"glsl",keywords:f(n),builtins:f(m),blockKeywords:f("case do else for if switch while struct"),atoms:f("null"),hooks:{"#":function(a,b){if(!b.startOfLine)return!1;a.skipToEnd();return"meta"}}})}},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:
b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b,c,d){d=void 0===d?{}:d;return r.a.forPromise(new Promise(function(e){e(a.getVectorGraphicsSource(b,c,d))}),{initialMessage:"Retrieving metadata for vector graphics source "+
c+".",delay:!0,errorPrefix:"Error retrieving metadata for vector graphics source "+c+": "})}Object.defineProperty(f,"__esModule",{value:!0});c.d(f,"VectorGraphicsUserLayer",function(){return B});m=c(12);f=c(9);var b=c(56),l=c(172),r=c(26),v=c(36),p=c(98),k=c(99),h=c(1),g=c(2),d=c(58),e=c(173),w=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,
c);d&&a(b,d);return b}}();c(96);c(60);c(97);var B=function(c){function d(c,e){q(this,d);var f=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));f.opacity=Object(v.a)(.5);f.lineWidth=Object(p.a)(10);f.color=Object(k.a)(h.p.fromValues(1,1,1));f.opacity.restoreState(e.opacity);f.lineWidth.restoreState(e.linewidth);f.color.restoreState(e.color);f.lineWidth.changed.add(function(){f.specificationChanged.dispatch()});f.color.changed.add(function(){f.specificationChanged.dispatch()});f.vectorGraphicsLayerType=
Object(g.n)(e.type,b.c);e=f.vectorGraphicsPath=Object(g.z)(e.source);void 0!==e&&f.vectorGraphicsLayerType===b.c.LINE&&a(c.dataSourceProvider,c.chunkManager,e).then(function(a){f.wasDisposed||(a=f.renderLayer=new l.a(a,{opacity:f.opacity,lineWidth:f.lineWidth,color:f.color,sourceOptions:{}}),f.addRenderLayer(a))});return f}t(d,c);w(d,[{key:"toJSON",value:function(){var a={type:this.getLayerType()};a.source=this.vectorGraphicsPath;a.opacity=this.opacity.toJSON();a.linewidth=this.lineWidth.toJSON();
a.color=this.color.toJSON();return a}},{key:"getLayerType",value:function(){return b.c[this.vectorGraphicsLayerType].toLowerCase()}},{key:"makeDropdown",value:function(a){return new F(a,this)}}]);return d}(m.f),F=function(a){function b(a,c){q(this,b);var e=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));e.element=a;e.layer=c;e.opacityWidget=e.registerDisposer(new d.a(e.layer.opacity));e.lineWidthWidget=e.registerDisposer(new d.a(e.layer.lineWidth,{min:0,max:50,step:1}));e.colorWidget=e.registerDisposer(new G(e.layer.color));
a.classList.add("image-dropdown");var f=e.opacityWidget,g=e.lineWidthWidget,h=e.colorWidget;c=document.createElement("div");c.className="image-dropdown-top-row";f.promptElement.textContent="Opacity";g.promptElement.textContent="Line Width";h.promptElement.textContent="Color";f=document.createElement("div");f.style.flex="1";g=document.createElement("a");h=document.createElement("button");h.type="button";h.textContent="?";h.className="help-link";g.appendChild(h);g.title="Documentation on vector graphics layer rendering";
g.target="_blank";g.href="https://github.com/google/neuroglancer/blob/master/src/neuroglancer/sliceview/vectorgraphics_layer_rendering.md";c.appendChild(f);c.appendChild(g);a.appendChild(c);a.appendChild(e.opacityWidget.element);a.appendChild(e.lineWidthWidget.element);a.appendChild(e.colorWidget.element);return e}t(b,a);return b}(m.g),G=function(a){function b(a){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a))}t(b,a);w(b,[{key:"verifyValue",value:function(a){a=Object(g.o)(a);
a/=255;return 0>a?0:1<a?1:a}},{key:"updateInput",value:function(){this.inputx.valueAsNumber=Math.round(255*this.model.value[0]);this.inputy.valueAsNumber=Math.round(255*this.model.value[1]);this.inputz.valueAsNumber=Math.round(255*this.model.value[2])}}]);return b}(e.a);Object(f.e)("line",B)},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==
typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return d});var t=c(23);m=c(90);var a=c(36),b=c(98),l=c(99),r=c(1),v=c(17),p=c(20),k=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;
"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),h=function w(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return w(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},g=r.j.create(),d=function(c){function d(c,f){var g=void 0===f?{}:f;f=void 0===g.opacity?Object(a.a)(.5):g.opacity;var h=void 0===
g.lineWidth?Object(b.a)(10):g.lineWidth,k=void 0===g.color?Object(l.a)(r.p.fromValues(255,255,255)):g.color;g=void 0===g.sourceOptions?{}:g.sourceOptions;if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");var p=q(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,c,{sourceOptions:g}));p.opacity=f;p.registerDisposer(f.changed.add(function(){p.redrawNeeded.dispatch()}));p.lineWidth=h;p.registerDisposer(h.changed.add(function(){p.redrawNeeded.dispatch()}));p.color=k;
p.registerDisposer(k.changed.add(function(){p.redrawNeeded.dispatch()}));c=p.gl;f=new Float32Array([1,0,0,1,1,0,0,1]);p.vertexIndexBuffer=v.a.fromData(c,f,c.ARRAY_BUFFER,c.STATIC_DRAW);f=new Float32Array([1,1,-1,-1]);p.normalDirectionBuffer=v.a.fromData(c,f,c.ARRAY_BUFFER,c.STATIC_DRAW);return p}n(d,c);k(d,[{key:"getShaderKey",value:function(){return"vectorgraphics.VectorGraphicsLineRenderLayer"}},{key:"defineShader",value:function(a){h(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"defineShader",
this).call(this,a);a.addUniform("highp float","uOpacity");a.addUniform("highp float","ulineWidth");a.addUniform("highp vec3","uColor");a.addVarying("vec3","vNormal");a.addAttribute("highp float","aNormalDirection");a.addAttribute("highp vec2","aVertexIndex");a.addAttribute("highp vec3","aVertexFirst");a.addAttribute("highp vec3","aVertexSecond");a.addUniform("highp mat4","uProjection");a.setFragmentMain("    \nfloat distance = length(vNormal);\n\nfloat antialiasing = 0.5;\n\nif (distance >= 1.0 - antialiasing) {\n  emitRGBA(vec4(uColor, (distance - 1.0) / -antialiasing )); \n}\nelse if (distance < 1.0 - antialiasing) {\n  emitRGB(uColor);\n}\n");
a.setVertexMain("\nvec3 direction = vec3(0., 0., 0.); \ndirection.z = aNormalDirection;\n\nvec3 difference = aVertexSecond - aVertexFirst;\ndifference.z = 0.; \n\nvec3 normal = cross(difference, direction);\nnormal = normalize(normal); \nvNormal = normal; \n\nvec4 delta = vec4(normal * ulineWidth, 0.0);\nvec4 pos = vec4(aVertexFirst * aVertexIndex.x + aVertexSecond * aVertexIndex.y, 1.0);\n\ngl_Position = uProjection * (pos + delta);\n")}},{key:"beginSlice",value:function(a){h(d.prototype.__proto__||
Object.getPrototypeOf(d.prototype),"beginSlice",this).call(this,a);a=this.gl;var b=this.shader;a.uniform1f(b.uniform("uOpacity"),this.opacity.value);a.uniform1f(b.uniform("ulineWidth"),this.lineWidth.value);a.uniform3fv(b.uniform("uColor"),this.color.value);this.vertexIndexBuffer.bindToVertexAttrib(b.attribute("aVertexIndex"),2);this.normalDirectionBuffer.bindToVertexAttrib(b.attribute("aNormalDirection"),1);return b}},{key:"endSlice",value:function(a){var b=this.gl;b.disableVertexAttribArray(a.attribute("aVertexIndex"));
b.disableVertexAttribArray(a.attribute("aNormalDirection"));b.disableVertexAttribArray(a.attribute("aVertexFirst"));b.disableVertexAttribArray(a.attribute("aVertexSecond"))}},{key:"draw",value:function(a){var b=a.visibleLayers.get(this);if(0!==b.length)if(this.initializeShader(),void 0===this.shader)console.log("error: shader undefined");else{var c=this.gl,d=this.beginSlice(a);b=$jscomp.makeIterator(b);for(var f=b.next();!f.done;f=b.next()){var h=f.value,k=h.spec.chunkLayout,l=h.spec.voxelSize;f=
h.chunks;var n=g;r.j.identity(n);h.vectorGraphicsCoordinatesInVoxels&&r.j.scale(n,n,l);r.j.multiply(n,k.transform,n);c.uniformMatrix4fv(d.uniform("uProjection"),!1,r.j.multiply(g,a.dataToDevice,n));if(h=a.visibleChunks.get(k))for(h=$jscomp.makeIterator(h),k=h.next();!k.done;k=h.next())if((k=f.get(k.value))&&k.state===t.d.GPU_MEMORY){l=k.numPoints/2;n=d.attribute("aVertexFirst");k.vertexBuffer.bindToVertexAttrib(n,3,p.c,!1,24,0);c.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(n,1);var q=d.attribute("aVertexSecond");
k.vertexBuffer.bindToVertexAttrib(q,3,p.c,!1,24,12);c.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(q,1);c.ANGLE_instanced_arrays.drawArraysInstancedANGLE(c.TRIANGLE_STRIP,0,4,l);c.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(n,0);c.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(q,0)}}this.endSlice(d)}}}]);return d}(m.a)},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?
a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return v});m=c(0);var t=c(1),a=c(2),b=c(3),l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in
d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),r=function k(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return k(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};c(174);var v=function(c){function f(a){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");var c=q(this,(f.__proto__||
Object.getPrototypeOf(f)).call(this));c.model=a;c.promptElement=document.createElement("span");c.element=document.createElement("label");c.inputx=document.createElement("input");c.inputy=document.createElement("input");c.inputz=document.createElement("input");c.valueEntered=new b.b;a=c.inputx;var e=c.inputy,g=c.inputz,h=c.element,k=c.promptElement;h.className="vec3-input-row";k.className="vec3-input-label";h.appendChild(k);h.appendChild(a);h.appendChild(e);h.appendChild(g);a.type=e.type=g.type="number";
c.updateInput();h=function(){c.model.value=c.getVec3Values()};c.registerEventListener(a,"change",h);c.registerEventListener(e,"change",h);c.registerEventListener(g,"change",h);c.model.changed.add(function(){c.updateInput()});return c}n(f,c);l(f,[{key:"getVec3Values",value:function(){var a=t.p.create();a[0]=this.verifyValue(this.inputx.valueAsNumber);a[1]=this.verifyValue(this.inputy.valueAsNumber);a[2]=this.verifyValue(this.inputz.valueAsNumber);return a}},{key:"verifyValue",value:function(b){return Object(a.o)(b)}},
{key:"updateInput",value:function(){this.inputx.valueAsNumber=this.model.value[0];this.inputy.valueAsNumber=this.model.value[1];this.inputz.valueAsNumber=this.model.value[2]}},{key:"disposed",value:function(){var a=this.inputx,b=this.inputy,c=this.inputz,h=this.element;a.parentElement&&a.parentElement.removeChild(a);b.parentElement&&b.parentElement.removeChild(b);c.parentElement&&c.parentElement.removeChild(c);h.parentElement&&h.parentElement.removeChild(h);r(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),
"disposed",this).call(this)}}]);return f}(m.a)},function(m,f){},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&
b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){return new z.a({fragmentMain:a.displayState.fragmentMain,shaderError:a.displayState.shaderError,fragmentMainStartLine:h.a})}Object.defineProperty(f,"__esModule",{value:!0});c.d(f,"SegmentationUserLayer",function(){return E});var b=c(57);m=c(12);var l=c(9),r=c(48);f=c(29);var v=c(100),p=c(37),k=c(177),h=c(75),g=c(8),d=c(179),e=c(36),w=c(41),
B=c(180),F=c(2),G=c(11),A=c(28),x=c(58),D=c(181),z=c(59),C=c(183),H=c(45),J=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();c(21);c(185);var E=function(a){function c(a,f){q(this,c);var m=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,[]));m.manager=a;m.displayState={segmentColorHash:v.a.getDefault(),
segmentSelectionState:new p.a,selectedAlpha:Object(e.a)(.5),notSelectedAlpha:Object(e.a)(0),objectAlpha:Object(e.a)(1),clipBounds:H.a.make(m.manager.worker,void 0),hideSegmentZero:new w.a(!0,!0),visibleSegments:B.a.makeWithCounterpart(m.manager.worker),segmentEquivalences:k.a.makeWithCounterpart(m.manager.worker),volumeSourceOptions:{},objectToDataTransform:new b.a,fragmentMain:Object(h.f)(),shaderError:Object(A.b)()};m.displayState.visibleSegments.changed.add(function(){m.specificationChanged.dispatch()});
m.displayState.segmentEquivalences.changed.add(function(){m.specificationChanged.dispatch()});m.displayState.segmentSelectionState.bindTo(a.layerSelectedValues,m);m.displayState.selectedAlpha.changed.add(function(){m.specificationChanged.dispatch()});m.displayState.notSelectedAlpha.changed.add(function(){m.specificationChanged.dispatch()});m.displayState.objectAlpha.changed.add(function(){m.specificationChanged.dispatch()});m.displayState.hideSegmentZero.changed.add(function(){m.specificationChanged.dispatch()});
m.displayState.fragmentMain.changed.add(function(){m.specificationChanged.dispatch()});m.displayState.selectedAlpha.restoreState(f.selectedAlpha);m.displayState.notSelectedAlpha.restoreState(f.notSelectedAlpha);m.displayState.objectAlpha.restoreState(f.objectAlpha);m.displayState.hideSegmentZero.restoreState(f.hideSegmentZero);m.displayState.objectToDataTransform.restoreState(f.transform);m.displayState.volumeSourceOptions.transform=m.displayState.objectToDataTransform.transform;m.displayState.fragmentMain.restoreState(f.skeletonShader);
var r=m.volumePath=Object(F.z)(f.source),t=m.meshPath=null===f.mesh?null:Object(F.z)(f.mesh),z=m.skeletonsPath=Object(F.z)(f.skeletons);void 0!==r&&Object(l.d)(a.dataSourceProvider,a.chunkManager,r,{volumeType:g.d.SEGMENTATION}).then(function(a){m.wasDisposed||(m.addRenderLayer(new d.a(a,m.displayState)),void 0===t&&(a=a.getMeshSource(),null!=a&&m.addMesh(a)))});null!=t&&m.manager.dataSourceProvider.getMeshSource(a.chunkManager,t).then(function(a){m.wasDisposed||m.addMesh(a)});void 0!==z&&m.manager.dataSourceProvider.getSkeletonSource(a.chunkManager,
z).then(function(b){m.wasDisposed||(b=new h.c(a.chunkManager,b,a.voxelSize,m.displayState),m.addRenderLayer(new h.b(b.addRef())),m.addRenderLayer(new h.e(b)))});Object(F.w)(f,"equivalences",function(a){m.displayState.segmentEquivalences.restoreState(a)});Object(F.w)(f,"segments",function(a){if(void 0!==a){var b=m.displayState,c=b.visibleSegments,d=b.segmentEquivalences;Object(F.a)(a,function(a){a=G.a.parseString(String(a),10);c.add(d.get(a))})}});Object(F.w)(f,"clipBounds",function(a){if(void 0!==
a){var b,c;Object(F.w)(a,"center",function(a){return b=Object(F.l)(a)});Object(F.w)(a,"size",function(a){return c=Object(F.l)(a)});b&&c&&(m.displayState.clipBounds.value={center:b,size:c})}});return m}t(c,a);J(c,[{key:"addMesh",value:function(a){this.meshLayer=new r.a(this.manager.chunkManager,a,this.displayState);this.addRenderLayer(this.meshLayer)}},{key:"toJSON",value:function(){var a={type:"segmentation"};a.source=this.volumePath;a.mesh=this.meshPath;a.skeletons=this.skeletonsPath;a.selectedAlpha=
this.displayState.selectedAlpha.toJSON();a.notSelectedAlpha=this.displayState.notSelectedAlpha.toJSON();a.objectAlpha=this.displayState.objectAlpha.toJSON();a.hideSegmentZero=this.displayState.hideSegmentZero.toJSON();var b=this.displayState.visibleSegments;0<b.size&&(a.segments=b.toJSON());b=this.displayState.segmentEquivalences;0<b.size&&(a.equivalences=b.toJSON());b=this.displayState.clipBounds;b.value&&(a.clipBounds={center:b.value.center,size:b.value.size});a.transform=this.displayState.objectToDataTransform.toJSON();
a.skeletonShader=this.displayState.fragmentMain.toJSON();return a}},{key:"transformPickedValue",value:function(a){if(null==a)return a;var b=this.displayState.segmentEquivalences;if(0===b.size)return a;"number"===typeof a&&(a=new G.a(a,0));b=b.get(a);return G.a.equal(b,a)?a:new p.c(a,b)}},{key:"makeDropdown",value:function(a){return new S(a,this)}},{key:"handleAction",value:function(a){switch(a){case "recolor":this.displayState.segmentColorHash.randomize();break;case "clear-segments":this.displayState.visibleSegments.clear();
break;case "select":if(a=this.displayState.segmentSelectionState,a.hasSelectedSegment){a=a.selectedSegment;var b=this.displayState.visibleSegments;b.has(a)?b.delete(a):b.add(a)}}}}]);return c}(m.f),S=function(b){function c(b,d){q(this,c);var e=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));e.element=b;e.layer=d;e.visibleSegmentWidget=e.registerDisposer(new D.a(e.layer.displayState));e.addSegmentWidget=e.registerDisposer(new C.a);e.selectedAlphaWidget=e.registerDisposer(new x.a(e.layer.displayState.selectedAlpha));
e.notSelectedAlphaWidget=e.registerDisposer(new x.a(e.layer.displayState.notSelectedAlpha));e.objectAlphaWidget=e.registerDisposer(new x.a(e.layer.displayState.objectAlpha));b.classList.add("segmentation-dropdown");var f=e.notSelectedAlphaWidget,g=e.objectAlphaWidget;e.selectedAlphaWidget.promptElement.textContent="Opacity (on)";f.promptElement.textContent="Opacity (off)";g.promptElement.textContent="Opacity (3d)";b.appendChild(e.selectedAlphaWidget.element);b.appendChild(e.notSelectedAlphaWidget.element);
b.appendChild(e.objectAlphaWidget.element);d=e.registerDisposer(new w.b(d.displayState.hideSegmentZero));d.element.className="neuroglancer-segmentation-dropdown-hide-segment-zero neuroglancer-noselect";f=document.createElement("label");f.className="neuroglancer-segmentation-dropdown-hide-segment-zero neuroglancer-noselect";f.appendChild(document.createTextNode("Hide segment ID 0"));f.appendChild(d.element);b.appendChild(f);e.addSegmentWidget.element.classList.add("add-segment");e.addSegmentWidget.element.title=
"Add one or more segment IDs";b.appendChild(e.registerDisposer(e.addSegmentWidget).element);e.registerDisposer(e.addSegmentWidget.valuesEntered.add(function(a){a=$jscomp.makeIterator(a);for(var b=a.next();!b.done;b=a.next())e.layer.displayState.visibleSegments.add(b.value)}));b.appendChild(e.registerDisposer(e.visibleSegmentWidget).element);if(void 0!==e.layer.skeletonsPath){d=document.createElement("div");d.className="neuroglancer-segmentation-dropdown-skeleton-shader-header";f=document.createElement("div");
f.style.flex="1";f.textContent="Skeleton shader:";g=document.createElement("a");var h=document.createElement("button");h.type="button";h.textContent="?";h.className="help-link";g.appendChild(h);g.title="Documentation on skeleton rendering";g.target="_blank";g.href="https://github.com/google/neuroglancer/blob/master/src/neuroglancer/sliceview/image_layer_rendering.md";h=document.createElement("button");h.innerHTML="&square;";h.className="maximize-button";h.title="Show larger editor view";e.registerEventListener(h,
"click",function(){new K(e.layer)});d.appendChild(f);d.appendChild(h);d.appendChild(g);b.appendChild(d);d=e.codeWidget=e.registerDisposer(a(e.layer));b.appendChild(d.element);d.textEditor.refresh()}return e}t(c,b);J(c,[{key:"onShow",value:function(){void 0!==this.codeWidget&&this.codeWidget.textEditor.refresh()}}]);return c}(m.g),K=function(b){function c(b){q(this,c);var d=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));d.layer=b;d.codeWidget=d.registerDisposer(a(d.layer));d.content.classList.add("neuroglancer-segmentation-layer-skeleton-shader-overlay");
d.content.appendChild(d.codeWidget.element);d.codeWidget.textEditor.refresh();return d}t(c,b);return c}(f.a);Object(l.e)("segmentation",E);Object(l.f)(g.d.SEGMENTATION,E)},function(m,f,c){f.a=function(c,f,m,a){f*=6;var b=Math.floor(f),l=f-b;f=a*(1-m);var n=a*(1-m*l);m=a*(1-m*(1-l));switch(b%6){case 0:c[0]=a;c[1]=m;c[2]=f;break;case 1:c[0]=n;c[1]=a;c[2]=f;break;case 2:c[0]=f;c[1]=a;c[2]=m;break;case 3:c[0]=f;c[1]=n;c[2]=a;break;case 4:c[0]=m;c[1]=f;c[2]=a;break;case 5:c[0]=a,c[1]=f,c[2]=n}return c}},
function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return v});var n=c(178),t=c(2),a=c(3),b=c(11);m=c(6);var l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||
!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}(),r=function g(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return g(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};f=this&&this.__decorate||function(a,b,c,f){var d=arguments.length,e=3>d?b:null===f?f=Object.getOwnPropertyDescriptor(b,
c):f,g;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)e=Reflect.decorate(a,b,c,f);else for(var k=a.length-1;0<=k;k--)if(g=a[k])e=(3>d?g(e):3<d?g(b,c,e):g(b,c))||e;return 3<d&&e&&Object.defineProperty(b,c,e),e};var v=function(c){function d(){if(!(this instanceof d))throw new TypeError("Cannot call a class as a function");var b=(d.__proto__||Object.getPrototypeOf(d)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
b=!b||"object"!==typeof b&&"function"!==typeof b?this:b;b.disjointSets=new n.a;b.changed=new a.a;return b}q(d,c);l(d,[{key:"disposed",value:function(){this.changed=this.disjointSets=void 0;r(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"disposed",this).call(this)}},{key:"link",value:function(a,b){if(this.disjointSets.link(a,b)){var c=this.rpc;c&&c.invoke("DisjointUint64Sets.add",{id:this.rpcId,al:a.low,ah:a.high,bl:b.low,bh:b.high});this.changed.dispatch()}}},{key:"get",value:function(a){return this.disjointSets.get(a)}},
{key:"clear",value:function(){if(this.disjointSets.clear()){var a=this.rpc;a&&a.invoke("DisjointUint64Sets.clear",{id:this.rpcId});this.changed.dispatch()}}},{key:"setElements",value:function(a){return this.disjointSets.setElements(a)}},{key:"toJSON",value:function(){return this.disjointSets.toJSON()}},{key:"restoreState",value:function(a){var c=this;this.clear();if(void 0!==a){var d=[new b.a,new b.a];Object(t.a)(a,function(a){Object(t.a)(a,function(a,b){d[b%2].parseString(String(a),10);0!==b&&c.link(d[0],
d[1])})})}}},{key:"size",get:function(){return this.disjointSets.size}}],[{key:"makeWithCounterpart",value:function(a){var b=new this;b.initializeCounterpart(a);return b}}]);return d}(m.c);v=f([Object(m.f)("DisjointUint64Sets")],v);var p=new b.a,k=new b.a;Object(m.e)("DisjointUint64Sets.add",function(a){var b=this.get(a.id);p.low=a.al;p.high=a.ah;k.low=a.bl;k.high=a.bh;b.disjointSets.link(p,k)&&b.changed.dispatch()});Object(m.e)("DisjointUint64Sets.clear",function(a){a=this.get(a.id);a.disjointSets.clear()&&
a.changed.dispatch()})},function(m,f,c){function q(a){for(var b=a,c=a[l];c!==a;)a=c,c=a[l];for(a=b[l];c!==a;)b[l]=c,b=a,a=b[l];return c}function n(a){function b(b,d){for(;;)switch(c){case 0:f=!0,e=a;case 1:if(!f&&e===a){c=3;break}c=4;return{value:e,done:!1};case 4:if(void 0===d){c=5;break}c=-1;throw d;case 5:e=e[r];case 2:f=!1;c=1;break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,e,f,h={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");
}};$jscomp.initSymbolIterator();h[Symbol.iterator]=function(){return this};return h}c.d(f,"a",function(){return k});var t=c(11),a=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}();$jscomp.initSymbol();var b=Symbol("disjoint_sets:rank");$jscomp.initSymbol();var l=Symbol("disjoint_sets:parent");$jscomp.initSymbol();
var r=Symbol("disjoint_sets:next");$jscomp.initSymbol();var v=Symbol("disjoint_sets:prev");$jscomp.initSymbol();var p=Symbol("disjoint_sets:min"),k=function(){function c(){if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");this.map=new Map;this.generation=0}$jscomp.initSymbol();$jscomp.initSymbolIterator();a(c,[{key:"get",value:function(a){var b=this.map.get(a.toString());return void 0===b?a:q(b)[p]}},{key:"isMinElement",value:function(a){var b=this.get(a);return b===
a||t.a.equal(b,a)}},{key:"makeSet",value:function(a){var c=a.toString(),e=this.map,f=e.get(c);return void 0===f?(a=f=a.clone(),a[l]=a,a[b]=0,a[r]=a[v]=a,f[p]=f,e.set(c,f),f):q(f)}},{key:"link",value:function(a,c){a=this.makeSet(a);c=this.makeSet(c);if(a===c)return!1;this.generation++;var d=a;var f=c,g=d[b],h=f[b];g>h?f[l]=d:(d[l]=f,g===h&&(f[b]=h+1),d=f);f=a;g=c;h=f[v];var k=g[v];g[v]=h;h[r]=g;f[v]=k;k[r]=f;a=a[p];c=c[p];d[p]=t.a.less(a,c)?a:c;return!0}},{key:"setElements",value:function(a){function b(b,
d){for(;;)switch(c){case 0:k=a.toString();h=l.map.get(k);if(void 0!==h){c=1;break}c=3;return{value:a,done:!1};case 3:if(void 0===d){c=4;break}c=-1;throw d;case 4:c=2;break;case 1:g=$jscomp.makeIterator(n(h));case 5:if((f=g.next(b)).done){c=6;break}c=7;return{value:f.value,done:!1};case 7:if(void 0===d){c=8;break}c=-1;throw d;case 8:c=5;break;case 6:case 2:c=-1;default:return{value:void 0,done:!0}}}var c=0,f,g,h,k,l=this,p={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},
return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();p[Symbol.iterator]=function(){return this};return p}},{key:"clear",value:function(){var a=this.map;if(0===a.size)return!1;++this.generation;a.clear();return!0}},{key:"mappings",value:function(a){function b(b,d){for(;;)switch(c){case 0:a=void 0===a?Array(2):a,h=$jscomp.makeIterator(k.map.values()),g=h.next();case 1:if(g.done){c=3;break}f=g.value;a[0]=f;a[1]=q(f)[p];c=4;return{value:a,done:!1};case 4:if(void 0===d){c=
5;break}c=-1;throw d;case 5:case 2:g=h.next();c=1;break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,f,g,h,k=this,l={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();l[Symbol.iterator]=function(){return this};return l}},{key:Symbol.iterator,value:function(){return this.mappings()}},{key:"toJSON",value:function(){for(var a=[],b=$jscomp.makeIterator(this.map.values()),c=b.next();!c.done;c=
b.next()){var f=c.value;if(f[l]===f){c=[];f=$jscomp.makeIterator(n(f));for(var h=f.next();!h.done;h=f.next())c.push(h.value);c.sort(t.a.compare);a.push(c)}}a.sort(function(a,b){return t.a.compare(a[0],b[0])});return a.map(function(a){return a.map(function(a){return a.toString()})})}},{key:"size",get:function(){return this.map.size}}]);return c}()},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&
"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function t(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(f,"a",function(){return d});var a=c(62),b=c(101),l=c(100),r=
c(37);m=c(94);var v=c(7),p=function w(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return w(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},k=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);
return b}}(),h=new Float32Array(8),g=function(){function b(c){t(this,b);this.disjointSets=c;this.generation=Number.NaN;this.hashMap=new a.a}k(b,[{key:"update",value:function(){var a=this.disjointSets,b=a.generation;if(this.generation!==b){this.generation=b;b=this.hashMap;b.clear();a=$jscomp.makeIterator(a.mappings());for(var c=a.next();!c.done;c=a.next()){var d=$jscomp.makeIterator(c.value);c=d.next().value;d=d.next().value;b.set(c,d)}}}}]);return b}(),d=function(a){function c(a,d){t(this,c);var f=
q(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,a,{sourceOptions:d.volumeSourceOptions}));f.displayState=d;f.segmentColorShaderManager=new l.b("segmentColorHash");f.hashTableManager=new b.c("visibleSegments");f.gpuHashTable=b.a.get(f.gl,f.displayState.visibleSegments.hashTable);f.equivalencesShaderManager=new b.b("equivalences");f.equivalencesHashMap=new g(f.displayState.segmentEquivalences.disjointSets);f.gpuEquivalencesHashTable=b.a.get(f.gl,f.equivalencesHashMap.hashMap);Object(r.g)(d,
f);f.registerDisposer(d.selectedAlpha.changed.add(function(){f.redrawNeeded.dispatch()}));f.registerDisposer(d.hideSegmentZero.changed.add(function(){f.redrawNeeded.dispatch();f.shaderUpdated=!0}));f.hasEquivalences=0!==f.displayState.segmentEquivalences.size;d.segmentEquivalences.changed.add(function(){var a=0!==f.displayState.segmentEquivalences.size;a!==f.hasEquivalences&&(f.hasEquivalences=a,f.shaderUpdated=!0)});f.registerDisposer(d.notSelectedAlpha.changed.add(function(){f.redrawNeeded.dispatch()}));
return f}n(c,a);k(c,[{key:"getValueAt",value:function(a){for(var b=$jscomp.makeIterator(this.sources),c=b.next();!c.done;c=b.next()){c=$jscomp.makeIterator(c.value);for(var d=c.next();!d.done;d=c.next())if(d=d.value.getValueAt(a),null!=d)return d}return null}},{key:"getShaderKey",value:function(){return"sliceview.SegmentationRenderLayer/"+this.hasEquivalences+"/"+this.displayState.hideSegmentZero.value}},{key:"defineShader",value:function(a){p(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),
"defineShader",this).call(this,a);this.hashTableManager.defineShader(a);a.addFragmentCode("\nuint64_t getUint64DataValue() {\n  return toUint64(getDataValue());\n}\n");this.hasEquivalences?(this.equivalencesShaderManager.defineShader(a),a.addFragmentCode("\nuint64_t getMappedObjectId() {\n  uint64_t value = getUint64DataValue();\n  uint64_t mappedValue;\n  if ("+this.equivalencesShaderManager.getFunctionName+"(value, mappedValue)) {\n    return mappedValue;\n  }\n  return value;\n}\n")):a.addFragmentCode("\nuint64_t getMappedObjectId() {\n  return getUint64DataValue();\n}\n");
this.segmentColorShaderManager.defineShader(a);a.addUniform("highp vec4","uSelectedSegment",2);a.addUniform("highp float","uShowAllSegments");a.addUniform("highp float","uSelectedAlpha");a.addUniform("highp float","uNotSelectedAlpha");a.addFragmentCode(v.o);var b="\n  uint64_t value = getMappedObjectId();\n  \n  float alpha = uSelectedAlpha;\n  float saturation = 1.0;\n";this.displayState.hideSegmentZero.value&&(b+="\n  if (value.low == vec4(0,0,0,0) && value.high == vec4(0,0,0,0)) {\n    emit(vec4(vec4(0, 0, 0, 0)));\n    return;\n  }\n");
b+="\n  bool has = uShowAllSegments > 0.0 ? true : "+this.hashTableManager.hasFunctionName+"(value);\n  if (uSelectedSegment[0] == unnormalizeUint8(value.low) &&\n      uSelectedSegment[1] == unnormalizeUint8(value.high)) {\n    saturation = has ? 0.5 : 0.75;\n  } else if (!has) {\n    alpha = uNotSelectedAlpha;\n  }\n  vec3 rgb = segmentColorHash(value);\n  emit(vec4(mix(vec3(1.0,1.0,1.0), rgb, saturation), alpha));\n";a.setFragmentMain(b)}},{key:"beginSlice",value:function(a){a=p(c.prototype.__proto__||
Object.getPrototypeOf(c.prototype),"beginSlice",this).call(this,a);var b=this.gl,d=this.displayState,f=this.displayState,g=f.segmentSelectionState;f=f.visibleSegments;if(g.hasSelectedSegment){var k=g.selectedSegment;g=k.low;k=k.high;for(var l=0;4>l;++l)h[l]=g>>8*l&255,h[4+l]=k>>8*l&255}else h.fill(0);b.uniform1f(a.uniform("uSelectedAlpha"),this.displayState.selectedAlpha.value);b.uniform1f(a.uniform("uNotSelectedAlpha"),this.displayState.notSelectedAlpha.value);b.uniform4fv(a.uniform("uSelectedSegment"),
h);b.uniform1f(a.uniform("uShowAllSegments"),f.hashTable.size?0:1);this.hashTableManager.enable(b,a,this.gpuHashTable);this.hasEquivalences&&(this.equivalencesHashMap.update(),this.equivalencesShaderManager.enable(b,a,this.gpuEquivalencesHashTable));this.segmentColorShaderManager.enable(b,a,d.segmentColorHash);return a}},{key:"endSlice",value:function(a){this.hashTableManager.disable(this.gl,a);p(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"endSlice",this).call(this,a)}}]);return c}(m.a)},
function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return l});var n=c(62),t=c(3);m=c(6);var a=function(){function a(a,b){for(var c=0;c<b.length;c++){var f=b[c];f.enumerable=f.enumerable||!1;f.configurable=
!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),b=function p(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return p(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};f=this&&this.__decorate||function(a,b,c,f){var d=arguments.length,e=3>d?b:null===f?f=Object.getOwnPropertyDescriptor(b,c):f,
g;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)e=Reflect.decorate(a,b,c,f);else for(var h=a.length-1;0<=h;h--)if(g=a[h])e=(3>d?g(e):3<d?g(b,c,e):g(b,c))||e;return 3<d&&e&&Object.defineProperty(b,c,e),e};var l=r=function(c){function f(){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");var a=(f.__proto__||Object.getPrototypeOf(f)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
a=!a||"object"!==typeof a&&"function"!==typeof a?this:a;a.hashTable=new n.b;a.changed=new t.b;return a}q(f,c);$jscomp.initSymbol();$jscomp.initSymbolIterator();a(f,[{key:"disposed",value:function(){b(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"disposed",this).call(this);this.changed=this.hashTable=void 0}},{key:"add_",value:function(a){return this.hashTable.add(a)}},{key:"add",value:function(a){if(this.add_(a)){var b=this.rpc;b&&b.invoke("Uint64Set.add",{id:this.rpcId,value:a});this.changed.dispatch(a,
!0)}}},{key:"has",value:function(a){return this.hashTable.has(a)}},{key:Symbol.iterator,value:function(){return this.hashTable.keys()}},{key:"delete_",value:function(a){return this.hashTable.delete(a)}},{key:"delete",value:function(a){if(this.delete_(a)){var b=this.rpc;b&&b.invoke("Uint64Set.delete",{id:this.rpcId,value:a});this.changed.dispatch(a,!1)}}},{key:"clear",value:function(){if(this.hashTable.clear()){var a=this.rpc;a&&a.invoke("Uint64Set.clear",{id:this.rpcId});this.changed.dispatch(null,
!1)}}},{key:"toJSON",value:function(){for(var a=[],b=$jscomp.makeIterator(this),c=b.next();!c.done;c=b.next())a.push(c.value.toString());return a}},{key:"size",get:function(){return this.hashTable.size}}],[{key:"makeWithCounterpart",value:function(a){var b=new r;b.initializeCounterpart(a);return b}}]);return f}(m.c);l=r=f([Object(m.f)("Uint64Set")],l);Object(m.e)("Uint64Set.add",function(a){var b=this.get(a.id);b.add_(a.value)&&b.changed.dispatch()});Object(m.e)("Uint64Set.delete",function(a){var b=
this.get(a.id);b.delete_(a.value)&&b.changed.dispatch()});Object(m.e)("Uint64Set.clear",function(a){a=this.get(a.id);a.hashTable.clear()&&a.changed.dispatch()});var r},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=
Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return l});m=c(0);f=c(11);var t=function(){function a(a,b){for(var c=0;c<b.length;c++){var f=b[c];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),a=function v(a,b,c){null===a&&(a=Function.prototype);
var f=Object.getOwnPropertyDescriptor(a,b);if(void 0===f){if(a=Object.getPrototypeOf(a),null!==a)return v(a,b,c)}else{if("value"in f)return f.value;b=f.get;return void 0===b?void 0:b.call(c)}};c(21);c(182);var b=new f.a,l=function(c){function f(a){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");var b=q(this,(f.__proto__||Object.getPrototypeOf(f)).call(this));b.displayState=a;b.element=document.createElement("div");b.clearButton=document.createElement("button");b.itemContainer=
document.createElement("span");b.items=new Map;var c=b.element,d=b.clearButton,e=b.itemContainer;c.className="segment-set-widget neuroglancer-noselect";d.className="clear-button";d.title="Remove all segment IDs";b.registerEventListener(d,"click",function(){b.visibleSegments.clear()});e.className="item-container";c.appendChild(e);e.appendChild(d);b.registerDisposer(a.visibleSegments.changed.add(function(a,c){b.handleSetChanged(a,c)}));b.registerDisposer(a.segmentColorHash.changed.add(function(){b.handleColorChanged()}));
a=$jscomp.makeIterator(a.visibleSegments);for(c=a.next();!c.done;c=a.next())b.addElement(c.value.toString());b.updateClearButtonVisibility();return b}n(f,c);t(f,[{key:"updateClearButtonVisibility",value:function(){this.clearButton.style.display=0<this.displayState.visibleSegments.size?"":"none"}},{key:"handleSetChanged",value:function(a,b){this.updateClearButtonVisibility();var c=this.items;if(null===a){a=this.itemContainer;for(b=this.clearButton;;){var d=a.lastElementChild;if(d===b)break;a.removeChild(d)}c.clear()}else b?
this.addElement(a.toString()):(a=a.toString(),b=c.get(a),b.parentElement.removeChild(b),c.delete(a))}},{key:"addElement",value:function(a){var c=document.createElement("button");c.className="segment-button";c.textContent=a;c.title="Remove segment ID "+a;var f=this;c.addEventListener("click",function(){b.tryParseString(this.textContent);f.visibleSegments.delete(b)});c.addEventListener("mouseenter",function(){b.tryParseString(this.textContent);f.segmentSelectionState.set(b)});c.addEventListener("mouseleave",
function(){b.tryParseString(this.textContent);f.segmentSelectionState.set(null)});this.setItemColor(c);this.itemContainer.appendChild(c);this.items.set(a,c)}},{key:"setItemColor",value:function(a){b.tryParseString(a.textContent);a.style.backgroundColor=this.segmentColorHash.computeCssColor(b)}},{key:"handleColorChanged",value:function(){var a=this;this.items.forEach(function(b){a.setItemColor(b)})}},{key:"disposed",value:function(){var b=this.element,c=b.parentElement;c&&c.removeChild(b);a(f.prototype.__proto__||
Object.getPrototypeOf(f.prototype),"disposed",this).call(this)}},{key:"visibleSegments",get:function(){return this.displayState.visibleSegments}},{key:"segmentColorHash",get:function(){return this.displayState.segmentColorHash}},{key:"segmentSelectionState",get:function(){return this.displayState.segmentSelectionState}}]);return f}(m.a)},function(m,f){},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==
typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return v});m=c(0);var t=c(4),a=c(3),b=c(11),l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||
!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),r=function k(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return k(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};c(21);c(184);var v=function(c){function f(){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");
var b=q(this,(f.__proto__||Object.getPrototypeOf(f)).call(this));b.element=document.createElement("form");b.label=document.createElement("label");b.input=document.createElement("input");b.valuesEntered=new a.b;var c=b.element,e=b.label,h=b.input;c.className="uint64-entry neuroglancer-noselect";c.appendChild(e);e.appendChild(h);b.registerEventListener(c,"submit",function(a){a.preventDefault();a=b.validateInput();void 0!==a&&(b.input.value="",b.input.classList.remove("valid-input","invalid-input"),
b.valuesEntered.dispatch(a))});b.registerEventListener(c,"input",function(){""===b.input.value?b.input.classList.remove("valid-input","invalid-input"):b.validateInput()?b.input.classList.remove("invalid-input"):b.input.classList.add("invalid-input")});return b}n(f,c);l(f,[{key:"validateInput",value:function(){var a=this.input.value;a=a.replace(/[\s,\(\)\[\]\{\};]+/g," ");a=a.trim();var c=a.split(" ");if(0!==c.length){a=[];c=$jscomp.makeIterator(c);for(var e=c.next();!e.done;e=c.next()){e=e.value;
var f=new b.a;if(!f.tryParseString(e))return;a.push(f)}return a}}},{key:"disposed",value:function(){Object(t.b)(this.element);r(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"disposed",this).call(this)}}]);return f}(m.a)},function(m,f){},function(m,f){},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==
typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){return a.split(/[^a-zA-Z0-9]+/).filter(function(a){return a}).join("_")}function b(b){var c=new Set,d=[];b=$jscomp.makeIterator(b);for(var e=
b.next();!e.done;e=b.next()){e=a(e.value);for(var f="",g=0;c.has(e+f);)f=""+ ++g;d.push(e+f)}return d}function l(a){return new e.a({fragmentMain:a.displayState.fragmentMain,shaderError:a.displayState.shaderError,fragmentMainStartLine:k.a})}function r(a){return new F(a.displayState.attributeNames,function(){return a.meshSource&&a.meshSource.info.vertexAttributes})}Object.defineProperty(f,"__esModule",{value:!0});c.d(f,"SingleMeshUserLayer",function(){return B});m=c(13);var v=c.n(m);m=c(12);f=c(9);
var p=c(29),k=c(187),h=c(0),g=c(4),d=c(2),e=c(59),w=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();c(189);var B=function(a){function c(a,e){q(this,c);var f=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,[]));f.manager=a;f.displayState=new k.b;f.parameters={meshSourceUrl:Object(d.w)(e,"source",d.B),
attributeSourceUrls:Object(d.w)(e,"vertexAttributeSources",function(a){return void 0!==a?Object(d.a)(a,d.B):[]})};f.displayState.objectToDataTransform.restoreState(e.transform);f.displayState.fragmentMain.restoreState(e.shader);f.userSpecifiedAttributeNames=Object(d.w)(e,"vertexAttributeNames",function(a){if(void 0!==a)return Object(d.a)(a,function(a){if(a=Object(d.z)(a))return a})});Object(k.e)(a.chunkManager,f.parameters).then(function(a){if(!f.wasDisposed){f.meshSource=a;var c=f.defaultAttributeNames=
b(a.info.vertexAttributes.map(function(a){return a.name})),d=f.userSpecifiedAttributeNames;void 0!==d&&d.length===c.length?(c=d,f.userSpecifiedAttributeNames=void 0):c=Array.from(c);f.displayState.attributeNames.value=c;f.addRenderLayer(new k.c(a,f.displayState))}});f.registerDisposer(f.displayState.fragmentMain.changed.add(function(){f.specificationChanged.dispatch()}));f.registerDisposer(f.displayState.attributeNames.changed.add(function(){f.specificationChanged.dispatch()}));return f}t(c,a);w(c,
[{key:"toJSON",value:function(){var a={type:"mesh"},b=this.parameters.attributeSourceUrls;a.source=this.parameters.meshSourceUrl;b&&(a.vertexAttributeSources=b);a.shader=this.displayState.fragmentMain.toJSON();a.transform=this.displayState.objectToDataTransform.toJSON();if(void 0===this.meshSource)b=this.userSpecifiedAttributeNames;else{b=this.defaultAttributeNames;for(var c=this.displayState.attributeNames.value,d=!0,e=c.length,f=0;f<e;++f)if(c[f]!==b[f]){d=!1;break}b=d?void 0:Array.from(c)}a.vertexAttributeNames=
b;return a}},{key:"makeDropdown",value:function(a){return new G(a,this)}}]);return c}(m.f),F=function(a){function b(a,c){q(this,b);var d=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));d.attributeNames=a;d.getAttributeInfo=c;d.element=document.createElement("div");d.debouncedValueUpdater=v()(function(){d.updateAttributeNames()},500);d.element.className="neuroglancer-single-mesh-attribute-widget";d.updateInputElements();d.registerDisposer(a.changed.add(function(){d.updateInputElements()}));
return d}t(b,a);w(b,[{key:"updateInputElements",value:function(){var a=this.attributeNames,b=this.attributeNameElements;if(void 0===b){var c=this.getAttributeInfo();if(void 0===c)return;b=this.attributeNameElements=[];for(var d=void 0,e=a.value.length,f=this.element,g=0;g<e;++g){var h=c[g],l=h.source;if(l!==d&&void 0!==l){d=l;var n=document.createElement("div");n.className="neuroglancer-single-mesh-source-header";n.textContent=l;f.appendChild(n)}l=document.createElement("div");l.className="neuroglancer-single-mesh-attribute";
n=document.createElement("input");n.title=h.name;this.registerEventListener(n,"input",this.debouncedValueUpdater);n.type="text";l.textContent=Object(k.d)(h);l.appendChild(n);if(void 0!==h.min&&void 0!==h.max){var p=document.createElement("span");p.className="neuroglancer-single-mesh-attribute-range";p.textContent="["+h.min.toPrecision(6)+", "+h.max.toPrecision(6)+"]";l.appendChild(p)}b[g]=n;f.appendChild(l)}}a.value.forEach(function(a,c){b[c].value=a||""})}},{key:"disposed",value:function(){Object(g.b)(this.element)}},
{key:"updateAttributeNames",value:function(){var a=this.attributeNames.value,b=this.attributeNameElements,c=!1;a.forEach(function(d,e){var f=b[e].value;f||(f=void 0);f!==d&&(c=!0,a[e]=f)});c&&this.attributeNames.changed.dispatch()}}]);return b}(h.a),G=function(a){function b(a,c){q(this,b);var d=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));d.element=a;d.layer=c;d.attributeWidget=d.registerDisposer(r(d.layer));d.codeWidget=d.registerDisposer(l(d.layer));a.classList.add("neuroglancer-single-mesh-dropdown");
c=document.createElement("div");c.className="neuroglancer-single-mesh-dropdown-top-row";var e=document.createElement("div");e.style.flex="1";var f=document.createElement("a"),g=document.createElement("button");g.type="button";g.textContent="?";g.className="help-link";f.appendChild(g);f.title="Documentation on single mesh layer rendering";f.target="_blank";f.href="https://github.com/google/neuroglancer/blob/master/src/neuroglancer/sliceview/image_layer_rendering.md";g=document.createElement("button");
g.innerHTML="&square;";g.className="maximize-button";g.title="Show larger editor view";d.registerEventListener(g,"click",function(){new A(d.layer)});c.appendChild(e);c.appendChild(g);c.appendChild(f);a.appendChild(c);a.appendChild(d.attributeWidget.element);a.appendChild(d.codeWidget.element);d.codeWidget.textEditor.refresh();return d}t(b,a);w(b,[{key:"onShow",value:function(){this.codeWidget.textEditor.refresh()}}]);return b}(m.g),A=function(a){function b(a){q(this,b);var c=n(this,(b.__proto__||
Object.getPrototypeOf(b)).call(this));c.layer=a;c.attributeWidget=c.registerDisposer(r(c.layer));c.codeWidget=c.registerDisposer(l(c.layer));c.content.classList.add("neuroglancer-single-mesh-layer-shader-overlay");c.content.appendChild(c.attributeWidget.element);c.content.appendChild(c.codeWidget.element);c.codeWidget.textEditor.refresh();return c}t(b,a);return b}(p.a);Object(f.e)("mesh",B)},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function t(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function a(){return new g.a([],function(a){return Object(w.a)(a,
w.z)})}function b(a){return Object(z.a)(a.dataType,a.numComponents)}function l(a){return a.map(function(a){return Object(x.c)(new x.b,a.dataType,a.numComponents)})}function r(a,b){return a.memoize.getUncounted({type:"single_mesh:getMeshInfo",parameters:b},function(){return a.rpc.promiseInvoke(h.a,{chunkManager:a.addCounterpartRef(),parameters:b})})}c.d(f,"b",function(){return S});f.d=b;c.d(f,"c",function(){return ha});f.e=function(a,b){return r(a,b).then(function(c){return a.getChunkSource(R,{parameters:Object.assign({},
b,{info:c})})})};var v=c(23);m=c(10);var p=c(57),k=c(32),h=c(188),g=c(5),d=c(27),e=c(1),w=c(2),B=c(19),F=c(33),G=c(28),A=c(102),x=c(63),D=c(25),z=c(7),C=c(6),H=function P(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return P(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},J=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;
d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();f.a="//NEUROGLANCER_SINGLE_MESH_LAYER_FRAGMENT_MAIN_START";var E=c(54),S=function Va(){t(this,Va);this.shaderError=Object(G.b)();var b=void 0;this.fragmentMain=new g.a(void 0===b?"void main() {\n  emitGray();\n}\n":b,w.B);this.attributeNames=a();this.objectToDataTransform=new p.a};$jscomp.initSymbol();var K=Symbol("SingleMeshShaderManager.vertexAttributeTextureUnit"),
U=Object(x.c)(new x.b,d.b.FLOAT32,3),W=function(){function a(b,c,d){t(this,a);this.attributeNames=b;this.attributeInfo=c;this.fragmentMain=d;this.tempLightVec=new Float32Array(4);this.tempPickID=new Float32Array(4);this.textureAccessHelper=new x.a("vertexData");this.indexBufferHelper=new A.a("VertexIndex")}J(a,[{key:"defineAttributeAccess",value:function(a,c){var e=this.textureAccessHelper;e.defineShader(a);a.addVertexCode(e.getAccessor("readVertexPosition","uVertexAttributeSampler[0]",d.b.FLOAT32,
3));a.addVertexCode(e.getAccessor("readVertexNormal","uVertexAttributeSampler[1]",d.b.FLOAT32,3));var f=2,g="\nvec3 vertexPosition = readVertexPosition("+c+");\nvec3 vertexNormal = readVertexNormal("+c+");\n",h=this.attributeNames;this.attributeInfo.forEach(function(d,k){if(void 0!==h[k]){var l=b(d);a.addVarying("highp "+l,"vCustom"+k);a.addFragmentCode("\n#define "+h[k]+" vCustom"+k+"\n");a.addVertexCode(e.getAccessor("readAttribute"+k,"uVertexAttributeSampler["+f+"]",d.dataType,d.numComponents));
g+="vCustom"+k+" = readAttribute"+k+"("+c+");\n";f+=1}});a.addTextureSampler2D("uVertexAttributeSampler",K,f);a.addVertexMain(g)}},{key:"defineShader",value:function(a){a.require(A.b);this.indexBufferHelper.defineShader(a);a.addVarying("highp float","vLightingFactor");a.addUniform("highp vec4","uLightDirection");a.addUniform("highp vec4","uColor");a.addUniform("highp mat4","uModelMatrix");a.addUniform("highp mat4","uProjection");a.addUniform("highp vec4","uPickID");a.addVarying("highp vec4","vPickID");
a.addVertexCode(z.b);a.addVertexCode(z.c);a.addVertexMain("\nfloat vertexIndex = getVertexIndex();\nuint32_t triangleIndex;\ndivmod(getPrimitiveIndex(), 3.0, triangleIndex);\nuint32_t pickID; pickID.value = uPickID;\nvPickID = add(pickID, triangleIndex).value;\n");a.addFragmentCode("\nvoid emitPremultipliedRGBA(vec4 color) {\n  emit(vec4(color.rgb * vLightingFactor, color.a), vPickID);\n}\nvoid emitRGBA(vec4 color) {\n  color = clamp(color, 0.0, 1.0);\n  color.xyz *= color.a;\n  emitPremultipliedRGBA(color);\n}\nvoid emitRGB(vec3 color) {\n  emitRGBA(vec4(color, 1.0));\n}\nvoid emitGray() {\n  emitRGB(vec3(1.0, 1.0, 1.0));\n}\n");
a.addFragmentCode(E);this.defineAttributeAccess(a,"vertexIndex");a.addVertexMain("\ngl_Position = uProjection * (uModelMatrix * vec4(vertexPosition, 1.0));\nvec3 normal = normalize((uModelMatrix * vec4(vertexNormal, 0.0)).xyz);\nvLightingFactor = abs(dot(normal, uLightDirection.xyz)) + uLightDirection.w;\n");a.setFragmentMainFunction("//NEUROGLANCER_SINGLE_MESH_LAYER_FRAGMENT_MAIN_START\n"+this.fragmentMain)}},{key:"beginLayer",value:function(a,b,c){var d=c.dataToDevice,f=c.lightDirection,g=c.ambientLighting;
c=c.directionalLighting;a.uniformMatrix4fv(b.uniform("uProjection"),!1,d);d=this.tempLightVec;e.p.scale(d,f,c);d[3]=g;a.uniform4fv(b.uniform("uLightDirection"),d)}},{key:"setPickID",value:function(a,b,c){a.uniform4fv(b.uniform("uPickID"),Object(z.p)(this.tempPickID,c))}},{key:"beginObject",value:function(a,b,c){a.uniformMatrix4fv(b.uniform("uModelMatrix"),!1,c)}},{key:"getShader",value:function(a,b){var c=this,d={attributeNames:this.attributeNames,attributeInfo:this.attributeInfo,fragmentMain:this.fragmentMain};
return a.memoize.get("single_mesh/SingleMeshShaderManager:"+Object(B.a)(b)+":"+Object(w.g)(d),function(){var d=new D.a(a);d.require(b);c.defineShader(d);return d.build()})}},{key:"bindVertexData",value:function(a,b,c){this.textureAccessHelper.setupTextureLayout(a,b,c);var d=b.textureUnit(K)+a.TEXTURE0,e=function(b){a.activeTexture(d++);a.bindTexture(a.TEXTURE_2D,b)};e(c.vertexTexture);e(c.normalTexture);var f=this.attributeNames;c.vertexAttributeTextures.forEach(function(a,b){void 0!==f[b]&&e(a)})}},
{key:"disableVertexData",value:function(a,b){for(var c=2,d=this.attributeInfo.length,e=this.attributeNames,f=0;f<d;++f)void 0!==e[f]&&++c;b=b.textureUnit(K)+a.TEXTURE0;for(d=0;d<c;++d)a.activeTexture(b++),a.bindTexture(a.TEXTURE_2D,null)}},{key:"drawFragment",value:function(a,b,c,d){d.ensure(c.numIndices).bind(b);this.bindVertexData(a,b,c.vertexData);this.indexBufferHelper.bind(c.indexBuffer,b);a.drawArrays(a.TRIANGLES,0,c.numIndices)}},{key:"endLayer",value:function(a,b){Object(A.c)(a,b);this.indexBufferHelper.disable(b);
this.disableVertexData(a,b)}}]);return a}(),V=function(){function a(){t(this,a)}J(a,[{key:"copyToGPU",value:function(a,b){var c=this;Object(x.d)(this,a,1,this.vertexPositions.length/3);var d=function(b,d){var e=a.createTexture();a.bindTexture(a.TEXTURE_2D,e);Object(x.f)(a,c,d,b);return e};this.vertexTexture=d(this.vertexPositions,U);this.normalTexture=d(this.vertexNormals,U);this.vertexAttributeTextures=this.vertexAttributes.map(function(a,c){return d(a,b[c])});a.bindTexture(a.TEXTURE_2D,null)}},
{key:"freeGPUMemory",value:function(a){a.deleteTexture(this.vertexTexture);a.deleteTexture(this.normalTexture);for(var b=this.vertexAttributeTextures,c=$jscomp.makeIterator(b),d=c.next();!d.done;d=c.next())a.deleteTexture(d.value);b.length=0}}]);return a}(),M=function(a){function b(a,c){t(this,b);a=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));var d=a.vertexData=new V;d.vertexPositions=c.vertexPositions;d.vertexNormals=c.vertexNormals;d.vertexAttributes=c.vertexAttributes;c=a.indices=
c.indices;a.numIndices=c.length;return a}n(b,a);J(b,[{key:"copyToGPU",value:function(a){H(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"copyToGPU",this).call(this,a);this.vertexData.copyToGPU(a,this.source.attributeTextureFormats);this.indexBuffer=Object(A.e)(a,this.indices)}},{key:"freeGPUMemory",value:function(a){H(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"freeGPUMemory",this).call(this,a);this.vertexData.freeGPUMemory(a);this.indexBuffer.dispose()}}]);return b}(m.b),
R=function(a){function b(){t(this,b);var a=q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments));a.attributeTextureFormats=l(a.info.vertexAttributes);return a}n(b,a);J(b,[{key:"getChunk",value:function(a){return new M(this,a)}},{key:"info",get:function(){return this.parameters.info}}]);return b}(Object(m.f)(m.e,h.d)),ba=function(a){function b(){t(this,b);return q(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}n(b,a);return b}(Object(F.c)(C.b)),ha=function(a){function b(a,
c){t(this,b);var d=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));d.source=a;d.displayState=c;d.shaders=new Map;d.sharedObject=d.registerDisposer(new ba);d.fallbackFragmentMain="void main() {\n  emitGray();\n}\n";d.countingBuffer=d.registerDisposer(Object(A.d)(d.gl));d.displayState.shaderError.value=void 0;var e=function(){d.shaderManager=void 0;d.displayState.shaderError.value=void 0;d.disposeShaders();d.redrawNeeded.dispatch()};d.registerDisposer(c.fragmentMain.changed.add(e));d.registerDisposer(c.attributeNames.changed.add(e));
d.registerDisposer(c.objectToDataTransform.changed.add(function(){d.redrawNeeded.dispatch()}));d.displayState.shaderError.value=void 0;c=d.sharedObject;c.visibility.add(d.visibility);c.RPC_TYPE_ID=h.c;c.initializeCounterpart(a.chunkManager.rpc,{chunkManager:a.chunkManager.rpcId,source:a.addCounterpartRef()});d.setReady(!0);return d}n(b,a);J(b,[{key:"disposeShaders",value:function(){for(var a=this.shaders,b=$jscomp.makeIterator(a.values()),c=b.next();!c.done;c=b.next())c=c.value,null!==c&&c.dispose();
a.clear()}},{key:"disposed",value:function(){this.disposeShaders();H(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"disposed",this).call(this)}},{key:"makeShaderManager",value:function(a){a=void 0===a?this.displayState.fragmentMain.value:a;return new W(this.displayState.attributeNames.value,this.source.info.vertexAttributes,a)}},{key:"getShader",value:function(a){var b=this.shaders,c=b.get(a);if(void 0===c){c=null;var d=this.shaderManager;void 0===d&&(d=this.shaderManager=this.makeShaderManager());
var e=this.displayState.fragmentMain.value;try{c=d.getShader(this.gl,a),this.fallbackFragmentMain=e,this.displayState.shaderError.value=null}catch(Ja){if(this.displayState.shaderError.value=Ja,d=this.fallbackFragmentMain,d!==e){d=this.shaderManager=this.makeShaderManager(d);try{c=d.getShader(this.gl,a)}catch(qc){}}}b.set(a,c)}return c}},{key:"draw",value:function(a){if(a.emitColor||!a.alreadyEmittedPickID){var b=this.source.chunks.get(h.b);if(void 0!==b&&b.state===v.d.GPU_MEMORY){var c=this.getShader(a.emitter);
if(null!==c){var d=this.gl,e=this.shaderManager;c.bind();e.beginLayer(d,c,a);var f=a.pickIDs;e.beginObject(d,c,this.displayState.objectToDataTransform.transform);a.emitPickID&&e.setPickID(d,c,f.register(this,b.numIndices/3));e.drawFragment(d,c,b,this.countingBuffer);e.endLayer(d,c)}}}}},{key:"drawPicking",value:function(a){this.draw(a)}},{key:"transformPickedValue",value:function(a,b){a=this.source.chunks.get(h.b);if(void 0!==a){b*=3;var c=a.indices;if(!(b>=c.length)){var d=c[b],e=[],f=this.displayState.attributeNames.value;
a.vertexData.vertexAttributes.forEach(function(a,b){b=f[b];void 0!==b&&e.push(b+"="+a[d].toPrecision(6))});return e.join(", ")}}}},{key:"isTransparent",get:function(){return null!==this.displayState.fragmentMain.value.match(/emitRGBA|emitPremultipliedRGBA/)}},{key:"gl",get:function(){return this.source.gl}}]);return b}(k.a)},function(m,f,c){function q(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&
b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function n(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}c.d(f,"d",function(){return t});f.c="single_mesh/SingleMeshLayer";f.a="single_mesh/getSingleMeshInfo";f.b="";var t=function(a){function b(){n(this,b);var a=(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments);if(!this)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!a||"object"!==typeof a&&"function"!==typeof a?this:a}q(b,a);return b}(function b(){n(this,b)});t.RPC_ID="single_mesh/SingleMeshSource"},function(m,f){},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(f,"__esModule",{value:!0});c.d(f,"AnnotationPointListUserLayer",function(){return h});var a=c(191),b=c(192);m=c(12);f=c(9);var l=c(5),r=c(1),v=c(194),p=function e(a,b,c){null===a&&(a=Function.prototype);var f=Object.getOwnPropertyDescriptor(a,b);if(void 0===f){if(a=Object.getPrototypeOf(a),null!==
a)return e(a,b,c)}else{if("value"in f)return f.value;b=f.get;return void 0===b?void 0:b.call(c)}},k=function(){function a(a,b){for(var c=0;c<b.length;c++){var e=b[c];e.enumerable=e.enumerable||!1;e.configurable=!0;"value"in e&&(e.writable=!0);Object.defineProperty(a,e.key,e)}}return function(b,c,e){c&&a(b.prototype,c);e&&a(b,e);return b}}();c(196);var h=function(c){function e(c,f){q(this,e);var g=n(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,[]));g.manager=c;g.selectedIndex=new l.b(null);
g.layer=new a.a(g.manager.chunkManager,new b.a,g.manager.voxelSize,g.selectedIndex);g.layer.pointList.restoreState(f.points);g.registerDisposer(g.layer.pointList.changed.add(function(){g.specificationChanged.dispatch()}));g.addRenderLayer(new a.b(g.layer));g.addRenderLayer(new a.c(g.layer));var h=c.layerSelectedValues;g.registerDisposer(h.changed.add(function(){var a=h.get(g);g.selectedIndex.value="number"===typeof a?a:null}));return g}t(e,c);k(e,[{key:"toJSON",value:function(){var a={type:"pointAnnotation"};
a.points=this.layer.pointList.toJSON();return a}},{key:"handleAction",value:function(a){switch(a){case "annotate":a=this.manager.layerSelectedValues.get(this),void 0!==a?this.layer.pointList.delete(a):this.manager.layerSelectedValues.mouseState.active&&this.layer.pointList.append(this.manager.voxelSize.voxelFromSpatial(r.p.create(),this.manager.layerSelectedValues.mouseState.position))}}},{key:"makeDropdown",value:function(a){return new g(a,this)}}]);return e}(m.f),g=function(a){function b(a,c){q(this,
b);var e=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));e.element=a;e.layer=c;e.pointListWidget=e.registerDisposer(new v.a(e.layer.layer.pointList,e.layer.selectedIndex));a.classList.add("neuroglancer-annotation-point-list-dropdown");a.appendChild(e.pointListWidget.element);e.registerDisposer(e.pointListWidget.pointSelected.add(function(a){e.layer.manager.setVoxelCoordinates(e.layer.layer.pointList.get(a))}));return e}t(b,a);k(b,[{key:"onShow",value:function(){p(b.prototype.__proto__||
Object.getPrototypeOf(b.prototype),"onShow",this).call(this);this.pointListWidget.visible=!0}},{key:"onHide",value:function(){p(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"onHide",this).call(this);this.pointListWidget.visible=!1}}]);return b}(m.g);Object(f.e)("pointAnnotation",h)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return B});c.d(f,"b",function(){return G});c.d(f,"c",function(){return x});m=c(32);f=c(50);var a=c(0),b=c(1),
l=c(3),r=c(17),v=c(102),p=c(25),k=c(7),h=c(53),g=function z(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return z(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,
c);d&&a(b,d);return b}}(),e=b.j.create(),w=new Float32Array(4),B=function(a){function c(a,b,d,e){q(this,c);var f=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));f.chunkManager=a;f.pointList=b;f.voxelSizeObject=d;f.selectedIndex=e;f.generation=-1;f.redrawNeeded=new l.a;f.color=Float32Array.of(1,1,0,1);f.selectedColor=Float32Array.of(0,1,0,1);f.buffer=new r.a(a.gl);f.registerDisposer(b.changed.add(function(){f.selectedIndex.value=null;f.redrawNeeded.dispatch()}));f.registerDisposer(e.changed.add(function(){f.redrawNeeded.dispatch()}));
return f}t(c,a);d(c,[{key:"updateBuffer",value:function(){var a=this.pointList,b=a.generation;this.generation!==b&&(this.generation=b,this.buffer.setData(a.points.view))}},{key:"updateMouseState",value:function(a,c){b.p.multiply(a.position,this.pointList.get(c),this.voxelSizeObject.size)}},{key:"gl",get:function(){return this.chunkManager.gl}}]);return c}(a.a);c=function(a){function c(a){q(this,c);var b=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));b.gl=a;b.shaders=new Map;b.squareCornersBuffer=
Object(h.a)(b.gl);b.countingBuffer=b.registerDisposer(Object(v.d)(b.gl));return b}t(c,a);d(c,[{key:"defineShader",value:function(a){a.addAttribute("highp vec3","aVertexPosition");a.addAttribute("highp vec2","aCornerOffset");a.addUniform("highp vec2","uPointRadii");a.addUniform("highp vec4","uColor");a.addUniform("highp vec4","uColorSelected");a.addUniform("highp vec4","uSelectedIndex");a.addVarying("highp vec4","vColor");a.addUniform("highp mat4","uProjection");a.addUniform("highp vec4","uPickID");
a.addVarying("highp vec4","vPickID");a.addVarying("highp vec2","vPointCoord");a.require(v.b);a.addVertexCode(k.b);a.setVertexMain("\ngl_Position = uProjection * vec4(aVertexPosition, 1.0);\ngl_Position.xy += aCornerOffset * uPointRadii * gl_Position.w;\nvPointCoord = aCornerOffset;\n\nuint32_t primitiveIndex = getPrimitiveIndex();\n\nuint32_t pickID; pickID.value = uPickID;\nvPickID = add(pickID, primitiveIndex).value;\n\nif (uSelectedIndex == primitiveIndex.value) {\n  vColor = uColorSelected;\n} else {\n  vColor = uColor;\n}\n");
a.setFragmentMain("\nif (dot(vPointCoord, vPointCoord) > 1.0) {\n  discard;\n}\nemit(getColor(), vPickID);\n")}},{key:"getShader",value:function(a){var b=this.shaders,c=b.get(a);void 0===c&&(c=new p.a(this.gl),c.require(a),this.defineShader(c),c=this.registerDisposer(c.build()),b.set(a,c));return c}},{key:"draw",value:function(a,c,d){var f=this.getShader(d.emitter),g=this.gl;f.bind();c.updateBuffer();var h=c.pointList.length,l=f.attribute("aVertexPosition"),n=f.attribute("aCornerOffset");c.buffer.bindToVertexAttrib(l,
3);g.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(l,1);this.squareCornersBuffer.bindToVertexAttrib(n,2);this.countingBuffer.ensure(h).bind(f,1);b.j.identity(e);b.j.scale(e,e,c.voxelSizeObject.size);b.j.multiply(e,d.dataToDevice,e);g.uniformMatrix4fv(f.uniform("uProjection"),!1,e);g.uniform2f(f.uniform("uPointRadii"),8/d.viewportWidth,8/d.viewportHeight);d.emitPickID&&(a=d.pickIDs.register(a,h),g.uniform4fv(f.uniform("uPickID"),Object(k.p)(w,a)));d.emitColor&&(g.uniform4fv(f.uniform("uColor"),c.color),
g.uniform4fv(f.uniform("uColorSelected"),c.selectedColor),c=c.selectedIndex.value,null===c&&(c=4294967295),g.uniform4fv(f.uniform("uSelectedIndex"),Object(k.p)(w,c)));g.ANGLE_instanced_arrays.drawArraysInstancedANGLE(g.TRIANGLE_FAN,0,4,h);g.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(l,0);Object(v.c)(g,f,!0);g.disableVertexAttribArray(l)}}]);return c}(a.a);var F=function(a){function b(){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}t(b,a);d(b,[{key:"defineShader",
value:function(a){g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"defineShader",this).call(this,a);a.addFragmentCode("\nvec4 getColor () { return vColor; }\n")}}]);return b}(c),G=function(a){function b(a){q(this,b);var c=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.base=a;c.renderHelper=c.registerDisposer(new F(c.gl));c.registerDisposer(a);c.registerDisposer(a.redrawNeeded.add(function(){c.redrawNeeded.dispatch()}));c.setReady(!0);return c}t(b,a);d(b,[{key:"draw",value:function(a){this.renderHelper.draw(this,
this.base,a)}},{key:"updateMouseState",value:function(a,b,c){this.base.updateMouseState(a,c)}},{key:"transformPickedValue",value:function(a,b){return b}},{key:"gl",get:function(){return this.base.chunkManager.gl}}]);return b}(m.a),A=function(a){function b(){q(this,b);return n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}t(b,a);d(b,[{key:"defineShader",value:function(a){g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"defineShader",this).call(this,a);a.addFragmentCode("\nvec4 getColor() {\n  float scalar = 1.0 - 2.0 * abs(0.5 - gl_FragCoord.z);\n  return vec4(vColor.xyz, scalar * vColor.a);\n}\n")}}]);
return b}(c),x=function(a){function b(a){q(this,b);var c=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.base=a;c.renderHelper=c.registerDisposer(new A(c.gl));c.registerDisposer(a);c.registerDisposer(a.redrawNeeded.add(function(){c.redrawNeeded.dispatch()}));c.setReady(!0);return c}t(b,a);d(b,[{key:"draw",value:function(a){this.renderHelper.draw(this,this.base,a)}},{key:"updateMouseState",value:function(a,b,c){this.base.updateMouseState(a,c)}},{key:"transformPickedValue",value:function(a,
b){return b}},{key:"gl",get:function(){return this.base.chunkManager.gl}}]);return b}(f.b)},function(m,f,c){c.d(f,"a",function(){return b});var q=c(193),n=c(2),t=c(3),a=function(){function a(a,b){for(var c=0;c<b.length;c++){var f=b[c];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),b=function(){function b(){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");
this.points=new q.a;this.changed=new t.a;this.generation=0}a(b,[{key:"delete",value:function(a){this.points.eraseRange(3*a,3*a+3);++this.generation;this.changed.dispatch()}},{key:"get",value:function(a){return this.points.data.subarray(3*a,3*a+3)}},{key:"append",value:function(a){this.points.appendArray(a.subarray(0,3));++this.generation;this.changed.dispatch()}},{key:"reset",value:function(){this.points.clear();++this.generation;this.changed.dispatch()}},{key:"restoreState",value:function(a){try{if(Array.isArray(a)){var b=
a.length,c=this.points;c.resize(3*b);var f=c.data;for(c=0;c<b;++c){var h=3*c;Object(n.c)(f.subarray(h,h+3),a[c],n.o)}++this.generation;this.changed.dispatch()}}catch(g){this.reset()}}},{key:"toJSON",value:function(){for(var a=this.length,b=this.points.data,c=Array(a),f=0;f<a;++f){var h=3*f;c[f]=[b[h],b[h+1],b[h+2]]}return c}},{key:"length",get:function(){return this.points.length/3}}]);return b}()},function(m,f,c){c.d(f,"a",function(){return n});var q=function(){function c(a,b){for(var c=0;c<b.length;c++){var f=
b[c];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(a,b,f){b&&c(a.prototype,b);f&&c(a,f);return a}}(),n=function(){function c(a){a=void 0===a?16:a;if(!(this instanceof c))throw new TypeError("Cannot call a class as a function");this.length=0;this.data=new Float32Array(a)}q(c,[{key:"resize",value:function(a){var b=this.data;if(a>b.length){var c=new Float32Array(Math.max(a,2*b.length));c.set(b.subarray(0,this.length));this.data=
c}this.length=a}},{key:"shrinkToFit",value:function(){this.data=new Float32Array(this.view)}},{key:"clear",value:function(){this.length=0}},{key:"appendArray",value:function(a){var b=this.length;this.resize(b+a.length);this.data.set(a,b)}},{key:"eraseRange",value:function(a,b){this.data.copyWithin(a,b,this.length);this.length-=b-a}},{key:"view",get:function(){var a=this.data;return new Float32Array(a.buffer,a.byteOffset,this.length)}}]);return c}()},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return r});m=c(0);var t=c(4),a=c(3),b=function(){function a(a,b){for(var c=0;c<b.length;c++){var f=b[c];f.enumerable=
f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),l=function p(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return p(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};c(21);c(195);var r=function(c){function f(b,c){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");
var d=q(this,(f.__proto__||Object.getPrototypeOf(f)).call(this));d.pointList=b;d.selectionIndex=c;d.element=document.createElement("div");d.clearButton=document.createElement("button");d.itemContainer=document.createElement("div");d.generation=-1;d.pointSelected=new a.b;d.visible_=!1;c=d.element;var e=d.clearButton,g=d.itemContainer;c.className="neuroglancer-point-list-widget";e.className="neuroglancer-clear-button";e.textContent="Delete all points";d.registerEventListener(e,"click",function(){d.pointList.reset()});
g.className="neuroglancer-item-container neuroglancer-select-text";c.appendChild(e);c.appendChild(g);d.registerDisposer(b.changed.add(function(){d.maybeUpdate()}));return d}n(f,c);b(f,[{key:"maybeUpdate",value:function(){var a=this;if(this.visible_){var b=this.pointList;if(this.generation!==b.generation){this.generation=b.generation;var c=this.itemContainer;Object(t.a)(c);var e=b.length;b=b.points.data;for(var f={i:0};f.i<e;f={i:f.i},++f.i){var k=document.createElement("div");k.className="neuroglancer-point-list-item";
var l=3*f.i;k.textContent=Math.round(b[l])+" "+Math.round(b[l+1])+" "+Math.round(b[l+2]);k.addEventListener("click",function(b){return function(){a.pointSelected.dispatch(b.i)}}(f));k.addEventListener("mouseenter",function(b){return function(){a.selectionIndex.value=b.i}}(f));k.addEventListener("mouseleave",function(){a.selectionIndex.value=null});c.appendChild(k)}}}}},{key:"disposed",value:function(){Object(t.b)(this.element);this.clearButton=this.itemContainer=this.element=void 0;l(f.prototype.__proto__||
Object.getPrototypeOf(f.prototype),"disposed",this).call(this)}},{key:"visible",get:function(){return this.visible_},set:function(a){this.visible_!==a&&(this.visible_=a,!0===a&&this.maybeUpdate())}}]);return f}(m.a)},function(m,f){},function(m,f){},function(m,f,c){Object.defineProperty(f,"__esModule",{value:!0});var q=c(198);window.addEventListener("DOMContentLoaded",function(){Object(q.a)()})},function(m,f,c){f.a=function(){var b=window.viewer=Object(q.a)();Object(t.a)(b.inputEventBindings);b.registerDisposer(new a.a(b.state)).updateFromUrlHash();
Object(n.a)(b);Object(n.b)(b);return b};var q=c(199),n=c(233),t=c(234),a=c(235)},function(m,f,c){f.a=function(b){Object(a.a)();Object(a.b)();try{var c=new n.a(document.getElementById("neuroglancer-container"));return new t.a(c,b)}catch(r){throw q.a.showMessage("Error: "+r.message),r;}};c(201);var q=c(26),n=c(80),t=c(206),a=c(232);c(200)},function(m,f){},function(m,f,c){c(202);c(203)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,
b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}m=c(103);var a=c(8);f=c(18);var b=
c(0),l=c(1),r=c(11),v=c(63),p=c(7),k=function F(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return F(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},h=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);
d&&a(b,d);return b}}(),g=function(a){function b(a,c,d,e){q(this,b);var f=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));f.chunkDataSize=c;f.channelStride=c[0]*c[1]*c[2];Object(v.e)(f,a,d,c[0],c[1],c[2]*e);return f}t(b,a);h(b,null,[{key:"get",value:function(a,c,d,e){return a.memoize.get("sliceview.UncompressedTextureLayout:"+Object(l.q)(c)+","+(d+","+e),function(){return new b(a,c,d,e)})}}]);return b}(b.a),d=function(a){function b(a,c,d,e){q(this,b);a=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,
e));a.dataType=c;a.numChannels=d;Object(v.c)(a,c);a.textureAccessHelper=new v.a("chunkData");return a}t(b,a);h(b,[{key:"defineShader",value:function(a){k(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"defineShader",this).call(this,a);var c=this.textureAccessHelper;c.defineShader(a);a.addFragmentCode(c.getAccessor("readVolumeData","uVolumeChunkSampler",this.dataType));1<this.numChannels?(a.addUniform("highp float","uChannelStride"),a.addFragmentCode("\nfloat getChannelOffset(int channelIndex) {\n  return float(channelIndex) * uChannelStride;\n}\n")):
a.addFragmentCode("float getChannelOffset(int channelIndex) { return 0.0; }");a.addFragmentCode("\nfloat getIndexIntoChunk (int channelIndex) {\n  vec3 chunkDataPosition = getPositionWithinChunk();\n  return chunkDataPosition.x + uChunkDataSize.x * (chunkDataPosition.y + uChunkDataSize.y * chunkDataPosition.z) + getChannelOffset(channelIndex);\n}\n");c=Object(p.a)(this.dataType);a.addFragmentCode("\n"+c+" getDataValue (int channelIndex) {\n  return readVolumeData(getIndexIntoChunk(channelIndex));\n}\n")}},
{key:"setupTextureLayout",value:function(a,b,c){1<this.numChannels&&a.uniform1f(b.uniform("uChannelStride"),c.channelStride);this.textureAccessHelper.setupTextureLayout(a,b,c)}},{key:"getTextureLayout",value:function(a,b){return g.get(a,b,this.texelsPerElement,this.numChannels)}},{key:"setTextureData",value:function(a,b,c){Object(v.f)(a,b,this,c)}}],[{key:"get",value:function(a,c,d){var e="sliceview.UncompressedChunkFormat:"+c+":"+d;return a.memoize.get(e,function(){return new b(a,c,d,e)})}}]);return b}(m.a),
e=function(b){function c(){q(this,c);return n(this,(c.__proto__||Object.getPrototypeOf(c)).apply(this,arguments))}t(c,b);h(c,[{key:"setTextureData",value:function(a){var b=this.source,c=b.chunkFormatHandler,d=c.chunkFormat,e;this.textureLayout=this.chunkDataSize===b.spec.chunkDataSize?e=c.textureLayout.addRef():e=d.getTextureLayout(a,this.chunkDataSize);this.chunkFormat.setTextureData(a,e,this.data)}},{key:"getChannelValueAt",value:function(b,c){var d=this.chunkDataSize;c=b[0]+d[0]*(b[1]+d[1]*(b[2]+
d[2]*c));d=this.chunkFormat.dataType;b=this.data;switch(d){case a.a.UINT8:case a.a.FLOAT32:case a.a.UINT16:case a.a.UINT32:return b[c];case a.a.UINT64:return c*=2,new r.a(b[c],b[c+1])}throw Error("Invalid data type: "+d);}}]);return c}(m.b),w=function(a){function b(a,c){q(this,b);var e=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));e.chunkFormat=e.registerDisposer(d.get(a,c.dataType,c.numChannels));e.textureLayout=e.registerDisposer(e.chunkFormat.getTextureLayout(a,c.chunkDataSize));return e}
t(b,a);h(b,[{key:"getChunk",value:function(a,b){return new e(a,b)}}]);return b}(b.a);Object(f.c)(function(a,b){return null==b.compressedSegmentationBlockSize?new w(a,b):null})},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==
b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}var a=c(204),b=c(205);m=c(103);var l=c(8);f=c(18);var r=c(0),v=c(1),p=c(11),k=c(63),h=c(7),g=function x(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==
a)return x(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),e=function(a){function b(a,c,d,e){q(this,b);var f=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));f.chunkDataSize=c;f.subchunkSize=d;Object(k.d)(f,
a,1,e);a=f.subchunkGridSize=v.p.create();for(e=0;3>e;++e)a[e]=Math.ceil(c[e]/d[e]);return f}t(b,a);d(b,null,[{key:"get",value:function(a,c,d,e){return a.memoize.get("sliceview.CompressedSegmentationTextureLayout:"+Object(v.q)(c)+","+(Object(v.q)(d)+","+e),function(){return new b(a,c,d,e)})}}]);return b}(r.a),w=Object(k.c)(new k.b,l.a.UINT32),B=function(a){function b(a,c,d,e){q(this,b);e=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,e));e.dataType=a;e.subchunkSize=c;e.numChannels=d;e.textureAccessHelper=
new k.a("chunkData");return e}t(b,a);d(b,[{key:"defineShader",value:function(a){g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"defineShader",this).call(this,a);var c=this.textureAccessHelper;c.defineShader(a);var d=function(a){return"compressedSegmentationChunkFormat_"+a};a.addUniform("highp vec3","uSubchunkGridSize");a.addUniform("highp vec3","uSubchunkSize");a.addFragmentCode(h.f);var e=this.dataType,f=Object(h.a)(e);e===l.a.UINT64&&a.addFragmentCode(h.l);a.addFragmentCode(c.getAccessor(d("readTextureValue"),
"uVolumeChunkSampler",l.a.UINT32));a.addFragmentCode(h.o);a.addFragmentCode(h.n);c="\nfloat "+d("getChannelOffset")+"(int channelIndex) {\n  if (channelIndex == 0) {\n    return "+this.numChannels+".0;\n  }\n  vec4 v = "+d("readTextureValue")+"(float(channelIndex)).value;\n  return uintleToFloat(v.xyz);\n}\n"+f+" getDataValue (int channelIndex) {\n  vec3 chunkPosition = getPositionWithinChunk();\n\n  // TODO: maybe premultiply this and store as uniform.\n  vec3 subchunkGridPosition = floor(chunkPosition / uSubchunkSize);\n  float subchunkGridOffset = getFortranOrderIndex(subchunkGridPosition, uSubchunkGridSize);\n\n  float channelOffset = "+
d("getChannelOffset")+"(channelIndex);\n\n  // TODO: Maybe just combine this offset into subchunkGridStrides.\n  float subchunkHeaderOffset = subchunkGridOffset * 2.0 + channelOffset;\n\n  vec4 subchunkHeader0 = "+d("readTextureValue")+"(subchunkHeaderOffset).value;\n  vec4 subchunkHeader1 = "+d("readTextureValue")+"(subchunkHeaderOffset + 1.0).value;\n\n  float outputValueOffset = uintleToFloat(subchunkHeader0.xyz) + channelOffset;\n  float encodingBits = unnormalizeUint8(subchunkHeader0[3]);\n  if (encodingBits > 0.0) {\n    vec3 subchunkPosition = floor(min(chunkPosition - subchunkGridPosition * uSubchunkSize, uSubchunkSize - 1.0));\n    float subchunkOffset = getFortranOrderIndex(subchunkPosition, uSubchunkSize);\n    highp float encodedValueBaseOffset = uintleToFloat(subchunkHeader1.xyz) + channelOffset;\n    highp float encodedValueOffset = floor(encodedValueBaseOffset + subchunkOffset * encodingBits / 32.0);\n    vec4 encodedValue = "+
d("readTextureValue")+"(encodedValueOffset).value;\n    float wordOffset = mod(subchunkOffset * encodingBits, 32.0);\n    // If the value is in the first byte, then 0 <= wordOffset < 8.\n    // We need to mod by 2**encodedBits\n    float wordShifter = pow(2.0, -wordOffset);\n    float encodedValueMod = pow(2.0, encodingBits);\n    float encodedValueShifted;\n    if (wordOffset < 16.0) {\n      encodedValueShifted = dot(unnormalizeUint8(encodedValue.xy), vec2(1.0, 256.0));\n    } else {\n      encodedValueShifted = dot(unnormalizeUint8(encodedValue.zw), vec2(256.0 * 256.0, 256.0 * 256.0 * 256.0));\n    }\n    encodedValueShifted = floor(encodedValueShifted * wordShifter);\n    float decodedValue = mod(encodedValueShifted, encodedValueMod);\n    outputValueOffset += decodedValue * "+
(this.dataType===l.a.UINT64?"2.0":"1.0")+";\n  }\n  "+f+" result;\n";c=e===l.a.UINT64?c+("\n  result.low = "+d("readTextureValue")+"(outputValueOffset).value;\n  result.high = "+d("readTextureValue")+"(outputValueOffset+1.0).value;\n"):c+("\n  result.value = "+d("readTextureValue")+"(outputValueOffset).value;\n");a.addFragmentCode(c+"\n  return result;\n}\n")}},{key:"setupTextureLayout",value:function(a,b,c){a.uniform3fv(b.uniform("uSubchunkGridSize"),c.subchunkGridSize);this.textureAccessHelper.setupTextureLayout(a,
b,c)}},{key:"setTextureData",value:function(a,b,c){Object(k.f)(a,b,w,c)}},{key:"getTextureLayout",value:function(a,b,c){return e.get(a,b,this.subchunkSize,c)}},{key:"beginSource",value:function(a,c){g(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"beginSource",this).call(this,a,c);a.uniform3fv(c.uniform("uSubchunkSize"),this.subchunkSize)}}],[{key:"get",value:function(a,c,d,e){var f="sliceview.CompressedSegmentationChunkFormat:"+c+":"+e,g=f+":"+Object(v.q)(d);return a.memoize.get(g,function(){return new b(c,
d,e,f)})}}]);return b}(m.a),F=function(c){function e(){q(this,e);return n(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}t(e,c);d(e,[{key:"setTextureData",value:function(a){var b=this.data,c=this.chunkFormat,d=this.textureLayout=c.getTextureLayout(a,this.chunkDataSize,b.length);c.setTextureData(a,d,b)}},{key:"getChannelValueAt",value:function(c,d){var e=this.chunkDataSize,f=this.chunkFormat,g=this.data;d=g[d];if(f.dataType===l.a.UINT64){var h=new p.a;Object(b.a)(h,g,d,e,f.subchunkSize,
c);return h}return Object(a.a)(g,d,e,f.subchunkSize,c)}}]);return e}(m.b),G=function(a){function b(a,c){q(this,b);var d=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this)),e=c.dataType;if(e!==l.a.UINT64&&e!==l.a.UINT32)throw Error("Unsupported compressed segmentation data type: "+l.a[e]);d.chunkFormat=d.registerDisposer(B.get(a,c.dataType,c.compressedSegmentationBlockSize,c.numChannels));return d}t(b,a);d(b,[{key:"getChunk",value:function(a,b){return new F(a,b)}}]);return b}(r.a);Object(f.c)(function(a,
b){return null!=b.compressedSegmentationBlockSize?new G(a,b):null})},function(m,f,c){f.a=function(c,f,a,b,l){f=Object(q.a)(c,f,a,b,l,1)+f;return c[f]};var q=c(104)},function(m,f,c){f.a=function(c,f,a,b,l,m){a=Object(q.a)(f,a,b,l,m,2)+a;c.low=f[a];c.high=f[a+1];return c};var q=c(104)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a){var b=new F.a,c=b.element;c.classList.add("neuroglancer-viewer-context-menu");var d=function(a,d){a=b.registerDisposer(new E.a(d,
{label:a}));a.element.classList.add("neuroglancer-viewer-context-menu-limit-widget");c.appendChild(a.element)};d("GPU memory limit",a.chunkQueueManager.capacities.gpuMemory.sizeLimit);d("System memory limit",a.chunkQueueManager.capacities.systemMemory.sizeLimit);d("Concurrent chunk requests",a.chunkQueueManager.capacities.download.itemLimit);d=function(a,d){var e=document.createElement("label");e.textContent=a;a=b.registerDisposer(new B.b(d));e.appendChild(a.element);c.appendChild(e)};d("Show axis lines",
a.showAxisLines);d("Show scale bar",a.showScaleBar);d("Show cross sections in 3-d",a.showPerspectiveSliceViews);return b}c.d(f,"a",function(){return M});m=c(13);var b=c.n(m),l=c(10),r=c(85);m=c(105);var v=c(22),p=c(211),k=c(12),h=c(106),g=c(220),d=c(9),e=c(42),w=c(29),B=c(41),F=c(64),G=c(110),A=c(38);f=c(0);var x=c(4),D=c(15),z=c(34),C=c(3),H=c(44),J=c(33),E=c(230),S=c(67),K=c(6),U=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in
d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();c(231);c(60);c(21);c(43);var W=function(a){function b(a){q(this,b);var c=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.gl=a;c.worker=new Worker("chunk_worker.bundle.js");c.chunkQueueManager=c.registerDisposer(new l.d(new K.a(c.worker),c.gl,{gpuMemory:new l.a({defaultItemLimit:1E6,defaultSizeLimit:1E9}),systemMemory:new l.a({defaultItemLimit:1E7,defaultSizeLimit:2E9}),
download:new l.a({defaultItemLimit:32,defaultSizeLimit:Number.POSITIVE_INFINITY})}));c.chunkManager=c.registerDisposer(new l.c(c.chunkQueueManager));c.chunkQueueManager.registerDisposer(function(){return c.worker.terminate()});return c}t(b,a);U(b,[{key:"rpc",get:function(){return this.chunkQueueManager.rpc}}]);return b}(f.a);(function(a){function b(){q(this,b);var a=n(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments));a.global=new z.a;return a}t(b,a);return b})(m.b);var V={showHelpButton:!0,
showLayerDialog:!0,showLayerPanel:!0,showLocation:!0,resetStateWhenEmpty:!0},M=function(c){function f(a,c){c=void 0===c?{}:c;q(this,f);var g=n(this,(f.__proto__||Object.getPrototypeOf(f)).call(this));g.display=a;g.navigationState=g.registerDisposer(new e.e);g.perspectiveNavigationState=new e.e(new e.g(g.navigationState.position),1);g.mouseState=new k.d;g.layerManager=g.registerDisposer(new k.a);g.showAxisLines=new B.a(!0,!0);g.showScaleBar=new B.a(!0,!0);g.showPerspectiveSliceViews=new B.a(!0,!0);
g.layerSelectedValues=g.registerDisposer(new k.b(g.layerManager,g.mouseState));g.resetInitiated=new C.a;g.state=new H.a;g.visible=!0;console.log(c);var l=c,m=void 0===l.dataContext?new W(a.gl):l.dataContext,p=void 0===l.visibility?new J.b(J.b.VISIBLE):l.visibility,t=void 0===l.inputEventBindings?{global:new z.a,sliceView:new z.a,perspectiveView:new z.a}:l.inputEventBindings,E=void 0===l.element?a.makeCanvasOverlayElement():l.element;l=void 0===l.dataSourceProvider?Object(v.a)({credentialsManager:r.a}):
l.dataSourceProvider;g.registerDisposer(function(){return Object(x.b)(g.element)});g.registerDisposer(m);g.options=Object.assign({},V,c,{dataContext:m,visibility:p,inputEventBindings:t,element:E,dataSourceProvider:l});g.layerSpecification=new d.c(g.dataSourceProvider,g.layerManager,g.chunkManager,g.layerSelectedValues,g.navigationState.voxelSize);g.registerDisposer(a.updateStarted.add(function(){g.onUpdateDisplay()}));g.registerDisposer(a.updateFinished.add(function(){g.onUpdateDisplayFinished()}));
c=g.state;c.add("layers",g.layerSpecification);c.add("navigation",g.navigationState);c.add("showAxisLines",g.showAxisLines);c.add("showScaleBar",g.showScaleBar);c.add("perspectiveOrientation",g.perspectiveNavigationState.pose.orientation);c.add("perspectiveZoom",g.perspectiveNavigationState.zoomFactor);c.add("showSlices",g.showPerspectiveSliceViews);c.add("gpuMemoryLimit",g.dataContext.chunkQueueManager.capacities.gpuMemory.sizeLimit);c.add("systemMemoryLimit",g.dataContext.chunkQueueManager.capacities.systemMemory.sizeLimit);
c.add("concurrentDownloads",g.dataContext.chunkQueueManager.capacities.download.itemLimit);g.registerDisposer(g.navigationState.changed.add(function(){g.handleNavigationStateChanged()}));g.layerManager.initializePosition(g.navigationState.position);g.registerDisposer(g.layerSpecification.voxelCoordinatesSet.add(function(a){g.navigationState.position.setVoxelCoordinates(a)}));m=g.registerCancellable(b()(function(){!g.wasDisposed&&0===g.layerManager.managedLayers.length&&g.options.resetStateWhenEmpty&&
(g.navigationState.reset(),g.perspectiveNavigationState.pose.orientation.reset(),g.perspectiveNavigationState.zoomFactor.reset(),g.resetInitiated.dispatch(),!w.b&&g.options.showLayerDialog&&g.visibility.visible&&new h.a(g.layerSpecification))}));g.layerManager.layersChanged.add(m);m();g.registerDisposer(g.dataContext.chunkQueueManager.visibleChunksChanged.add(function(){g.layerSelectedValues.handleLayerChange()}));g.registerDisposer(g.dataContext.chunkQueueManager.visibleChunksChanged.add(function(){g.visible&&
a.scheduleRedraw()}));g.makeUI();c.add("layout",g.layout);g.registerActionListeners();g.registerEventActionBindings();g.registerDisposer(Object(G.a)(E,g.navigationState.position));return g}t(f,c);U(f,[{key:"makeUI",value:function(){var b=this,c=this.options,d=this.element;d.classList.add("neuroglancer-viewer");d.classList.add("neuroglancer-noselect");d.style.display="flex";d.style.flexDirection="column";if(c.showHelpButton||c.showLocation){var e=document.createElement("div");e.title="Right click for settings";
this.registerDisposer(a(this)).registerParent(e);e.style.display="none";e.style.flexDirection="row";e.style.alignItems="stretch";if(c.showLocation){var f=this.registerDisposer(new S.c(document.createElement("div"),this.navigationState.voxelSize));e.appendChild(f.element);f=this.registerDisposer(new S.b(this.navigationState.position));e.appendChild(f.element);f=this.registerDisposer(new S.a(document.createElement("div"),this.mouseState,this.navigationState.voxelSize));f.element.style.flex="1";f.element.style.alignSelf=
"center";e.appendChild(f.element)}c.showHelpButton&&(c=document.createElement("div"),c.className="neuroglancer-help-button neuroglancer-button",c.textContent="?",c.title="Help",this.registerEventListener(c,"click",function(){b.showHelpDialog()}),e.appendChild(c));d.appendChild(e)}this.layout=this.registerDisposer(new g.a(this,"4panel"));d.appendChild(this.layout.element);this.display.onResize();e=function(){var a=b.visibility.visible;a!==b.visible&&(d.style.visibility=a?"inherit":"hidden",b.visible=
a)};e();this.registerDisposer(this.visibility.changed.add(e))}},{key:"registerEventActionBindings",value:function(){var a=this.element;this.registerDisposer(new z.b(a,this.inputEventMap));this.registerDisposer(new A.a(a))}},{key:"bindAction",value:function(a,b){this.registerDisposer(Object(D.c)(this.element,a,b))}},{key:"registerActionListeners",value:function(){for(var a=this,b={},c=$jscomp.makeIterator(["recolor","clear-segments"]),d=c.next();!d.done;b={action:b.action},d=c.next())b.action=d.value,
this.bindAction(b.action,function(b){return function(){a.layerManager.invokeAction(b.action)}}(b));b={};c=$jscomp.makeIterator(["select","annotate"]);for(d=c.next();!d.done;b={action$211:b.action$211},d=c.next())b.action$211=d.value,this.bindAction(b.action$211,function(b){return function(){a.mouseState.updateUnconditionally();a.layerManager.invokeAction(b.action$211)}}(b));this.bindAction("help",function(){return a.showHelpDialog()});for(d={i:1};9>=d.i;d={i:d.i},++d.i)this.bindAction("toggle-layer-"+
d.i,function(b){return function(){var c=b.i-1,d=a.layerManager.managedLayers;c<d.length&&(c=d[c],c.setVisible(!c.visible))}}(d));this.bindAction("toggle-axis-lines",function(){return a.showAxisLines.toggle()});this.bindAction("toggle-scale-bar",function(){return a.showScaleBar.toggle()});this.bindAction("toggle-show-slices",function(){return a.showPerspectiveSliceViews.toggle()})}},{key:"showHelpDialog",value:function(){var a=this.inputEventBindings;new p.a([["Global",a.global],["Slice View",a.sliceView],
["Perspective View",a.perspectiveView]])}},{key:"onUpdateDisplay",value:function(){this.visible&&(this.dataContext.chunkQueueManager.chunkUpdateDeadline=null)}},{key:"onUpdateDisplayFinished",value:function(){this.visible&&this.mouseState.updateIfStale()}},{key:"handleNavigationStateChanged",value:function(){if(this.visible){var a=this.dataContext.chunkQueueManager;null===a.chunkUpdateDeadline&&(a.chunkUpdateDeadline=Date.now()+10)}this.mouseState.stale=!0}},{key:"chunkManager",get:function(){return this.dataContext.chunkManager}},
{key:"chunkQueueManager",get:function(){return this.dataContext.chunkQueueManager}},{key:"dataContext",get:function(){return this.options.dataContext}},{key:"visibility",get:function(){return this.options.visibility}},{key:"inputEventBindings",get:function(){return this.options.inputEventBindings}},{key:"inputEventMap",get:function(){return this.inputEventBindings.global}},{key:"element",get:function(){return this.options.element}},{key:"dataSourceProvider",get:function(){return this.options.dataSourceProvider}},
{key:"gl",get:function(){return this.display.gl}}]);return f}(f.a)},function(m,f,c){f.b=function(c,f){return function(n){n.style.flex=c;f(n)}};f.a=function(c,f){return function(n){n.style.display="flex";n.style.flexDirection=c;for(var a=$jscomp.makeIterator(f),b=a.next();!b.done;b=a.next()){b=b.value;var l=n.ownerDocument.createElement("div");n.appendChild(l);b(l)}}}},function(m,f,c){c.d(f,"a",function(){return a});var q=c(2),n=c(3),t=function(){function a(a,b){for(var c=0;c<b.length;c++){var f=b[c];
f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),a=function(){function a(b,c,f){f=void 0===f?c:f;if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this.enumType=b;this.value_=c;this.defaultValue=f;this.changed=new n.a}t(a,[{key:"reset",value:function(){this.value=this.defaultValue}},{key:"restoreState",value:function(a){this.value=Object(q.n)(a,
this.enumType)}},{key:"toJSON",value:function(){return this.enumType[this.value_].toLowerCase()}},{key:"value",set:function(a){this.value_!==a&&(this.value_=a,this.changed.dispatch())},get:function(){return this.value_}}]);return a}()},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function t(a){a.addFragmentExtension("GL_EXT_draw_buffers");a.addFragmentCode(x)}function a(a){a.addFragmentExtension("GL_EXT_draw_buffers");a.addFragmentCode(D)}function b(a){a.setFragmentMain("\nvec4 v0 = getValue0();\nvec4 v1 = getValue1();\nvec4 accum = vec4(v0.rgb, v1.r);\nfloat revealage = v0.a;\n\ngl_FragColor = vec4(accum.rgb / accum.a, revealage);\n")}
c.d(f,"a",function(){return H});var l=c(76),r=c(12),v=c(78),p=c(32);m=c(79);var k=c(35),h=c(41),g=c(15),d=c(1),e=c(83),w=c(52),B=c(7),F=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),G=function E(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),
null!==a)return E(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};c(21);c(210);var A;(function(a){a[a.COLOR=0]="COLOR";a[a.Z=1]="Z";a[a.PICK=2]="PICK";a[a.NUM_TEXTURES=3]="NUM_TEXTURES"})(A||(A={}));var x=[B.i,"\nvoid emit(vec4 color, vec4 pickId) {\n  gl_FragData["+A.COLOR+"] = color;\n  gl_FragData["+A.Z+"] = packFloat01ToFixedPoint(1.0 - gl_FragCoord.z);\n  gl_FragData["+A.PICK+"] = pickId;\n}\n"],D=["\nfloat computeOITWeight(float alpha) {\n  float a = min(1.0, alpha) * 8.0 + 0.01;\n  float b = -gl_FragCoord.z * 0.95 + 1.0;\n  return a * a * a * b * b * b;\n}\n",
"\nvoid emit(vec4 color, vec4 pickId) {\n  float weight = computeOITWeight(color.a);\n  vec4 accum = color * weight;\n  gl_FragData[0] = vec4(accum.rgb, color.a);\n  gl_FragData[1] = vec4(accum.a, 0.0, 0.0, 0.0);\n}\n"],z=d.p.create(),C=d.j.create(),H=function(c){function f(a,c,n){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");var m=q(this,(f.__proto__||Object.getPrototypeOf(f)).call(this,a,c,n));m.visibleLayerTracker=Object(r.i)(m.viewer.layerManager,p.a,m);m.sliceViews=
new Set;m.projectionMat=d.j.create();m.inverseProjectionMat=d.j.create();m.modelViewMat=d.j.create();m.width=0;m.height=0;m.pickIDs=new v.a;m.axesLineHelper=m.registerDisposer(l.a.get(m.gl));m.sliceViewRenderHelper=m.registerDisposer(k.d.get(m.gl,t));m.offscreenFramebuffer=m.registerDisposer(new w.b(m.gl,{colorBuffers:Object(w.e)(m.gl,A.NUM_TEXTURES),depthBuffer:new w.a(m.gl)}));m.offscreenCopyHelper=m.registerDisposer(w.c.get(m.gl));m.transparencyCopyHelper=m.registerDisposer(w.c.get(m.gl,b,2));
m.registerDisposer(m.navigationState.changed.add(function(){m.viewportChanged()}));Object(g.c)(c,"translate-via-mouse-drag",function(a){Object(e.a)(a.detail,function(a,b,c){a=m.width;var e=m.height,f=m.viewer.navigationState.position,g=f.spatialCoordinates;d.p.transformMat4(z,g,m.projectionMat);z[0]=2*b/a;z[1]=-2*c/e;d.p.transformMat4(g,z,m.inverseProjectionMat);f.changed.dispatch()})});Object(g.c)(c,"rotate-via-mouse-drag",function(a){Object(e.a)(a.detail,function(a,b,c){m.navigationState.pose.rotateRelative(d.e[1],
-b/4*Math.PI/180);m.navigationState.pose.rotateRelative(d.e[0],c/4*Math.PI/180);m.viewer.navigationState.changed.dispatch()})});n.showSliceViewsCheckbox&&(a=m.registerDisposer(new h.b(n.showSliceViews)),a.element.className="perspective-panel-show-slice-views neuroglancer-noselect",c=document.createElement("label"),c.className="perspective-panel-show-slice-views neuroglancer-noselect",c.appendChild(document.createTextNode("Slices")),c.appendChild(a.element),m.element.appendChild(c));m.registerDisposer(n.showSliceViews.changed.add(function(){m.scheduleRedraw()}));
m.registerDisposer(n.showAxisLines.changed.add(function(){m.scheduleRedraw()}));return m}n(f,c);F(f,[{key:"updateProjectionMatrix",value:function(){var a=this.projectionMat;d.j.perspective(a,Math.PI/4,this.width/this.height,10,5E3);var b=this.modelViewMat;this.navigationState.toMat4(b);d.p.set(z,1,-1,-1);d.j.scale(b,b,z);var c=d.p.set(z,0,0,100);d.j.translate(b,b,c);d.j.invert(C,b);d.j.multiply(a,a,C);d.j.invert(this.inverseProjectionMat,a)}},{key:"viewportChanged",value:function(){this.context.scheduleRedraw()}},
{key:"onResize",value:function(){var a=this.element,b=a.clientHeight;if(a.clientWidth!==this.width||b!==this.height)this.width=this.element.clientWidth,this.height=this.element.clientHeight,this.viewportChanged()}},{key:"disposed",value:function(){for(var a=$jscomp.makeIterator(this.sliceViews),b=a.next();!b.done;b=a.next())b.value.dispose();this.sliceViews.clear();G(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"disposed",this).call(this)}},{key:"updateMouseState",value:function(a){a.pickedRenderLayer=
null;if(!this.navigationState.valid)return!1;var b=a.position,c=this.offscreenFramebuffer,e=this.width,f=this.height;if(!c.hasSize(e,f))return!1;var g=this.mouseX,h=f-this.mouseY,k=c.readPixel(A.Z,g,h);k=1-Object(B.q)(k);if(1===k)return!1;b[0]=2*g/e-1;b[1]=2*h/f-1;b[2]=2*k-1;d.p.transformMat4(b,b,this.inverseProjectionMat);this.pickIDs.setMouseState(a,c.readPixelAsUint32(A.PICK,g,h));return!0}},{key:"draw",value:function(){if(this.navigationState.valid){this.onResize();var b=this.width,c=this.height;
if(0!==b&&0!==c){if(this.viewer.showSliceViews.value)for(var e=$jscomp.makeIterator(this.sliceViews),f=e.next();!f.done;f=e.next())f.value.updateRendering();e=this.gl;this.offscreenFramebuffer.bind(b,c);e.disable(e.SCISSOR_TEST);this.gl.clearColor(0,0,0,0);e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT);e.enable(e.DEPTH_TEST);f=this.projectionMat;this.updateProjectionMatrix();var g=d.p.create();Object(d.n)(g,d.e[2],this.modelViewMat);d.p.normalize(g,g);var h=this.pickIDs;h.clear();f={dataToDevice:f,
lightDirection:g,ambientLighting:.2,directionalLighting:.8,pickIDs:h,emitter:t,emitColor:!0,emitPickID:!0,alreadyEmittedPickID:!1,viewportWidth:b,viewportHeight:c};g=this.visibleLayerTracker.getVisibleLayers();var k=!1,l=$jscomp.makeIterator(g);for(h=l.next();!h.done;h=l.next())h=h.value,h.isTransparent?k=!0:h.draw(f);this.viewer.showSliceViews.value&&this.drawSliceViews(f);this.viewer.showAxisLines.value&&this.drawAxisLines();if(k){e.depthMask(!1);e.enable(e.BLEND);k=this.transparentConfiguration;
k.bind(b,c);this.gl.clearColor(0,0,0,1);e.clear(e.COLOR_BUFFER_BIT);f.emitter=a;e.blendFuncSeparate(e.ONE,e.ONE,e.ZERO,e.ONE_MINUS_SRC_ALPHA);f.emitPickID=!1;l=$jscomp.makeIterator(g);for(h=l.next();!h.done;h=l.next())h=h.value,h.isTransparent&&h.draw(f);e.disable(e.DEPTH_TEST);this.offscreenFramebuffer.bindSingle(A.COLOR);e.blendFunc(e.ONE_MINUS_SRC_ALPHA,e.SRC_ALPHA);this.transparencyCopyHelper.draw(k.colorBuffers[0].texture,k.colorBuffers[1].texture);e.depthMask(!0);e.disable(e.BLEND);e.enable(e.DEPTH_TEST);
this.offscreenFramebuffer.bind(b,c)}e.WEBGL_draw_buffers.drawBuffersWEBGL([e.NONE,e.WEBGL_draw_buffers.COLOR_ATTACHMENT1_WEBGL,e.WEBGL_draw_buffers.COLOR_ATTACHMENT2_WEBGL]);f.emitter=t;f.emitPickID=!0;f.emitColor=!1;b=$jscomp.makeIterator(g);for(h=b.next();!h.done;h=b.next())c=h.value,f.alreadyEmittedPickID=!c.isTransparent,c.draw(f);e.disable(e.DEPTH_TEST);this.offscreenFramebuffer.unbind();this.setGLViewport();this.offscreenCopyHelper.draw(this.offscreenFramebuffer.colorBuffers[A.COLOR].texture)}}}},
{key:"drawSliceViews",value:function(a){var b=this.sliceViewRenderHelper,c=a.lightDirection,e=a.ambientLighting,f=a.directionalLighting;a=a.dataToDevice;for(var g=$jscomp.makeIterator(this.sliceViews),h=g.next();!h.done;h=g.next())if(h=h.value,0!==h.width&&0!==h.height){var k=Math.abs(d.p.dot(c,h.viewportAxes[2]));k=e+k*f;var l=C;d.j.identity(l);l[0]=h.width/2;l[5]=-h.height/2;d.j.multiply(l,h.viewportToData,l);d.j.multiply(l,a,l);b.draw(h.offscreenFramebuffer.colorBuffers[0].texture,l,d.r.fromValues(k,
k,k,1),d.r.fromValues(.5,.5,.5,1),0,0,1,1)}}},{key:"drawAxisLines",value:function(){var a=this.gl;d.j.identity(C);C[0]=1600;C[5]=1600;C[10]=1600;var b=this.navigationState.position.spatialCoordinates;C[12]=b[0];C[13]=b[1];C[14]=b[2];C[15]=1;d.j.multiply(C,this.projectionMat,C);a.WEBGL_draw_buffers.drawBuffersWEBGL([a.WEBGL_draw_buffers.COLOR_ATTACHMENT0_WEBGL]);this.axesLineHelper.draw(C,!1)}},{key:"zoomByMouse",value:function(a){this.navigationState.zoomBy(a)}},{key:"navigationState",get:function(){return this.viewer.navigationState}},
{key:"transparentConfiguration",get:function(){var a=this.transparentConfiguration_;void 0===a&&(a=this.transparentConfiguration_=this.registerDisposer(new w.b(this.gl,{colorBuffers:Object(w.e)(this.gl,2,this.gl.RGBA,this.gl.FLOAT)})));return a}}]);return f}(m.a)},function(m,f){},function(m,f,c){function q(a,c){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!c||"object"!==typeof c&&"function"!==typeof c?a:c}function n(a,c){if("function"!==typeof c&&
null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}function t(a){return a.startsWith("key")?a.substring(3):a.startsWith("digit")||a.startsWith("arrow")?a.substring(5):a}c.d(f,"a",function(){return a});m=c(29);c(212);var a=function(a){function b(a){function c(a,b){for(var d=$jscomp.makeIterator(a.parents),
e=d.next();!e.done;e=d.next())e=e.value,void 0!==e.label?f(e.label,e):c(e,b);a=$jscomp.makeIterator(a.bindings.entries());for(d=a.next();!d.done;d=a.next()){e=$jscomp.makeIterator(d.value);d=e.next().value;e=e.next().value;var g=d.indexOf(":");d=d.substring(g+1);b.set(d,e.action)}}function f(a,b){d.has(b)||(a={label:a,entries:new Map},c(b,a.entries),d.set(b,a))}if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var k=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this)),
h=k.content;h.classList.add("describe-key-bindings");var g=document.createElement("div");g.classList.add("describe-key-bindings-container");var d=new Map;a=$jscomp.makeIterator(a);for(var e=a.next();!e.done;e=a.next()){var l=$jscomp.makeIterator(e.value);e=l.next().value;l=l.next().value;f(e,l)}a=$jscomp.makeIterator(d.values());for(e=a.next();!e.done;e=a.next()){l=e.value;e=document.createElement("h2");e.textContent=l.label;g.appendChild(e);e=document.createElement("div");e.className="dl";l=$jscomp.makeIterator(l.entries);
for(var n=l.next();!n.done;n=l.next()){var m=$jscomp.makeIterator(n.value);n=m.next().value;m=m.next().value;var r=document.createElement("div"),A=document.createElement("div");A.className="definition-outer-container";r.className="definition-container";var x=document.createElement("div");x.className="dt";x.textContent=n.split("+").map(t).join("+");n=document.createElement("div");n.className="dd";n.textContent=m;r.appendChild(x);r.appendChild(n);e.appendChild(A);A.appendChild(r)}g.appendChild(e)}h.appendChild(g);
return k}n(b,a);return b}(m.a)},function(m,f){},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?
Object.setPrototypeOf(a,b):a.__proto__=b)}function t(a){var b=document.createElement("div");b.textContent=a.value;return b}f.b=function(a){var b=document.createElement("div");b.className="autocomplete-completion-with-description";b.textContent=a.value;var c=document.createElement("div");c.className="autocomplete-completion-description";c.textContent=a.description||"";b.appendChild(c);return b};c.d(f,"a",function(){return F});m=c(13);var a=c.n(m),b=c(14);m=c(0);var l=c(4),r=c(214),v=c(34),p=c(215),
k=c(216),h=c(3),g=c(107),d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),e=function A(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return A(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:
b.call(c)}};c(217);$jscomp.initSymbol();var w=Symbol("autocompleteIndex"),B=v.a.fromObject({arrowdown:{action:"cycle-next-active-completion"},arrowup:{action:"cycle-prev-active-completion"},tab:{action:"choose-active-completion-or-prefix",preventDefault:!1},enter:{action:"choose-active-completion",preventDefault:!1},escape:{action:"cancel",preventDefault:!1,stopPropagation:!1}}),F=function(c){function f(c){if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");var d=q(this,
(f.__proto__||Object.getPrototypeOf(f)).call(this));d.inputChanged=new h.b;d.prevInputValue="";d.completionsVisible=!1;d.activeCompletionPromise=null;d.activeCompletionCancellationToken=void 0;d.hasFocus=!1;d.completionResult=null;d.dropdownContentsStale=!0;d.updateHintScrollPositionTimer=null;d.completionElements=null;d.hasResultForDropdown=!1;d.commonPrefix="";d.activeIndex=-1;d.dropdownStyleStale=!0;d.completer=c.completer;c=void 0===c.delay?200:c.delay;var e=d.scheduleUpdateCompletions=a()(function(){var a=
d.activeCompletionCancellationToken=new b.b,c=d.activeCompletionPromise=d.completer(d.value,a);null!==c&&c.then(function(a){d.activeCompletionPromise===c&&(d.setCompletions(a),d.activeCompletionPromise=null)})},c);d.registerDisposer(function(){e.cancel()});c=d.element=document.createElement("div");c.className="autocomplete";var k=document.createElement("div");k.className="autocomplete-dropdown-wrapper";var l=d.dropdownElement=document.createElement("div");l.className="autocomplete-dropdown";var n=
d.promptElement=document.createElement("label");n.className="autocomplete-prompt";var m=d.inputWrapperElement=document.createElement("div");m.className="autocomplete-input-wrapper";c.appendChild(n);var p=d.inputElement=document.createElement("input");p.type="text";p.autocomplete="off";p.spellcheck=!1;p.className="autocomplete-input";Object(g.a)(n,p);n=d.hintElement=document.createElement("input");n.type="text";n.spellcheck=!1;n.className="autocomplete-hint";n.disabled=!0;m.appendChild(n);m.appendChild(p);
k.appendChild(m);k.appendChild(l);c.appendChild(k);d.registerInputHandler();d.handleInputChanged("");d.registerEventListener(d.inputElement,"focus",function(){d.hasFocus||(d.hasFocus=!0,d.dropdownStyleStale=!0,d.updateDropdown())});d.registerEventListener(d.inputElement,"blur",function(){d.hasFocus&&(d.hasFocus=!1,d.updateDropdown())});d.registerEventListener(c.ownerDocument.defaultView,"resize",function(){d.dropdownStyleStale=!0});d.registerEventListener(c.ownerDocument.defaultView,"scroll",function(){d.dropdownStyleStale=
!0});d.registerEventListener(d.dropdownElement,"mousedown",d.handleDropdownMousedown.bind(d));d.registerEventListener(d.inputElement,"keydown",function(){d.hintScrollPositionMayBeStale()});d.registerEventListener(d.inputElement,"mousemove",function(a){0!==a.buttons&&d.hintScrollPositionMayBeStale()});d.registerDisposer(new v.b(p,B)).allShortcutsAreGlobal=!0;Object(v.c)(p,"cycle-next-active-completion",function(){d.cycleActiveCompletion(1)});Object(v.c)(p,"cycle-prev-active-completion",function(){d.cycleActiveCompletion(-1)});
Object(v.c)(p,"choose-active-completion-or-prefix",function(a){d.selectActiveCompletion(!0)&&a.preventDefault()});Object(v.c)(p,"choose-active-completion",function(a){d.selectActiveCompletion(!1)&&a.preventDefault()});Object(v.c)(p,"cancel",function(a){a.stopPropagation();d.cancel()&&(a.detail.preventDefault(),a.detail.stopPropagation())});return d}n(f,c);d(f,[{key:"hintScrollPositionMayBeStale",value:function(){""!==this.hintElement.value&&this.scheduleUpdateHintScrollPosition()}},{key:"handleDropdownMousedown",
value:function(a){this.inputElement.focus();for(var b=this.dropdownElement,c=a.target;c instanceof HTMLElement;c=c.parentElement){var d=c[w];if(void 0!==d){this.selectCompletion(d);break}if(c===b)break}a.preventDefault()}},{key:"cycleActiveCompletion",value:function(a){if(null!==this.completionResult){var b=this.activeIndex,c=this.completionResult.completions.length;this.setActiveIndex(-1===b?0<a?0:c-1:(b+a+c)%c)}}},{key:"registerInputHandler",value:function(){for(var a=this,b=function(b){b=a.inputElement.value;
b!==a.prevInputValue&&(a.prevInputValue=b,a.handleInputChanged(b))},c=$jscomp.makeIterator(["input"]),d=c.next();!d.done;d=c.next())this.registerEventListener(this.inputElement,d.value,b,!1)}},{key:"shouldShowDropdown",value:function(){return null!==this.completionResult&&this.hasFocus?this.hasResultForDropdown:!1}},{key:"updateDropdownStyle",value:function(){Object(r.a)(this.dropdownElement,this.inputElement,{horizontal:!1});this.dropdownStyleStale=!1}},{key:"updateDropdown",value:function(){if(this.shouldShowDropdown()){var a=
this.dropdownElement,b=this.activeIndex;if(this.dropdownContentsStale){var c=this.completionResult,d=void 0===c.makeElement?t:c.makeElement;this.completionElements=c.completions.map(function(e,f){e=d.call(c,e);e[w]=f;e.classList.add("autocomplete-completion");b===f&&e.classList.add("autocomplete-completion-active");a.appendChild(e);return e});this.dropdownContentsStale=!1}this.dropdownStyleStale&&this.updateDropdownStyle();this.completionsVisible||(a.style.display="block",this.completionsVisible=
!0);-1!==b&&Object(k.a)(this.completionElements[b])}else this.completionsVisible&&(this.dropdownElement.style.display="none",this.completionsVisible=!1)}},{key:"setCompletions",value:function(a){this.clearCompletions();var b=a.completions;0!==b.length&&(this.completionResult=a,1===b.length?(b=b[0],a.showSingleResult?this.hasResultForDropdown=!0:b.value.startsWith(this.prevInputValue)?this.hasResultForDropdown=!1:this.hasResultForDropdown=!0,a.selectSingleResult?this.setActiveIndex(0):this.setHintValue(this.getCompletedValueByIndex(0))):
(this.hasResultForDropdown=!0,b=Object(p.a)(function(){function b(b,g){for(;;)switch(c){case 0:f=$jscomp.makeIterator(a.completions),e=f.next();case 1:if(e.done){c=3;break}d=e.value;c=4;return{value:d.value,done:!1};case 4:if(void 0===g){c=5;break}c=-1;throw g;case 5:case 2:e=f.next();c=1;break;case 3:c=-1;default:return{value:void 0,done:!0}}}var c=0,d,e,f,g={next:function(a){return b(a,void 0)},throw:function(a){return b(void 0,a)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();
g[Symbol.iterator]=function(){return this};return g}()),b=this.getCompletedValue(b),b.startsWith(this.prevInputValue)&&(this.commonPrefix=b,this.setHintValue(b))),this.updateDropdown())}},{key:"scheduleUpdateHintScrollPosition",value:function(){var a=this;null===this.updateHintScrollPositionTimer&&(this.updateHintScrollPositionTimer=setTimeout(function(){a.updateHintScrollPosition()},0))}},{key:"setHintValue",value:function(a){var b=this.prevInputValue;a!==b&&a.startsWith(b)||(a="");this.hintElement.value=
a;this.scheduleUpdateHintScrollPosition()}},{key:"setActiveIndex",value:function(a){if(!this.dropdownContentsStale){var b=this.activeIndex;-1!==b&&this.completionElements[b].classList.remove("autocomplete-completion-active");-1!==a&&(b=this.completionElements[a],b.classList.add("autocomplete-completion-active"),Object(k.a)(b))}-1!==a&&this.setHintValue(this.getCompletedValueByIndex(a));this.activeIndex=a}},{key:"getCompletedValueByIndex",value:function(a){return this.getCompletedValue(this.completionResult.completions[a].value)}},
{key:"getCompletedValue",value:function(a){return this.prevInputValue.substring(0,this.completionResult.offset)+a}},{key:"selectActiveCompletion",value:function(a){var b=this.activeIndex;if(-1===b){if(!a)return!1;a=this.completionResult;if(null!==a&&1===a.completions.length)b=0;else return a=this.commonPrefix,a.length>this.value.length?(this.value=a,!0):!1}a=this.getCompletedValueByIndex(b);if(this.value===a)return!1;this.value=a;return!0}},{key:"selectCompletion",value:function(a){this.value=this.getCompletedValueByIndex(a)}},
{key:"cancel",value:function(){return!1}},{key:"updateHintScrollPosition",value:function(){this.updateHintScrollPositionTimer=null;this.hintElement.scrollLeft=this.inputElement.scrollLeft}},{key:"cancelActiveCompletion",value:function(){var a=this.activeCompletionCancellationToken;void 0!==a&&a.cancel();this.activeCompletionCancellationToken=void 0;this.activeCompletionPromise=null}},{key:"handleInputChanged",value:function(a){this.cancelActiveCompletion();this.hintElement.value="";this.clearCompletions();
this.inputChanged.dispatch(a);this.scheduleUpdateCompletions()}},{key:"clearCompletions",value:function(){null!==this.completionResult&&(this.activeIndex=-1,this.completionElements=this.completionResult=null,this.dropdownStyleStale=this.dropdownContentsStale=!0,this.commonPrefix="",Object(l.a)(this.dropdownElement),this.updateDropdown())}},{key:"disposed",value:function(){Object(l.b)(this.element);this.cancelActiveCompletion();null!==this.updateHintScrollPositionTimer&&(clearTimeout(this.updateHintScrollPositionTimer),
this.updateHintScrollPositionTimer=null);e(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"disposed",this).call(this)}},{key:"disabled",get:function(){return this.inputElement.disabled},set:function(a){this.inputElement.disabled=a}},{key:"value",get:function(){return this.prevInputValue},set:function(a){a!==this.prevInputValue&&(this.prevInputValue=this.inputElement.value=a,this.handleInputChanged(a))}}]);return f}(m.a)},function(m,f,c){f.a=function(c,f,m){var a=void 0===m?{}:m,b=void 0===
a.horizontal?!1:a.horizontal,l=void 0===a.vertical?!0:a.vertical,n=void 0===a.topMargin?6:a.topMargin,q=void 0===a.bottomMargin?6:a.bottomMargin,p=void 0===a.leftMargin?6:a.leftMargin,k=void 0===a.rightMargin?6:a.rightMargin;m=void 0===a.maxHeight?!0:a.maxHeight;a=void 0===a.maxWidth?!0:a.maxWidth;f=f.getBoundingClientRect();if(b){b=f.right;var h=c.ownerDocument.documentElement.clientHeight-f.left;b>h?(c.style.left="",c.style.right="0",a&&(c.style.maxWidth=b-p+"px")):(c.style.right="",c.style.left=
"0",a&&(c.style.maxWidth=h-k+"px"))}l&&(l=f.top-n,q=c.ownerDocument.documentElement.clientHeight-f.bottom-q,l>3*q?(c.style.top="",c.style.bottom="100%",m&&(c.style.maxHeight=l+"px")):(c.style.top="100%",c.style.bottom="",m&&(c.style.maxHeight=q+"px")))}},function(m,f,c){f.a=function(c){$jscomp.initSymbol();$jscomp.initSymbolIterator();c=c[Symbol.iterator]();var f=c.next(),m=f.value;if(f.done)return"";for(f=m.length;0<f;){var a=c.next(),b=a.value;if(a.done)break;for(a=0;a<f&&m.charCodeAt(a)===b.charCodeAt(a);++a);
f=a}return m.substring(0,f)}},function(m,f,c){f.a=function(c){var f=c.parentElement,m=c.offsetLeft-f.clientLeft,a=c.offsetTop-f.clientTop,b=f.scrollLeft,l=f.scrollTop;a=Math.max(0,a+c.offsetHeight-(l+f.clientHeight))||Math.min(0,a-l);f.scrollLeft+=Math.max(0,m+c.offsetWidth-(b+f.clientWidth))||Math.min(0,m-b);f.scrollTop+=a}},function(m,f){},function(m,f,c){f.a=function(){var c=document.createElement("button");c.type="submit";c.className="hidden-submit-button";c.style.margin="0";c.style.border="0";
c.style.padding="0";c.style.width="0";c.style.height="0";c.style.overflow="hidden";c.tabIndex=-1;return c}},function(m,f){},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+
typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b,c){var d=Object(k.c)(a,"dragenter",function(b){void 0!==Object(p.c)(b)&&a.classList.add("neuroglancer-drag-over")}),e=Object(k.c)(a,"dragleave",function(){a.classList.remove("neuroglancer-drag-over")}),f=Object(k.c)(a,"dragover",function(a){Object(r.c)(a)?(Object(g.e)(a,Object(r.b)(a,b)),a.stopPropagation(),
a.preventDefault()):void 0!==Object(p.c)(a)&&(Object(p.f)(a,b,!0),a.stopPropagation(),a.preventDefault())}),h=Object(k.c)(a,"drop",function(d){a.classList.remove("neuroglancer-drag-over");if(Object(r.c)(d)){d.stopPropagation();try{var e=JSON.parse(d.dataTransfer.getData(r.d))}catch(R){return}var f=Object(p.b)(d,b,!1,!1,!0);if(void 0!==f&&f.finalize(d)){d.preventDefault();d.dataTransfer.dropEffect=Object(g.c)();Object(p.a)(d);var h=c();f=$jscomp.makeIterator(f.layers.keys());for(d=f.next();!d.done;d=
f.next())h.layerSpecification.add(d.value);try{h.restoreState(e)}catch(R){}}}else if(h=Object(p.b)(d,b,"copy"===Object(g.c)(),!1,!0),void 0!==h&&h.finalize(d))for(d.preventDefault(),d.dataTransfer.dropEffect=Object(g.c)(),Object(p.a)(d),e=c(),h=$jscomp.makeIterator(h.layers.keys()),d=h.next();!d.done;d=h.next())e.layerSpecification.add(d.value)});return function(){h();f();e();d()}}function b(a,b){var c=document.createElement("div");c.style.flex="1";c.style.width="0px";if("string"===typeof b){if(void 0!==
a.parent)throw Error("Invalid layout component specification: "+JSON.stringify(b));return new A(c,b,a.viewer)}Object(d.u)(b);var e=Object(d.w)(b,"type",d.B);switch(e){case "row":case "column":return new x(c,e,Object(d.w)(b,"children",function(b){b=Object(d.a)(b,function(a){return a});if(void 0===a.parent&&0===b.length)throw Error("Stack layout requires at least one child.");return b}),a);case "viewer":e=a.viewer;var f=new v.a(e.layerSpecification.addRef());c=new r.a(c,{display:e.display,navigationState:e.navigationState.addRef(),
perspectiveNavigationState:e.perspectiveNavigationState.addRef(),mouseState:e.mouseState,showAxisLines:e.showAxisLines,showScaleBar:e.showScaleBar,showPerspectiveSliceViews:e.showPerspectiveSliceViews,layerSpecification:f,inputEventBindings:e.inputEventBindings,visibility:e.visibility},{showLayerPanel:e.options.showLayerPanel,showViewerMenu:!0});try{c.restoreState(b)}catch(S){throw c.dispose(),S;}return c}throw Error("Invalid layout component specification: "+JSON.stringify(b));}c.d(f,"a",function(){return D});
m=c(13);var l=c.n(m),r=c(221),v=c(9),p=c(65),k=c(0),h=c(4),g=c(66),d=c(2),e=c(3),w=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),B=function C(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return C(a,b,c)}else{if("value"in
d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};c(229);$jscomp.initSymbol();var F=Symbol("layoutComponentContainer"),G=function(c){function d(b,c,f){q(this,d);var g=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));g.viewer=b;g.parent=f;g.changed=new e.a;g.element=document.createElement("div");var h=g.element;h.style.display="flex";h.style.flex="1";h.style.position="relative";h.style.alignItems="stretch";h.foo="hello";h[F]=g;g.setSpecification(c);var k=[];b=function(b){var c=
document.createElement("div");c.className="neuroglancer-layout-split-drop-zone";c.style[b]="0";switch(b){case "left":case "right":var d="row";c.style.width="10px";c.style.height="100%";break;case "top":case "bottom":d="column",c.style.height="10px",c.style.width="100%"}c.style.display="none";k.push({element:c,direction:d,orientation:b});h.appendChild(c);g.registerDisposer(a(c,g.viewer.layerSpecification,function(){return g.split(b).newContainer.component}))};b("left");b("right");b("top");b("bottom");
var l=!1;g.registerEventListener(h,"dragenter",function(a){if(!l&&void 0!==Object(p.c)(a)){l=!0;a=$jscomp.makeIterator(k);for(var b=a.next();!b.done;b=a.next()){var c=b.value;b=c.element;var d=c.direction;c=c.orientation;if(void 0===f||d!==f.direction||("left"!==c&&"top"!==c||f.get(0)===g)&&("bottom"!==c&&"right"!==c||f.get(f.length-1)===g))c=g.component,c instanceof x&&c.direction===d||(b.style.display="block")}}},!0);g.registerEventListener(h,"drop",function(a){if(l){l=!1;a=$jscomp.makeIterator(k);
for(var b=a.next();!b.done;b=a.next())b.value.element.style.display="none"}});g.registerEventListener(h,"dragleave",function(a){a=a.relatedTarget;if(l&&!(a instanceof HTMLElement&&g.element.contains(a))){l=!1;a=$jscomp.makeIterator(k);for(var b=a.next();!b.done;b=a.next())b.value.element.style.display="none"}},!0);return g}t(d,c);w(d,[{key:"unsetComponent",value:function(){var a=this.componentValue;void 0!==a&&(a.changed.remove(this.changed.dispatch),this.element.removeChild(a.element),a.dispose())}},
{key:"setComponent",value:function(a){var b=this;this.unsetComponent();this.componentValue=a;a.changed.add(this.changed.dispatch);this.element.appendChild(a.element);if(a instanceof r.a){var c=a.layerManager,d=a.registerCancellable(l()(function(){0===c.managedLayers.length&&b.dispose()},0));a.registerDisposer(c.layersChanged.add(function(){0===c.managedLayers.length&&d()}));d()}else if(a instanceof x){var e=a.registerCancellable(l()(function(){var c=a.length;if(0===c&&void 0!==b.parent)b.dispose();
else if(1===c){c=a.get(0).component;if(void 0===b.parent&&c instanceof r.a){var d=c.layout.name;c.viewerNavigationState.copyToParent();var e=new Set(c.layerManager.managedLayers),f=c.layerSpecification;f.rootLayers.filter(function(a){return e.has(a)});f.rootLayers.managedLayers=Array.from(c.layerManager.managedLayers);f.rootLayers.layersChanged.dispatch()}else d=c.toJSON();b.setSpecification(d)}},0));a.registerDisposer(a.changed.add(function(){2>a.length&&e()}));e()}}},{key:"toJSON",value:function(){return this.component.toJSON()}},
{key:"setSpecification",value:function(a){this.setComponent(b(this,a))}},{key:"disposed",value:function(){this.unsetComponent();this.componentValue=void 0;B(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"disposed",this).call(this)}},{key:"split",value:function(a){var b={type:"viewer"},c=this.parent;if(void 0!==c){if("left"===a&&"row"===c.direction||"top"===a&&"column"===c.direction)return{newContainer:c.insertChild(b,this),existingContainer:this};if("right"===a&&"row"===c.direction||"bottom"===
a&&"column"===c.direction)return{newContainer:c.insertChild(b),existingContainer:this}}c=this.component;c=c instanceof A?c.layerGroupViewer.toJSON():c.toJSON();var d="left"===a||"right"===a?"row":"column";switch(a){case "left":case "top":var e={type:d,children:[b,c]};var f=0;break;case "right":case "bottom":e={type:d,children:[c,b]},f=1}this.setSpecification(e);a=this.component;return{newContainer:a.get(f),existingContainer:a.get(1-f)}}},{key:"component",get:function(){return this.componentValue}}],
[{key:"getFromElement",value:function(a){return a[F]}}]);return d}(k.a),A=function(a){function b(a,c,d){q(this,b);var e=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));e.element=a;e.layerGroupViewer=e.registerDisposer(new r.a(a,{display:d.display,navigationState:d.navigationState.addRef(),perspectiveNavigationState:d.perspectiveNavigationState.addRef(),mouseState:d.mouseState,showAxisLines:d.showAxisLines,showScaleBar:d.showScaleBar,showPerspectiveSliceViews:d.showPerspectiveSliceViews,
layerSpecification:d.layerSpecification.addRef(),inputEventBindings:d.inputEventBindings,visibility:d.visibility},{showLayerPanel:d.options.showLayerPanel,showViewerMenu:!1}));e.layerGroupViewer.layout.name=c;return e}t(b,a);w(b,[{key:"toJSON",value:function(){return this.layerGroupViewer.layout.name}},{key:"changed",get:function(){return this.layerGroupViewer.layout.changed}}]);return b}(k.a),x=function(b){function c(a,b,d,f){q(this,c);var g=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));
g.element=a;g.direction=b;g.container=f;g.changed=new e.a;a.classList.add("neuroglancer-stack-layout");a.classList.add("neuroglancer-stack-layout-"+b);a.style.display="flex";a.style.flexDirection=b;a.appendChild(g.makeDropPlaceholder(g));a=$jscomp.makeIterator(d);for(b=a.next();!b.done;b=a.next())g.insertChild(b.value);return g}t(c,b);$jscomp.initSymbol();$jscomp.initSymbolIterator();w(c,[{key:"makeDropPlaceholder",value:function(b){var c=this,d=document.createElement("div");d.className="neuroglancer-stack-layout-drop-placeholder";
b.registerDisposer(a(d,this.viewer.layerSpecification,function(){var a=d.nextElementSibling,b;null!==a&&(b=G.getFromElement(a));return c.insertChild({type:"viewer",layers:[]},b).component}));b.registerDisposer(function(){Object(h.b)(d)});return d}},{key:"get",value:function(a){return G.getFromElement(this.element.children[2*a+1])}},{key:"insertChild",value:function(a,b){var c=this,d=new G(this.viewer,a,this);a=this.makeDropPlaceholder(d);d.element.classList.add("neuroglancer-stack-layout-child");
d.registerDisposer(d.changed.add(this.changed.dispatch));d.registerDisposer(function(){c.element.removeChild(d.element);c.changed.dispatch()});b=void 0!==b?b.element:null;this.element.insertBefore(d.element,b);this.element.insertBefore(a,b);this.changed.dispatch();return d}},{key:"disposed",value:function(){this.clear();B(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"disposed",this).call(this)}},{key:"clear",value:function(){for(;0!==this.length;)this.get(0).dispose()}},{key:Symbol.iterator,
value:function(){function a(a,g){for(;;)switch(b){case 0:e=f,d=e.length,c=0;case 1:if(!(c<d)){b=3;break}b=4;return{value:f.get(c),done:!1};case 4:if(void 0===g){b=5;break}b=-1;throw g;case 5:case 2:++c;b=1;break;case 3:b=-1;default:return{value:void 0,done:!0}}}var b=0,c,d,e,f=this,g={next:function(b){return a(b,void 0)},throw:function(b){return a(void 0,b)},return:function(a){throw Error("Not yet implemented");}};$jscomp.initSymbolIterator();g[Symbol.iterator]=function(){return this};return g}},
{key:"toJSON",value:function(){return{type:this.direction,children:Array.from(this).map(function(a){return a.toJSON()})}}},{key:"length",get:function(){return(this.element.childElementCount-1)/2}},{key:"viewer",get:function(){return this.container.viewer}}]);return c}(k.a),D=function(a){function b(a,c){q(this,b);var d=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));d.viewer=a;d.defaultSpecification=c;d.container=d.registerDisposer(new G(d.viewer,d.defaultSpecification,void 0));return d}
t(b,a);w(b,[{key:"reset",value:function(){this.container.setSpecification(this.defaultSpecification)}},{key:"restoreState",value:function(a){this.container.setSpecification(a)}},{key:"disposed",value:function(){B(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"disposed",this).call(this)}},{key:"toJSON",value:function(){var a=this.container.toJSON();if(a!==this.defaultSpecification)return a}},{key:"changed",get:function(){return this.container.changed}},{key:"element",get:function(){return this.container.element}}]);
return b}(k.a)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,
writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){a=new p.a(a);var c=a.element;c.classList.add("neuroglancer-layer-group-viewer-context-menu");var d=document.createElement("button");d.textContent="Remove layer group";c.appendChild(d);a.registerEventListener(d,"click",function(){b.layerSpecification.layerManager.clear()});d=b.viewerNavigationState;d=$jscomp.makeIterator([["Position",d.position.link],["Cross-section orientation",d.crossSectionOrientation.link],
["Cross-section zoom",d.crossSectionZoom.link],["Perspective orientation",d.perspectiveOrientation.link],["Perspective zoom",d.perspectiveZoom.link]]);for(var e=d.next();!e.done;e=d.next()){var f=$jscomp.makeIterator(e.value);e=f.next().value;f=f.next().value;f=a.registerDisposer(new B.a(f));var g=document.createElement("label");g.style.display="flex";g.style.flexDirection="row";g.style.whiteSpace="nowrap";g.textContent=e;g.appendChild(f.element);c.appendChild(g)}return a}f.c=function(a){return-1!==
a.dataTransfer.types.indexOf("neuroglancer-layer-group-viewer")};f.b=function(a,b){if(a.shiftKey)return"copy";if(a.ctrlKey)return"move";a=A&&A.viewer.layerSpecification.rootLayers===b.rootLayers?A.viewer:void 0;return void 0!==a?"move":"copy"};c.d(f,"a",function(){return D});var b=c(105),l=c(222),r=c(9),v=c(42),p=c(64),k=c(65),h=c(110),g=c(38);m=c(0);var d=c(4),e=c(15),w=c(44),B=c(227),F=function C(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=
Object.getPrototypeOf(a),null!==a)return C(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},G=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}();c(228);f.d="neuroglancer-layer-group-viewer";var A,x=function(a){function b(a){q(this,b);var c=n(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));
c.position=new v.b(a.navigationState.position.addRef());c.crossSectionOrientation=new v.a(a.navigationState.pose.orientation.addRef());c.crossSectionZoom=new v.c(a.navigationState.zoomFactor.addRef());c.navigationState=c.registerDisposer(new v.e(new v.g(c.position.value,c.crossSectionOrientation.value),c.crossSectionZoom.value));c.perspectiveOrientation=new v.a(a.perspectiveNavigationState.pose.orientation.addRef());c.perspectiveZoom=new v.c(a.perspectiveNavigationState.zoomFactor.addRef());c.perspectiveNavigationState=
c.registerDisposer(new v.e(new v.g(c.position.value.addRef(),c.perspectiveOrientation.value),c.perspectiveZoom.value));return c}t(b,a);G(b,[{key:"copyToParent",value:function(){for(var a=$jscomp.makeIterator([this.position,this.crossSectionOrientation,this.crossSectionZoom,this.perspectiveOrientation,this.perspectiveZoom]),b=a.next();!b.done;b=a.next())b.value.copyToPeer()}},{key:"register",value:function(a){a.add("position",this.position);a.add("crossSectionOrientation",this.crossSectionOrientation);
a.add("crossSectionZoom",this.crossSectionZoom);a.add("perspectiveOrientation",this.perspectiveOrientation);a.add("perspectiveZoom",this.perspectiveZoom)}}]);return b}(m.a),D=function(c){function f(a,c,d){d=void 0===d?{}:d;q(this,f);var e=n(this,(f.__proto__||Object.getPrototypeOf(f)).call(this));e.element=a;e.viewerState=c;e.state=new w.a;e.options=Object.assign({showLayerPanel:!0,showViewerMenu:!1},d);e.layerSpecification=e.registerDisposer(c.layerSpecification);e.viewerNavigationState=e.registerDisposer(new x(c));
e.viewerNavigationState.register(e.state);e.layerSpecification instanceof r.a?e.state.add("layers",e.layerSpecification):e.state.add("layers",{changed:e.layerSpecification.changed,toJSON:function(){return e.layerSpecification.layerManager.managedLayers.map(function(a){return a.name})},reset:function(){throw Error("not implemented");},restoreState:function(){throw Error("not implemented");}});a.classList.add("neuroglancer-layer-group-viewer");e.registerDisposer(new g.a(a));e.layout=e.registerDisposer(new b.a(e,
"xy"));e.state.add("layout",e.layout);e.registerActionBindings();e.registerDisposer(e.layerManager.useDirectly());e.registerDisposer(Object(h.a)(a,e.navigationState.position));e.makeUI();return e}t(f,c);G(f,[{key:"bindAction",value:function(a,b){this.registerDisposer(Object(e.c)(this.element,a,b))}},{key:"registerActionBindings",value:function(){var a=this;this.bindAction("add-layer",function(){a.layerPanel&&a.layerPanel.addLayerMenu()})}},{key:"toJSON",value:function(){return Object.assign({type:"viewer"},
this.state.toJSON())}},{key:"reset",value:function(){this.state.reset()}},{key:"restoreState",value:function(a){this.state.restoreState(a)}},{key:"makeUI",value:function(){var b=this;this.element.style.flex="1";this.element.style.display="flex";this.element.style.flexDirection="column";var c=this.options;if(c.showLayerPanel){var d=this.layerPanel=this.registerDisposer(new l.a(this.display,this.layerSpecification,this.viewerNavigationState));c.showViewerMenu?(this.registerDisposer(a(d.element,this)),
d.element.title="Right click for options, drag to move/copy layer group."):d.element.title="Drag to move/copy layer group.";d.element.draggable=!0;this.registerEventListener(d.element,"dragstart",function(a){Object(k.e)(a,{manager:b.layerSpecification,layers:b.layerManager.managedLayers});var c=function(){A&&A.viewer===b&&(A=void 0);b.unregisterDisposer(c)};A={viewer:b,disposer:c};b.registerDisposer(c);var d=b.toJSON();delete d.layers;a.dataTransfer.setData("neuroglancer-layer-group-viewer",JSON.stringify(d))});
this.registerEventListener(d.element,"dragend",function(a){Object(k.a)(a);void 0!==A&&A.viewer===b&&A.disposer()});this.element.appendChild(d.element)}this.element.appendChild(this.layout.element)}},{key:"disposed",value:function(){Object(d.a)(this.element);F(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"disposed",this).call(this)}},{key:"perspectiveNavigationState",get:function(){return this.viewerNavigationState.perspectiveNavigationState}},{key:"navigationState",get:function(){return this.viewerNavigationState.navigationState}},
{key:"display",get:function(){return this.viewerState.display}},{key:"layerManager",get:function(){return this.layerSpecification.layerManager}},{key:"chunkManager",get:function(){return this.layerSpecification.chunkManager}},{key:"mouseState",get:function(){return this.viewerState.mouseState}},{key:"showAxisLines",get:function(){return this.viewerState.showAxisLines}},{key:"showScaleBar",get:function(){return this.viewerState.showScaleBar}},{key:"showPerspectiveSliceViews",get:function(){return this.viewerState.showPerspectiveSliceViews}},
{key:"inputEventBindings",get:function(){return this.viewerState.inputEventBindings}},{key:"visibility",get:function(){return this.viewerState.visibility}},{key:"changed",get:function(){return this.state.changed}}]);return f}(m.a)},function(m,f,c){function q(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function");}function n(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?
a:b}function t(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}function a(a,b){if("move"===a.method)return!1;a.manager.layerManager.filter(function(b){return!a.layers.has(b)});return void 0!==b&&a.layers.has(b)}function b(b,c,d){function f(c,f){var g=
b.dropLayers,h=f?Object(k.d)(c,b.manager):Object(e.c)(),l=!0;if(void 0!==g&&(f&&Object(e.e)(c,h),!g.compatibleWithMethod(h)&&(b.dropLayers=void 0,a(g,d))))return;if(void 0===g){g=b.dropLayers=Object(k.b)(c,b.manager,"copy"===h,!0,!1);if(void 0===g)return;l="move"===g.method}if(void 0!==d&&g.layers.has(d))return g;if(l){var m=b.manager.layerManager,n=new Set,p=Number.POSITIVE_INFINITY;c=m.managedLayers=m.managedLayers.filter(function(a,b){return g.layers.has(a)?(p===Number.POSITIVE_INFINITY&&(p=b),
n.add(a),!1):!0});void 0!==d?(f=c.indexOf(d),p<=f&&++f):f=c.length;h=$jscomp.makeIterator(g.layers.keys());for(l=h.next();!l.done;l=h.next())l=l.value,n.has(l)||g.layers.delete(l);c.splice.apply(c,[].concat([f,0],$jscomp.arrayFromIterable(g.layers.keys())));m.layersChanged.dispatch()}else for(void 0!==d&&(m=b.manager.layerManager.managedLayers.indexOf(d)),c=$jscomp.makeIterator(g.layers.keys()),f=c.next();!f.done;f=c.next())b.manager.add(f.value,m);return g}var h=Object(g.c)(c,"dragenter",function(a){void 0!==
f(a,!0)&&a.preventDefault()}),l=Object(g.c)(c,"drop",function(c){c.preventDefault();var d=f(c,!1);void 0!==d&&(d.finalize(c)?(c.dataTransfer.dropEffect=Object(e.c)(),Object(k.a)("move"===d.method?void 0:c)):a(d));b.dropLayers=void 0}),m=Object(g.c)(c,"dragover",function(a){void 0!==f(a,!0)&&(a.preventDefault(),a.stopPropagation())});return function(){m();l();h()}}c.d(f,"a",function(){return A});var l=c(106),r=c(9),v=c(42),p=c(64),k=c(65),h=c(108),g=c(0),d=c(4),e=c(66),w=c(67),B=function(){function a(a,
b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,d){c&&a(b.prototype,c);d&&a(b,d);return b}}(),F=function D(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return D(a,b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}};c(21);c(226);c(43);var G=function(a){function c(a,
d){q(this,c);var e=n(this,(c.__proto__||Object.getPrototypeOf(c)).call(this));e.layer=a;e.panel=d;var f=e.element=document.createElement("div");f.title="Right click for layer options, drag to move/copy.";f.className="neuroglancer-layer-item neuroglancer-noselect";var g=e.labelElement=document.createElement("span");g.className="neuroglancer-layer-item-label";var h=e.layerNumberElement=document.createElement("span");h.className="neuroglancer-layer-item-number";var m=e.valueElement=document.createElement("span");
m.className="neuroglancer-layer-item-value";var t=document.createElement("span");t.title="Delete layer";t.className="neuroglancer-layer-item-close";e.registerEventListener(t,"click",function(a){e.panel.layerManager.removeManagedLayer(e.layer);a.stopPropagation()});f.appendChild(h);f.appendChild(g);f.appendChild(m);f.appendChild(t);e.registerEventListener(f,"click",function(b){a.setVisible(!a.visible)});g=e.contextMenu=e.registerDisposer(new p.a(f));g.element.classList.add("neuroglancer-layer-dropdown");
g.opened.add(function(){if(void 0!==e.dropdown)e.dropdown.onShow()});g.closed.add(function(){if(void 0!==e.dropdown)e.dropdown.onHide()});f.draggable=!0;e.registerEventListener(f,"dragstart",function(a){Object(k.e)(a,{manager:d.manager,layers:[e.layer]});a.stopPropagation()});e.registerEventListener(f,"dragend",function(a){Object(k.a)(a)});e.registerDisposer(b(e.panel,f,e.layer));e.registerEventListener(f,"dblclick",function(b){a instanceof r.b&&new l.a(e.panel.manager,a)});e.handleLayerChanged();
e.registerDisposer(a.layerChanged.add(function(){e.handleLayerChanged()}));return e}t(c,a);B(c,[{key:"update",value:function(){var a=this.layer;this.labelElement.textContent=a.name;this.element.setAttribute("layer-visible",a.visible.toString())}},{key:"handleLayerChanged",value:function(){var a=this.layer.layer;if(a!==this.userLayer)if(this.dropdown&&(this.dropdown.dispose(),Object(d.a)(this.contextMenu.element)),this.userLayer=a){var b=document.createElement("div");this.contextMenu.element.appendChild(b);
this.dropdown=a.makeDropdown(b)}else this.dropdown=void 0;this.contextMenu.disabled=void 0===this.dropdown}},{key:"disposed",value:function(){this.dropdown&&this.dropdown.dispose();this.element.parentElement.removeChild(this.element);F(c.prototype.__proto__||Object.getPrototypeOf(c.prototype),"disposed",this).call(this)}}]);return c}(g.a),A=function(c){function d(c,f,g){q(this,d);var k=n(this,(d.__proto__||Object.getPrototypeOf(d)).call(this));k.display=c;k.manager=f;k.viewerNavigationState=g;k.layerWidgets=
new Map;k.element=document.createElement("div");k.layerUpdateNeeded=!0;k.valueUpdateNeeded=!1;k.layerWidgetInsertionPoint=document.createElement("div");k.positionWidget=k.registerDisposer(new w.b(k.viewerNavigationState.position.value));k.scheduleUpdate=k.registerCancellable(Object(h.a)(function(){return k.update()}));var l=k.element;l.className="neuroglancer-layer-panel";k.registerDisposer(f.layerSelectedValues.changed.add(function(){k.handleLayerValuesChanged()}));k.registerDisposer(f.layerManager.layersChanged.add(function(){k.handleLayersChanged()}));
k.layerWidgetInsertionPoint.style.display="none";k.element.appendChild(k.layerWidgetInsertionPoint);f=k.addButton=document.createElement("div");f.className="neuroglancer-layer-add-button neuroglancer-button";f.title="Add layer";f.textContent="+";g=k.dropZone=document.createElement("div");g.className="neuroglancer-layer-panel-drop-zone";k.registerEventListener(f,"click",function(){k.addLayerMenu()});l.appendChild(f);l.appendChild(g);k.registerDisposer(Object(e.d)(f));l.appendChild(k.positionWidget.element);
var m=function(){k.positionWidget.element.style.display=k.viewerNavigationState.position.link.value===v.d.LINKED?"none":null};k.registerDisposer(k.viewerNavigationState.position.link.changed.add(m));m();k.update();k.registerEventListener(l,"dragleave",function(b){b.relatedTarget&&l.contains(b.relatedTarget)||(b=k.dropLayers,void 0!==b&&(a(b),k.dropLayers=void 0))});k.registerDisposer(b(k,f,void 0));k.registerDisposer(b(k,g,void 0));k.registerDisposer(c.updateStarted.add(function(){return k.updateLayers()}));
return k}t(d,c);B(d,[{key:"disposed",value:function(){this.layerWidgets.forEach(function(a){return a.dispose()});this.layerWidgets=void 0;F(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),"disposed",this).call(this)}},{key:"handleLayersChanged",value:function(){this.layerUpdateNeeded=!0;this.handleLayerValuesChanged()}},{key:"handleLayerValuesChanged",value:function(){this.valueUpdateNeeded||(this.valueUpdateNeeded=!0,this.scheduleUpdate())}},{key:"update",value:function(){this.valueUpdateNeeded=
!1;this.updateLayers();for(var a=this.manager.layerSelectedValues,b=$jscomp.makeIterator(this.layerWidgets),c=b.next();!c.done;c=b.next()){c=$jscomp.makeIterator(c.value);var d=c.next().value;c=c.next().value;var e=d.layer;d="";null!==e&&(e=a.get(e),void 0!==e&&(d=""+e));c.valueElement.textContent=d}}},{key:"updateLayers",value:function(){var a=this;if(this.layerUpdateNeeded){this.layerUpdateNeeded=!1;var b=this.element,c=new Set,d=this.layerWidgetInsertionPoint.nextElementSibling;this.manager.layerManager.managedLayers.forEach(function(e){c.add(e);
var f=a.layerWidgets.get(e),g=a.manager.rootLayers.managedLayers.indexOf(e);void 0===f&&(f=new G(e,a),a.layerWidgets.set(e,f));f.layerNumberElement.textContent=""+(1+g);f.update();e=f.element;e!==d&&b.insertBefore(f.element,d);d=e.nextElementSibling});for(var e=$jscomp.makeIterator(this.layerWidgets),f=e.next();!f.done;f=e.next()){var g=$jscomp.makeIterator(f.value);f=g.next().value;g=g.next().value;c.has(f)||(this.layerWidgets.delete(f),g.dispose())}}}},{key:"addLayerMenu",value:function(){new l.a(this.manager)}},
{key:"layerManager",get:function(){return this.manager.layerManager}}]);return d}(g.a)},function(m,f){},function(m,f,c){f.b=function(c){return Array.prototype.map.call(c,function(c){return("0"+c.toString(16)).slice(-2)}).join("")};f.a=function(c){if(!/^(?:[0-9a-fA-F]{2})*$/.test(c))throw Error("Invalid hex-encoded string");for(var f=c.length/2,m=new Uint8Array(f),a=0;a<f;++a)m[a]=parseInt(c.substr(2*a,2),16);return m}},function(m,f){},function(m,f){},function(m,f,c){function q(a,c){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
return!c||"object"!==typeof c&&"function"!==typeof c?a:c}function n(a,c){if("function"!==typeof c&&null!==c)throw new TypeError("Super expression must either be null or a function, not "+typeof c);a.prototype=Object.create(c&&c.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});c&&(Object.setPrototypeOf?Object.setPrototypeOf(a,c):a.__proto__=c)}c.d(f,"a",function(){return a});m=c(0);var t=function(){function a(a,b){for(var c=0;c<b.length;c++){var f=b[c];f.enumerable=f.enumerable||
!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),a=function(a){function b(a){if(!(this instanceof b))throw new TypeError("Cannot call a class as a function");var c=q(this,(b.__proto__||Object.getPrototypeOf(b)).call(this));c.model=a;c.element=document.createElement("select");c.valueIndexMap=new Map;for(var f=c.element,k=c.valueIndexMap,h=0,g=$jscomp.makeIterator(Object.keys(a.enumType)),d=g.next();!d.done;d=
g.next())if(d=d.value,isNaN(Number(d))){var e=document.createElement("option");e.textContent=e.value=d.toLowerCase();f.appendChild(e);k.set(a.enumType[d],h);++h}c.registerDisposer(a.changed.add(function(){return c.updateView()}));c.registerEventListener(f,"change",function(){return c.updateModel()});c.updateView();return c}n(b,a);t(b,[{key:"updateView",value:function(){this.element.selectedIndex=this.valueIndexMap.get(this.model.value)}},{key:"updateModel",value:function(){this.model.restoreState(this.element.value)}}]);
return b}(m.a)},function(m,f){},function(m,f){},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?
Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return r});var t=c(5);m=c(0);var a=c(4),b=function(){function a(a,b){for(var c=0;c<b.length;c++){var f=b[c];f.enumerable=f.enumerable||!1;f.configurable=!0;"value"in f&&(f.writable=!0);Object.defineProperty(a,f.key,f)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),l=function p(a,b,c){null===a&&(a=Function.prototype);var d=Object.getOwnPropertyDescriptor(a,b);if(void 0===d){if(a=Object.getPrototypeOf(a),null!==a)return p(a,
b,c)}else{if("value"in d)return d.value;b=d.get;return void 0===b?void 0:b.call(c)}},r=function(c){function f(a,b){b=void 0===b?{}:b;if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");var c=q(this,(f.__proto__||Object.getPrototypeOf(f)).call(this));c.model=a;c.element=document.createElement("label");c.inputElement=document.createElement("input");var e=b;b=e.validator;e=e.label;var g=c.element,h=c.inputElement;void 0===b&&(b=a instanceof t.a?a.validator:function(a){return a});
c.validator=b;void 0!==e&&(g.textContent=e);g.appendChild(h);g.className="neuroglancer-number-input";h.type="input";c.registerDisposer(c.model.changed.add(function(){return c.updateView()}));c.registerEventListener(h,"change",function(){return c.updateModel()});c.updateView();return c}n(f,c);b(f,[{key:"updateView",value:function(){this.inputElement.value=""+this.model.value}},{key:"updateModel",value:function(){var a=parseFloat(this.inputElement.value.trim());if(Number.isNaN(a))this.updateView();
else try{a=this.validator(a),this.model.value=a}catch(g){this.updateView()}}},{key:"disposed",value:function(){Object(a.b)(this.element);l(f.prototype.__proto__||Object.getPrototypeOf(f.prototype),"disposed",this).call(this)}}]);return f}(m.a)},function(m,f){},function(m,f,c){f.a=function(){return Object(q.c)(document,"contextmenu",function(c){c.preventDefault()})};f.b=function(){return Object(q.c)(document,"wheel",function(c){c.ctrlKey&&c.preventDefault()})};var q=c(0)},function(m,f,c){f.a=function(a){a.registerEventListener(document,
"copy",function(b){if(!Object(q.a)(b)){var c=Object(t.b)(a.state).value;b.clipboardData.setData("text/plain",JSON.stringify(c,void 0,"  "));b.preventDefault()}})};f.b=function(a){a.registerEventListener(document,"paste",function(b){if(!Object(q.a)(b)){var c=b.clipboardData.getData("text/plain").match(/^[\[\]{}()\s,]*(\d+(?:\.\d+)?)[,\s]+(\d+(?:\.\d+)?)[,\s]+(\d+(?:\.\d+)?)[\[\]{}()\s,]*$/);c=null!==c?n.p.fromValues(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3])):void 0;void 0!==c&&a.navigationState.position.setVoxelCoordinates(c);
b.preventDefault()}})};var q=c(109),n=c(1),t=c(44)},function(m,f,c){function q(){if(void 0===l){var a=new b.a;a.set("keyl","recolor");a.set("keyx","clear-segments");a.set("keys","toggle-show-slices");a.set("keyb","toggle-scale-bar");a.set("keya","toggle-axis-lines");for(var c=1;9>=c;++c)a.set("digit"+c,"toggle-layer-"+c);a.set("keyn","add-layer");a.set("keyh","help");a.set("space","toggle-layout");a.set("shift+space","toggle-layout-alternative");l=a}return l}function n(){void 0===r&&(r=b.a.fromObject({arrowleft:"x-",
arrowright:"x+",arrowup:"y-",arrowdown:"y+",comma:"z-",period:"z+",keyz:"snap","control+equal":"zoom-in","control+shift+equal":"zoom-in","control+minus":"zoom-out",keyr:"rotate-relative-z-",keye:"rotate-relative-z+","shift+arrowdown":"rotate-relative-x-","shift+arrowup":"rotate-relative-x+","shift+arrowleft":"rotate-relative-y-","shift+arrowright":"rotate-relative-y+","at:control+wheel":{action:"zoom-via-wheel",preventDefault:!0},"at:wheel":{action:"z+1-via-wheel",preventDefault:!0},"at:shift+wheel":{action:"z+10-via-wheel",
preventDefault:!0},"at:dblclick0":"select","at:control+mousedown0":"annotate","at:mousedown2":"move-to-mouse-position"},{label:"All Data Panels"}));return r}function t(){void 0===v&&(v=b.a.fromObject({"at:mousedown0":{action:"rotate-via-mouse-drag",stopPropagation:!0},"at:shift+mousedown0":{action:"translate-via-mouse-drag",stopPropagation:!0}},{parents:[[n(),Number.NEGATIVE_INFINITY]]}));return v}function a(){void 0===p&&(p=b.a.fromObject({"at:mousedown0":{action:"translate-via-mouse-drag",stopPropagation:!0},
"at:shift+mousedown0":{action:"rotate-via-mouse-drag",stopPropagation:!0}},{parents:[[n(),Number.NEGATIVE_INFINITY]]}));return p}f.a=function(b){b.global.addParent(q(),Number.NEGATIVE_INFINITY);b.sliceView.addParent(a(),Number.NEGATIVE_INFINITY);b.perspectiveView.addParent(t(),Number.NEGATIVE_INFINITY)};var b=c(15),l,r,v,p},function(m,f,c){function q(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==typeof b&&"function"!==typeof b?
a:b}function n(a,b){if("function"!==typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}});b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}c.d(f,"a",function(){return v});m=c(13);var t=c.n(m),a=c(5);m=c(0);var b=c(2),l=c(44),r=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||
!1;d.configurable=!0;"value"in d&&(d.writable=!0);Object.defineProperty(a,d.key,d)}}return function(b,c,f){c&&a(b.prototype,c);f&&a(b,f);return b}}(),v=function(c){function f(b,c){c=void 0===c?200:c;if(!(this instanceof f))throw new TypeError("Cannot call a class as a function");var d=q(this,(f.__proto__||Object.getPrototypeOf(f)).call(this));d.root=b;d.parseError=new a.b(void 0);d.registerEventListener(window,"hashchange",function(){return d.updateFromUrlHash()});var e=t()(function(){return d.setUrlHash()},
c);d.registerDisposer(b.changed.add(e));d.registerDisposer(function(){return e.cancel()});return d}n(f,c);r(f,[{key:"setUrlHash",value:function(){var a=Object(l.b)(this.root);a.generation!==this.prevStateGeneration&&(this.prevStateGeneration=a.generation,a=Object(b.i)(a.value),a!==this.prevStateString&&(this.prevStateString=a,"{}"===a?history.replaceState(null,"","#"):history.replaceState(null,"","#!"+a)))}},{key:"updateFromUrlHash",value:function(){try{var a=location.href.replace(/^[^#]+/,"");if(""===
a||"#"===a||"#!"===a)a="#!{}";if(a.startsWith("#!+")){a=a.slice(3);a=decodeURI(a);var c=Object(b.h)(a);Object(b.u)(c);this.root.restoreState(c);this.prevStateString=void 0}else if(a.startsWith("#!")){a=a.slice(2);a=decodeURI(a);if(a===this.prevStateString)return;this.prevStateString=a;this.root.reset();var d=Object(b.h)(a);Object(b.u)(d);this.root.restoreState(d)}else throw Error('URL hash is expected to be of the form "#!{...}" or "#!+{...}".');this.parseError.value=void 0}catch(e){this.parseError.value=
e}}}]);return f}(m.a)}]);
